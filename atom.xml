<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>çº³æ–¯å¡å¯`Blog</title>
  <icon>https://www.gravatar.com/avatar/feb67af737a34cba9363ed2d415c9ae9</icon>
  <subtitle>ğŸ˜¶â€ğŸŒ«ï¸</subtitle>
  <link href="https://nmcb666.vip/atom.xml" rel="self"/>
  
  <link href="https://nmcb666.vip/"/>
  <updated>2026-01-26T13:39:36.091Z</updated>
  <id>https://nmcb666.vip/</id>
  
  <author>
    <name>çº³æ–¯å¡å¯</name>
    <email>2843035026@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆä¸ƒï¼‰ æ»‘åŠ¨çª—å£</title>
    <link href="https://nmcb666.vip/posts/aad8ff6.html"/>
    <id>https://nmcb666.vip/posts/aad8ff6.html</id>
    <published>2026-01-26T16:59:21.000Z</published>
    <updated>2026-01-26T13:39:36.091Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„"><a href="#ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„" class="headerlink" title="ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„"></a>ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„</h2><p>éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥æ»‘åŠ¨çª—å£å…·æœ‰å•è°ƒæ€§ï¼ŒåŠ å…¥æ–°æ•°è‚¯å®šä¼šå¯¼è‡´ç´¯åŠ å’Œå˜å¤§ï¼Œå‡å°‘æ•°å­—ä¼šå¯¼è‡´ç´¯åŠ å’Œå˜å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minSubArrayLen</span><span class="params">(<span class="type">int</span> target, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>, sum = <span class="number">0</span>; r &lt; nums.length; r++) &#123;</span><br><span class="line">sum += nums[r];</span><br><span class="line"><span class="keyword">while</span> (sum - nums[l] &gt;= target) &#123;</span><br><span class="line"><span class="comment">// sum : nums[l....r]</span></span><br><span class="line"><span class="comment">// å¦‚æœlä½ç½®çš„æ•°ä»çª—å£å‡ºå»ï¼Œè¿˜èƒ½ç»§ç»­è¾¾æ ‡ï¼Œé‚£å°±å‡ºå»</span></span><br><span class="line">sum -= nums[l++];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum &gt;= target) &#123;</span><br><span class="line">ans = Math.min(ans, r - l + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans == Integer.MAX_VALUE ? <span class="number">0</span> : ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦"><a href="#æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦" class="headerlink" title="æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦"></a>æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦</h2><p>è®°å½•ä¸Šæ¬¡è¿™ä¸ªå­—ç¬¦å‡ºç°çš„ä½ç½®ï¼Œæ¯æ¬¡æ›´æ–°å·¦è¾¹ç•Œï¼Œå°±ç”¨å½“å‰å·¦è¾¹ç•Œè·Ÿï¼ˆä¸Šæ¬¡é‡å¤ä½ç½®+1ï¼‰çš„æœ€å¤§å€¼å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String str)</span> &#123;</span><br><span class="line"><span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length;</span><br><span class="line"><span class="comment">// char -&gt; int -&gt; 0 ~ 255</span></span><br><span class="line"><span class="comment">// æ¯ä¸€ç§å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line"><span class="type">int</span>[] last = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">256</span>];</span><br><span class="line"><span class="comment">// æ‰€æœ‰å­—ç¬¦éƒ½æ²¡æœ‰ä¸Šæ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line">Arrays.fill(last, -<span class="number">1</span>);</span><br><span class="line"><span class="comment">// ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>; r &lt; n; r++) &#123;</span><br><span class="line">l = Math.max(l, last[s[r]] + <span class="number">1</span>);</span><br><span class="line">ans = Math.max(ans, r - l + <span class="number">1</span>);</span><br><span class="line"><span class="comment">// æ›´æ–°å½“å‰å­—ç¬¦ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line">last[s[r]] = r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœ€å°è¦†ç›–å­ä¸²"><a href="#æœ€å°è¦†ç›–å­ä¸²" class="headerlink" title="æœ€å°è¦†ç›–å­ä¸²"></a>æœ€å°è¦†ç›–å­ä¸²</h2><p>æè¿°ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œé•¿åº¦åˆ†åˆ«æ˜¯ m å’Œ nï¼Œè¿”å› s ä¸­çš„ æœ€çŸ­çª—å£ å­ä¸²ï¼Œä½¿å¾—è¯¥å­ä¸²åŒ…å« t ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬é‡å¤å­—ç¬¦ï¼‰ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„å­ä¸²ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² â€œâ€ã€‚</p><p>ç­‰åˆ°æ»¡è¶³è¦†ç›–æ¡ä»¶ä¹‹åï¼Œå†å¼€å§‹è€ƒè™‘ç§»åŠ¨å·¦è¾¹ç•Œã€‚ï¼Œåªæœ‰ç§»åŠ¨å·¦è¾¹ç•Œä¸ä¼šå¯¼è‡´è¦†ç›–æ¡ä»¶å¤±æ•ˆï¼Œæ‰èƒ½ç§»åŠ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">minWindow</span><span class="params">(String str, String tar)</span> &#123;</span><br><span class="line"><span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line"><span class="type">char</span>[] t = tar.toCharArray();</span><br><span class="line"><span class="comment">// æ¯ç§å­—ç¬¦çš„æ¬ å€ºæƒ…å†µ</span></span><br><span class="line"><span class="comment">// cnts[i] = è´Ÿæ•°ï¼Œä»£è¡¨å­—ç¬¦iæœ‰è´Ÿå€º</span></span><br><span class="line"><span class="comment">// cnts[i] = æ­£æ•°ï¼Œä»£è¡¨å­—ç¬¦iæœ‰ç›ˆä½™</span></span><br><span class="line"><span class="type">int</span>[] cnts = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">256</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">char</span> cha : t) &#123;</span><br><span class="line">cnts[cha]--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ€å°è¦†ç›–å­ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"><span class="comment">// ä»å“ªä¸ªä½ç½®å¼€å¤´ï¼Œå‘ç°çš„æœ€å°è¦†ç›–å­ä¸²</span></span><br><span class="line"><span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// æ€»å€ºåŠ¡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">debt</span> <span class="operator">=</span> t.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>; r &lt; s.length; r++) &#123;</span><br><span class="line"><span class="comment">// çª—å£å³è¾¹ç•Œå‘å³ï¼Œç»™å‡ºå­—ç¬¦</span></span><br><span class="line"><span class="keyword">if</span> (cnts[s[r]]++ &lt; <span class="number">0</span>) &#123;</span><br><span class="line">debt--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (debt == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// çª—å£å·¦è¾¹ç•Œå‘å³ï¼Œæ‹¿å›å­—ç¬¦</span></span><br><span class="line"><span class="keyword">while</span> (cnts[s[l]] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">cnts[s[l++]]--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»¥rä½ç½®ç»“å°¾çš„è¾¾æ ‡çª—å£ï¼Œæ›´æ–°ç­”æ¡ˆ</span></span><br><span class="line"><span class="keyword">if</span> (r - l + <span class="number">1</span> &lt; len) &#123;</span><br><span class="line">len = r - l + <span class="number">1</span>;</span><br><span class="line">start = l;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> len == Integer.MAX_VALUE ? <span class="string">&quot;&quot;</span> : str.substring(start, start + len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²"><a href="#æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²" class="headerlink" title="æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²"></a>æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²</h2><p>è§£é‡Šï¼šæœ‰ä¸€ä¸ªåªå«æœ‰ â€˜Qâ€™, â€˜Wâ€™, â€˜Eâ€™, â€˜Râ€™ å››ç§å­—ç¬¦ï¼Œä¸”é•¿åº¦ä¸º n çš„å­—ç¬¦ä¸²ã€‚</p><p>å‡å¦‚åœ¨è¯¥å­—ç¬¦ä¸²ä¸­ï¼Œè¿™å››ä¸ªå­—ç¬¦éƒ½æ°å¥½å‡ºç° n/4 æ¬¡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚</p><p>ç»™ä½ ä¸€ä¸ªè¿™æ ·çš„å­—ç¬¦ä¸² sï¼Œè¯·é€šè¿‡ã€Œæ›¿æ¢ä¸€ä¸ªå­ä¸²ã€çš„æ–¹å¼ï¼Œä½¿åŸå­—ç¬¦ä¸² s å˜æˆä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚</p><p>ä½ å¯ä»¥ç”¨å’Œã€Œå¾…æ›¿æ¢å­ä¸²ã€é•¿åº¦ç›¸åŒçš„ ä»»ä½• å…¶ä»–å­—ç¬¦ä¸²æ¥å®Œæˆæ›¿æ¢ã€‚</p><p>è¯·è¿”å›å¾…æ›¿æ¢å­ä¸²çš„æœ€å°å¯èƒ½é•¿åº¦ã€‚</p><p>å¦‚æœåŸå­—ç¬¦ä¸²è‡ªèº«å°±æ˜¯ä¸€ä¸ªå¹³è¡¡å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› 0ã€‚</p><p>æ€è·¯ï¼šè·Ÿæœ€å°è¦†ç›–å­ä¸²æ€è·¯ä¸€æ ·ã€‚åªéœ€è¦æ‰¾åˆ°å“ªäº›å­—ç¬¦è¶…è¿‡äº†å¤šå°‘ï¼Œæˆ‘ä»¬æ›¿æ¢ä»–å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">balancedString</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">4</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.length();i++)&#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">        cnt[pos]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">debat</span> <span class="operator">=</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(cnt[i] &lt;= n/<span class="number">4</span>)&#123;</span><br><span class="line">            cnt[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            cnt[i] = n/<span class="number">4</span> - cnt[i];</span><br><span class="line">            debat-=cnt[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(debat == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> r=<span class="number">0</span>,l=<span class="number">0</span>;r&lt;s.length();r++)&#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(r);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">if</span>(cnt[pos]++ &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            debat--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(debat == <span class="number">0</span>)&#123;</span><br><span class="line">            c = s.charAt(l);</span><br><span class="line">            pos = c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">            <span class="keyword">while</span>( cnt[pos] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                cnt[pos]--;</span><br><span class="line">                l++;</span><br><span class="line">                c = s.charAt(l);</span><br><span class="line">                pos = c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.min(ans,r-l+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„"><a href="#Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„" class="headerlink" title="Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„"></a>Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„</h2><p>æè¿°ï¼šç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ numså’Œä¸€ä¸ªæ•´æ•° kï¼Œè¿”å› nums ä¸­ ã€Œå¥½å­æ•°ç»„ã€ çš„æ•°ç›®ã€‚</p><p>å¦‚æœ nums çš„æŸä¸ªå­æ•°ç»„ä¸­ä¸åŒæ•´æ•°çš„ä¸ªæ•°æ°å¥½ä¸º kï¼Œåˆ™ç§° nums çš„è¿™ä¸ªè¿ç»­ã€ä¸ä¸€å®šä¸åŒçš„å­æ•°ç»„ä¸º ã€Œå¥½å­æ•°ç»„ ã€ã€‚</p><p>ä¾‹å¦‚ï¼Œ[1,2,3,1,2] ä¸­æœ‰ 3 ä¸ªä¸åŒçš„æ•´æ•°ï¼š1ï¼Œ2ï¼Œä»¥åŠ 3ã€‚<br>å­æ•°ç»„ æ˜¯æ•°ç»„çš„ è¿ç»­ éƒ¨åˆ†ã€‚</p><p>æ€è·¯ï¼šè½¬åŒ–ä¸ºæ±‚ä¸è¶…è¿‡kä¸ªä¸åŒæ•´æ•°é—®é¢˜ï¼Œç”¨k å‡å» k-1 å¯¹åº”çš„ç­”æ¡ˆ å°±æ˜¯åˆšå¥½ä¸ªæ•°ä¸ºkçš„ä¸ªæ•°ã€‚</p><p>å¯¹äºä¸è¶…è¿‡è¿™ä¸ªé—®é¢˜ç”¨æ»‘åŠ¨çª—å£è§£å†³ï¼Œåªè¦ç§ç±»ä¸è¶…è¿‡å°±æ‰©å¤§çª—å£ï¼Œå¦åˆ™ç¼©å°çª—å£ç›´åˆ°ç§ç±»ä¸è¶…è¿‡ã€‚ç„¶åç»Ÿè®¡ä»¥çª—å£å³è¾¹ç»“å°¾çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚å³r-l+1.æ¯æ¬¡ç´¯åŠ è¿™ä¸ªç»“æœå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subarraysWithKDistinct</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸è¶…è¿‡kä¸ªä¸åŒæ•´æ•°</span></span><br><span class="line">    <span class="keyword">return</span> find(nums,k) - find(nums,k-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">20001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[MAX];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">    Arrays.fill(cnt,<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">kinds</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>,r=<span class="number">0</span>;r&lt;nums.length;r++)&#123;</span><br><span class="line">        <span class="comment">// çª—å£å³è¾¹ç•Œå‘å³ï¼Œç»™å‡ºå­—ç¬¦,å¹¶åˆ¤æ–­æ˜¯ä¸æ˜¯æ–°çš„</span></span><br><span class="line">        <span class="keyword">if</span>(++cnt[nums[r]] == <span class="number">1</span>)&#123;</span><br><span class="line">            kinds++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (kinds &gt; k)&#123;</span><br><span class="line">            <span class="comment">// çª—å£å·¦è¾¹ç•Œå‘å³ï¼Œæ‹¿å›å­—ç¬¦ï¼Œå¦‚æœä¸€ä¸ªå­—ç¬¦æ²¡æœ‰äº†ï¼Œåˆ™ç§ç±»å‡ä¸€</span></span><br><span class="line">            <span class="keyword">if</span>( -- cnt[nums[l++]] == <span class="number">0</span>)&#123;</span><br><span class="line">                kinds--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä»¥rä½ç½®ç»“å°¾çš„è¾¾æ ‡çª—å£ï¼Œç´¯åŠ ä¸ªæ•°</span></span><br><span class="line">        sum+= r-l+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&quot;&gt;&lt;a href=&quot;#ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&quot; class=&quot;headerlink&quot; title=&quot;ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&quot;&gt;&lt;/a&gt;ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&lt;/h2&gt;&lt;p&gt;éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥æ»‘åŠ¨çª—å£å…·æœ‰å•</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>èšåˆä¸èšåˆæ ¹</title>
    <link href="https://nmcb666.vip/posts/6758315a.html"/>
    <id>https://nmcb666.vip/posts/6758315a.html</id>
    <published>2026-01-26T01:21:51.000Z</published>
    <updated>2026-01-26T13:39:36.088Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« ç”¨äºå­˜æ”¾æˆ‘åœ¨é˜…è¯»ã€Šæ‚Ÿé“é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹æ—¶ï¼Œå…³äºèšåˆä¸èšåˆæ ¹çš„ç¬”è®°ã€‚</p><p>1.åªèƒ½é€šè¿‡èšåˆæ ¹æ¥ä¿®æ”¹å†…éƒ¨å¯¹è±¡ï¼Œä¸èƒ½ç»•è¿‡èšåˆæ ¹ã€‚</p><p>2.å°±ç®—æƒ³å¼•ç”¨èšåˆæ ¹é‡Œé¢çš„å¯¹è±¡ï¼Œæ¯”å¦‚è®¢å•é‡Œé¢çš„è®¢å•é¡¹åˆ—è¡¨ã€‚é‚£ä¹ˆè®¢å•è¿™ä¸ªèšåˆæ ¹æä¾›çš„getæ–¹æ³•ä¹Ÿå¿…é¡»new ä¸€ä¸ªæ–°åˆ—è¡¨è¿”å›ï¼</p><p>3.åªæœ‰èšåˆæ ¹æœ‰repositoryã€‚ï¼ˆå®ä½“å¯ä»¥æœ‰factoryï¼‰</p><p>4.è®¾è®¡èšåˆæœ€å¥½å°è€Œå…¨ï¼Œæœ€å¥½èƒ½åšåˆ°ä¸€ä¸ªå®ä½“å°±æ˜¯èšåˆã€‚ä½†åšä¸åˆ°ä¹Ÿä¸å¼ºæ±‚ï¼Œèƒ½æ»¡è¶³è¦æ±‚å³å¯ï¼Œä½†åˆ‡è®°ä¸èƒ½è¿‡å¤§ï¼Œä¹Ÿä¸èƒ½å¤ªå°ã€‚</p><p>5.èšåˆæ ¹ä¸èƒ½åœ¨å†…éƒ¨ç›´æ¥å¼•ç”¨å…¶ä»–èšåˆæ ¹ï¼Œåªèƒ½æ ¹æ®å”¯ä¸€idå»æŸ¥è¯¢å¦ä¸€ä¸ªèšåˆæ ¹ï¼Œç”±æœåŠ¡è¿›è¡Œç»Ÿæ’ã€‚</p><p>6.ä¸€ä¸ªäº‹åŠ¡åªå¯¹ä¸€ä¸ªèšåˆæ ¹ä¿å­˜ç”Ÿæ•ˆã€‚</p><p>7.è·¨èšåˆé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå› ä¸ºè§„å®šäº†ç¬¬6æ¡ï¼Œæ‰€ä»¥åœ¨è·¨èšåˆä¸­ç»å¸¸ä¼šå¯¹ä¸åŒçš„è¡¨è¿›è¡Œæ“ä½œï¼‰ï¼Œå…·ä½“å¯ä»¥ç”±é¢†åŸŸäº‹ä»¶å®ç°ã€‚</p><p>8.å¦‚æœèšåˆæ ¹å†…éƒ¨æœ‰ä¸€ä¸ªå®ä½“åˆ—è¡¨ï¼ˆ1ï¼šNå…³ç³»ï¼‰é‚£ä¹ˆå¯ä»¥è€ƒè™‘æŠŠè¿™ä¸ªå®ä½“ä¹Ÿå˜æˆèšåˆæ ¹ï¼ŒåŸèšåˆæ ¹åªä¿ç•™ä»–çš„å”¯ä¸€idåˆ—è¡¨ã€‚å¦‚æœæ˜¯å¤šå¯¹å¤šå…³ç³»ï¼Œå¯ä»¥è€ƒè™‘å†æ–°å»ºä¸€ä¸ªè¡¨ç¤ºå®ƒä»¬ä¸¤ä¸ªå…³ç³»çš„èšåˆæ ¹ã€‚</p><p>9.ä¸ºä»€ä¹ˆè¦æ‹†åˆ†èšåˆæ ¹ï¼Ÿ å› ä¸ºä¸€ä¸ªèšåˆæ ¹ä¿ç•™çš„ä¿¡æ¯è¶Šå¤šï¼Œé‚£ä¹ˆåœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¿å­˜èšåˆæ ¹æ—¶å†²çªçš„æ¦‚ç‡å°±è¶Šå¤§ã€‚æ¯”å¦‚æˆ‘çš„ç”¨æˆ·ä¿ç•™äº†èµ„æºåˆ—è¡¨ï¼Œè€Œä¸”æˆ‘æ˜¯ä¿ç•™äº†å®Œæ•´çš„èµ„æºä¿¡æ¯ï¼Œé‚£ä¹ˆå¯èƒ½èµ„æºçš„ä¿¡æ¯ä¿®æ”¹ï¼ˆåªæ˜¯ä¿®æ”¹äº†èµ„æºçš„æ›´æ–°æ—¥æœŸï¼‰ï¼Œä¹Ÿä¼šå¯¼è‡´æˆ‘çš„ç”¨æˆ·ä¿å­˜å¤±è´¥ï¼ˆä¹è§‚é”ï¼Œæ•°æ®ä¸ä¸€æ ·ï¼‰ã€‚ä½†å¦‚æœæŠŠèµ„æºå•ç‹¬å˜æˆèšåˆæ ¹ï¼Œç”¨æˆ·èšåˆåªä¿ç•™èµ„æºidé‚£ä¹ˆå°†ä¼šé¿å…è¿™ç§æƒ…å†µã€‚åŒæ—¶è€ƒè™‘èµ„æºè·Ÿç”¨æˆ·æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œæ‰€ä»¥æœ€å¥½æœ€æ–°å»ºä¸€ä¸ªè§’è‰²è·Ÿèµ„æºç»‘å®šçš„èšåˆæ ¹ï¼Œè§’è‰²èšåˆæ ¹é‡Œé¢ä¸ä¼šæœ‰ä»»ä½•èµ„æºç›¸å…³çš„ä¿¡æ¯ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™ç¯‡æ–‡ç« ç”¨äºå­˜æ”¾æˆ‘åœ¨é˜…è¯»ã€Šæ‚Ÿé“é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹æ—¶ï¼Œå…³äºèšåˆä¸èšåˆæ ¹çš„ç¬”è®°ã€‚&lt;/p&gt;
&lt;p&gt;1.åªèƒ½é€šè¿‡èšåˆæ ¹æ¥ä¿®æ”¹å†…éƒ¨å¯¹è±¡ï¼Œä¸èƒ½ç»•è¿‡èšåˆæ ¹ã€‚&lt;/p&gt;
&lt;p&gt;2.å°±ç®—æƒ³å¼•ç”¨èšåˆæ ¹é‡Œé¢çš„å¯¹è±¡ï¼Œæ¯”å¦‚è®¢å•é‡Œé¢çš„è®¢å•é¡¹åˆ—è¡¨ã€‚é‚£ä¹ˆè®¢å•è¿™ä¸ªèšåˆæ ¹æä¾›çš„getæ–¹æ³•ä¹Ÿå¿…é¡»new ä¸€ä¸ªæ–°åˆ—è¡¨è¿”å›</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆå…­ï¼‰å‰ç¼€å’Œ</title>
    <link href="https://nmcb666.vip/posts/3fdde4bd.html"/>
    <id>https://nmcb666.vip/posts/3fdde4bd.html</id>
    <published>2026-01-25T17:52:09.000Z</published>
    <updated>2026-01-26T13:39:36.092Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰"><a href="#ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰" class="headerlink" title="ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰"></a>ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰</h1><h2 id="å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦"><a href="#å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦" class="headerlink" title="å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦"></a>å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦</h2><p>æ€è·¯ï¼šå‰ç¼€å’Œ+å“ˆå¸Œè¡¨ã€‚å“ˆå¸Œè¡¨å­˜çš„æ˜¯keyæ˜¯å‰ç¼€å’Œï¼Œvalueæ˜¯å‡ºç°çš„ä½ç½®ã€‚ä½†è¿™ä¸ªä½ç½®å¿…é¡»æ˜¯æœ€æ—©å‡ºç°çš„ï¼Œè€Œä¸”å¿…é¡»é¢„å…ˆæ’å…¥ä¸€æ¡ 0 ,-1è¡¨ç¤º0ä¸€å¼€å§‹å°±æ˜¯ã€‚<br>ç„¶åï¼Œä¾æ¬¡éå†æ•°ç»„è®¡ç®—å‰ç¼€å’Œï¼Œç”¨å½“å‰çš„å‰ç¼€å’Œå‡å»kçš„å€¼å»å“ˆå¸Œè¡¨é‡Œé¢æŸ¥æ‰¾ï¼Œå½“å‰ä½ç½®å‡å»å¯¹åº”çš„ä½ç½®å°±æ˜¯ä»¥å½“å‰ä½ç½®ç»“å°¾çš„æœ€é•¿å­æ•°ç»„é•¿åº¦ã€‚éå†æ±‚æœ€å¤§å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">map.clear();</span><br><span class="line"><span class="comment">// é‡è¦ : 0è¿™ä¸ªå‰ç¼€å’Œï¼Œä¸€ä¸ªæ•°å­—ä¹Ÿæ²¡æœ‰çš„æ—¶å€™ï¼Œå°±å­˜åœ¨äº†</span></span><br><span class="line">map.put(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">sum += arr[i];</span><br><span class="line"><span class="keyword">if</span> (map.containsKey(sum - aim)) &#123;</span><br><span class="line">ans = Math.max(ans, i - map.get(sum - aim));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!map.containsKey(sum)) &#123;</span><br><span class="line">map.put(sum, i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„"><a href="#æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„" class="headerlink" title="æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„"></a>æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„</h2><p>æ€è·¯ï¼š æ„é€ å‰ç¼€å’Œï¼Œä½†æ˜¯å‰ç¼€å’Œè®°å½•æ­£è´Ÿæ•°æ•°é‡çš„å·®å€¼ã€‚æ­£æ•°ä¸º1ï¼Œè´Ÿæ•°ä¸º-1ï¼Œ0ä¸º0.ç„¶åæ¯åˆ°ä¸€ä¸ªä½ç½®é å“ˆå¸Œè¡¨æŸ¥è¯¢è·Ÿè‡ªå·±å‰ç¼€å’Œç›¸åŒçš„ä½ç½®ï¼Œç„¶åæ±‚é•¿åº¦ï¼Œå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compute</span><span class="params">()</span>&#123;</span><br><span class="line">        map.put(<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            cnt+= arr[i] == <span class="number">0</span> ? <span class="number">0</span> : arr[i]&lt;<span class="number">0</span> ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(cnt))&#123;</span><br><span class="line">              ans = Math.max(ans,i-map.get(cnt));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!map.containsKey(cnt))&#123;</span><br><span class="line">                map.put(cnt,i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ-é“¾æ¥ï¼š-https-leetcode-cn-problems-longest-well-performing-interval"><a href="#è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ-é“¾æ¥ï¼š-https-leetcode-cn-problems-longest-well-performing-interval" class="headerlink" title="è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ é“¾æ¥ï¼š https://leetcode.cn/problems/longest-well-performing-interval/"></a>è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ é“¾æ¥ï¼š <a href="https://leetcode.cn/problems/longest-well-performing-interval/">https://leetcode.cn/problems/longest-well-performing-interval/</a></h2><p>æ€è·¯ï¼šè¿˜æ˜¯å‰ç¼€å’Œ+å“ˆå¸Œè¡¨ã€‚è¶…è¿‡æ—¶é•¿+1ï¼Œå°äºæ—¶é•¿-1ã€‚å¦‚æœé‡åˆ°å‰ç¼€å’Œä¸ºæ­£æ•°è¯´æ˜ä»ä¸€å¼€å§‹å°±æ˜¯æ»¡è¶³çš„ï¼Œè¿”å›i+1.å¦‚æœä¸ºè´Ÿæ•°æˆ–è€…0ï¼Œé‚£ä¹ˆå°±æ‰¾å‰ç¼€å’Œ-1çš„ä½ç½®ï¼ˆæ‹‰æ ¼æœ—æ—¥ä¸­å€¼å®šç†ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">longestWPI</span><span class="params">(<span class="type">int</span>[] hours)</span> &#123;</span><br><span class="line"><span class="comment">// æŸä¸ªå‰ç¼€å’Œï¼Œæœ€æ—©å‡ºç°çš„ä½ç½®</span></span><br><span class="line">HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 0è¿™ä¸ªå‰ç¼€å’Œï¼Œæœ€æ—©å‡ºç°åœ¨-1ï¼Œä¸€ä¸ªæ•°ä¹Ÿæ²¡æœ‰çš„æ—¶å€™</span></span><br><span class="line">map.put(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; hours.length; i++) &#123;</span><br><span class="line">sum += hours[i] &gt; <span class="number">8</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (sum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">ans = i + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// sum &lt;= 0</span></span><br><span class="line"><span class="keyword">if</span> (map.containsKey(sum - <span class="number">1</span>)) &#123;</span><br><span class="line">ans = Math.max(ans, i - map.get(sum - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!map.containsKey(sum)) &#123;</span><br><span class="line">map.put(sum, i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤"><a href="#ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤" class="headerlink" title="ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤"></a>ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤</h2><p>æ€è·¯ï¼šä»¥ä½™æ•°ä¸ºå‰ç¼€å’Œï¼Œæ±‚å‡ºæ•´ä¸ªæ•°ç»„å’Œçš„ä½™æ•°modã€‚ç„¶ååœ¨éå†è¿‡ç¨‹ä¸­é‡åˆ°å½“å‰ä½™æ•°curModï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°ä¹‹å‰æœ€åä¸€ä¸ªä½™æ•°ä¸º (curMod + p - mod)%p çš„ä½ç½®ï¼Œç„¶åæ±‚å‡ºé•¿åº¦ã€‚å°±æ˜¯éœ€è¦åœ¨å½“å‰ä½ç½®ç§»é™¤çš„å­æ•°ç»„çš„é•¿åº¦ã€‚éœ€è¦æœ€ååˆ¤æ–­é•¿åº¦æ˜¯ç­‰äºæ•°ç»„é•¿åº¦çš„æ—¶å€™ï¼Œè¿”å›-1.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minSubarray</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> p)</span> &#123;</span><br><span class="line"><span class="comment">// æ•´ä½“ä½™æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">mod = (mod + num) % p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mod == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// key : å‰ç¼€å’Œ%pçš„ä½™æ•°</span></span><br><span class="line"><span class="comment">// value : æœ€æ™šå‡ºç°çš„ä½ç½®</span></span><br><span class="line">HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, cur = <span class="number">0</span>, find; i &lt; nums.length; i++) &#123;</span><br><span class="line"><span class="comment">// 0...iè¿™éƒ¨åˆ†çš„ä½™æ•°</span></span><br><span class="line">cur = (cur + nums[i]) % p;</span><br><span class="line">find = cur &gt;= mod ? (cur - mod) : (cur + p - mod);</span><br><span class="line"><span class="comment">// find = (cur + p - mod) % p;</span></span><br><span class="line"><span class="keyword">if</span> (map.containsKey(find)) &#123;</span><br><span class="line">ans = Math.min(ans, i - map.get(find));</span><br><span class="line">&#125;</span><br><span class="line">map.put(cur, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans == nums.length ? -<span class="number">1</span> : ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸€ç»´å·®åˆ†"><a href="#ä¸€ç»´å·®åˆ†" class="headerlink" title="ä¸€ç»´å·®åˆ†"></a>ä¸€ç»´å·®åˆ†</h1><p>è§£é‡Šï¼šç°åœ¨è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ol><li>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘è¦åœ¨ç»™å®šåŒºé—´åŠ ä¸Šä¸€ä¸ªåŒæ ·çš„æ•°ã€‚å¾ªç¯å¤šæ¬¡</li><li>åŠ å®Œä¹‹åè¿”å›ç»™æˆ‘æ¯ä¸ªä½ç½®ä¸Šçš„å€¼ã€‚</li></ol><p>ä¸€ç»´å·®åˆ†ï¼š</p><ol><li>åŒºé—´å¦‚æœä¸ºl,r è¦åŠ ä¸Ša,é‚£ä¹ˆæˆ‘åœ¨arr[l]+a,arr[r+1]-a.</li><li>ä¹‹åå¯¹è¿™ä¸ªæ•°ç»„æ±‚å‰ç¼€å’Œï¼Œå°±æ˜¯ç»“æœã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bookings</span></span><br><span class="line"><span class="comment">// [1,5,6]</span></span><br><span class="line"><span class="comment">// [2,9,3]</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] corpFlightBookings(<span class="type">int</span>[][] bookings, <span class="type">int</span> n) &#123;</span><br><span class="line"><span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">2</span>];</span><br><span class="line"><span class="comment">// è®¾ç½®å·®åˆ†æ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ“ä½œå¯¹åº”ä¸¤ä¸ªè®¾ç½®</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span>[] book : bookings) &#123;</span><br><span class="line">cnt[book[<span class="number">0</span>]] += book[<span class="number">2</span>];</span><br><span class="line">cnt[book[<span class="number">1</span>] + <span class="number">1</span>] -= book[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŠ å·¥å‰ç¼€å’Œ</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; cnt.length; i++) &#123;</span><br><span class="line">cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">ans[i] = cnt[i + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç­‰å·®å·®åˆ†"><a href="#ç­‰å·®å·®åˆ†" class="headerlink" title="ç­‰å·®å·®åˆ†"></a>ç­‰å·®å·®åˆ†</h1><p>è§£é‡Šï¼š è·Ÿä¸€ç»´å·®åˆ†ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘è¦ä»låˆ°r ä¾æ¬¡åŠ ä¸Šä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°ã€‚</p><p>ç»“è®ºï¼š å‡è®¾è¿™ä¸ªç­‰å·®æ•°åˆ— é¦–é¡¹ä¸º s , å…¬å·®ä¸º d, æœ«é¡¹ä¸º eã€‚é‚£å¯¹arr[l]+=s,arr[l+1]+=d-s,arr[r+1]-=d+e,arr[r+2]+=e; ç„¶åè¿›è¡Œä¸¤æ¬¡å‰ç¼€å’Œå³å¯ã€‚</p><h1 id="äºŒç»´å‰ç¼€å’Œ"><a href="#äºŒç»´å‰ç¼€å’Œ" class="headerlink" title="äºŒç»´å‰ç¼€å’Œ"></a>äºŒç»´å‰ç¼€å’Œ</h1><p>å…¬å¼ï¼š sum[i][j] = sum[i-1][j] + sum[i][j-1] - sum[i-1][j-1] + arr[i][j]<br>è®¡ç®—ä»ï¼ˆa,bï¼‰åˆ° ï¼ˆc,dï¼‰çš„å­çŸ©é˜µçš„å’Œ : sum[c][d] - sum[a-1][d] - sum[c][b-1] + sum[a-1][b-1]</p><h2 id="æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢"><a href="#æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢" class="headerlink" title="æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢"></a>æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢</h2><p>æè¿°ï¼šç»™ä½ ä¸€ä¸ªç”±è‹¥å¹² 0 å’Œ 1 ç»„æˆçš„äºŒç»´ç½‘æ ¼ gridï¼Œè¯·ä½ æ‰¾å‡ºè¾¹ç•Œå…¨éƒ¨ç”± 1 ç»„æˆçš„æœ€å¤§ æ­£æ–¹å½¢ å­ç½‘æ ¼ï¼Œå¹¶è¿”å›è¯¥å­ç½‘æ ¼ä¸­çš„å…ƒç´ æ•°é‡ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› 0ã€‚</p><p>æ ¸å¿ƒæ€è·¯ï¼šæ„é€ å‡ºäºŒç»´å‰ç¼€å’Œï¼Œä¾æ¬¡æšä¸¾ä»¥ï¼ˆi,jï¼‰ä¸ºå·¦ä¸Šè§’çš„æ­£æ–¹å½¢æ˜¯å¦åˆæ³•ã€‚å‡è®¾ä»¥(c,d)ä¸ºå³ä¸‹è§’ã€‚è¿™ä¸ªæ­£æ–¹å½¢çš„å’Œå‡å»ä»¥(i+1,j+1),(c-1,d-1)ä¸ºå¯¹è§’çš„æ­£æ–¹å½¢å’Œçš„å€¼åº”è¯¥ç­‰äºä»–çš„ï¼ˆè¾¹é•¿-1ï¼‰ * 2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">largest1BorderedSquare</span><span class="params">(<span class="type">int</span>[][] g)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> g.length;</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> g[<span class="number">0</span>].length;</span><br><span class="line">build(n, m, g);</span><br><span class="line"><span class="keyword">if</span> (sum(g, <span class="number">0</span>, <span class="number">0</span>, n - <span class="number">1</span>, m - <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰¾åˆ°çš„æœ€å¤§åˆæ³•æ­£æ–¹å½¢çš„è¾¹é•¿</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>; a &lt; n; a++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>; b &lt; m; b++) &#123;</span><br><span class="line"><span class="comment">// (a,b)æ‰€æœ‰å·¦ä¸Šè§’ç‚¹</span></span><br><span class="line"><span class="comment">//     (c,d)æ›´å¤§è¾¹é•¿çš„å³ä¸‹è§’ç‚¹ï¼Œkæ˜¯å½“å‰å°è¯•çš„è¾¹é•¿</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + ans, d = b + ans, k = ans + <span class="number">1</span>; c &lt; n &amp;&amp; d &lt; m; c++, d++, k++) &#123;</span><br><span class="line"><span class="keyword">if</span> (sum(g, a, b, c, d) - sum(g, a + <span class="number">1</span>, b + <span class="number">1</span>, c - <span class="number">1</span>, d - <span class="number">1</span>) == (k - <span class="number">1</span>) &lt;&lt; <span class="number">2</span>) &#123;</span><br><span class="line">ans = k;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans * ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// g : åŸå§‹äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">// æŠŠgå˜æˆåŸå§‹äºŒç»´æ•°ç»„çš„å‰ç¼€å’Œæ•°ç»„sumï¼Œå¤ç”¨è‡ªå·±</span></span><br><span class="line"><span class="comment">// ä¸èƒ½è¡¥0è¡Œï¼Œ0åˆ—ï¼Œéƒ½æ˜¯0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span>[][] g)</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">g[i][j] += get(g, i, j - <span class="number">1</span>) + get(g, i - <span class="number">1</span>, j) - get(g, i - <span class="number">1</span>, j - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span>[][] g, <span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a &gt; c ? <span class="number">0</span> : (g[c][d] - get(g, c, b - <span class="number">1</span>) - get(g, a - <span class="number">1</span>, d) + get(g, a - <span class="number">1</span>, b - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span>[][] g, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> (i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span>) ? <span class="number">0</span> : g[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="äºŒç»´å·®åˆ†"><a href="#äºŒç»´å·®åˆ†" class="headerlink" title="äºŒç»´å·®åˆ†"></a>äºŒç»´å·®åˆ†</h1><p>è·Ÿä¸€ç»´å·®åˆ†å·®ä¸å¤šè¿™é‡Œç›´æ¥ç»™å…¬å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒç»´å·®åˆ†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">diff[a][b] += k;</span><br><span class="line">diff[c + <span class="number">1</span>][b] -= k;</span><br><span class="line">diff[a][d + <span class="number">1</span>] -= k;</span><br><span class="line">diff[c + <span class="number">1</span>][d + <span class="number">1</span>] += k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&quot;&gt;&lt;a href=&quot;#ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&quot;&gt;&lt;/a&gt;ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦&quot;&gt;&lt;a </summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Raftä¸Paxos</title>
    <link href="https://nmcb666.vip/posts/b1c1c3b5.html"/>
    <id>https://nmcb666.vip/posts/b1c1c3b5.html</id>
    <published>2026-01-25T14:05:03.000Z</published>
    <updated>2026-01-26T13:39:36.090Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ"><a href="#æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ" class="headerlink" title="[æ·±åº¦å¯¹æ¯”] åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos ä¸ Raftï¼Œä¸ºä½• Raft æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ"></a>[æ·±åº¦å¯¹æ¯”] åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos ä¸ Raftï¼Œä¸ºä½• Raft æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ</h1><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµ©ç€šå®‡å®™ä¸­ï¼Œ<strong>â€œå…±è¯†ï¼ˆConsensusï¼‰â€</strong> æ˜¯æœ€æ ¸å¿ƒçš„éš¾é¢˜ä¹‹ä¸€ã€‚å¦‚ä½•è®©ä¸€å †å¯èƒ½éšæ—¶å®•æœºã€ç½‘ç»œå»¶è¿Ÿçš„æœºå™¨å¯¹æŸä¸ªå€¼è¾¾æˆä¸€è‡´ï¼Ÿè¿™ä¸ªé—®é¢˜å›°æ‰°äº†è®¡ç®—æœºç§‘å­¦å®¶å‡ åå¹´ã€‚</p><p>åœ¨è¿™ä¸ªé¢†åŸŸï¼Œæœ‰ä¸¤ä½ç»å¯¹çš„ä¸»è§’ï¼šä¸€ä¸ªæ˜¯ç†è®ºç•Œçš„â€œç¥â€ <strong>Paxos</strong>ï¼Œå¦ä¸€ä¸ªæ˜¯å·¥ç¨‹ç•Œçš„â€œæ•‘ä¸–ä¸»â€ <strong>Raft</strong>ã€‚</p><p>å¾ˆå¤šå¼€å‘è€…éƒ½çŸ¥é“ï¼Œç°åœ¨ä¸»æµçš„åˆ†å¸ƒå¼ç»„ä»¶ï¼ˆå¦‚ Etcd, Consul, TiKV, Kafkaçš„æ–°ç‰ˆæœ¬ï¼‰å¤§å¤šé€‰æ‹©äº† Raftã€‚é‚£ä¹ˆï¼ŒPaxos åˆ°åº•è¾“åœ¨å“ªé‡Œï¼ŸRaft åˆä¸ºä½•å¦‚æ­¤å®¹æ˜“å®ç°ï¼Ÿæœ¬æ–‡å°†å¸¦ä½ æ·±å…¥å‰–æä¸¤è€…çš„åŒºåˆ«ä¸ä¼˜åŠ£ã€‚</p><hr><h2 id="ä¸€ã€-æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚"><a href="#ä¸€ã€-æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚" class="headerlink" title="ä¸€ã€ æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚"></a>ä¸€ã€ æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚</h2><p>è¦ç†è§£å®ƒä»¬çš„åŒºåˆ«ï¼Œé¦–å…ˆè¦çœ‹å®ƒä»¬è¯ç”Ÿçš„åˆè¡·ï¼š</p><ul><li><strong>Paxos (Leslie Lamport, 1990)</strong>ï¼šæ—¨åœ¨å‘ç°å…±è¯†é—®é¢˜çš„<strong>æ•°å­¦è§„å¾‹</strong>ã€‚å®ƒä»æ•°å­¦è§’åº¦è¯æ˜äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¾¾æˆä¸€è‡´çš„å……è¦æ¡ä»¶ã€‚å®ƒè¿½æ±‚çš„æ˜¯ç†è®ºçš„å®Œå¤‡æ€§å’Œä¸€èˆ¬æ€§ã€‚</li><li><strong>Raft (Diego Ongaro &amp; John Ousterhout, 2013)</strong>ï¼šæ—¨åœ¨æä¾›ä¸€ä¸ª<strong>å¯ç†è§£ï¼ˆUnderstandableï¼‰</strong>ä¸”<strong>æ˜“äºå®ç°</strong>çš„ç®—æ³•ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡éå¸¸æ˜ç¡®ï¼š<strong>å°±æ˜¯ä¸ºäº†è§£å†³ Paxos å¤ªéš¾æ‡‚ã€å¤ªéš¾å®ç°çš„é—®é¢˜</strong>ã€‚</li></ul><p>å¦‚æœæŠŠ Paxos æ¯”ä½œé‡å­åŠ›å­¦ï¼ˆè§£é‡Šäº†ä¸–ç•Œçš„æœ¬è´¨ï¼Œä½†å¾ˆéš¾ç›´æ¥ç”¨æ¥é€ æ¡¥ï¼‰ï¼Œé‚£ä¹ˆ Raft å°±æ˜¯ç‰›é¡¿åŠ›å­¦ï¼ˆåœ¨ç‰¹å®šçº¦æŸä¸‹ï¼Œç»™äº†ä½ ä¸€å¥—é€ æ¡¥çš„æ ‡å‡†å…¬å¼ï¼‰ã€‚</p><hr><h2 id="äºŒã€-ä¸ºä»€ä¹ˆ-Raft-æ›´å®¹æ˜“å®ç°ï¼Ÿ"><a href="#äºŒã€-ä¸ºä»€ä¹ˆ-Raft-æ›´å®¹æ˜“å®ç°ï¼Ÿ" class="headerlink" title="äºŒã€ ä¸ºä»€ä¹ˆ Raft æ›´å®¹æ˜“å®ç°ï¼Ÿ"></a>äºŒã€ ä¸ºä»€ä¹ˆ Raft æ›´å®¹æ˜“å®ç°ï¼Ÿ</h2><p>è¿™æ˜¯ Raft èƒ½å¤Ÿåæ¥å±…ä¸Šçš„æœ€å¤§åŸå› ã€‚Raft å¹¶ä¸æ˜¯åœ¨ç†è®ºä¸Šè¶…è¶Šäº† Paxosï¼Œè€Œæ˜¯é€šè¿‡<strong>å¢åŠ çº¦æŸ</strong>å’Œ<strong>åˆ†è§£é—®é¢˜</strong>ï¼Œæå¤§åœ°é™ä½äº†å·¥ç¨‹è½åœ°çš„å¤æ‚åº¦ã€‚</p><h3 id="1-é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰"><a href="#1-é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰" class="headerlink" title="1. é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰"></a>1. é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰</h3><p>Paxos å°†é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€ç¡®è®¤æäº¤ç­‰é€»è¾‘æ··æ‚åœ¨ä¸€èµ·ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚<br>Raft å¼ºåˆ¶å°†å…±è¯†é—®é¢˜æ‹†è§£ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„å­æ¨¡å—ï¼š</p><ul><li><strong>Leader Electionï¼ˆé€‰ä¸»ï¼‰</strong>ï¼šå…ˆé€‰å‡ºè€å¤§ï¼Œåˆ«çš„ä»€ä¹ˆéƒ½ä¸å¹²ã€‚</li><li><strong>Log Replicationï¼ˆæ—¥å¿—å¤åˆ¶ï¼‰</strong>ï¼šè€å¤§è´Ÿè´£åŒæ­¥æ•°æ®ï¼ŒFollower è´Ÿè´£æ¥æ”¶ã€‚</li><li><strong>Safetyï¼ˆå®‰å…¨æ€§ï¼‰</strong>ï¼šç¡®ä¿æ•°æ®ä¸€æ—¦æäº¤ï¼Œå°±æ°¸è¿œå­˜åœ¨ã€‚</li></ul><p>è¿™ç§è§£è€¦ä½¿å¾—å¼€å‘è€…å¯ä»¥ç‹¬ç«‹ç¼–å†™å’Œæµ‹è¯•æ¯ä¸ªæ¨¡å—ã€‚</p><h3 id="2-å¼º-Leader-æ¨¡å‹ï¼ˆStrong-Leaderï¼‰"><a href="#2-å¼º-Leader-æ¨¡å‹ï¼ˆStrong-Leaderï¼‰" class="headerlink" title="2. å¼º Leader æ¨¡å‹ï¼ˆStrong Leaderï¼‰"></a>2. å¼º Leader æ¨¡å‹ï¼ˆStrong Leaderï¼‰</h3><p>è¿™æ˜¯ Raft ç®€åŒ–çš„æ€æ‰‹é”ã€‚</p><ul><li><strong>Paxos</strong>ï¼šå…è®¸æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶å‘èµ·ææ¡ˆï¼ˆè™½ç„¶ Multi-Paxos ä¹Ÿä¼šä¼˜åŒ–ä¸ºå• Leaderï¼Œä½†åè®®æœ¬èº«å…è®¸å¹¶å‘ï¼‰ã€‚è¿™å¯¼è‡´éœ€è¦å¤„ç†æå…¶å¤æ‚çš„â€œå†²çªè§£å†³â€å’Œâ€œæ—¥å¿—ä¹±åºâ€é—®é¢˜ã€‚</li><li><strong>Raft</strong>ï¼šæ˜¯<strong>ç‹¬è£</strong>çš„ã€‚æ—¥å¿—æµå‘åªèƒ½æ˜¯ <code>Leader -&gt; Follower</code>ã€‚Follower ç»å¯¹ä¸ä¼šä¿®æ”¹ Leader çš„æ—¥å¿—ï¼ŒLeader ä¹Ÿæ°¸è¿œä¸ä¼šè¦†ç›–è‡ªå·±çš„æ—¥å¿—ã€‚è¿™ç§å•å‘æ•°æ®æµæ¶ˆé™¤äº†å¤§é‡è¾¹ç¼˜çŠ¶æ€ã€‚</li></ul><h3 id="3-å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog-Continuityï¼‰"><a href="#3-å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog-Continuityï¼‰" class="headerlink" title="3. å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog Continuityï¼‰"></a>3. å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog Continuityï¼‰</h3><ul><li><strong>Paxos</strong>ï¼šå…è®¸æ—¥å¿—æœ‰â€œç©ºæ´â€ã€‚æ¯”å¦‚èŠ‚ç‚¹ A ç¡®è®¤äº†ç¬¬ 1ã€2ã€5 å·æ—¥å¿—ï¼Œç¼ºäº† 3 å’Œ 4ã€‚Paxos å…è®¸è¿™ç§æƒ…å†µå­˜åœ¨ï¼Œåç»­å†é€šè¿‡å¤æ‚çš„é€»è¾‘æŠŠç©ºæ´è¡¥é½ã€‚</li><li><strong>Raft</strong>ï¼š<strong>ä¸å…è®¸ç©ºæ´</strong>ã€‚Follower å¿…é¡»æŒ‰é¡ºåºæ¥æ”¶æ—¥å¿—ã€‚å¦‚æœ Follower ç¼ºäº†ç¬¬ 4 å·æ—¥å¿—ï¼ŒLeader ç»ä¸ä¼šå‘ç¬¬ 5 å·ç»™å®ƒï¼Œè€Œæ˜¯ä¼šå¼ºåˆ¶å›é€€ï¼ˆåˆ©ç”¨ <code>PrevLogIndex</code> æ£€æŸ¥ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€è‡´çš„ç‚¹ï¼Œç„¶åè¦†ç›–åŒæ­¥ã€‚è¿™è®©çŠ¶æ€æœºçš„å®ç°å˜å¾—æå…¶ç®€å•â€”â€”æŒ‰é¡ºåºæ‰§è¡Œå³å¯ã€‚</li></ul><h3 id="4-é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰"><a href="#4-é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰" class="headerlink" title="4. é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰"></a>4. é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰</h3><p>åœ¨ Paxos ä¸­ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½å¯èƒ½æˆä¸º Leaderï¼Œå“ªæ€•å®ƒçš„æ•°æ®å¾ˆæ—§ã€‚ä¸Šä½åï¼Œå®ƒéœ€è¦å…ˆå­¦ä¹ å†å²æ•°æ®ï¼Œè¡¥å…¨è‡ªå·±çš„çŸ¥è¯†ï¼Œç„¶åæ‰èƒ½å¼€å§‹å·¥ä½œã€‚<br>Raft è§„å®šï¼š<strong>åªæœ‰æ‹¥æœ‰æ‰€æœ‰å·²æäº¤æ—¥å¿—çš„èŠ‚ç‚¹ï¼Œæ‰æœ‰èµ„æ ¼å½“é€‰ Leaderã€‚</strong> è¿™æ„å‘³ç€æ–° Leader ä¸Šä»»çš„ç¬¬ä¸€åˆ»èµ·ï¼Œå®ƒå°±ä¸éœ€è¦å»é—®åˆ«äººâ€œæˆ‘æ˜¯ä¸æ˜¯ç¼ºæ•°æ®äº†â€ï¼Œç›´æ¥æ¥å—æ–°å†™å…¥å³å¯ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Raft ä¹‹æ‰€ä»¥å®¹æ˜“å®ç°ï¼Œæ˜¯å› ä¸ºå®ƒå‰¥å¤ºäº†èŠ‚ç‚¹çš„è‡ªç”±ï¼š</p><p>ä¸å‡†ä¹±åºæäº¤ï¼ˆæ¶ˆç­äº†å¤æ‚çš„å¹¶å‘åˆå¹¶é€»è¾‘ï¼‰ã€‚</p><p>ä¸å‡† Follower è´¨ç–‘ Leaderï¼ˆæ¶ˆç­äº†åŒå‘åŒæ­¥é€»è¾‘ï¼‰ã€‚</p><p>ä¸å‡†æ—§èŠ‚ç‚¹å½“ Leaderï¼ˆæ¶ˆç­äº† Leader ä¸Šä½åçš„è¡¥æ•°æ®é€»è¾‘ï¼‰ã€‚</p><hr><h2 id="ä¸‰ã€-Paxos-ä¸-Raft-çš„ä¼˜ç¼ºç‚¹æƒè¡¡"><a href="#ä¸‰ã€-Paxos-ä¸-Raft-çš„ä¼˜ç¼ºç‚¹æƒè¡¡" class="headerlink" title="ä¸‰ã€ Paxos ä¸ Raft çš„ä¼˜ç¼ºç‚¹æƒè¡¡"></a>ä¸‰ã€ Paxos ä¸ Raft çš„ä¼˜ç¼ºç‚¹æƒè¡¡</h2><p>æ—¢ç„¶ Raft è¿™ä¹ˆå¥½ï¼ŒPaxos æ˜¯ä¸æ˜¯ä¸€æ— æ˜¯å¤„ï¼Ÿå¹¶éå¦‚æ­¤ã€‚ä¸¤è€…åœ¨ä¸åŒçš„ç»´åº¦å„æœ‰åƒç§‹ã€‚</p><h3 id="1-Paxos-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Raftï¼‰"><a href="#1-Paxos-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Raftï¼‰" class="headerlink" title="1. Paxos çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Raftï¼‰"></a>1. Paxos çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Raftï¼‰</h3><ul><li><strong>ç†è®ºçš„æè‡´ä¸é€šç”¨æ€§</strong>ï¼šPaxos æ˜¯å…±è¯†ç®—æ³•çš„åŸºçŸ³ã€‚Google çš„ Chubbyã€Spanner åº•å±‚ä¾ç„¶æ˜¯ Paxos çš„å˜ç§ã€‚äº‹å®ä¸Šï¼ŒRaft å¯ä»¥è¢«çœ‹ä½œæ˜¯ Paxos çš„ä¸€ä¸ªç‰¹å®šçº¦æŸä¸‹çš„å­é›†ã€‚</li><li><strong>æ›´é«˜çš„å†™å…¥å¹¶å‘æ½œåŠ›</strong>ï¼šç”±äº Paxos å…è®¸æ—¥å¿—ä¹±åºç¡®è®¤ï¼ˆOut-of-Order Commitï¼‰ï¼Œåœ¨ä¸ä¾èµ–å¼ºé¡ºåºçš„åœºæ™¯ä¸‹ï¼ˆæˆ–è€…ä½¿ç”¨ EPaxos ç­‰å˜ç§ï¼‰ï¼Œå®ƒçš„ç†è®ºååé‡å¯ä»¥é«˜äº Raftã€‚Raft å¿…é¡»ä¸€ä¸ªæ¥ä¸€ä¸ªé¡ºåºæäº¤ï¼Œå­˜åœ¨é˜Ÿå¤´é˜»å¡ï¼ˆHead-of-Line Blockingï¼‰é£é™©ã€‚</li><li><strong>æ—  Leader çš„ç”Ÿå­˜èƒ½åŠ›</strong>ï¼šBasic Paxos ä¸éœ€è¦ Leaderï¼Œåœ¨ç½‘ç»œæå…¶ä¸ç¨³å®šã€æ— æ³•ç»´æŒç¨³å®š Leader çš„æç«¯ç¯å¢ƒä¸‹ï¼ŒBasic Paxos ä¾ç„¶èƒ½å·¥ä½œï¼Œè€Œ Raft ä¼šé™·å…¥åå¤é€‰ä¸»çš„æ­»å¾ªç¯ï¼ˆä¸å¯ç”¨ï¼‰ã€‚</li></ul><h3 id="2-Raft-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Paxosï¼‰"><a href="#2-Raft-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Paxosï¼‰" class="headerlink" title="2. Raft çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Paxosï¼‰"></a>2. Raft çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Paxosï¼‰</h3><ul><li><strong>å¯ç†è§£æ€§ï¼ˆUnderstandabilityï¼‰</strong>ï¼šè¿™æ˜¯ Raft çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚ä¸€ä¸ªæ™®é€šçš„å·¥ç¨‹å¸ˆé˜…è¯» Raft è®ºæ–‡ä¸¤éå¯èƒ½å°±èƒ½å†™å‡ºåŸå‹ï¼›è€Œé˜…è¯» Paxos è®ºæ–‡åéå¯èƒ½è¿˜æ˜¯ä¸€å¤´é›¾æ°´ã€‚</li><li><strong>å·¥ç¨‹ç»†èŠ‚å®Œå¤‡</strong>ï¼šPaxos è®ºæ–‡åªè®²äº†å¦‚ä½•è¾¾æˆå…±è¯†ï¼Œæ²¡è®²å¦‚ä½•å¢åˆ èŠ‚ç‚¹ã€å¦‚ä½•å‹ç¼©æ—¥å¿—ï¼ˆSnapshotï¼‰ã€‚Raft å¯¹è¿™äº›å·¥ç¨‹ç—›ç‚¹éƒ½ç»™å‡ºäº†æ ‡å‡†è§£å†³æ–¹æ¡ˆï¼ˆå¦‚ Joint Consensus æˆå‘˜å˜æ›´ç®—æ³•ï¼‰ã€‚</li><li><strong>è°ƒè¯•ä¸æ’é”™</strong>ï¼šç”±äº Raft çš„çŠ¶æ€è½¬æ¢è·¯å¾„éå¸¸æ¸…æ™°ï¼ˆä¸”æœ‰é™ï¼‰ï¼Œå½“ç³»ç»Ÿå‡ºç° Bug æ—¶ï¼Œæ›´å®¹æ˜“å¤ç°å’Œå®šä½ã€‚</li></ul><hr><h2 id="å››ã€-æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#å››ã€-æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="å››ã€ æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>å››ã€ æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ</h2><div class="table-container"><table><thead><tr><th style="text-align:left">ç‰¹æ€§</th><th style="text-align:left">Paxos (Multi-Paxos)</th><th style="text-align:left">Raft</th></tr></thead><tbody><tr><td style="text-align:left"><strong>è®¾è®¡ç›®æ ‡</strong></td><td style="text-align:left">ç†è®ºè¯æ˜</td><td style="text-align:left">å·¥ç¨‹å®ç°ã€å¯ç†è§£æ€§</td></tr><tr><td style="text-align:left"><strong>æ—¥å¿—ç»“æ„</strong></td><td style="text-align:left">å…è®¸ç©ºæ´ï¼Œå¹¶å‘ç¡®è®¤</td><td style="text-align:left">å¿…é¡»è¿ç»­ï¼Œé¡ºåºç¡®è®¤</td></tr><tr><td style="text-align:left"><strong>æ•°æ®æµå‘</strong></td><td style="text-align:left">å¤šç‚¹å¯èƒ½ï¼ˆå¤æ‚ï¼‰</td><td style="text-align:left">Leader å•å‘æµå‘ Follower</td></tr><tr><td style="text-align:left"><strong>å®ç°éš¾åº¦</strong></td><td style="text-align:left">æé«˜ï¼ˆå®¹æ˜“å†™å‡º Bugï¼‰</td><td style="text-align:left">ä¸­ç­‰ï¼ˆæœ‰æ ‡å‡†å‚è€ƒï¼‰</td></tr><tr><td style="text-align:left"><strong>å·¥ä¸šç•Œç°çŠ¶</strong></td><td style="text-align:left">Google Spanner, Zookeeper (ZAB ç±»ä¼¼)</td><td style="text-align:left">Etcd, Consul, TiKV, CockroachDB</td></tr></tbody></table></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ&quot;&gt;&lt;a href=&quot;#æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;[æ·±</summary>
      
    
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://nmcb666.vip/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆäº”ï¼‰ å‰ç¼€æ ‘</title>
    <link href="https://nmcb666.vip/posts/38c6bd07.html"/>
    <id>https://nmcb666.vip/posts/38c6bd07.html</id>
    <published>2026-01-24T16:36:58.000Z</published>
    <updated>2026-01-26T13:39:36.092Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰ç¼€æ ‘ç»“æ„"><a href="#å‰ç¼€æ ‘ç»“æ„" class="headerlink" title="å‰ç¼€æ ‘ç»“æ„"></a>å‰ç¼€æ ‘ç»“æ„</h2><p>Trieæ ‘ï¼Œå³å­—å…¸æ ‘ï¼Œåˆç§°å•è¯æŸ¥æ‰¾æ ‘æˆ–é”®æ ‘ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘çš„å˜ç§ã€‚å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡å’Œæ’åºå¤§é‡çš„å­—ç¬¦ä¸²ï¼ˆä½†ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼‰ï¼Œæ‰€ä»¥ç»å¸¸è¢«æœç´¢å¼•æ“ç³»ç»Ÿç”¨äºæ–‡æœ¬è¯é¢‘ç»Ÿè®¡ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥å‡å°‘æŸ¥è¯¢æ—¶é—´ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒã€‚</p><p>å‰ç¼€æ ‘çš„åŸºæœ¬æ“ä½œ</p><p>æ’å…¥å­—ç¬¦ä¸²ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡æ’å…¥å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦ã€‚å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°èŠ‚ç‚¹ã€‚æœ€åä¸€ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸ºå­—ç¬¦ä¸²çš„ç»“æŸã€‚</p><p>åˆ é™¤å­—ç¬¦ä¸²ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å‡å°‘è·¯å¾„ä¸ŠèŠ‚ç‚¹çš„è®¡æ•°ã€‚å¦‚æœæŸèŠ‚ç‚¹çš„è®¡æ•°ä¸ºé›¶ï¼Œåˆ™åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p><p>æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°ï¼šæ²¿è·¯å¾„éå†å­—ç¬¦ä¸²ï¼Œè‹¥è·¯å¾„å®Œæ•´ä¸”ç»“æŸèŠ‚ç‚¹å­˜åœ¨ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²çš„è®¡æ•°ã€‚</p><p>æŸ¥è¯¢å‰ç¼€æ•°é‡ï¼šæ²¿è·¯å¾„éå†å‰ç¼€ï¼Œè‹¥è·¯å¾„å®Œæ•´ï¼Œåˆ™è¿”å›æœ€åèŠ‚ç‚¹çš„é€šè¿‡è®¡æ•°ã€‚</p><h3 id="èŠ‚ç‚¹çš„ç»“æ„"><a href="#èŠ‚ç‚¹çš„ç»“æ„" class="headerlink" title="èŠ‚ç‚¹çš„ç»“æ„"></a>èŠ‚ç‚¹çš„ç»“æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">class</span> <span class="title class_">TrieNode</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> pass;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> end;</span><br><span class="line"><span class="keyword">public</span> TrieNode[] nexts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TrieNode</span><span class="params">()</span> &#123;</span><br><span class="line">pass = <span class="number">0</span>;</span><br><span class="line">end = <span class="number">0</span>;</span><br><span class="line">nexts = <span class="keyword">new</span> <span class="title class_">TrieNode</span>[<span class="number">26</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥å­—ç¬¦ä¸²"><a href="#æ’å…¥å­—ç¬¦ä¸²" class="headerlink" title="æ’å…¥å­—ç¬¦ä¸²"></a>æ’å…¥å­—ç¬¦ä¸²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">node.pass++;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123; <span class="comment">// ä»å·¦å¾€å³éå†å­—ç¬¦</span></span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>; <span class="comment">// ç”±å­—ç¬¦ï¼Œå¯¹åº”æˆèµ°å‘å“ªæ¡è·¯</span></span><br><span class="line"><span class="keyword">if</span> (node.nexts[path] == <span class="literal">null</span>) &#123;</span><br><span class="line">node.nexts[path] = <span class="keyword">new</span> <span class="title class_">TrieNode</span>();</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">node.pass++;</span><br><span class="line">&#125;</span><br><span class="line">node.end++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°"><a href="#æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°" class="headerlink" title="æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°"></a>æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// æŸ¥è¯¢å‰ç¼€æ ‘é‡Œï¼Œwordå•è¯å‡ºç°äº†å‡ æ¬¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countWordsEqualTo</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (node.nexts[path] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> node.end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢å‰ç¼€æ•°é‡"><a href="#æŸ¥è¯¢å‰ç¼€æ•°é‡" class="headerlink" title="æŸ¥è¯¢å‰ç¼€æ•°é‡"></a>æŸ¥è¯¢å‰ç¼€æ•°é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">// æŸ¥è¯¢å‰ç¼€æ ‘é‡Œï¼Œæœ‰å¤šå°‘å•è¯ä»¥preåšå‰ç¼€</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countWordsStartingWith</span><span class="params">(String pre)</span> &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; pre.length(); i++) &#123;</span><br><span class="line">path = pre.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (node.nexts[path] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> node.pass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å­—ç¬¦ä¸²"><a href="#åˆ é™¤å­—ç¬¦ä¸²" class="headerlink" title="åˆ é™¤å­—ç¬¦ä¸²"></a>åˆ é™¤å­—ç¬¦ä¸²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// å¦‚æœä¹‹å‰wordæ’å…¥è¿‡å‰ç¼€æ ‘ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ æ‰ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">// å¦‚æœä¹‹å‰wordæ²¡æœ‰æ’å…¥è¿‡å‰ç¼€æ ‘ï¼Œé‚£ä¹ˆä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">erase</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (countWordsEqualTo(word) &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">node.pass--;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (--node.nexts[path].pass == <span class="number">0</span>) &#123;</span><br><span class="line">node.nexts[path] = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">&#125;</span><br><span class="line">node.end--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘"><a href="#ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘" class="headerlink" title="ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘"></a>ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å¦‚æœå°†æ¥å¢åŠ äº†æ•°æ®é‡ï¼Œå°±æ”¹å¤§è¿™ä¸ªå€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">150001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][] tree = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN][<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] end = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] pass = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">pass[cur]++;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = ++cnt;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">pass[cur]++;</span><br><span class="line">&#125;</span><br><span class="line">end[cur]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> end[cur];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">prefixNumber</span><span class="params">(String pre)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; pre.length(); i++) &#123;</span><br><span class="line">path = pre.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pass[cur];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (search(word) &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">// ä¸‹é¢è¿™ä¸€è¡Œä»£ç ï¼Œè®²è¯¾çš„æ—¶å€™æ²¡åŠ </span></span><br><span class="line"><span class="comment">// æœ¬é¢˜ä¸ä¼šç”¨åˆ°pass[1]çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åŠ ä¸åŠ éƒ½å¯ä»¥ï¼Œä¸è¿‡æ­£ç¡®çš„å†™æ³•æ˜¯åŠ ä¸Š</span></span><br><span class="line">pass[cur]--;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (--pass[tree[cur][path]] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line">end[cur]--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">Arrays.fill(tree[i], <span class="number">0</span>);</span><br><span class="line">end[i] = <span class="number">0</span>;</span><br><span class="line">pass[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›¸å…³é¢˜ç›®"><a href="#ç›¸å…³é¢˜ç›®" class="headerlink" title="ç›¸å…³é¢˜ç›®"></a>ç›¸å…³é¢˜ç›®</h2><h3 id="æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼"><a href="#æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼" class="headerlink" title="æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼"></a>æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼</h3><p>æ€è·¯ï¼šæˆ‘ä»¬ä½¿ç”¨æ¯ä¸€ä¸ªæ•°ï¼Œæ ¹æ®ä»–çš„æ¯ä¸€ä½å»æ„å»ºä¸€ä¸ªå‰ç¼€æ ‘ã€‚ç„¶åä¾æ¬¡éå†æ¯ä¸€ä¸ªæ•°ï¼Œä»æœ€é«˜ä½å¼€å§‹éå†ï¼Œæˆ‘å¸Œæœ›æ‰¾åˆ°è·Ÿæˆ‘ä¸ä¸€æ ·çš„ä½ï¼Œäºæ˜¯æˆ‘åœ¨å‰ç¼€æ ‘é‡Œé¢æŸ¥æ‰¾ã€‚å¦‚æœå­˜åœ¨é‚£ä¹ˆæŠŠè¿™ä¸ªä½ç½®å˜æˆ1åŠ å…¥ç­”æ¡ˆï¼Œå¦‚æœä¸å­˜åœ¨é‚£ä¹ˆæŠŠè¿™ä¸ªä½ç½®å˜æˆ0åŠ å…¥ç­”æ¡ˆã€‚ç„¶åè·³åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ ‘å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å‰ç¼€æ ‘çš„åšæ³•</span></span><br><span class="line"><span class="comment">// å¥½æƒ³</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">findMaximumXOR1</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">build(nums);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">ans = Math.max(ans, maxXor(num));</span><br><span class="line">&#125;</span><br><span class="line">clear();</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡†å¤‡è¿™ä¹ˆå¤šé™æ€ç©ºé—´å°±å¤Ÿäº†ï¼Œå®éªŒå‡ºæ¥çš„</span></span><br><span class="line"><span class="comment">// å¦‚æœæµ‹è¯•æ•°æ®å‡çº§äº†è§„æ¨¡ï¼Œå°±æ”¹å¤§è¿™ä¸ªå€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">3000001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][] tree = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰ç¼€æ ‘ç›®å‰ä½¿ç”¨äº†å¤šå°‘ç©ºé—´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°å­—åªéœ€è¦ä»å“ªä¸€ä½å¼€å§‹è€ƒè™‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> high;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// æ‰¾ä¸ªæœ€å¤§å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">max = Math.max(num, max);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¡ç®—æ•°ç»„æœ€å¤§å€¼çš„äºŒè¿›åˆ¶çŠ¶æ€ï¼Œæœ‰å¤šå°‘ä¸ªå‰ç¼€çš„0</span></span><br><span class="line"><span class="comment">// å¯ä»¥å¿½ç•¥è¿™äº›å‰ç½®çš„0ï¼Œä»leftä½å¼€å§‹è€ƒè™‘</span></span><br><span class="line">high = <span class="number">31</span> - Integer.numberOfLeadingZeros(max);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">insert(num);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> high, path; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">path = (num &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = ++cnt;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxXor</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line"><span class="comment">// æœ€ç»ˆå¼‚æˆ–çš„ç»“æœ(å°½é‡å¤§)</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// å‰ç¼€æ ‘ç›®å‰æ¥åˆ°çš„èŠ‚ç‚¹ç¼–å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> high, status, want; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"><span class="comment">// status : numç¬¬iä½çš„çŠ¶æ€</span></span><br><span class="line">status = (num &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line"><span class="comment">// want : numç¬¬iä½å¸Œæœ›é‡åˆ°çš„çŠ¶æ€</span></span><br><span class="line">want = status ^ <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][want] == <span class="number">0</span>) &#123; <span class="comment">// è¯¢é—®å‰ç¼€æ ‘ï¼Œèƒ½ä¸èƒ½è¾¾æˆ</span></span><br><span class="line"><span class="comment">// ä¸èƒ½è¾¾æˆ</span></span><br><span class="line">want ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// wantå˜æˆçœŸçš„å¾€ä¸‹èµ°çš„è·¯</span></span><br><span class="line">ans |= (status ^ want) &lt;&lt; i;</span><br><span class="line">cur = tree[cur][want];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">tree[i][<span class="number">0</span>] = tree[i][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„"><a href="#åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„" class="headerlink" title="åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„"></a>åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„</h3><p>æ€è·¯ï¼šå›æº¯+å‰ç¼€æ ‘å‡æ</p><p>å…³é”®ç‚¹ï¼š1.æŠŠèµ°è¿‡çš„æ ¼å­ï¼Œæ ‡ä¸º0ï¼Œè¿™æ ·ä¸ä¼šé‡å¤èµ°ï¼Œä½†æ˜¯éœ€è¦æ¢å¤ç°åœº</p><p>2.åˆ©ç”¨å‰ç¼€æ ‘å‡æï¼Œé¦–å…ˆåˆ©ç”¨å•è¯ç»„æ„å»ºå‡ºå‰ç¼€æ ‘ã€‚æ¯æ¬¡é€’å½’çš„æ—¶å€™æ ¹æ®å‰ç¼€æ ‘æœ‰æ²¡æœ‰è·¯å¾„æ¥åˆ¤æ–­è¿™ä¸ªæ ¼å­é‡Œé¢çš„å•è¯èƒ½ä¸èƒ½è¦ã€‚é™¤äº†è·¯å¾„è¿˜è¦åˆ¤æ–­è¿™æ¡è·¯å¾„ä¸‹è¿˜æœ‰æ²¡æœ‰å‰©ä½™çš„æœªæ¢ç´¢å•è¯ï¼ˆåˆ©ç”¨passæ•°ç»„ï¼‰ã€‚</p><p>3.å·§ç”¨passè·Ÿendæ•°ç»„ã€‚pass[i] è¡¨ç¤ºå½“å‰èŠ‚ç‚¹å‰©ä½™è¿˜æœªæ”¶é›†çš„å•è¯ï¼Œend[i] è¡¨ç¤ºåœ¨å½“å‰èŠ‚ç‚¹å®Œç»“çš„å•è¯ï¼Œå¯ä»¥ç›´æ¥åŠ å…¥ansã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">findWords</span><span class="params">(<span class="type">char</span>[][] board, String[] words)</span> &#123;</span><br><span class="line">build(words);</span><br><span class="line">List&lt;String&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">dfs(board, i, j, <span class="number">1</span>, ans);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">clear();</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// board : äºŒç»´ç½‘æ ¼</span></span><br><span class="line"><span class="comment">// i,j : æ­¤æ—¶æ¥åˆ°çš„æ ¼å­ä½ç½®ï¼Œiè¡Œã€jåˆ—</span></span><br><span class="line"><span class="comment">// t : å‰ç¼€æ ‘çš„ç¼–å·</span></span><br><span class="line"><span class="comment">// List&lt;String&gt; ans : æ”¶é›†åˆ°äº†å“ªäº›å­—ç¬¦ä¸²ï¼Œéƒ½æ”¾å…¥ans</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ : æ”¶é›†åˆ°äº†å‡ ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> t, List&lt;String&gt; ans)</span> &#123;</span><br><span class="line"><span class="comment">// è¶Šç•Œ æˆ–è€… èµ°äº†å›å¤´è·¯ï¼Œç›´æ¥è¿”å›0</span></span><br><span class="line"><span class="keyword">if</span> (i &lt; <span class="number">0</span> || i == board.length || j &lt; <span class="number">0</span> || j == board[<span class="number">0</span>].length || board[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸è¶Šç•Œ ä¸” ä¸æ˜¯å›å¤´è·¯</span></span><br><span class="line"><span class="comment">// ç”¨tmpè®°å½•å½“å‰å­—ç¬¦</span></span><br><span class="line"><span class="type">char</span> <span class="variable">tmp</span> <span class="operator">=</span> board[i][j];</span><br><span class="line"><span class="comment">// è·¯çš„ç¼–å·</span></span><br><span class="line"><span class="comment">// a -&gt; 0</span></span><br><span class="line"><span class="comment">// b -&gt; 1</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// z -&gt; 25</span></span><br><span class="line"><span class="type">int</span> <span class="variable">road</span> <span class="operator">=</span> tmp - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">t = tree[t][road];</span><br><span class="line">       <span class="comment">// ä¸å­˜åœ¨è¯¥è·¯å¾„ï¼Œæˆ–è€…è¯¥è·¯å¾„ä¸‹çš„å•è¯å·²ç»è¢«ä½ æ‰¾å‡ºæ¥å®Œäº†  å…¶å®åº”è¯¥å†™æˆ t==0 || pass[t]==0 ä½†æ˜¯åˆå§‹åŒ–çš„æ—¶å€™passå°±æ˜¯ä»1å¼€å§‹ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä¸ç”¨åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> (pass[t] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// iï¼Œjä½ç½®æœ‰å¿…è¦æ¥</span></span><br><span class="line"><span class="comment">// fix ï¼šä»å½“å‰iï¼Œjä½ç½®å‡ºå‘ï¼Œä¸€å…±æ”¶é›†åˆ°äº†å‡ ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">int</span> <span class="variable">fix</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (end[t] != <span class="literal">null</span>) &#123;</span><br><span class="line">fix++;</span><br><span class="line">ans.add(end[t]);</span><br><span class="line">end[t] = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŠŠiï¼Œjä½ç½®çš„å­—ç¬¦ï¼Œæ”¹æˆ0ï¼Œåç»­çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸å¯ä»¥å†æ¥åˆ°iï¼Œjä½ç½®çš„ï¼</span></span><br><span class="line">board[i][j] = <span class="number">0</span>;</span><br><span class="line">fix += dfs(board, i - <span class="number">1</span>, j, t, ans);</span><br><span class="line">fix += dfs(board, i + <span class="number">1</span>, j, t, ans);</span><br><span class="line">fix += dfs(board, i, j - <span class="number">1</span>, t, ans);</span><br><span class="line">fix += dfs(board, i, j + <span class="number">1</span>, t, ans);</span><br><span class="line">       <span class="comment">// å‡å»å·²ç»æ‰¾åˆ°çš„å•è¯æ•°é‡</span></span><br><span class="line">pass[t] -= fix;</span><br><span class="line">       <span class="comment">// æ¢å¤ç°åœº</span></span><br><span class="line">board[i][j] = tmp;</span><br><span class="line"><span class="keyword">return</span> fix;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">10001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][] tree = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN][<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] pass = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String[] end = <span class="keyword">new</span> <span class="title class_">String</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(String[] words)</span> &#123;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">pass[cur]++;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = ++cnt;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">pass[cur]++;</span><br><span class="line">&#125;</span><br><span class="line">end[cur] = word;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">Arrays.fill(tree[i], <span class="number">0</span>);</span><br><span class="line">pass[i] = <span class="number">0</span>;</span><br><span class="line">end[i] = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰ç¼€æ ‘ç»“æ„&quot;&gt;&lt;a href=&quot;#å‰ç¼€æ ‘ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;å‰ç¼€æ ‘ç»“æ„&quot;&gt;&lt;/a&gt;å‰ç¼€æ ‘ç»“æ„&lt;/h2&gt;&lt;p&gt;Trieæ ‘ï¼Œå³å­—å…¸æ ‘ï¼Œåˆç§°å•è¯æŸ¥æ‰¾æ ‘æˆ–é”®æ ‘ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘çš„å˜ç§ã€‚å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡å’Œæ’åºå¤§é‡çš„å­—ç¬¦ä¸²</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>CAPä¸­çš„ä¸€è‡´æ€§</title>
    <link href="https://nmcb666.vip/posts/5bb35c22.html"/>
    <id>https://nmcb666.vip/posts/5bb35c22.html</id>
    <published>2026-01-24T14:37:48.000Z</published>
    <updated>2026-01-26T13:39:36.090Z</updated>
    
    <content type="html"><![CDATA[<p>å…³äºCAPè¿™é‡Œå°±ä¸è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºCAPä¸­çš„ C å³ä¸€è‡´æ€§ï¼ˆçº¿æ€§ä¸€è‡´æ€§ï¼‰</p><h2 id="é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸ä¸”å®¹æ˜“æ··æ·†çš„é—®é¢˜ï¼Œå› ä¸ºâ€œä¸€è‡´æ€§â€ï¼ˆConsistencyï¼‰è¿™ä¸ªè¯åœ¨è®¡ç®—æœºç§‘å­¦çš„ä¸åŒé¢†åŸŸé‡Œï¼Œè™½ç„¶åå­—ä¸€æ ·ï¼Œä½†å«ä¹‰å´å¤§ç›¸å¾„åº­ã€‚</p><p>è¿™ä¸‰ä¸ªæ¦‚å¿µåˆ†åˆ«å¯¹åº”äº†ï¼š<strong>å•æœºæ•°æ®åº“ç†è®ºï¼ˆACIDï¼‰</strong>ã€<strong>åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºï¼ˆCAPï¼‰</strong> å’Œ <strong>å·¥ç¨‹å®è·µï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</strong>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬å®ƒä»¬çš„åŒºåˆ«ï¼š</p><ul><li><strong>ACID çš„ä¸€è‡´æ€§</strong>ï¼šå…³ä¹<strong>æ•°æ®çš„â€œæ­£ç¡®æ€§â€</strong>ï¼ˆç¬¦åˆä¸šåŠ¡çº¦æŸï¼‰ã€‚</li><li><strong>CAP çš„ä¸€è‡´æ€§</strong>ï¼šå…³ä¹<strong>æ•°æ®çš„â€œæ–°æ—§â€</strong>ï¼ˆå¤šå‰¯æœ¬åŒæ­¥ï¼‰ã€‚</li><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§</strong>ï¼šå…³ä¹<strong>è·¨ç³»ç»Ÿçš„â€œåè°ƒâ€</strong>ï¼ˆè®©å¤šä¸ªç‹¬ç«‹ç³»ç»Ÿçš„æ•°æ®æœ€ç»ˆå¯¹é½ï¼‰ã€‚</li></ul><hr><h3 id="1-äº‹åŠ¡çš„ä¸€è‡´æ€§-ACID-ä¸­çš„-C"><a href="#1-äº‹åŠ¡çš„ä¸€è‡´æ€§-ACID-ä¸­çš„-C" class="headerlink" title="1. äº‹åŠ¡çš„ä¸€è‡´æ€§ (ACID ä¸­çš„ C)"></a>1. äº‹åŠ¡çš„ä¸€è‡´æ€§ (ACID ä¸­çš„ C)</h3><p>è¿™é‡Œçš„èƒŒæ™¯é€šå¸¸æŒ‡<strong>å•æœºæ•°æ®åº“</strong>ï¼ˆå¦‚ MySQLï¼‰çš„æœ¬åœ°äº‹åŠ¡ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šæŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“å¿…é¡»ä»ä¸€ä¸ª<strong>åˆæ³•çŠ¶æ€</strong>å˜æ¢åˆ°å¦ä¸€ä¸ª<strong>åˆæ³•çŠ¶æ€</strong>ã€‚</li><li><strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ï¼š<strong>ä¸šåŠ¡é€»è¾‘ä¸çº¦æŸ (Business Logic &amp; Constraints)</strong>ã€‚</li><li><strong>è¯¦ç»†è§£é‡Š</strong>ï¼š<br>â€œåˆæ³•çŠ¶æ€â€æ˜¯æŒ‡æ•°æ®å¿…é¡»ç¬¦åˆé¢„å®šä¹‰çš„è§„åˆ™ã€‚è¿™äº›è§„åˆ™åŒ…æ‹¬ï¼š<ul><li><strong>æ•°æ®åº“çº¦æŸ</strong>ï¼šä¸»é”®å”¯ä¸€ã€å¤–é”®çº¦æŸã€å­—æ®µç±»å‹ã€Checkçº¦æŸï¼ˆä¾‹å¦‚ä½™é¢ä¸èƒ½å°äº0ï¼‰ã€‚</li><li><strong>ä¸šåŠ¡é€»è¾‘</strong>ï¼šä¾‹å¦‚ A è½¬è´¦ç»™ B 100å…ƒï¼Œé‚£ä¹ˆ A å‡å» 100ï¼ŒB åŠ ä¸Š 100ï¼Œæ€»é‡‘é¢å¿…é¡»ä¸å˜ã€‚å¦‚æœä»£ç å†™é”™äº†ï¼ŒA å‡äº† 100ï¼ŒB å´åªåŠ äº† 50ï¼Œè™½ç„¶æ•°æ®åº“æ²¡å´©æºƒï¼ˆåŸå­æ€§æ»¡è¶³ï¼‰ï¼Œä½†<strong>ä¸€è‡´æ€§</strong>è¢«ç ´åäº†ï¼Œå› ä¸ºæ•°æ®ä¸å†ç¬¦åˆâ€œæ€»é¢å®ˆæ’â€çš„ä¸šåŠ¡è§„åˆ™ã€‚</li></ul></li><li><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<strong>å®ƒä¿è¯æ•°æ®ä¸è¿èƒŒç°å®ä¸–ç•Œçš„ä¸šåŠ¡è§„åˆ™ã€‚</strong></li></ul><hr><h3 id="2-åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§-CAP-ä¸­çš„-C"><a href="#2-åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§-CAP-ä¸­çš„-C" class="headerlink" title="2. åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§ (CAP ä¸­çš„ C)"></a>2. åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§ (CAP ä¸­çš„ C)</h3><p>è¿™é‡Œçš„èƒŒæ™¯æ˜¯æŒ‡<strong>å¤šå‰¯æœ¬çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿ</strong>ï¼ˆå¦‚ Redis Cluster, Cassandra, ZooKeeper, HDFSï¼‰ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šåœ¨ CAP ç†è®ºä¸­ï¼ŒC ä»£è¡¨ <strong>Linearizability (çº¿æ€§ä¸€è‡´æ€§)</strong> æˆ– <strong>Strong Consistency (å¼ºä¸€è‡´æ€§)</strong>ã€‚æ„æ€æ˜¯ï¼š<strong>æ‰€æœ‰çš„èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯å®Œå…¨ç›¸åŒçš„</strong>ã€‚</li><li><strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ï¼š<strong>å¤šèŠ‚ç‚¹é—´çš„æ•°æ®åŒæ­¥ (Synchronization &amp; Timing)</strong>ã€‚</li><li><strong>è¯¦ç»†è§£é‡Š</strong>ï¼š<br>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†å®¹ç¾ï¼Œæ•°æ®é€šå¸¸ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆReplicaï¼‰ã€‚<ul><li>å½“ä½ å‘èŠ‚ç‚¹ A å†™å…¥ä¸€ä¸ªæ–°å€¼ <code>x = 1</code>ã€‚</li><li>ç´§æ¥ç€å‘èŠ‚ç‚¹ B è¯»å– <code>x</code>ã€‚</li><li><strong>ä¸€è‡´æ€§</strong>è¦æ±‚ï¼šä½ å¿…é¡»è¯»åˆ° <code>1</code>ã€‚å¦‚æœä½ è¯»åˆ°äº†æ—§å€¼ <code>0</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿå°±ä¸æ»¡è¶³ CAP ä¸­çš„ Cã€‚</li></ul></li><li><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<strong>å®ƒä¿è¯ä½ è¯»åˆ°çš„æ°¸è¿œæ˜¯æœ€æ–°å†™å…¥çš„æ•°æ®ï¼ˆå°±åƒåªæœ‰ä¸€ä¸ªå‰¯æœ¬ä¸€æ ·ï¼‰ã€‚</strong></li></ul><hr><h3 id="3-åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§"><a href="#3-åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§" class="headerlink" title="3. åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§"></a>3. åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§</h3><p>è¿™é‡Œçš„èƒŒæ™¯æ˜¯æŒ‡<strong>å¾®æœåŠ¡æ¶æ„</strong>æˆ–<strong>è·¨æ•°æ®åº“</strong>çš„æ“ä½œï¼ˆå¦‚ è®¢å•æœåŠ¡ + åº“å­˜æœåŠ¡ + æ”¯ä»˜æœåŠ¡ï¼‰ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šæŒ‡åœ¨è·¨è¶Šå¤šä¸ªç‹¬ç«‹æœåŠ¡æˆ–æ•°æ®åº“çš„æ“ä½œä¸­ï¼Œç¡®ä¿æ‰€æœ‰ç›¸å…³çš„æ•°æ®æœ€ç»ˆèƒ½å¤Ÿè¾¾æˆä¸€ç§<strong>é€»è¾‘ä¸Šçš„å¯¹é½</strong>ã€‚å®ƒå¯ä»¥ç†è§£ä¸ºäº‹åŠ¡çš„åŸå­æ€§ï¼Œ<strong>è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</strong>ã€‚</li><li><strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ï¼š<strong>è·¨ç³»ç»Ÿçš„åŸå­æ€§ä¸æœ€ç»ˆçŠ¶æ€ (Global Outcome)</strong>ã€‚</li><li><strong>è¯¦ç»†è§£é‡Š</strong>ï¼š<br>ç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆéš¾åŒæ—¶æ»¡è¶³ CAPï¼ˆé€šå¸¸ä¸ºäº†å¯ç”¨æ€§ Aï¼Œå¿…é¡»ç‰ºç‰²å¼ºä¸€è‡´æ€§ Cï¼‰ï¼Œæ‰€ä»¥åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è®¨è®ºä¸¤ç§ä¸€è‡´æ€§ï¼š<ol><li><strong>å¼ºä¸€è‡´æ€§ï¼ˆåˆšæ€§äº‹åŠ¡ï¼‰</strong>ï¼šå¦‚ XA åè®®ã€2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ã€‚è¦æ±‚æ‰€æœ‰æœåŠ¡åŒæ—¶æäº¤ï¼Œç«‹åˆ»çœ‹åˆ°ç»“æœã€‚è¿™å¾ˆåƒ ACIDï¼Œä½†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ€§èƒ½æå·®ã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæŸ”æ€§äº‹åŠ¡ï¼ŒBASEç†è®ºï¼‰</strong>ï¼šå¦‚ TCCã€Sagaã€æ¶ˆæ¯é˜Ÿåˆ—ã€‚å…è®¸ä¸­é—´æœ‰ä¸€æ®µæ—¶é—´æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼ˆä¾‹å¦‚è®¢å•å·²åˆ›å»ºï¼Œä½†åº“å­˜è¿˜æ²¡æ‰£å‡å®Œï¼‰ï¼Œä½†ä¿è¯ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šå˜å¯¹ã€‚</li></ol></li><li><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<strong>å®ƒä¿è¯å¤šä¸ªç‹¬ç«‹ç³»ç»Ÿçš„æ•°æ®ï¼Œè™½ç„¶å¯èƒ½æœ‰å»¶è¿Ÿï¼Œä½†æœ€ç»ˆä¼šâ€œè´¦ç›®â€å¯¹é½ï¼Œä¸ä¼šå‡ºç°â€œè®¢å•æˆåŠŸäº†ä½†æ²¡æ‰£åº“å­˜â€çš„çƒ‚è´¦ã€‚</strong></li></ul><hr><h3 id="ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨"><a href="#ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨" class="headerlink" title="ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨"></a>ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨</h3><p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹è¡¨å¯¹æ¯”ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">ç»´åº¦</th><th style="text-align:left">ACID çš„ä¸€è‡´æ€§ (äº‹åŠ¡)</th><th style="text-align:left">CAP çš„ä¸€è‡´æ€§ (åˆ†å¸ƒå¼ç³»ç»Ÿ)</th><th style="text-align:left">åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§</th></tr></thead><tbody><tr><td style="text-align:left"><strong>ä¾§é‡ç‚¹</strong></td><td style="text-align:left"><strong>æ•°æ®çš„æ­£ç¡®æ€§</strong> (é€»è¾‘çº¦æŸ)</td><td style="text-align:left"><strong>æ•°æ®çš„å¯è§æ€§</strong> (æ—¶é—´åŒæ­¥)</td><td style="text-align:left"><strong>å…¨å±€æ“ä½œçš„ååŒ</strong> (å¤šæ–¹å¯¹é½)</td></tr><tr><td style="text-align:left"><strong>åœºæ™¯</strong></td><td style="text-align:left">å•æœºæ•°æ®åº“ (Oracle, MySQL)</td><td style="text-align:left">åˆ†å¸ƒå¼å­˜å‚¨ (Redis, ZK, NoSQL)</td><td style="text-align:left">å¾®æœåŠ¡ã€è·¨åº“ä¸šåŠ¡</td></tr><tr><td style="text-align:left"><strong>åä¾‹</strong></td><td style="text-align:left">è½¬è´¦åæ€»é‡‘é¢å˜å°‘äº† (è¿åå®ˆæ’)</td><td style="text-align:left">åˆšå†™å®Œä¸»åº“ï¼Œè¯»ä»åº“è¿˜æ˜¯æ—§æ•°æ®</td><td style="text-align:left">è®¢å•åº“æ˜¾ç¤ºâ€œå·²æ”¯ä»˜â€ï¼Œåº“å­˜åº“æ˜¾ç¤ºâ€œæœªæ‰£å‡â€</td></tr><tr><td style="text-align:left"><strong>ä¾èµ–å¯¹è±¡</strong></td><td style="text-align:left">ä¾èµ–æ•°æ®åº“å¼•æ“çš„çº¦æŸæ£€æŸ¥</td><td style="text-align:left">ä¾èµ–å…±è¯†ç®—æ³• (Raft, Paxos) æˆ–åŒæ­¥å¤åˆ¶</td><td style="text-align:left">ä¾èµ–åè°ƒå™¨ã€MQ æˆ– è¡¥å¿ä»£ç </td></tr><tr><td style="text-align:left"><strong>æ ¸å¿ƒé—®é¢˜</strong></td><td style="text-align:left">â€œè¿™ç¬”æ•°æ®åˆä¹é€»è¾‘å—ï¼Ÿâ€</td><td style="text-align:left">â€œæˆ‘ç°åœ¨è¯»åˆ°çš„æ˜¯æœ€æ–°çš„å—ï¼Ÿâ€</td><td style="text-align:left">â€œè¿™å‡ ä¸ªç³»ç»Ÿçš„æ•°æ®æœ€åèƒ½å¯¹ä¸Šå—ï¼Ÿâ€</td></tr></tbody></table></div><h3 id="ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­"><a href="#ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­" class="headerlink" title="ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­"></a>ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­</h3><p>å‡è®¾ä½ è¦å»ä¹°ä¸€æ¯å¥¶èŒ¶ï¼š</p><ol><li><p><strong>ACID ä¸€è‡´æ€§</strong>ï¼šä½ ä»˜äº† 20 å…ƒï¼Œåº—å‘˜å¿…é¡»ç»™ä½ ä¸€æ¯ 20 å…ƒçš„å¥¶èŒ¶ã€‚å¦‚æœåº—å‘˜åªç»™ä½ ä¸€æ¯ 10 å…ƒçš„æ°´ï¼Œæˆ–è€…æ²¡æ”¶é’±å°±ç»™ä½ å¥¶èŒ¶ï¼Œè¿™å°±è¿èƒŒäº†<strong>äº¤æ˜“è§„åˆ™</strong>ï¼ˆACID ç ´åï¼‰ã€‚</p></li><li><p><strong>CAP ä¸€è‡´æ€§</strong>ï¼šè¿™å®¶å¥¶èŒ¶åº—æœ‰ 3 ä¸ªåº—å‘˜ï¼ˆå‰¯æœ¬ï¼‰ã€‚åº—é•¿ï¼ˆä¸»èŠ‚ç‚¹ï¼‰åˆšåˆšæ›´æ–°äº†èœå•ï¼ŒæŠŠâ€œçç å¥¶èŒ¶â€æ¶¨ä»·åˆ° 25 å…ƒã€‚ä½ é—®åº—å‘˜ Aï¼Œä»–è¯´ 25 å…ƒï¼›ä½ ç«‹åˆ»é—®åº—å‘˜ Bï¼Œå¦‚æœåº—å‘˜ B è¿˜è¯´ 20 å…ƒï¼Œé‚£å°±æ˜¯<strong>åŒæ­¥</strong>æ²¡åšå¥½ï¼ˆCAP çš„ C ç ´åï¼‰ã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§</strong>ï¼šä½ åœ¨æ‰‹æœº App ä¸Šç‚¹å•ã€‚</p><ul><li>ä½ çš„æ”¯ä»˜å®æ‰£äº†é’±ï¼ˆæ”¯ä»˜æœåŠ¡ï¼‰ã€‚</li><li>å¥¶èŒ¶åº—çš„æ‰“å°æœºå‡ºäº†å°ç¥¨ï¼ˆè®¢å•æœåŠ¡ï¼‰ã€‚</li><li>å¦‚æœæ”¯ä»˜å®æ‰£äº†é’±ï¼Œä½†å¥¶èŒ¶åº—æ²¡æ”¶åˆ°å•å­ï¼›æˆ–è€…å¥¶èŒ¶åº—å‡ºäº†å•å­ï¼Œæ”¯ä»˜å®æ²¡æ‰£é’±ï¼Œè¿™å°±æ˜¯<strong>è·¨ç³»ç»Ÿ</strong>çš„ä¸ä¸€è‡´ã€‚åˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯è¦ä¿è¯ï¼šè¦ä¹ˆæ²¡æ‰£é’±ä¹Ÿæ²¡å•å­ï¼Œè¦ä¹ˆæ‰£äº†é’±ä¹Ÿæœ‰å•å­ï¼ˆå“ªæ€•ä¸­é—´æœ‰å‡ ç§’å»¶è¿Ÿï¼‰ã€‚</li></ul></li></ol><h2 id="çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§"><a href="#çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§" class="headerlink" title="çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§"></a>çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§</h2><h3 id="é¡ºåºä¸€è‡´æ€§"><a href="#é¡ºåºä¸€è‡´æ€§" class="headerlink" title="é¡ºåºä¸€è‡´æ€§"></a>é¡ºåºä¸€è‡´æ€§</h3><p>å¦‚æœä¸€ä¸ªå¹¶å‘æ‰§è¡Œè¿‡ç¨‹æ‰€åŒ…å«çš„æ‰€æœ‰è¯»å†™æ“ä½œèƒ½å¤Ÿé‡æ’æˆä¸€ä¸ªå…¨å±€çº¿æ€§æœ‰åºçš„åºåˆ—ï¼Œå¹¶ä¸”è¿™ä¸ªåºåˆ—æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå¹¶å‘æ‰§è¡Œè¿‡ç¨‹å°±æ˜¯æ»¡è¶³é¡ºåºä¸€è‡´æ€§çš„ï¼š</p><p>â€¢    æ¡ä»¶ Iï¼šé‡æ’åçš„åºåˆ—ä¸­æ¯ä¸€ä¸ªè¯»æ“ä½œè¿”å›çš„å€¼ï¼Œå¿…é¡»ç­‰äºå‰é¢å¯¹åŒä¸€ä¸ªæ•°æ®å¯¹è±¡çš„æœ€è¿‘ä¸€æ¬¡å†™æ“ä½œæ‰€å†™å…¥çš„å€¼ã€‚</p><p>â€¢    æ¡ä»¶ IIï¼šåŸæ¥æ¯ä¸ªè¿›ç¨‹ä¸­å„ä¸ªæ“ä½œçš„æ‰§è¡Œå…ˆåé¡ºåºï¼Œåœ¨è¿™ä¸ªé‡æ’åçš„åºåˆ—ä¸­å¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><h3 id="çº¿æ€§ä¸€è‡´æ€§"><a href="#çº¿æ€§ä¸€è‡´æ€§" class="headerlink" title="çº¿æ€§ä¸€è‡´æ€§"></a>çº¿æ€§ä¸€è‡´æ€§</h3><p>çº¿æ€§ä¸€è‡´æ€§çš„å®šä¹‰ï¼Œä¸é¡ºåºä¸€è‡´æ€§éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯è¯•å›¾æŠŠæ‰€æœ‰è¯»å†™æ“ä½œé‡æ’æˆä¸€ä¸ªå…¨å±€çº¿æ€§æœ‰åºçš„åºåˆ—ï¼Œä½†é™¤äº†æ»¡è¶³å‰é¢çš„æ¡ä»¶ I å’Œæ¡ä»¶ II ä¹‹å¤–ï¼Œè¿˜è¦åŒæ—¶æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ï¼š</p><p>â€¢    æ¡ä»¶ IIIï¼šä¸åŒè¿›ç¨‹çš„æ“ä½œï¼Œå¦‚æœåœ¨æ—¶é—´ä¸Šä¸é‡å ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ‰§è¡Œå…ˆåé¡ºåºï¼Œåœ¨è¿™ä¸ªé‡æ’åçš„åºåˆ—ä¸­å¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><p>â€¢    å®ƒä»¬éƒ½è¯•å›¾è®©ç³»ç»Ÿâ€œè¡¨ç°å¾—åƒåªæœ‰ä¸€ä¸ªå‰¯æœ¬â€ä¸€æ ·ã€‚</p><p>â€¢    å®ƒä»¬éƒ½ä¿è¯äº†ç¨‹åºæ‰§è¡Œé¡ºåºä¸ä¼šè¢«æ‰“ä¹±ã€‚ä½“ç°åœ¨æ¡ä»¶ II å¯¹äºè¿›ç¨‹å†…å„ä¸ªæ“ä½œçš„æ’åºä¿æŒä¸Šã€‚</p><p>â€¢    çº¿æ€§ä¸€è‡´æ€§è€ƒè™‘äº†æ—¶é—´å…ˆåé¡ºåºï¼Œè€Œé¡ºåºä¸€è‡´æ€§æ²¡æœ‰ã€‚</p><p>â€¢    æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè‚¯å®šéƒ½æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼›åä¹‹ä¸ä¸€å®šã€‚</p><p>â€¢    çº¿æ€§ä¸€è‡´æ€§éšå«äº†æ—¶æ•ˆæ€§ä¿è¯ï¼ˆrecency guaranteeï¼‰ã€‚å®ƒä¿è¯æˆ‘ä»¬æ€»æ˜¯èƒ½è¯»åˆ°æ•°æ®æœ€æ–°çš„å€¼ã€‚</p><p>â€¢    åœ¨é¡ºåºä¸€è‡´æ€§ä¸­ï¼Œæˆ‘ä»¬æœ‰å¯èƒ½è¯»åˆ°æ—§ç‰ˆæœ¬çš„æ•°æ®ã€‚</p><p>å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ <a href="https://mp.weixin.qq.com/s/3odLhBtebF4cm58hl-87JA">https://mp.weixin.qq.com/s/3odLhBtebF4cm58hl-87JA</a></p><h2 id="æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ"></a>æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å…¶å®æœ€ç»ˆä¸€è‡´æ€§å°±ä¸æ»¡è¶³CAPç†è®ºçš„C,è€Œæ˜¯å¯¹äºAPç³»ç»Ÿçš„æ‰©å……ã€‚</p><p><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰æ˜¯ CAP ç†è®ºä¸­é€‰æ‹©äº† APï¼ˆå¯ç”¨æ€§ + åˆ†åŒºå®¹é”™æ€§ï¼‰ç­–ç•¥åï¼Œä¸ºäº†å¼¥è¡¥ç¼ºå¤±çš„ Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰è€Œä¸å¾—ä¸é‡‡ç”¨çš„ä¸€ç§â€œå¦¥åâ€æ–¹æ¡ˆã€‚</strong></p><p>æˆ–è€…æ›´ç®€å•ç‚¹è¯´ï¼š<strong>æœ€ç»ˆä¸€è‡´æ€§æ˜¯ AP ç³»ç»Ÿçš„æ ¸å¿ƒç‰¹å¾ã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªå±‚é¢æ¥å‰–æè¿™æ®µå…³ç³»ï¼š</p><h3 id="1-CAP-çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€"><a href="#1-CAP-çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€" class="headerlink" title="1. CAP çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€"></a>1. CAP çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€</h3><p>CAP ç†è®ºå‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ<strong>Pï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰æ˜¯ä¸å¯é¿å…çš„</strong>ï¼ˆç½‘çº¿æ€»ä¼šæ–­ï¼ŒèŠ‚ç‚¹æ€»ä¼šæŒ‚ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½åœ¨ Cï¼ˆå¼ºä¸€è‡´æ€§/çº¿æ€§ä¸€è‡´æ€§ï¼‰å’Œ Aï¼ˆå¯ç”¨æ€§ï¼‰ä¹‹é—´åšé€‰æ‹©ï¼š</p><ul><li><strong>é€‰æ‹© CPï¼ˆæ”¾å¼ƒ Aï¼‰</strong>ï¼šä¸ºäº†ä¿è¯æ•°æ®ç»å¯¹ä¸€è‡´ï¼Œå½“ç½‘ç»œå‡ºé—®é¢˜æ—¶ï¼Œæˆ‘å®æ„¿æŠ¥é”™æ‹’ç»æœåŠ¡ï¼Œä¹Ÿä¸è®©ä½ è¯»åˆ°æ—§æ•°æ®ã€‚<ul><li><em>ç»“æœ</em>ï¼šè¿™æ˜¯<strong>å¼ºä¸€è‡´æ€§</strong>ç³»ç»Ÿï¼ˆå¦‚ Zookeeper, HBaseï¼‰ã€‚</li></ul></li><li><strong>é€‰æ‹© APï¼ˆæ”¾å¼ƒ Cï¼‰</strong>ï¼šä¸ºäº†ä¿è¯æœåŠ¡æ°¸è¿œå¯ç”¨ï¼Œå“ªæ€•ç½‘ç»œå‡ºé—®é¢˜äº†ï¼Œæˆ‘ä¹Ÿè®©ä½ è¯»ï¼Œè™½ç„¶è¯»åˆ°çš„å¯èƒ½æ˜¯æ—§æ•°æ®ã€‚<ul><li><em>ç»“æœ</em>ï¼šè¿™å°±æ˜¯<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ï¼ˆå¦‚ DNS, Eureka, Cassandraï¼‰ã€‚</li></ul></li></ul><h3 id="2-æœ€ç»ˆä¸€è‡´æ€§åœ¨-CAP-å›¾è°±ä¸­çš„ä½ç½®"><a href="#2-æœ€ç»ˆä¸€è‡´æ€§åœ¨-CAP-å›¾è°±ä¸­çš„ä½ç½®" class="headerlink" title="2. æœ€ç»ˆä¸€è‡´æ€§åœ¨ CAP å›¾è°±ä¸­çš„ä½ç½®"></a>2. æœ€ç»ˆä¸€è‡´æ€§åœ¨ CAP å›¾è°±ä¸­çš„ä½ç½®</h3><p>å¦‚æœæŠŠ CAP ç”»æˆä¸€ä¸ªä¸‰è§’å½¢ï¼š</p><ul><li><strong>CAP ä¸­çš„ C (Consistency)</strong>ï¼šæŒ‡çš„æ˜¯<strong>çº¿æ€§ä¸€è‡´æ€§</strong>ï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ã€‚å¦‚æœä½ è¿½æ±‚ CAP çš„ Cï¼Œä½ å°±å¿…é¡»ä¿è¯å†™å®Œç«‹åˆ»èƒ½è¯»åˆ°ã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šå®ƒæ˜¯<strong>å¼±ä¸€è‡´æ€§</strong>çš„ä¸€ç§ç‰¹ä¾‹ã€‚<strong>å®ƒä¸å±äº CAP çš„ C</strong>ã€‚ç›¸åï¼Œå®ƒæ˜¯å½“æˆ‘ä»¬<strong>æŠ›å¼ƒäº† CAP çš„ C</strong> ä¹‹åï¼Œé€€è€Œæ±‚å…¶æ¬¡è¿½æ±‚çš„ç›®æ ‡ã€‚</li></ul><blockquote><p><strong>å…³ç³»å…¬å¼</strong>ï¼š<br><strong>CAP (AP æ¨¡å¼)</strong> = <strong>Availability</strong> (é«˜å¯ç”¨) + <strong>Partition Tolerance</strong> (åˆ†åŒºå®¹é”™) + <strong>Eventual Consistency</strong> (æœ€ç»ˆä¸€è‡´æ€§)</p></blockquote><h3 id="3-ä¸ºä»€ä¹ˆ-AP-ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆ-AP-ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆ AP ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ"></a>3. ä¸ºä»€ä¹ˆ AP ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ</h3><p>è®©æˆ‘ä»¬æ¨æ¼”ä¸€ä¸‹ï¼š</p><ol><li><strong>å‰æ (P)</strong>ï¼šç³»ç»Ÿæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ Node A å’Œ Node Bï¼Œå®ƒä»¬ä¹‹é—´çš„ç½‘ç»œæ–­äº†ã€‚</li><li><strong>æŠ‰æ‹© (A)</strong>ï¼šæˆ‘ä»¬é€‰æ‹©äº†é«˜å¯ç”¨ï¼ˆAvailabilityï¼‰ï¼Œæ‰€ä»¥å½“ç”¨æˆ·å‘ Node A å†™å…¥ <code>x=1</code> æ—¶ï¼ŒNode A å¿…é¡»æ¥å—å¹¶è¿”å›æˆåŠŸï¼Œä¸èƒ½æŠ¥é”™ã€‚</li><li><strong>åæœ</strong>ï¼šæ­¤æ—¶ï¼ŒNode A çš„æ•°æ®æ˜¯ <code>x=1</code>ï¼Œè€Œ Node B å› ä¸ºç½‘ç»œæ–­äº†ï¼Œæ•°æ®è¿˜æ˜¯ <code>x=0</code>ã€‚</li><li><strong>ç°çŠ¶</strong>ï¼šæ­¤æ—¶ç³»ç»Ÿå·²ç»<strong>ä¸ä¸€è‡´</strong>äº†ï¼ˆè¿åäº† CAP çš„ Cï¼‰ã€‚</li><li><strong>è¡¥æ•‘ (æœ€ç»ˆä¸€è‡´æ€§)</strong>ï¼šæˆ‘ä»¬ä¸èƒ½è®© Node B æ°¸è¿œæ˜¯ <code>0</code>ã€‚ç³»ç»Ÿæ‰¿è¯ºï¼šå½“ç½‘ç»œæ¢å¤åï¼ŒNode A ä¼šåå°æŠŠ <code>x=1</code> åŒæ­¥ç»™ Node Bã€‚ç»è¿‡ä¸€æ®µæ—¶é—´ï¼ˆä¸ç¡®å®šå¤šä¹…ï¼‰ï¼ŒNode B æœ€ç»ˆä¹Ÿä¼šå˜æˆ <code>1</code>ã€‚</li></ol><p><strong>ç»“è®º</strong>ï¼šå› ä¸ºé€‰æ‹©äº† Aï¼ˆå…è®¸åœ¨æ–­ç½‘æ—¶ç»§ç»­å†™ï¼‰ï¼Œå¿…ç„¶å¯¼è‡´æ•°æ®æš‚æ—¶ä¸ä¸€è‡´ã€‚è€Œâ€œæœ€ç»ˆä¸€è‡´æ€§â€å°±æ˜¯å¯¹è¿™ç§æš‚æ—¶ä¸ä¸€è‡´çš„<strong>å®¹å¿</strong>å’Œå¯¹æœªæ¥çš„<strong>æ‰¿è¯º</strong>ã€‚</p><h3 id="4-å»¶ä¼¸ï¼šBASE-ç†è®º"><a href="#4-å»¶ä¼¸ï¼šBASE-ç†è®º" class="headerlink" title="4. å»¶ä¼¸ï¼šBASE ç†è®º"></a>4. å»¶ä¼¸ï¼šBASE ç†è®º</h3><p>è®²åˆ°æœ€ç»ˆä¸€è‡´æ€§ä¸ CAP çš„å…³ç³»ï¼Œå°±ä¸å¾—ä¸æ <strong>BASE ç†è®º</strong>ã€‚å®ƒæ˜¯å¯¹ CAP ä¸­ AP ç­–ç•¥çš„å·¥ç¨‹åŒ–å»¶ä¼¸ã€‚ï¼š</p><ul><li><strong>BA (Basically Available)</strong>ï¼šåŸºæœ¬å¯ç”¨ï¼ˆå…è®¸å“åº”æ—¶é—´æ…¢ä¸€ç‚¹ï¼Œæˆ–è€…éƒ¨åˆ†é™çº§ï¼‰ã€‚</li><li><strong>S (Soft state)</strong>ï¼šè½¯çŠ¶æ€ï¼ˆå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå³å…è®¸æ•°æ®åŒæ­¥æœ‰å»¶è¿Ÿï¼‰ã€‚</li><li><strong>E (Eventual consistency)</strong>ï¼šæœ€ç»ˆä¸€è‡´æ€§ï¼ˆæ•°æ®æœ€ç»ˆä¼šå˜å¯¹ï¼‰ã€‚</li></ul><h3 id="5-æ€»ç»“è¡¨"><a href="#5-æ€»ç»“è¡¨" class="headerlink" title="5. æ€»ç»“è¡¨"></a>5. æ€»ç»“è¡¨</h3><div class="table-container"><table><thead><tr><th style="text-align:left">ç»´åº¦</th><th style="text-align:left">CAP çš„ C (å¼ºä¸€è‡´æ€§)</th><th style="text-align:left">æœ€ç»ˆä¸€è‡´æ€§ (å¼±ä¸€è‡´æ€§çš„ä¸€ç§)</th></tr></thead><tbody><tr><td style="text-align:left"><strong>CAP é€‰æ‹©</strong></td><td style="text-align:left"><strong>CP</strong> (æ”¾å¼ƒå¯ç”¨æ€§)</td><td style="text-align:left"><strong>AP</strong> (æ”¾å¼ƒå¼ºä¸€è‡´æ€§)</td></tr><tr><td style="text-align:left"><strong>æ ¸å¿ƒé€»è¾‘</strong></td><td style="text-align:left">å†™æ“ä½œå®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹<strong>ç«‹åˆ»</strong>å¯è§ã€‚</td><td style="text-align:left">å†™æ“ä½œå®Œæˆåï¼Œæ•°æ®<strong>å¼‚æ­¥</strong>å¤åˆ¶ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´æ‰å¯è§ã€‚</td></tr><tr><td style="text-align:left"><strong>ç”¨æˆ·ä½“éªŒ</strong></td><td style="text-align:left">â€œè¦ä¹ˆè¯»åˆ°æœ€æ–°çš„ï¼Œè¦ä¹ˆç³»ç»Ÿå‘Šè¯‰æˆ‘æŠ¥é”™/è¶…æ—¶ã€‚â€</td><td style="text-align:left">â€œæˆ‘å¯èƒ½è¯»åˆ°æ—§çš„ï¼Œä½†ç³»ç»Ÿä¿è¯éšæ—¶èƒ½ç”¨ã€‚â€</td></tr><tr><td style="text-align:left"><strong>å…¸å‹åœºæ™¯</strong></td><td style="text-align:left">é“¶è¡Œä½™é¢ã€åº“å­˜æ‰£å‡ã€åˆ†å¸ƒå¼é” (Etcd/ZK)</td><td style="text-align:left">ç¤¾äº¤ç½‘ç»œç‚¹èµã€DNSè§£æã€ç”µå•†å•†å“æµè§ˆé‡</td></tr><tr><td style="text-align:left"><strong>å…³ç³»</strong></td><td style="text-align:left"><strong>å®ƒæ˜¯ CAP å®šä¹‰çš„ä¸€è‡´æ€§æ ‡å‡†</strong></td><td style="text-align:left"><strong>å®ƒæ˜¯æ”¾å¼ƒ CAP çš„ C ä¹‹åçš„æ›¿ä»£æ–¹æ¡ˆ</strong></td></tr></tbody></table></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…³äºCAPè¿™é‡Œå°±ä¸è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºCAPä¸­çš„ C å³ä¸€è‡´æ€§ï¼ˆçº¿æ€§ä¸€è‡´æ€§ï¼‰&lt;/p&gt;
&lt;h2 id=&quot;é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot;&gt;&lt;a href=&quot;#é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿ</summary>
      
    
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://nmcb666.vip/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆå››ï¼‰é€’å½’</title>
    <link href="https://nmcb666.vip/posts/38e6282b.html"/>
    <id>https://nmcb666.vip/posts/38e6282b.html</id>
    <published>2026-01-20T15:24:25.000Z</published>
    <updated>2026-01-26T13:39:36.092Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é€’å½’ç›¸å…³çš„é¢˜ç›®"><a href="#é€’å½’ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="é€’å½’ç›¸å…³çš„é¢˜ç›®"></a>é€’å½’ç›¸å…³çš„é¢˜ç›®</h1><h2 id="æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—"><a href="#æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—" class="headerlink" title="æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—"></a>æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—</h2><p>é€’å½’çš„æ€è·¯ï¼šæ¯æ¬¡æŒ‰è¦è¿™ä¸ªä½ç½®çš„å­—ç¬¦å’Œä¸è¦è¿™ä¸ªä½ç½®çš„å­—ç¬¦ä¸¤ç§æƒ…å†µå»é€’å½’ï¼Œå½“i = s.length()æ—¶ï¼Œä¿å­˜å½“å‰çš„å­åºåˆ—ã€‚ç”¨hashSetå»é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String[] generatePermutation(String str) &#123;</span><br><span class="line"><span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line">HashSet&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">f2(s, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">char</span>[s.length], <span class="number">0</span>, set);</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> set.size();</span><br><span class="line">String[] ans = <span class="keyword">new</span> <span class="title class_">String</span>[m];</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (String cur : set) &#123;</span><br><span class="line">ans[i++] = cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">// iæ˜¯å½“å‰è¦å¤„ç†çš„å­—ç¬¦çš„ç´¢å¼•,pathæ˜¯å½“å‰å·²ç»ä¿å­˜çš„è·¯å¾„ï¼Œsizeæ˜¯pathçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">(<span class="type">char</span>[] s, <span class="type">int</span> i, <span class="type">char</span>[] path, <span class="type">int</span> size, HashSet&lt;String&gt; set)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i == s.length) &#123;</span><br><span class="line">set.add(String.valueOf(path, <span class="number">0</span>, size));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">path[size] = s[i];</span><br><span class="line">f2(s, i + <span class="number">1</span>, path, size + <span class="number">1</span>, set);</span><br><span class="line">f2(s, i + <span class="number">1</span>, path, size, set);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„"><a href="#æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„" class="headerlink" title="æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„"></a>æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„</h2><p>æ€è·¯ï¼šå…ˆå°†æ•°ç»„æ’åºï¼Œç„¶åæ¯æ¬¡å¯¹åŒä¸€ä¸ªæ•°è®¨è®ºï¼Œè¦0ä¸ªï¼Œè¦1ä¸ªâ€¦ è¿˜éœ€è¦çŸ¥é“å¯¹äºè¿™ä¸ªæ•°æ¥è¯´ä¸‹ä¸€ä¸ªè·Ÿè‡ªå·±ä¸åŒçš„æ•°çš„ä½ç½®ï¼Œç„¶åè°ƒç”¨é€’å½’ä»ä¸‹ä¸ªä¸åŒçš„æ•°å¼€å§‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[] path = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">11</span>];</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    findSubsetsWithDup(<span class="number">0</span>,nums,<span class="number">0</span>,path,ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findSubsetsWithDup</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span>[] nums,<span class="type">int</span> size,<span class="type">int</span>[] path,List&lt;List&lt;Integer&gt;&gt; ans)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i==nums.length)&#123;</span><br><span class="line">        List&lt;Integer&gt; temp =<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">            temp.add(path[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        ans.add(temp);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æ‰¾å‡ºä¸‹ä¸€ä¸ªè·Ÿè‡ªå·±ä¸åŒçš„æ•°çš„ä½ç½®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; nums.length &amp;&amp; nums[j] == nums[i])&#123;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¦0ä¸ª</span></span><br><span class="line">        findSubsetsWithDup(j,nums,size,path,ans);</span><br><span class="line">        <span class="comment">// ä¾æ¬¡è¦å¤šä¸ª</span></span><br><span class="line">        <span class="keyword">for</span>(;i&lt;j;i++)&#123;</span><br><span class="line">            path[size++] = nums[i];</span><br><span class="line">            findSubsetsWithDup(j,nums,size,path,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„-nums-ï¼Œè¿”å›å…¶-æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—-ã€‚ä½ å¯ä»¥-æŒ‰ä»»æ„é¡ºåº-è¿”å›ç­”æ¡ˆã€‚"><a href="#ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„-nums-ï¼Œè¿”å›å…¶-æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—-ã€‚ä½ å¯ä»¥-æŒ‰ä»»æ„é¡ºåº-è¿”å›ç­”æ¡ˆã€‚" class="headerlink" title="ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚"></a>ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚</h2><p>æ€è·¯ï¼š æ¯æ¬¡æ‹¿ä¸€ä¸ªæ•°è·Ÿå½“å‰ä¸‹æ ‡çš„ç¬¬ä¸€ä¸ªæ•°äº¤æ¢ï¼Œç„¶åé€’å½’è°ƒç”¨å°†ä¸‹æ ‡+1ï¼Œé€’å½’å®Œæˆåå†äº¤æ¢å›æ¥ã€‚ç»ˆæ­¢æ¡ä»¶å°±ç®—ä¸‹æ ‡==nums.length</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans =<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    findPermute(nums,<span class="number">0</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findPermute</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> i,List&lt;List&lt;Integer&gt;&gt; ans)</span>&#123;</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span>(i == nums.length)&#123;</span><br><span class="line">        List&lt;Integer&gt; temp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;nums.length;j++)&#123;</span><br><span class="line">            temp.add(nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        ans.add(temp);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¾æ¬¡äº¤æ¢</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i;j&lt;nums.length;j++)&#123;</span><br><span class="line">            swap(nums,i,j);</span><br><span class="line">            findPermute(nums,i+<span class="number">1</span>,ans);</span><br><span class="line">            <span class="comment">// äº¤æ¢å›æ¥</span></span><br><span class="line">            swap(nums,i,j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹“å±•ï¼šå¦‚æœæœ‰é‡å¤æ•°å­—ï¼Œåˆ™éœ€è¦å»é‡</p><p>æ€è·¯ï¼š æ¯æ¬¡é€’å½’çš„æ—¶å€™ç»´æŠ¤ä¸€ä¸ªsetè¿™ä¸ªsetè®°å½•å“ªäº›æ•°æ¥åˆ°è¿‡æˆ‘è¿™ä¸ªä¸‹æ ‡ï¼Œå¦‚æœå‘ç°ä¸€ä¸ªæ•°å·²ç»æ¥åˆ°è¿‡ï¼Œåˆ™ä¸è¿›è¡Œäº¤æ¢ï¼Œä¹Ÿä¸é€’å½’è·³è¿‡å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, List&lt;List&lt;Integer&gt;&gt; ans)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i == nums.length) &#123;</span><br><span class="line">List&lt;Integer&gt; cur = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">cur.add(num);</span><br><span class="line">&#125;</span><br><span class="line">ans.add(cur);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; nums.length; j++) &#123;</span><br><span class="line"><span class="comment">// nums[j]æ²¡æœ‰æ¥åˆ°è¿‡iä½ç½®ï¼Œæ‰ä¼šå»å°è¯•</span></span><br><span class="line"><span class="keyword">if</span> (!set.contains(nums[j])) &#123;</span><br><span class="line">set.add(nums[j]);</span><br><span class="line">swap(nums, i, j);</span><br><span class="line">f(nums, i + <span class="number">1</span>, ans);</span><br><span class="line">swap(nums, i, j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Nçš‡åé—®é¢˜"><a href="#Nçš‡åé—®é¢˜" class="headerlink" title="Nçš‡åé—®é¢˜"></a>Nçš‡åé—®é¢˜</h2><p>æ€è·¯ï¼šç»´æŠ¤ä¸€ä¸ªè·¯å¾„æ•°ç»„path[],pathçš„ç¬¬å‡ ä¸ªæ•°çš„å€¼è¡¨ç¤ºç¬¬å‡ è¡Œçš„çš‡åæ”¾åœ¨ç¬¬å‡ åˆ—ï¼Œæ¯æ¬¡å¾ªç¯æ¯ä¸€è¡Œçš„åˆ—å»åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œå¦‚æœåˆæ³•åˆ™é€’å½’è°ƒç”¨ä¸‹ä¸€è¡Œï¼Œå¹¶ä¸”size++.ç»ˆæ­¢æ¡ä»¶æ˜¯size == n å³æ‰¾åˆ°åˆæ³•çš„ä¸€ä¸ªè§£ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[] path = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    findSolveNQueens(<span class="number">0</span>,n,path,ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">findSolveNQueens</span><span class="params">(<span class="type">int</span> size,<span class="type">int</span> n,<span class="type">int</span>[] path,List&lt;List&lt;String&gt;&gt; ans)</span>&#123;</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span>(size == n)&#123;</span><br><span class="line">        List&lt;String&gt; temp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span>path[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">0</span> ;j&lt;pos;j++)&#123;</span><br><span class="line">                sb.append(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(<span class="string">&#x27;Q&#x27;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> pos+<span class="number">1</span>;j&lt;n;j++)&#123;</span><br><span class="line">                sb.append(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            temp.add(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        ans.add(temp);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¾æ¬¡å°è¯•</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="comment">// å°è¯•ç¬¬iåˆ—</span></span><br><span class="line">            <span class="keyword">if</span>(isvalid(i,path,size))&#123;</span><br><span class="line">                <span class="comment">// åˆæ³•</span></span><br><span class="line">                path[size] = i;</span><br><span class="line">                findSolveNQueens(size+<span class="number">1</span>,n,path,ans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isvalid</span> <span class="params">(<span class="type">int</span> i ,<span class="type">int</span>[] path,<span class="type">int</span> size)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k&lt; size; k++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i==path[k])&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( Math.abs(size-k) == Math.abs(i-path[k]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‹“å±•ï¼š åˆ©ç”¨ä½è¿ç®—å»åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦åˆæ³•ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-21%20162737.png" alt="ç¤ºä¾‹å›¾ç‰‡"/></div><span class="image-caption">ç¤ºä¾‹å›¾ç‰‡</span></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">totalNQueens2</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (n &lt; <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// n = 5</span></span><br><span class="line"><span class="comment">// 1 &lt;&lt; 5 = 0...100000 - 1</span></span><br><span class="line"><span class="comment">// limit  = 0...011111; </span></span><br><span class="line"><span class="comment">// n = 7</span></span><br><span class="line"><span class="comment">// limit  = 0...01111111; </span></span><br><span class="line"><span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> (<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> f2(limit, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// limit : å½“å‰æ˜¯å‡ çš‡åé—®é¢˜</span></span><br><span class="line"><span class="comment">// ä¹‹å‰çš‡åçš„åˆ—å½±å“ï¼šcol</span></span><br><span class="line"><span class="comment">// ä¹‹å‰çš‡åçš„å³ä¸Š -&gt; å·¦ä¸‹å¯¹è§’çº¿å½±å“ï¼šleft</span></span><br><span class="line"><span class="comment">// ä¹‹å‰çš‡åçš„å·¦ä¸Š -&gt; å³ä¸‹å¯¹è§’çº¿å½±å“ï¼šright</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f2</span><span class="params">(<span class="type">int</span> limit, <span class="type">int</span> col, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (col == limit) &#123;</span><br><span class="line"><span class="comment">// æ‰€æœ‰çš‡åæ”¾å®Œäº†ï¼</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ€»é™åˆ¶</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ban</span> <span class="operator">=</span> col | left | right;</span><br><span class="line"><span class="comment">// ~ban : 1å¯æ”¾çš‡åï¼Œ0ä¸èƒ½æ”¾</span></span><br><span class="line"><span class="type">int</span> <span class="variable">candidate</span> <span class="operator">=</span> limit &amp; (~ban);</span><br><span class="line"><span class="comment">// æ”¾ç½®çš‡åçš„å°è¯•ï¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">place</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// ä¸€å…±æœ‰å¤šå°‘æœ‰æ•ˆçš„æ–¹æ³•</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (candidate != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// æå–å‡ºæœ€å³ä¾§çš„1</span></span><br><span class="line"><span class="comment">// 0 0 1 1 1 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line"><span class="comment">// place : </span></span><br><span class="line"><span class="comment">// 0 0 0 0 1 0</span></span><br><span class="line"><span class="comment">// candidate : </span></span><br><span class="line"><span class="comment">// 0 0 1 1 0 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line"><span class="comment">// place : </span></span><br><span class="line"><span class="comment">// 0 0 0 1 0 0</span></span><br><span class="line"><span class="comment">// candidate : </span></span><br><span class="line"><span class="comment">// 0 0 1 0 0 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line"><span class="comment">// place : </span></span><br><span class="line"><span class="comment">// 0 0 1 0 0 0</span></span><br><span class="line"><span class="comment">// candidate : </span></span><br><span class="line"><span class="comment">// 0 0 0 0 0 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line">place = candidate &amp; (-candidate);</span><br><span class="line">candidate ^= place;</span><br><span class="line">ans += f2(limit, col | place, (left | place) &gt;&gt; <span class="number">1</span>, (right | place) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é€’å½’ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é€’å½’ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é€’å½’ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;é€’å½’ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—&quot;&gt;&lt;a href=&quot;#æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—&quot; cla</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆå››ï¼‰äºŒå‰æ ‘</title>
    <link href="https://nmcb666.vip/posts/44956a51.html"/>
    <id>https://nmcb666.vip/posts/44956a51.html</id>
    <published>2026-01-19T21:48:58.000Z</published>
    <updated>2026-01-26T13:39:36.091Z</updated>
    
    <content type="html"><![CDATA[<h1 id="äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®"><a href="#äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®"></a>äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®</h1><h2 id="å±‚åºéå†"><a href="#å±‚åºéå†" class="headerlink" title="å±‚åºéå†"></a>å±‚åºéå†</h2><p>æ€è·¯ï¼šåˆ©ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†ï¼Œç±»ä¼¼ä¸BFSã€‚</p><p>è¿™é‡Œä¸¾ä¸€ä¸ªé”¯é½¿å½¢å±‚åºéå†çš„ä¾‹å­ï¼ˆå³å…ˆä»å·¦å¾€å³ï¼Œå†ä»å³å¾€å·¦è¿›è¡Œä¸‹ä¸€å±‚éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">2001</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> TreeNode[] queue = <span class="keyword">new</span> <span class="title class_">TreeNode</span>[MAXN];</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> l, r;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">l = r = <span class="number">0</span>;</span><br><span class="line">queue[r++] = root;</span><br><span class="line"><span class="comment">// false ä»£è¡¨ä»å·¦å¾€å³</span></span><br><span class="line"><span class="comment">// true ä»£è¡¨ä»å³å¾€å·¦</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">reverse</span> <span class="operator">=</span> <span class="literal">false</span>; </span><br><span class="line"><span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r - l;</span><br><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"><span class="comment">// reverse == false, å·¦ -&gt; å³ï¼Œ l....r-1, æ”¶é›†sizeä¸ª</span></span><br><span class="line"><span class="comment">// reverse == true,  å³ -&gt; å·¦ï¼Œ r-1....l, æ”¶é›†sizeä¸ª</span></span><br><span class="line"><span class="comment">// å·¦ -&gt; å³, i = i + 1</span></span><br><span class="line"><span class="comment">// å³ -&gt; å·¦, i = i - 1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> reverse ? r - <span class="number">1</span> : l, j = reverse ? -<span class="number">1</span> : <span class="number">1</span>, k = <span class="number">0</span>; k &lt; size; i += j, k++) &#123;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue[i];</span><br><span class="line">list.add(cur.val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue[l++];</span><br><span class="line"><span class="keyword">if</span> (cur.left != <span class="literal">null</span>) &#123;</span><br><span class="line">queue[r++] = cur.left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (cur.right != <span class="literal">null</span>) &#123;</span><br><span class="line">queue[r++] = cur.right;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ans.add(list);</span><br><span class="line">reverse = !reverse;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘æœ€å¤§å®½åº¦"><a href="#äºŒå‰æ ‘æœ€å¤§å®½åº¦" class="headerlink" title="äºŒå‰æ ‘æœ€å¤§å®½åº¦"></a>äºŒå‰æ ‘æœ€å¤§å®½åº¦</h2><p>æ€è·¯ï¼šåˆ©ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†ï¼Œå¹¶åŒæ­¥è®°å½•å½“å‰å±‚èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œå°†ç´¢å¼•ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€åè®¡ç®—æ¯ä¸€å±‚å¼€å§‹ä¸ç»“æŸçš„ç´¢å¼•çš„å·®å€¼ï¼Œå¹¶è¿”å›æœ€å¤§å€¼ã€‚æƒ³è±¡ä¸ºå®Œå…¨äºŒå‰æ ‘ï¼Œå¯¹äºèŠ‚ç‚¹iï¼Œå…¶å·¦å­èŠ‚ç‚¹ä¸º2iï¼Œå³å­èŠ‚ç‚¹ä¸º2i+1ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">widthOfBinaryTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    TreeNode[] queue = <span class="keyword">new</span> <span class="title class_">TreeNode</span>[<span class="number">3001</span>];</span><br><span class="line">    Long[] idQueue = <span class="keyword">new</span> <span class="title class_">Long</span>[<span class="number">3001</span>];</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[r] = root;</span><br><span class="line">    idQueue[r++] = <span class="number">1L</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">        <span class="comment">//æ¯æ¬¡éå†å®Œæˆåï¼Œl åˆ° r-1ï¼Œå°±æ˜¯å½“å‰å±‚æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r-l;</span><br><span class="line">        ans = Math.max(ans,(<span class="type">int</span>)(idQueue[r-<span class="number">1</span>]-idQueue[l]+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue[l];</span><br><span class="line">            <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> idQueue[l++];</span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                queue[r] = node.left;</span><br><span class="line">                idQueue[r++] = id*<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                queue[r] =node.right;</span><br><span class="line">                idQueue[r++] = id*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦"><a href="#æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦" class="headerlink" title="æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦"></a>æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦</h2><p>æ€è·¯ï¼šåˆ©ç”¨é€’å½’è¿›è¡Œæ±‚è§£ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ±‚å·¦å³å­æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œå¹¶è¿”å›è¾ƒå¤§çš„å€¼ã€‚ï¼ˆæœ€å°æ·±åº¦åŒç†ï¼Œä½†è¦å¤„ç†æ ¹èŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µï¼Œå› ä¸ºä¸ºç©ºå­é—®é¢˜è¿”å›0é«˜åº¦ï¼Œä½†é¢˜ç›®è¯´çš„æœ€å°æ·±åº¦å¿…é¡»åˆ°å¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šå¹²æ‰°æœ€å°æ·±åº¦çš„è®¡ç®—ï¼Œæ‰€ä»¥å¿…é¡»å­èŠ‚ç‚¹ä¸ä¸ºç©ºæ‰èƒ½è¿›è¡Œé€’å½’ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> root == <span class="literal">null</span> ? <span class="number">0</span> : Math.max(maxDepth(root.left),maxDepth(root.right))+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right ==<span class="literal">null</span> &amp;&amp; root.left ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">lMin</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="type">int</span> <span class="variable">rMin</span> <span class="operator">=</span>Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        lMin = minDepth(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">        rMin = minDepth(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Math.min(lMin,rMin)+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘"><a href="#æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘" class="headerlink" title="æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘"></a>æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘</h2><p>æ€è·¯ï¼š</p><p>ç¡®å®šæ ¹èŠ‚ç‚¹ï¼š<br>å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸€å®šæ˜¯æ•´ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p><p>åˆ’åˆ†å·¦å³å­æ ‘ï¼š<br>æ ¹æ®æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®ï¼Œå¯ä»¥å°†ä¸­åºéå†åºåˆ—åˆ’åˆ†ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—ã€‚<br>å·¦å­æ ‘çš„ä¸­åºéå†åºåˆ—ä½äºæ ¹èŠ‚ç‚¹çš„å·¦è¾¹ï¼Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—ä½äºæ ¹èŠ‚ç‚¹çš„å³è¾¹ã€‚</p><p>é€’å½’æ„å»ºï¼š<br>æ ¹æ®å·¦å­æ ‘å’Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—é•¿åº¦ï¼Œå¯ä»¥åœ¨å‰åºéå†åºåˆ—ä¸­åˆ’åˆ†å‡ºå¯¹åº”çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„å‰åºéå†åºåˆ—ã€‚<br>é€’å½’åœ°å¯¹å·¦å³å­æ ‘è¿›è¡Œä¸Šè¿°æ“ä½œï¼Œç›´åˆ°éå†åºåˆ—ä¸ºç©ºï¼Œè¿”å› nullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(preorder.length == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> preorder.length;</span><br><span class="line">    HashMap&lt;Integer,Integer&gt; map =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i= <span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        map.put(inorder[i],i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> build(preorder,<span class="number">0</span>,len-<span class="number">1</span>,inorder,<span class="number">0</span>,len-<span class="number">1</span>,map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] pre ,<span class="type">int</span> l1,<span class="type">int</span> r1,<span class="type">int</span>[] in,<span class="type">int</span> l2,<span class="type">int</span> r2,HashMap&lt;Integer,Integer&gt; map)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l1&gt;r1 || l2 &gt; r2)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l1 == r1)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(pre[l1]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(pre[l1]);</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span>map.get(pre[l1]);</span><br><span class="line">    <span class="comment">// åˆ’åˆ†å·¦å³å­æ ‘ é€’å½’æ±‚è§£</span></span><br><span class="line">    head.left = build(pre,l1+<span class="number">1</span>,k-l2+l1,in,l2,k-<span class="number">1</span>,map);</span><br><span class="line">    head.right = build(pre,k-l2+l1+<span class="number">1</span>,r1,in,k+<span class="number">1</span>,r2,map);</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h2><p>æ€è·¯ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">null</span> || root == p || root == q) &#123;</span><br><span class="line"><span class="comment">// é‡åˆ°ç©ºï¼Œæˆ–è€…pï¼Œæˆ–è€…qï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">l</span> <span class="operator">=</span> lowestCommonAncestor(root.left, p, q);</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">r</span> <span class="operator">=</span> lowestCommonAncestor(root.right, p, q);</span><br><span class="line"><span class="keyword">if</span> (l != <span class="literal">null</span> &amp;&amp; r != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// å·¦æ ‘ä¹Ÿæœåˆ°ï¼Œå³æ ‘ä¹Ÿæœåˆ°ï¼Œè¿”å›root</span></span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (l == <span class="literal">null</span> &amp;&amp; r == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// éƒ½æ²¡æœåˆ°è¿”å›ç©º</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// lå’Œrä¸€ä¸ªä¸ºç©ºï¼Œä¸€ä¸ªä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">// è¿”å›ä¸ç©ºçš„é‚£ä¸ª</span></span><br><span class="line"><span class="keyword">return</span> l != <span class="literal">null</span> ? l : r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#éªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="éªŒè¯äºŒå‰æœç´¢æ ‘"></a>éªŒè¯äºŒå‰æœç´¢æ ‘</h2><p>æ€è·¯ï¼šæ¯ä¸ªç‚¹å¿…é¡»å¤§äºå·¦æ ‘çš„æœ€å¤§å€¼ï¼Œå°äºå³æ ‘æœ€å°å€¼ã€‚é€’å½’éªŒè¯å³å¯ã€‚ä½†æ³¨æ„æŠŠæœ€å¤§å€¼è®¾ä¸ºLong.MIN_VALUEï¼Œæœ€å°å€¼è®¾ä¸ºLong.MAX_VALUEï¼ˆä¸ºäº†ä¸å¯¹ç»“æœé€ æˆå¹²æ‰°ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">max</span> <span class="operator">=</span> Long.MIN_VALUE;</span><br><span class="line"><span class="type">long</span> <span class="variable">min</span> <span class="operator">=</span> Long.MAX_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        max = Long.MIN_VALUE;</span><br><span class="line">        min = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">lok</span> <span class="operator">=</span> isValidBST(root.left);</span><br><span class="line">    <span class="type">long</span> <span class="variable">lmax</span> <span class="operator">=</span> max;</span><br><span class="line">    <span class="type">long</span> <span class="variable">lmin</span> <span class="operator">=</span> min;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">rok</span> <span class="operator">=</span> isValidBST(root.right);</span><br><span class="line">    <span class="type">long</span> <span class="variable">rmax</span> <span class="operator">=</span> max;</span><br><span class="line">    <span class="type">long</span> <span class="variable">rmin</span> <span class="operator">=</span> min;</span><br><span class="line">    max = Math.max(Math.max(lmax,rmax),root.val);</span><br><span class="line">    min = Math.min(Math.min(lmin,rmin),root.val);</span><br><span class="line">    <span class="keyword">return</span> lok &amp;&amp; rok &amp;&amp; root.val &gt; lmax &amp;&amp; root.val&lt; rmin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;å±‚åºéå†&quot;&gt;&lt;a href=&quot;#å±‚åºéå†&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>DDDé¢†åŸŸäº‹ä»¶çš„æœ€ä½³å®è·µ</title>
    <link href="https://nmcb666.vip/posts/8f3b837f.html"/>
    <id>https://nmcb666.vip/posts/8f3b837f.html</id>
    <published>2026-01-16T23:59:31.000Z</published>
    <updated>2026-01-26T13:39:36.088Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ"><a href="#DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ" class="headerlink" title="DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ"></a>DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ</h1><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„æˆ˜æœ¯è½åœ°è¿‡ç¨‹ä¸­ï¼Œ<strong>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰</strong> æ˜¯è¿æ¥å„ä¸ªå­åŸŸã€èšåˆä»¥åŠé™ç•Œä¸Šä¸‹æ–‡çš„â€œèƒ¶æ°´â€ã€‚å®ƒä¸ä»…è§£è€¦äº†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ›´æ˜¯å®ç°â€œæœ€ç»ˆä¸€è‡´æ€§â€æ¶æ„çš„å…³é”®æ‰‹æ®µã€‚</p><p>æœ¬æ–‡åŸºäºå®é™…å¼€å‘ç»éªŒï¼Œæ€»ç»“é¢†åŸŸäº‹ä»¶çš„å»ºæ¨¡ã€ç”Ÿæˆã€å‘å¸ƒåŠå¯é æ€§æŠ•é€’çš„æœ€ä½³å®è·µï¼Œå¹¶æ¢è®¨ä¸åŒæ–¹æ¡ˆèƒŒåçš„æƒè¡¡ã€‚</p><hr><h2 id="ä¸€ã€-ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ"><a href="#ä¸€ã€-ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ" class="headerlink" title="ä¸€ã€ ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ"></a>ä¸€ã€ ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ</h2><p>ç®€å•æ¥è¯´ï¼Œé¢†åŸŸäº‹ä»¶æ˜¯<strong>èšåˆå†…å·²å‘ç”Ÿçš„ä¸šåŠ¡äº‹å®</strong>ã€‚</p><ul><li><strong>ä¸šåŠ¡äº‹å®</strong>ï¼šæ„å‘³ç€å®ƒæ˜¯è¿‡å»å¼ã€‚æ¯”å¦‚â€œç”¨æˆ·å·²æ³¨å†Œâ€ã€â€œè®¢å•å·²æ”¯ä»˜â€ã€‚</li><li><strong>å‘½åè§„èŒƒ</strong>ï¼šæ¨èä½¿ç”¨ <code>åŠ¨è¯è¿‡å»å¼</code>ï¼ˆå¦‚ <code>OrderPaid</code>, <code>AccountActivated</code>ï¼‰ã€‚</li><li><strong>ä»·å€¼</strong>ï¼š<ol><li><strong>è§£è€¦</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸éœ€è¦çŸ¥é“è°åœ¨å…³æ³¨å®ƒã€‚</li><li><strong>å‰¯ä½œç”¨å¤„ç†</strong>ï¼šè§¦å‘é€šçŸ¥ã€å¤§æ•°æ®åˆ†æã€æŠ¥è¡¨ç”Ÿæˆç­‰éæ ¸å¿ƒé€»è¾‘ã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šè·¨èšåˆã€è·¨æœåŠ¡çš„çŠ¶æ€åŒæ­¥ã€‚</li></ol></li></ul><hr><h2 id="äºŒã€-å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯-vs-ç˜¦æ¶ˆæ¯"><a href="#äºŒã€-å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯-vs-ç˜¦æ¶ˆæ¯" class="headerlink" title="äºŒã€ å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯ vs ç˜¦æ¶ˆæ¯"></a>äºŒã€ å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯ vs ç˜¦æ¶ˆæ¯</h2><p>é¢†åŸŸäº‹ä»¶é€šå¸¸è¢«å»ºæ¨¡ä¸º<strong>ä¸å¯å˜çš„å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰</strong>ã€‚ä½†åœ¨è®¾è®¡æ¶ˆæ¯ä½“ï¼ˆPayloadï¼‰æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªç»å…¸æŠ‰æ‹©ï¼š</p><h3 id="1-ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰"><a href="#1-ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰" class="headerlink" title="1. ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰"></a>1. ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰</h3><p>æ¶ˆæ¯ä½“ä»…åŒ…å«æœ€åŸºç¡€çš„å…ƒæ•°æ®ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MobileChanged&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;entityId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eventId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uuid-001&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eventTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1654156165&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆæ¯æå°ï¼Œä¼ è¾“å¿«ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆè´¹è€…ï¼ˆSubscriberï¼‰å¿…é¡»æ‹¿ç€ <code>entityId</code> åæŸ¥èšåˆæ ¹ä¿¡æ¯ï¼Œå¯¼è‡´<strong>è¯»æ”¾å¤§</strong>ã€‚</li></ul><h3 id="2-èƒ–æ¶ˆæ¯ï¼ˆEvent-Enrichment-äº‹ä»¶å¢å¼ºï¼‰"><a href="#2-èƒ–æ¶ˆæ¯ï¼ˆEvent-Enrichment-äº‹ä»¶å¢å¼ºï¼‰" class="headerlink" title="2. èƒ–æ¶ˆæ¯ï¼ˆEvent Enrichment / äº‹ä»¶å¢å¼ºï¼‰"></a>2. èƒ–æ¶ˆæ¯ï¼ˆEvent Enrichment / äº‹ä»¶å¢å¼ºï¼‰</h3><p>æ¶ˆæ¯ä½“åŒ…å«æ¶ˆè´¹è€…æ‰€éœ€çš„ä¸šåŠ¡æ•°æ®ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MobileChanged&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">&quot;beforeMobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13800000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;afterMobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18100000000&quot;</span> <span class="comment">// å¢å¼ºå­—æ®µ</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆè´¹è€…å®Œå…¨è‡ªæ²»ï¼Œæ— éœ€åæŸ¥ï¼Œé™ä½æºç«¯ç³»ç»Ÿå‹åŠ›ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆæ¯ä½“è¾ƒå¤§ï¼›å¯èƒ½åŒ…å«æ¶ˆè´¹è€…ä¸åº”å…³å¿ƒçš„æ•æ„Ÿæ•°æ®ï¼›å­˜åœ¨æ•°æ®æ—¶æ•ˆæ€§é—®é¢˜ï¼ˆå¦‚æœæ¶ˆè´¹è€…å¤„ç†æ…¢ï¼Œæ¶ˆæ¯é‡Œçš„æ•°æ®å¯èƒ½æ˜¯æ—§çš„ï¼‰ã€‚</li></ul><blockquote><p><strong>ğŸ’¡ æ€è€ƒä¸å»ºè®®</strong>ï¼š<br>åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œä¸ºäº†å‡å°‘è·¨æœåŠ¡è°ƒç”¨å¸¦æ¥çš„è€¦åˆä¸å»¶è¿Ÿï¼Œ<strong>æ¨èé€‚åº¦çš„â€œäº‹ä»¶å¢å¼ºâ€</strong>ã€‚å³ï¼šåŒ…å«æ¶ˆè´¹è€…å¤„ç†ä¸šåŠ¡æ‰€å¿…é¡»çš„æ ¸å¿ƒå­—æ®µï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ªèšåˆæ ¹éƒ½å¡è¿›å»ã€‚</p></blockquote><hr><h2 id="ä¸‰ã€-ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ"><a href="#ä¸‰ã€-ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ" class="headerlink" title="ä¸‰ã€ ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ"></a>ä¸‰ã€ ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ</h2><p>åœ¨ä»£ç å±‚é¢ï¼Œä½•å¤„åˆ›å»ºã€ä½•å¤„å‘å¸ƒäº‹ä»¶ï¼Œç›´æ¥å½±å“ä»£ç çš„æ•´æ´åº¦ï¼ˆClean Codeï¼‰ã€‚æˆ‘ä»¬å¯¹æ¯”å››ç§å¸¸è§æ–¹æ¡ˆï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">æ–¹æ¡ˆ</th><th style="text-align:left">æè¿°</th><th style="text-align:left">è¯„ä»·</th><th style="text-align:left">å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>1. Serviceå±‚åˆ›å»º</strong></td><td style="text-align:left">ä¸šåŠ¡æ‰§è¡Œå®Œåï¼Œæ‰‹åŠ¨ <code>new Event()</code> å¹¶å‘å¸ƒ</td><td style="text-align:left"><strong>ç®€å•ç²—æš´</strong>ã€‚é€‚åˆè´«è¡€æ¨¡å‹ï¼Œä½†å®¹æ˜“å¯¼è‡´Serviceå±‚é€»è¾‘è†¨èƒ€ï¼Œå®¹æ˜“é—æ¼ã€‚</td><td style="text-align:left">â­ï¸â­ï¸</td></tr><tr><td style="text-align:left"><strong>2. èšåˆæ ¹ä¾èµ–Infra</strong></td><td style="text-align:left">èšåˆæ ¹æ³¨å…¥ <code>Publisher</code>ï¼Œå†…éƒ¨ç›´æ¥å‘å¸ƒ</td><td style="text-align:left"><strong>åæ¨¡å¼</strong>ã€‚èšåˆæ ¹ä¸åº”ä¾èµ–åŸºç¡€è®¾æ–½ï¼Œç ´åäº†POJOçš„çº¯å‡€æ€§ï¼Œä¸”å¯¼è‡´å•ä¸€èŒè´£é—®é¢˜ã€‚</td><td style="text-align:left">ğŸš«</td></tr><tr><td style="text-align:left"><strong>3. èšåˆæ ¹è¿”å›äº‹ä»¶</strong></td><td style="text-align:left">æ–¹æ³•ç­¾åæ”¹ä¸º <code>List&lt;Event&gt; doSomething()</code></td><td style="text-align:left"><strong>ä¾µå…¥æ€§å¼º</strong>ã€‚å¼ºè¡Œæ”¹å˜äº†ä¸šåŠ¡æ–¹æ³•ç­¾åï¼Œè°ƒç”¨æ–¹å¤„ç†ç¹çã€‚</td><td style="text-align:left">â­ï¸</td></tr><tr><td style="text-align:left"><strong>4. èšåˆæ ¹æš‚å­˜ + æŠ½å–</strong></td><td style="text-align:left">èšåˆæ ¹å†…éƒ¨ <code>List</code> æš‚å­˜ï¼ŒRepoä¿å­˜æ—¶æŠ½å–</td><td style="text-align:left"><strong>æœ€ä½³å®è·µ</strong>ã€‚ä¿è¯äº†èšåˆæ ¹çš„çº¯å‡€ï¼ŒåŒæ—¶åˆ©ç”¨åŸºç¡€è®¾æ–½å±‚è‡ªåŠ¨åŒ–å¤„ç†å‘å¸ƒï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚</td><td style="text-align:left">â­ï¸â­ï¸â­ï¸â­ï¸</td></tr></tbody></table></div><h3 id="æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹"><a href="#æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹" class="headerlink" title="æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹"></a>æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹</h3><p><strong>æŠ½è±¡èšåˆæ ¹åŸºç±»ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractAggregateRoot</span> &#123;</span><br><span class="line">    <span class="comment">// æš‚å­˜äº‹ä»¶ï¼Œä¸æŒä¹…åŒ–åˆ°ä¸šåŠ¡è¡¨</span></span><br><span class="line">    <span class="meta">@Transient</span> </span><br><span class="line">    <span class="keyword">private</span> List&lt;DomainEvent&gt; domainEvents = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">registerEvent</span><span class="params">(DomainEvent event)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.domainEvents.add(event);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›ç»™åŸºç¡€è®¾æ–½å±‚è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;DomainEvent&gt; <span class="title function_">pollEvents</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;DomainEvent&gt; events = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.domainEvents);</span><br><span class="line">        <span class="built_in">this</span>.domainEvents.clear();</span><br><span class="line">        <span class="keyword">return</span> events;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>ä¸šåŠ¡èšåˆæ ¹ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">AbstractAggregateRoot</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeMobile</span><span class="params">(String newMobile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mobile = newMobile;</span><br><span class="line">        <span class="comment">// ä»…ä»…æ˜¯æ³¨å†Œï¼Œä¸æ¶‰åŠIOæ“ä½œ</span></span><br><span class="line">        registerEvent(<span class="keyword">new</span> <span class="title class_">MobileChangedEvent</span>(<span class="built_in">this</span>.id, newMobile));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="å››ã€-å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦"><a href="#å››ã€-å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦" class="headerlink" title="å››ã€ å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦"></a>å››ã€ å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦</h2><p>æœ€æ ¸å¿ƒçš„å·¥ç¨‹éš¾é¢˜åœ¨äºï¼š<strong>Databaseä¿å­˜</strong> ä¸ <strong>MQæ¶ˆæ¯å‘é€</strong> æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œã€‚<br>å¦‚æœ DB æäº¤äº†ï¼Œä½† MQ æŒ‚äº†ï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥<strong>æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆTransactional Outbox Patternï¼‰</strong>ã€‚</p><h3 id="1-æ ¸å¿ƒæœºåˆ¶"><a href="#1-æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="1. æ ¸å¿ƒæœºåˆ¶"></a>1. æ ¸å¿ƒæœºåˆ¶</h3><p>åˆ©ç”¨å…³ç³»å‹æ•°æ®åº“çš„æœ¬åœ°äº‹åŠ¡ï¼ˆACIDï¼‰ï¼Œå°†â€œä¸šåŠ¡æ•°æ®ä¿å­˜â€å’Œâ€œäº‹ä»¶æ•°æ®ä¿å­˜â€æ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤ã€‚</p><ul><li><strong>Step 1</strong>: å¼€å¯äº‹åŠ¡ã€‚</li><li><strong>Step 2</strong>: Update ä¸šåŠ¡è¡¨ã€‚</li><li><strong>Step 3</strong>: Insert into <code>t_event</code> (çŠ¶æ€ï¼šPENDING)ã€‚</li><li><strong>Step 4</strong>: æäº¤äº‹åŠ¡ã€‚</li></ul><p>æ­¤æ—¶ï¼Œä¸šåŠ¡æ“ä½œå’Œäº‹ä»¶è®°å½•è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><h3 id="2-å‘é€ä¸è¡¥å¿ç­–ç•¥"><a href="#2-å‘é€ä¸è¡¥å¿ç­–ç•¥" class="headerlink" title="2. å‘é€ä¸è¡¥å¿ç­–ç•¥"></a>2. å‘é€ä¸è¡¥å¿ç­–ç•¥</h3><p>ä¿å­˜åˆ° <code>t_event</code> åï¼Œå¦‚ä½•å‘åˆ° MQï¼Ÿ</p><ul><li><strong>æ–¹æ¡ˆ Aï¼šåº”ç”¨ç›´æ¥å‘ + è½®è¯¢è¡¥å¿ï¼ˆé€‚åˆä¸­å°è§„æ¨¡ï¼‰</strong><ul><li>åº”ç”¨åœ¨äº‹åŠ¡æäº¤åï¼Œç›´æ¥å¼‚æ­¥å‘é€ MQã€‚å‘é€æˆåŠŸåˆ™æ›´æ–° <code>t_event</code> ä¸º <code>PUBLISHED</code>ã€‚</li><li>åå°å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼ˆWorkerï¼‰ï¼Œæ‰«æ <code>t_event</code> ä¸­è¶…è¿‡ 1 åˆ†é’Ÿä»ä¸º <code>PENDING</code> çš„è®°å½•ï¼Œè¿›è¡Œé‡è¯•ã€‚</li><li><em>ç¼ºç‚¹</em>ï¼šå¢åŠ äº†æ•°æ®åº“æŸ¥è¯¢å‹åŠ›ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EventJdbcRepository eventJdbcRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBusiness</span> <span class="params">(Command cmd)</span> &#123;</span><br><span class="line">        <span class="type">AggregateRoot</span> <span class="variable">root</span> <span class="operator">=</span> repository.load(bizId);</span><br><span class="line">        entity.doBusiness(cmd.getValue());</span><br><span class="line">        repository.save(root);</span><br><span class="line">        <span class="comment">// å‘å¸ƒé¢†åŸŸäº‹ä»¶</span></span><br><span class="line">        List&lt;DomainEvent&gt; domainEvents = entity.getDomainEvents();</span><br><span class="line">        publisher.publish(domainEvents);</span><br><span class="line">        <span class="comment">// é€šè¿‡äº‹ä»¶çš„EntityIdæ›´æ–°EventStoreä¸­äº‹ä»¶çš„çŠ¶æ€ä¸ºå·²å‘å¸ƒ</span></span><br><span class="line">        List&lt;String&gt; eventIds = domainEvents.stream()</span><br><span class="line">        .map(e-&gt;e.getEventId())</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">     eventJdbcRepository.publishSuccess(eventIds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">// TODO 1.æ‰«ææ•°æ®åº“è¶…æ—¶æœªå‘å¸ƒæˆåŠŸçš„é¢†åŸŸäº‹ä»¶</span></span><br><span class="line">    <span class="comment">// TODO 2.å‘å¸ƒé¢†åŸŸäº‹ä»¶åˆ°æ¶ˆæ¯ä¸­é—´ä»¶</span></span><br><span class="line">    <span class="comment">// TODO 3.ä¿®æ”¹æ•°æ®åº“é¢†åŸŸäº‹ä»¶å‘å¸ƒçŠ¶æ€ä¸ºå·²å‘å¸ƒ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>æ–¹æ¡ˆ Bï¼šäº‹åŠ¡æ—¥å¿—æ‹–å°¾ / CDCï¼ˆé€‚åˆå¤§è§„æ¨¡ï¼‰</strong><ul><li>åº”ç”¨åªç®¡å†™åº“ï¼Œä¸å‘æ¶ˆæ¯ã€‚</li><li>åˆ©ç”¨ <strong>Canal / Debezium</strong> ç›‘å¬æ•°æ®åº“çš„ Binlogã€‚</li><li>CDC ç»„ä»¶è§£æ Binlog ä¸­çš„ <code>t_event</code> æ’å…¥è®°å½•ï¼Œè‡ªåŠ¨æŠ•é€’åˆ° MQã€‚</li><li><em>ä¼˜ç‚¹</em>ï¼šåº”ç”¨å±‚å®Œå…¨è§£è€¦ï¼Œæ€§èƒ½æé«˜ã€‚</li></ul></li></ul><hr><h2 id="äº”ã€-è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ"><a href="#äº”ã€-è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ" class="headerlink" title="äº”ã€ è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ"></a>äº”ã€ è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ</h2><p>åœ¨ DDD çš„åˆ†å±‚æ¶æ„ä¸­ï¼Œäº‹ä»¶è®¢é˜…è€…ï¼ˆSubscriber/Listenerï¼‰åº”è¯¥æ”¾åœ¨å“ªé‡Œï¼Ÿ</p><p><strong>ç»“è®ºï¼šç”¨æˆ·æ¥å£å±‚ï¼ˆUser Interface / Adapters Layerï¼‰ã€‚</strong></p><ul><li><strong>ç†ç”±</strong>ï¼šè®¢é˜… MQ æ¶ˆæ¯æœ¬è´¨ä¸Šå’Œ Controller æ¥æ”¶ HTTP è¯·æ±‚æ˜¯ä¸€æ ·çš„ã€‚å®ƒä»¬éƒ½æ˜¯å¤–éƒ¨ä¸–ç•Œçš„è¾“å…¥ï¼ˆInputï¼‰ã€‚</li><li><strong>æµç¨‹</strong>ï¼š<ol><li>Subscriber æ¥æ”¶ JSON æ¶ˆæ¯ã€‚</li><li>ååºåˆ—åŒ–ä¸º DTOã€‚</li><li><strong>è°ƒç”¨ Application Service</strong> æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡å‘½ä»¤ã€‚</li></ol></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é¢†åŸŸäº‹ä»¶è®¢é˜…è€…</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DomainEventSubscriber</span> &#123;</span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        <span class="keyword">private</span> ApplicationService applicationService;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@KafkaListener(topics = &quot;domain_event_topic&quot;,groupId = &quot;local_consumer_group_id&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span> <span class="params">(String event)</span> &#123;</span><br><span class="line">            <span class="comment">// è§£æå¾—åˆ°é¢†åŸŸäº‹ä»¶</span></span><br><span class="line">            <span class="type">DomainEvent</span> <span class="variable">domainEvent</span> <span class="operator">=</span> JSON.parse(event,DomainEvent.class);</span><br><span class="line">            <span class="comment">// æ‹¼è£…Command</span></span><br><span class="line">            <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> <span class="built_in">this</span>.toCommand(domainEvent);</span><br><span class="line">            <span class="comment">// åº”ç”¨å±‚æ‰§è¡Œé¢†åŸŸæ¨¡å‹çŠ¶æ€å˜æ›´</span></span><br><span class="line">            applicationService.handleCommand(command);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰"><a href="#å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰" class="headerlink" title="å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰"></a>å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰</h3><p>ç”±äºç½‘ç»œæŠ–åŠ¨æˆ–é‡è¯•æœºåˆ¶ï¼Œæ¶ˆè´¹è€…å¿…ç„¶ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯ã€‚<strong>å¿…é¡»</strong>åˆ©ç”¨ <code>event_id</code> å»ºç«‹å”¯ä¸€ç´¢å¼•æˆ–å»é‡è¡¨ï¼Œç¡®ä¿åŒä¸€ä¸šåŠ¡é€»è¾‘ä¸æ‰§è¡Œä¸¤æ¬¡ã€‚</p><hr><h2 id="å…­ã€-æ€»ç»“"><a href="#å…­ã€-æ€»ç»“" class="headerlink" title="å…­ã€ æ€»ç»“"></a>å…­ã€ æ€»ç»“</h2><p>é¢†åŸŸäº‹ä»¶çš„è®¾è®¡ä¸ä»…ä»…æ˜¯æŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯ä¸€ç§å°†<strong>ä¸šåŠ¡æµç¨‹æ˜¾æ€§åŒ–</strong>çš„æ‰‹æ®µã€‚</p><ol><li><strong>è®¾è®¡ä¸Š</strong>ï¼šä¼˜å…ˆé€‰æ‹© <strong>â€œèšåˆæ ¹æš‚å­˜ + åŸºç¡€è®¾æ–½æŠ½å–â€</strong> çš„ç”Ÿæˆæ¨¡å¼ï¼Œä¿æŒé¢†åŸŸçº¯å‡€ã€‚</li><li><strong>æ•°æ®ä¸Š</strong>ï¼šæƒè¡¡æ¶ˆæ¯å¤§å°ï¼Œæ¨èä½¿ç”¨ <strong>å¢å¼ºå‹äº‹ä»¶</strong> å‡å°‘ä¸‹æ¸¸ä¾èµ–ã€‚</li><li><strong>æ¶æ„ä¸Š</strong>ï¼šå¿…é¡»æ­£è§†åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ï¼Œ<strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong> æ˜¯å®ç°å¯é æŠ•é€’çš„åŸºçŸ³ã€‚</li></ol><p>DDD çš„è·¯é€”è™½è¿œï¼Œä½†åªè¦å¤„ç†å¥½é¢†åŸŸäº‹ä»¶ï¼Œç³»ç»Ÿçš„è§£è€¦ä¸æ¼”è¿›å°±ä¼šå˜å¾—ä»å®¹è®¸å¤šã€‚</p><p>æœ€åæœ‰å…³äºé¢†åŸŸäº‹ä»¶è·Ÿäº‹ä»¶å›æº¯ä»¥åŠCQRSçš„ç»“åˆå¯ä»¥çœ‹ä¸“é—¨çš„æ–‡ç« ã€‚ CQRSä¸DDD: <a href="https://juejin.cn/post/7510057969265115146">https://juejin.cn/post/7510057969265115146</a> , é¢†åŸŸäº‹ä»¶ä¸äº‹ä»¶å›æº¯ï¼š<a href="https://juejin.cn/post/7510120678847184906">https://juejin.cn/post/7510120678847184906</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ&quot;&gt;&lt;a href=&quot;#DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆä¸‰) é“¾è¡¨</title>
    <link href="https://nmcb666.vip/posts/73873447.html"/>
    <id>https://nmcb666.vip/posts/73873447.html</id>
    <published>2026-01-16T16:06:09.000Z</published>
    <updated>2026-01-26T13:39:36.091Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é“¾è¡¨ç›¸å…³çš„é¢˜ç›®"><a href="#é“¾è¡¨ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="é“¾è¡¨ç›¸å…³çš„é¢˜ç›®"></a>é“¾è¡¨ç›¸å…³çš„é¢˜ç›®</h1><p>è¿™é‡Œç”¨æ¥è®°å½•é“¾è¡¨ç›¸å…³çš„é¢˜ç›®ä»¥åŠæ€è·¯</p><h2 id="ç›¸äº¤é“¾è¡¨"><a href="#ç›¸äº¤é“¾è¡¨" class="headerlink" title="ç›¸äº¤é“¾è¡¨"></a>ç›¸äº¤é“¾è¡¨</h2><p>è¾“å…¥ä¸¤ä¸ªé“¾è¡¨ï¼Œæ‰¾å‡ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ, ç¬¬ä¸€è½®è®©ä¸¤ä¸ªåˆ°è¾¾æœ«å°¾çš„èŠ‚ç‚¹æŒ‡å‘å¦ä¸€ä¸ªé“¾è¡¨çš„å¤´éƒ¨, æœ€åå¦‚æœç›¸é‡åˆ™ä¸ºäº¤ç‚¹(åœ¨ç¬¬ä¸€è½®ç§»åŠ¨ä¸­æ°å¥½æŠ¹é™¤äº†é•¿åº¦å·®)</span></span><br><span class="line"><span class="comment">        ä¸¤ä¸ªæŒ‡é’ˆç­‰äºç§»åŠ¨äº†ç›¸åŒçš„è·ç¦», æœ‰äº¤ç‚¹å°±è¿”å›, æ— äº¤ç‚¹å°±æ˜¯å„èµ°äº†ä¸¤æ¡æŒ‡é’ˆçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">        **/</span></span><br><span class="line">        <span class="keyword">if</span>(headA == <span class="literal">null</span> || headB == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pA</span> <span class="operator">=</span> headA, pB = headB;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œç¬¬ä¸€è½®ä½“ç°åœ¨pAå’ŒpBç¬¬ä¸€æ¬¡åˆ°è¾¾å°¾éƒ¨ä¼šç§»å‘å¦ä¸€é“¾è¡¨çš„è¡¨å¤´, è€Œç¬¬äºŒè½®ä½“ç°åœ¨å¦‚æœpAæˆ–pBç›¸äº¤å°±è¿”å›äº¤ç‚¹, ä¸ç›¸äº¤æœ€åå°±æ˜¯null==null</span></span><br><span class="line">        <span class="keyword">while</span>(pA != pB) &#123;</span><br><span class="line">            pA = pA == <span class="literal">null</span> ? headB : pA.next;</span><br><span class="line">            pB = pB == <span class="literal">null</span> ? headA : pB.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"><a href="#Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨" class="headerlink" title="Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"></a>Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</h2><p>æ€è·¯ï¼šæ¯kä¸ªç¿»è½¬ä¸€æ¬¡ï¼Œå¯ä»¥å•ç‹¬è¿›è¡Œåè½¬ï¼Œä½†æ³¨æ„ä¸Šä¸€ç»„çš„å°¾èŠ‚ç‚¹å’Œä¸‹ä¸€ç»„çš„å¤´èŠ‚ç‚¹è¦è¿æ¥èµ·æ¥ï¼Œæ‰€ä»¥éœ€è¦è®°å½•ä¸Šä¸€ç»„å°¾èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">start</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">end</span> <span class="operator">=</span> teamEnd(start, k);</span><br><span class="line"><span class="keyword">if</span> (end == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç»„å¾ˆç‰¹æ®Šå› ä¸ºç‰µæ‰¯åˆ°æ¢å¤´çš„é—®é¢˜</span></span><br><span class="line">head = end;</span><br><span class="line">reverse(start, end);</span><br><span class="line"><span class="comment">// ç¿»è½¬ä¹‹åstartå˜æˆäº†ä¸Šä¸€ç»„çš„ç»“å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">ListNode</span> <span class="variable">lastTeamEnd</span> <span class="operator">=</span> start;</span><br><span class="line"><span class="keyword">while</span> (lastTeamEnd.next != <span class="literal">null</span>) &#123;</span><br><span class="line">start = lastTeamEnd.next;</span><br><span class="line">end = teamEnd(start, k);</span><br><span class="line"><span class="keyword">if</span> (end == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line">reverse(start, end);</span><br><span class="line">lastTeamEnd.next = end; <span class="comment">// ä¸Šä¸€ç»„ç»“å°¾èŠ‚ç‚¹è¦è¿æ¥ä¸‹ä¸€ç»„å¤´èŠ‚ç‚¹</span></span><br><span class="line">lastTeamEnd = start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„çš„å¼€å§‹èŠ‚ç‚¹æ˜¯sï¼Œå¾€ä¸‹æ•°kä¸ªæ‰¾åˆ°å½“å‰ç»„çš„ç»“æŸèŠ‚ç‚¹è¿”å›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">teamEnd</span><span class="params">(ListNode s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (--k != <span class="number">0</span> &amp;&amp; s != <span class="literal">null</span>) &#123;</span><br><span class="line">s = s.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// s -&gt; a -&gt; b -&gt; c -&gt; e -&gt; ä¸‹ä¸€ç»„çš„å¼€å§‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// ä¸Šé¢çš„é“¾è¡¨é€šè¿‡å¦‚ä¸‹çš„reverseæ–¹æ³•è°ƒæ•´æˆ : e -&gt; c -&gt; b -&gt; a -&gt; s -&gt; ä¸‹ä¸€ç»„çš„å¼€å§‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(ListNode s, ListNode e)</span> &#123;</span><br><span class="line">e = e.next;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>, cur = s, next = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">while</span> (cur != e) &#123;</span><br><span class="line">next = cur.next;</span><br><span class="line">cur.next = pre;</span><br><span class="line">pre = cur;</span><br><span class="line">cur = next;</span><br><span class="line">&#125;</span><br><span class="line">s.next = e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éšæœºé“¾è¡¨çš„å¤åˆ¶"><a href="#éšæœºé“¾è¡¨çš„å¤åˆ¶" class="headerlink" title="éšæœºé“¾è¡¨çš„å¤åˆ¶"></a>éšæœºé“¾è¡¨çš„å¤åˆ¶</h2><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ random ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚</p><p>æ€è·¯ï¼šå°†æ¯ä¸ªèŠ‚ç‚¹å¤åˆ¶ä¸€ä»½ï¼Œå¹¶æŠŠå¤åˆ¶çš„èŠ‚ç‚¹æ”¾åœ¨åŸèŠ‚ç‚¹åé¢ï¼Œæ¯”å¦‚1-&gt;2-&gt;3-&gt;4-&gt;5ï¼Œå¤åˆ¶ä¹‹åå˜æˆ1-&gt;1â€™-&gt;2-&gt;2â€™-&gt;3-&gt;3â€™-&gt;4-&gt;4â€™-&gt;5-&gt;5â€™ï¼Œç„¶åéå†é“¾è¡¨ï¼Œå°†å¤åˆ¶çš„èŠ‚ç‚¹çš„randomæŒ‡é’ˆæŒ‡å‘åŸèŠ‚ç‚¹çš„randomæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ€åå°†é“¾è¡¨æ‹†åˆ†ï¼Œè¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">copyRandomList</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">pre</span> <span class="operator">=</span>head;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†é“¾è¡¨å¤åˆ¶ä¸²è”</span></span><br><span class="line">    <span class="keyword">while</span>(pre != <span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next;</span><br><span class="line">        pre.next = <span class="keyword">new</span> <span class="title class_">Node</span>(pre.val);</span><br><span class="line">        pre.next.next = next;</span><br><span class="line">        pre = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†randomè¿›è¡Œå¤åˆ¶</span></span><br><span class="line">    pre = head;</span><br><span class="line">    <span class="keyword">while</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next.next;</span><br><span class="line">        pre.next.random = pre.random == <span class="literal">null</span> ? <span class="literal">null</span> : pre.random.next;</span><br><span class="line">        pre = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ†ç¦»ä¸¤ä¸ªé“¾è¡¨</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">newHead</span> <span class="operator">=</span> head.next;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">newPre</span> <span class="operator">=</span> newHead;</span><br><span class="line">    pre =head;</span><br><span class="line">    <span class="keyword">while</span>(pre != <span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next.next;</span><br><span class="line">        newPre.next = next == <span class="literal">null</span> ? <span class="literal">null</span> : next.next ;</span><br><span class="line">        pre.next = next;</span><br><span class="line">        pre =next;</span><br><span class="line">        newPre = newPre.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­å›æ–‡é“¾è¡¨"><a href="#åˆ¤æ–­å›æ–‡é“¾è¡¨" class="headerlink" title="åˆ¤æ–­å›æ–‡é“¾è¡¨"></a>åˆ¤æ–­å›æ–‡é“¾è¡¨</h2><p>æ€è·¯ï¼šåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œæ‰¾åˆ°ä¸­ç‚¹ï¼Œç„¶åç¿»è½¬ååŠéƒ¨åˆ†é“¾è¡¨ï¼Œæ¯”è¾ƒå‰åä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ç›¸ç­‰ã€‚æœ€åæ¢å¤é“¾è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(head.next==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//åˆ©ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­ç‚¹</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">man</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">kuai</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span> (kuai.next != <span class="literal">null</span> &amp;&amp; kuai.next.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        man = man.next;</span><br><span class="line">        kuai = kuai.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">reverseHead</span> <span class="operator">=</span> reverseList(man);</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">isPal</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">reversePre</span> <span class="operator">=</span>reverseHead;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span>(reversePre!=<span class="literal">null</span> &amp;&amp; pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(pre.val!=reversePre.val)&#123;</span><br><span class="line">            isPal = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        reversePre = reversePre.next;</span><br><span class="line">        pre = pre.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é“¾è¡¨è¿˜åŸ</span></span><br><span class="line">    reverseList(reverseHead);</span><br><span class="line">    <span class="keyword">return</span> isPal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span>&#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>,next=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">        next =head.next;</span><br><span class="line">        head.next = pre;</span><br><span class="line">        pre =head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯-å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹"><a href="#é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯-å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹" class="headerlink" title="é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹"></a>é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹</h2><p>æ€è·¯ï¼šåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå¿«æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œå¦‚æœå¿«æ…¢æŒ‡é’ˆç›¸é‡ï¼Œåˆ™è¯´æ˜é“¾è¡¨æœ‰ç¯ï¼Œå¦åˆ™æ²¡æœ‰ç¯ã€‚ç›¸é‡çš„æ—¶å€™ï¼Œå¿«æŒ‡é’ˆå›åˆ°å¤´èŠ‚ç‚¹ï¼Œæ…¢æŒ‡é’ˆç»§ç»­ç§»åŠ¨ï¼Œä½†æ˜¯æ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆæ¯æ¬¡éƒ½ç§»åŠ¨ä¸€æ­¥ï¼Œå†æ¬¡ç›¸é‡çš„æ—¶å€™å°±æ˜¯ç¯çš„å…¥å£èŠ‚ç‚¹ã€‚ a+(nb+c) = 2(a+c)  a = nb - c  æ‰€ä»¥æ…¢æŒ‡é’ˆå†èµ°aæ­¥ï¼Œå°±èƒ½åˆ°è¾¾å…¥å£èŠ‚ç‚¹ã€‚æ­¤æ—¶å¿«æŒ‡é’ˆä¹Ÿèµ°aæ­¥ï¼Œæ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆç›¸é‡çš„èŠ‚ç‚¹å°±æ˜¯å…¥å£èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span>head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="literal">null</span> &amp;&amp; fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        <span class="keyword">if</span>(fast==slow)&#123;</span><br><span class="line">            fast = head;</span><br><span class="line">            <span class="keyword">while</span>(fast!=slow)&#123;</span><br><span class="line">                fast = fast.next;</span><br><span class="line">                slow = slow.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> slow;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ’åºé“¾è¡¨"><a href="#æ’åºé“¾è¡¨" class="headerlink" title="æ’åºé“¾è¡¨"></a>æ’åºé“¾è¡¨</h2><p>è¦æ±‚ï¼šæ—¶é—´å¤æ‚åº¦nlog(n),ç©ºé—´å¤æ‚åº¦O(1)ï¼Œä¸”ç¨³å®š<br>æ€è·¯ï¼šåˆ©ç”¨éé€’å½’ç‰ˆæœ¬çš„å½’å¹¶æ’åºï¼Œå¹¶ä¸”mergeæ˜¯åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ã€‚<br>ä»£ç å¾ˆå¤æ‚ï¼Œçœ‹çœ‹å°±å¥½<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// æ—¶é—´å¤æ‚åº¦O(n*logn)ï¼Œé¢å¤–ç©ºé—´å¤æ‚åº¦O(1)ï¼Œæœ‰ç¨³å®šæ€§</span></span><br><span class="line"><span class="comment">// æ³¨æ„ä¸ºäº†é¢å¤–ç©ºé—´å¤æ‚åº¦O(1)ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨é€’å½’</span></span><br><span class="line"><span class="comment">// å› ä¸ºmergeSorté€’å½’éœ€è¦O(log n)çš„é¢å¤–ç©ºé—´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">sortList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">n++;</span><br><span class="line">cur = cur.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// l1...r1 æ¯ç»„çš„å·¦éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// l2...r2 æ¯ç»„çš„å³éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// next ä¸‹ä¸€ç»„çš„å¼€å¤´</span></span><br><span class="line"><span class="comment">// lastTeamEnd ä¸Šä¸€ç»„çš„ç»“å°¾</span></span><br><span class="line">ListNode l1, r1, l2, r2, next, lastTeamEnd;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">step</span> <span class="operator">=</span> <span class="number">1</span>; step &lt; n; step &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç»„å¾ˆç‰¹æ®Šï¼Œå› ä¸ºè¦å†³å®šæ•´ä¸ªé“¾è¡¨çš„å¤´ï¼Œæ‰€ä»¥å•ç‹¬å¤„ç†</span></span><br><span class="line">l1 = head;</span><br><span class="line">r1 = findEnd(l1, step);</span><br><span class="line">l2 = r1.next;</span><br><span class="line">r2 = findEnd(l2, step);</span><br><span class="line">next = r2.next;</span><br><span class="line">r1.next = <span class="literal">null</span>;</span><br><span class="line">r2.next = <span class="literal">null</span>;</span><br><span class="line">merge(l1, r1, l2, r2);</span><br><span class="line">head = start;</span><br><span class="line">lastTeamEnd = end;</span><br><span class="line"><span class="keyword">while</span> (next != <span class="literal">null</span>) &#123;</span><br><span class="line">l1 = next;</span><br><span class="line">r1 = findEnd(l1, step);</span><br><span class="line">l2 = r1.next;</span><br><span class="line"><span class="keyword">if</span> (l2 == <span class="literal">null</span>) &#123;</span><br><span class="line">lastTeamEnd.next = l1;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">r2 = findEnd(l2, step);</span><br><span class="line">next = r2.next;</span><br><span class="line">r1.next = <span class="literal">null</span>;</span><br><span class="line">r2.next = <span class="literal">null</span>;</span><br><span class="line">merge(l1, r1, l2, r2);</span><br><span class="line">lastTeamEnd.next = start;</span><br><span class="line">lastTeamEnd = end;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ…æ‹¬såœ¨å†…ï¼Œå¾€ä¸‹æ•°kä¸ªèŠ‚ç‚¹è¿”å›</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸å¤Ÿï¼Œè¿”å›æœ€åä¸€ä¸ªæ•°åˆ°çš„éç©ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">findEnd</span><span class="params">(ListNode s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (s.next != <span class="literal">null</span> &amp;&amp; --k != <span class="number">0</span>) &#123;</span><br><span class="line">s = s.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode start;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode end;</span><br><span class="line"></span><br><span class="line"><span class="comment">// l1...r1 -&gt; null : æœ‰åºçš„å·¦éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// l2...r2 -&gt; null : æœ‰åºçš„å³éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// æ•´ä½“mergeåœ¨ä¸€èµ·ï¼Œä¿è¯æœ‰åº</span></span><br><span class="line"><span class="comment">// å¹¶ä¸”æŠŠå…¨å±€å˜é‡startè®¾ç½®ä¸ºæ•´ä½“çš„å¤´ï¼Œå…¨å±€å˜é‡endè®¾ç½®ä¸ºæ•´ä½“çš„å°¾</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(ListNode l1, ListNode r1, ListNode l2, ListNode r2)</span> &#123;</span><br><span class="line">ListNode pre;</span><br><span class="line"><span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">start = l1;</span><br><span class="line">pre = l1;</span><br><span class="line">l1 = l1.next;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">start = l2;</span><br><span class="line">pre = l2;</span><br><span class="line">l2 = l2.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (l1 != <span class="literal">null</span> &amp;&amp; l2 != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">pre.next = l1;</span><br><span class="line">pre = l1;</span><br><span class="line">l1 = l1.next;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre.next = l2;</span><br><span class="line">pre = l2;</span><br><span class="line">l2 = l2.next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">pre.next = l1;</span><br><span class="line">end = r1;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre.next = l2;</span><br><span class="line">end = r2;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å®ç°LRUç¼“å­˜"><a href="#å®ç°LRUç¼“å­˜" class="headerlink" title="å®ç°LRUç¼“å­˜"></a>å®ç°LRUç¼“å­˜</h2><p>æ€è·¯ï¼šåˆ©ç”¨åŒå‘é“¾è¡¨å’ŒHashMapï¼ŒåŒå‘é“¾è¡¨è´Ÿè´£ç»´æŠ¤æœ€ä¹…æœªä½¿ç”¨çš„é¡ºåºï¼ˆæœ€ä¹…æœªä½¿ç”¨æ”¾åˆ°å¤´èŠ‚ç‚¹ï¼Œåªè¦ä½¿ç”¨å°±æ”¾åˆ°å°¾èŠ‚ç‚¹ï¼‰ï¼ˆå®ç°ä¸‰ä¸ªåŠŸèƒ½ 1.åŠ å…¥èŠ‚ç‚¹(ç›´æ¥æ”¾å…¥å°¾éƒ¨)ï¼Œ2.å°†å·²ç»æœ‰çš„èŠ‚ç‚¹æ”¾å…¥å°¾éƒ¨ï¼Œ3.åˆ é™¤å¤´èŠ‚ç‚¹ï¼‰ï¼ŒHashMapå®ç°å¿«é€ŸæŸ¥æ‰¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Listnode</span>&#123;</span><br><span class="line">            <span class="type">int</span> val;</span><br><span class="line">            <span class="type">int</span> key;</span><br><span class="line">            Listnode last;</span><br><span class="line">            Listnode next;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">Listnode</span><span class="params">(<span class="type">int</span> val,<span class="type">int</span> key)</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.val =val;</span><br><span class="line">                <span class="built_in">this</span>.key =key;</span><br><span class="line">                last =<span class="literal">null</span>;</span><br><span class="line">                next =<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">doubleList</span>&#123;</span><br><span class="line">            Listnode head;</span><br><span class="line">            Listnode tail;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">doubleList</span><span class="params">()</span>&#123;</span><br><span class="line">                head =<span class="literal">null</span>;</span><br><span class="line">                tail =<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNode</span><span class="params">(Listnode node)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(head == <span class="literal">null</span>)&#123;</span><br><span class="line">                    head = node;</span><br><span class="line">                    tail = node;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    tail.next = node;</span><br><span class="line">                    node.last = tail;</span><br><span class="line">                    tail = node;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveNode2Tail</span><span class="params">(Listnode node)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (tail == node) &#123;  <span class="comment">/// å¦‚æœæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ä¸éœ€è¦ç§»åŠ¨</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node == head)&#123;</span><br><span class="line">                    head = node.next;</span><br><span class="line">                    head.last =<span class="literal">null</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    node.last.next = node.next;</span><br><span class="line">                    node.next.last = node.last;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                tail.next = node;</span><br><span class="line">                node.last = tail;</span><br><span class="line">                node.next = <span class="literal">null</span>;</span><br><span class="line">                tail =node;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> Listnode <span class="title function_">delHead</span><span class="params">()</span>&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">h</span> <span class="operator">=</span>head;</span><br><span class="line">                <span class="keyword">if</span>(head == tail)&#123;</span><br><span class="line">                    head = <span class="literal">null</span>;</span><br><span class="line">                    tail =<span class="literal">null</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Listnode</span> <span class="variable">next</span> <span class="operator">=</span>head.next;</span><br><span class="line">                    head.next = <span class="literal">null</span>;</span><br><span class="line">                    head = next;</span><br><span class="line">                    head.last = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> h;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> HashMap&lt;Integer,Listnode&gt; myMap;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span>  <span class="type">int</span> <span class="variable">MaxCap</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span> doubleList myList;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cap = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">this</span>.MaxCap = capacity;</span><br><span class="line">            myMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer,Listnode&gt;();</span><br><span class="line">            myList = <span class="keyword">new</span> <span class="title class_">doubleList</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(myMap.containsKey(key))&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> myMap.get(key);</span><br><span class="line">                myList.moveNode2Tail(node);</span><br><span class="line">                <span class="keyword">return</span> node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(myMap.containsKey(key))&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> myMap.get(key);</span><br><span class="line">                node.val = value;</span><br><span class="line">                myList.moveNode2Tail(node);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(cap == MaxCap)&#123;</span><br><span class="line">                    myMap.remove(myList.delHead().key);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    cap++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Listnode</span>(value,key);</span><br><span class="line">                myMap.put(key,node);</span><br><span class="line">                myList.addNode(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;p&gt;è¿™é‡Œç”¨æ¥è®°å½•é“¾è¡¨ç›¸å…³çš„é¢˜ç›®ä»¥åŠæ€è·¯&lt;/p&gt;
&lt;h2 id=&quot;ç›¸äº¤é“¾è¡¨&quot;&gt;&lt;a href=&quot;#ç›¸äº¤é“¾è¡¨</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çš„æ€»ç»“</title>
    <link href="https://nmcb666.vip/posts/fee9ca7b.html"/>
    <id>https://nmcb666.vip/posts/fee9ca7b.html</id>
    <published>2026-01-15T14:13:30.000Z</published>
    <updated>2026-01-26T13:39:36.090Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><h3 id="TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ"><a href="#TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ" class="headerlink" title="TC å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ"></a>TC å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ</h3><p>ä»¥Seateæ¡†æ¶ä¸ºä¾‹ï¼Œåœ¨TMå‘TCå‘é€å…¨å±€äº‹åŠ¡å¼€å§‹æ—¶ï¼ŒTCä¼šç”Ÿæˆå¯¹åº”çš„å…¨å±€äº‹åŠ¡IDï¼ˆXIDï¼‰ï¼Œå¹¶å‘é€ç»™TMã€‚TM å°† XID æ”¾å…¥å½“å‰çº¿ç¨‹çš„ ThreadLocal ä¸­ï¼Œåç»­çš„ RM (èµ„æºç®¡ç†å™¨) åˆ†æ”¯äº‹åŠ¡é€šè¿‡è§£æè¯¥ XID æ¥æ³¨å†Œåˆ†æ”¯ã€‚å¦‚æœæ¶‰åŠRPCè°ƒç”¨ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ä¼šåœ¨è¯·æ±‚å¤´éƒ¨ä¼ é€’è¿™ä¸ªXIDï¼Œè®©RMçŸ¥é“è¿™ä¸ªXID,RMå‘TCå‘é€åˆ†æ”¯äº‹åŠ¡å¼€å§‹æ—¶,å°±ä¼šæºå¸¦è¿™ä¸ªXID,ä»è€Œå‘Šè¯‰TCè¿™ä¸ªRMå±äºå“ªä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</p><p>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹çš„XIDæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥æ— æ³•ç¡®å®šå“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚è¿™æ—¶å…¨å±€äº‹åŠ¡ä¼šå¤±æ•ˆã€‚è§£å†³æ–¹æ¡ˆå¯ä»¥æ˜¯åœ¨å¼€å¯æ–°çº¿ç¨‹æ—¶ï¼Œå°†XIDä¼ é€’ç»™æ–°çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹çš„XIDä¼šç»§æ‰¿çˆ¶çº¿ç¨‹çš„XIDã€‚è¿™æ ·å­çº¿ç¨‹çš„XIDå°±ä¼šå’Œçˆ¶çº¿ç¨‹çš„XIDä¸€è‡´ï¼Œä»è€Œå¯ä»¥ç¡®å®šå“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-15%20142842.png" alt="æµç¨‹å›¾ç‰‡"/></div><span class="image-caption">æµç¨‹å›¾ç‰‡</span></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#åˆ†å¸ƒå¼äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;/a&gt;åˆ†å¸ƒå¼äº‹åŠ¡&lt;/h2&gt;&lt;h3 id=&quot;TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ&quot;&gt;&lt;a href=&quot;#TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡</summary>
      
    
    
    
    
    <category term="å…«è‚¡" scheme="https://nmcb666.vip/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
  <entry>
    <title>DDDä¸MVCçš„ç»Ÿä¸€</title>
    <link href="https://nmcb666.vip/posts/f4b47790.html"/>
    <id>https://nmcb666.vip/posts/f4b47790.html</id>
    <published>2026-01-11T18:50:35.000Z</published>
    <updated>2026-01-26T13:39:36.088Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ"><a href="#MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ" class="headerlink" title="MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ"></a>MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ</h1><p>åœ¨åç«¯å¼€å‘å­¦ä¹ å’Œå®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šè¢«å„ç§æ¶æ„æ¨¡å¼å’Œè®¾è®¡æ€æƒ³å›´ç»•â€”â€”MVCã€Service+DAOåˆ†å±‚ã€DDDå››å±‚æ¶æ„ï¼ˆDDDå¹¶éä¸å››å±‚æ¶æ„ç»‘å®š DDDæ˜¯æ€æƒ³ï¼Œå››å±‚æ¶æ„æ˜¯ä»£ç è½åœ°çš„ä¸€ä¸ªæ¶æ„ï¼‰â€¦â€¦è¿™äº›æ¦‚å¿µä¹‹é—´åˆ°åº•æ˜¯æ›¿ä»£å…³ç³»è¿˜æ˜¯äº’è¡¥å…³ç³»ï¼Ÿä¸ºä»€ä¹ˆç®€å•ä¸šåŠ¡ç”¨Service+DAOå°±å¤Ÿï¼Œå¤æ‚ä¸šåŠ¡å´è¦å¼•å…¥DDDï¼Ÿç»“åˆè¿‘æœŸçš„å­¦ä¹ æ€è€ƒï¼Œæˆ‘æƒ³æ¢³ç†æ¸…æ¥šè¿™äº›æ¶æ„ä¹‹é—´çš„æ ¸å¿ƒå…³è”ï¼Œå¸®è‡ªå·±ï¼ˆä¹Ÿå¸Œæœ›å¸®åˆ°åŒæ ·å›°æƒ‘çš„åŒå­¦ï¼‰å»ºç«‹æ¸…æ™°çš„è®¤çŸ¥ã€‚</p><h2 id="ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜"><a href="#ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜" class="headerlink" title="ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜"></a>ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜</h2><p>æœ€æ—©æ¥è§¦åç«¯å¼€å‘æ—¶ï¼ŒMVCæ˜¯ç»•ä¸å¼€çš„å…¥é—¨æ¶æ„ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼šå°†è½¯ä»¶åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒå±‚çº§ï¼Œå®ç°â€œå±•ç¤ºä¸é€»è¾‘â€çš„åˆæ­¥è§£è€¦ã€‚</p><ul><li><p><strong>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰</strong>ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ã€åè°ƒåç»­å¤„ç†ã€è¿”å›å“åº”ï¼Œç›¸å½“äºç³»ç»Ÿçš„â€œå…¥å£/å‡ºå£â€ï¼Œä¸æ‰¿è½½æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼›</p></li><li><p><strong>Modelï¼ˆæ¨¡å‹ï¼‰</strong>ï¼šå°è£…æ•°æ®å’Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ˜¯ç³»ç»Ÿçš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£æ•°æ®çš„å¢åˆ æ”¹æŸ¥å’Œä¸šåŠ¡è§„åˆ™æ ¡éªŒï¼›</p></li><li><p><strong>Viewï¼ˆè§†å›¾ï¼‰</strong>ï¼šå±•ç¤ºæ•°æ®ï¼Œä¸ç”¨æˆ·ç›´æ¥äº¤äº’ï¼ˆå‰åç«¯åˆ†ç¦»åœºæ™¯ä¸‹ï¼Œå‰ç«¯é¡µé¢å³Viewå±‚ï¼Œåç«¯ä¸å†å…³æ³¨ï¼‰ã€‚</p></li></ul><p>MVCçš„ä»·å€¼åœ¨äºç»™å‡ºäº†â€œä»£ç è¯¥æ”¾å“ªâ€çš„æ˜ç¡®ç­”æ¡ˆï¼Œè§£å†³äº†æ—©æœŸå¼€å‘ä¸­â€œä¸šåŠ¡é€»è¾‘ä¸é¡µé¢å±•ç¤ºæ··åœ¨ä¸€èµ·â€çš„æ··ä¹±é—®é¢˜ã€‚ä½†å®ƒçš„å±€é™æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼šModelå±‚æ˜¯ä¸€ä¸ªâ€œå¤§é»‘ç›’â€ï¼Œæ²¡æœ‰æ˜ç¡®çš„å†…éƒ¨åˆ’åˆ†æ ‡å‡†â€”â€”å½“ä¸šåŠ¡ç®€å•æ—¶ï¼Œä¸€ä¸ªService+Mapperå°±èƒ½æ’‘èµ·Modelå±‚ï¼›ä½†å½“ä¸šåŠ¡å¤æ‚ï¼ˆæ¯”å¦‚ç”µå•†è®¢å•å±¥çº¦ã€é‡‘èé£æ§ï¼‰æ—¶ï¼Œç›´æ¥æŠŠæ‰€æœ‰é€»è¾‘å †åœ¨Serviceé‡Œï¼Œå¾ˆå¿«å°±ä¼šå¯¼è‡´ä»£ç è‡ƒè‚¿ã€é€»è¾‘æ··ä¹±ã€éš¾ä»¥ç»´æŠ¤ã€‚</p><h2 id="äºŒã€æ¼”è¿›ï¼šService-DAOåˆ†å±‚â€”â€”MVC-Modelå±‚çš„ç®€æ˜“æ‹†åˆ†"><a href="#äºŒã€æ¼”è¿›ï¼šService-DAOåˆ†å±‚â€”â€”MVC-Modelå±‚çš„ç®€æ˜“æ‹†åˆ†" class="headerlink" title="äºŒã€æ¼”è¿›ï¼šService+DAOåˆ†å±‚â€”â€”MVC Modelå±‚çš„ç®€æ˜“æ‹†åˆ†"></a>äºŒã€æ¼”è¿›ï¼šService+DAOåˆ†å±‚â€”â€”MVC Modelå±‚çš„ç®€æ˜“æ‹†åˆ†</h2><p>ä¸ºäº†å¼¥è¡¥MVC Modelå±‚çš„æ¨¡ç³Šæ€§ï¼Œåœ¨Springç”Ÿæ€å®è·µä¸­ï¼Œæˆ‘ä»¬è‡ªç„¶æ¼”åŒ–å‡ºäº†â€œController+Service+DAOï¼ˆMapperï¼‰â€çš„ä¸‰å±‚è½åœ°æ–¹æ¡ˆã€‚è¿™æœ¬è´¨ä¸Šæ˜¯å¯¹MVCçš„Modelå±‚åšäº†ç¬¬ä¸€æ¬¡â€œç²—ç²’åº¦æ‹†åˆ†â€ï¼Œè®©èŒè´£æ›´æ¸…æ™°ï¼š</p><ul><li><p><strong>Controllerå±‚</strong>ï¼šå®Œå…¨å¯¹åº”MVCçš„Controllerå±‚ï¼Œè´Ÿè´£è¯·æ±‚æ¥æ”¶ã€å‚æ•°ç®€å•æ ¡éªŒã€è°ƒç”¨Serviceå±‚ï¼›</p></li><li><p><strong>Serviceå±‚</strong>ï¼šå¯¹åº”MVC Modelå±‚çš„â€œä¸šåŠ¡é€»è¾‘æ ¸å¿ƒâ€ï¼Œå®ç°è®¢å•æ”¯ä»˜ã€åº“å­˜æ‰£å‡ç­‰æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ï¼›</p></li><li><p><strong>DAOï¼ˆMapperï¼‰å±‚</strong>ï¼šå¯¹åº”MVC Modelå±‚çš„â€œæ•°æ®è®¿é—®éƒ¨åˆ†â€ï¼Œä»…è´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ï¼Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚</p></li></ul><p>è¿™ç§æ‹†åˆ†æ–¹æ¡ˆç®€å•ç›´è§‚ã€å¼€å‘æ•ˆç‡é«˜ï¼Œéå¸¸é€‚åˆç®€å•CRUDåœºæ™¯ï¼ˆæ¯”å¦‚å°å‹ç®¡ç†åå°ã€ä¸ªäººå·¥å…·ï¼‰ã€‚ä½†å®ƒçš„é—®é¢˜åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹ä¼šæš´éœ²æ— é—ï¼šServiceå±‚å¾ˆå®¹æ˜“å˜æˆâ€œä¸‡èƒ½å±‚â€â€”â€”æ—¢è¦å¤„ç†è·¨å®ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼ˆæ¯”å¦‚æ”¯ä»˜éœ€è¦åè°ƒè®¢å•ã€åº“å­˜ã€æ”¯ä»˜ä¸‰ä¸ªæ¨¡å—ï¼‰ï¼Œåˆè¦å…¼é¡¾äº‹åŠ¡æ§åˆ¶ã€æ•°æ®ç»„è£…ç­‰è¾…åŠ©é€»è¾‘ï¼Œæœ€ç»ˆå¯¼è‡´Serviceå±‚ä»£ç è‡ƒè‚¿ã€é€»è¾‘ç¼ ç»•ï¼Œåç»­è¿­ä»£å’Œç»´æŠ¤æˆæœ¬æé«˜ã€‚</p><h2 id="ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC-Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§"><a href="#ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC-Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§" class="headerlink" title="ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§"></a>ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§</h2><p>å½“ä¸šåŠ¡å¤æ‚åº¦ä¸Šå‡åˆ°ä¸€å®šç¨‹åº¦ï¼ŒDDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰å°±æˆäº†æ›´ä¼˜çš„é€‰æ‹©ã€‚å¾ˆå¤šäººä¼šè¯¯ä»¥ä¸ºDDDæ˜¯â€œæ›¿ä»£MVCâ€çš„æ¶æ„ï¼Œå…¶å®ä¸ç„¶â€”â€”DDDæœ¬è´¨ä¸Šæ˜¯ä¸€å¥—â€œä¸šåŠ¡å»ºæ¨¡æ–¹æ³•è®ºâ€ï¼Œå®ƒåœ¨MVCçš„å¤§æ¡†æ¶ä¸‹ï¼Œå¯¹Modelå±‚åšäº†æ›´ç²¾ç»†çš„æ‹†åˆ†ï¼Œè®©å¤æ‚ä¸šåŠ¡é€»è¾‘æ›´æ¸…æ™°ã€æ›´è´´åˆä¸šåŠ¡æœ¬èº«ã€‚</p><p>DDDæå‡ºçš„å››å±‚æ¶æ„ï¼ˆç”¨æˆ·å±‚/æ¥å£å±‚ã€åº”ç”¨å±‚ã€é¢†åŸŸå±‚ã€åŸºç¡€è®¾æ–½å±‚ï¼‰ï¼Œä¸MVCã€Service+DAOåˆ†å±‚çš„å¯¹åº”å…³ç³»éå¸¸æ¸…æ™°ï¼Œæ ¸å¿ƒç»“è®ºå…ˆæŠ›å‡ºæ¥ï¼š<strong>DDDçš„ç”¨æˆ·å±‚å¯¹åº”MVCçš„Controllerå±‚ï¼Œåä¸‰å±‚å…±åŒæ„æˆMVCçš„Modelå±‚ï¼›DDDä¸MVCå®Œå…¨å…¼å®¹ï¼Œåªæ˜¯å¯¹Modelå±‚çš„æ‹†åˆ†æ›´å½»åº•</strong>ã€‚</p><h3 id="1-DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»"><a href="#1-DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»" class="headerlink" title="1. DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»"></a>1. DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»</h3><div class="table-container"><table><thead><tr><th>DDDå››å±‚æ¶æ„</th><th>æ ¸å¿ƒèŒè´£</th><th>å¯¹åº”MVCåˆ†å±‚</th><th>å¯¹åº”Service+DAOåˆ†å±‚</th><th>Springå®è·µè½åœ°</th></tr></thead><tbody><tr><td>ç”¨æˆ·å±‚ï¼ˆæ¥å£å±‚ï¼‰</td><td>æ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼ˆHTTP/RPC/æ¶ˆæ¯ï¼‰ã€è¿”å›å“åº”ã€å‚æ•°éä¸šåŠ¡æ ¡éªŒã€æƒé™æ‹¦æˆª</td><td>Controllerå±‚</td><td>Controllerå±‚</td><td>@RestControllerã€ControllerAdviceã€RPCæ¥å£</td></tr><tr><td>åº”ç”¨å±‚</td><td>åè°ƒé¢†åŸŸå±‚æ‰§è¡Œã€å¤„ç†äº‹åŠ¡ã€ç»„è£…è¿”å›æ•°æ®ï¼Œæ— æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</td><td>Modelå±‚</td><td>Serviceå±‚çš„â€œåè°ƒéƒ¨åˆ†â€</td><td>XXXApplicationServiceï¼ˆåº”ç”¨æœåŠ¡ï¼‰</td></tr><tr><td>é¢†åŸŸå±‚</td><td>å°è£…æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€èšåˆæ ¹/å®ä½“/å€¼å¯¹è±¡ã€è·¨å®ä½“ä¸šåŠ¡é€»è¾‘ï¼Œç³»ç»Ÿæ ¸å¿ƒ</td><td>Modelå±‚ï¼ˆæ ¸å¿ƒï¼‰</td><td>Serviceå±‚çš„â€œæ ¸å¿ƒä¸šåŠ¡éƒ¨åˆ†â€</td><td>èšåˆæ ¹ï¼ˆEntityï¼‰ã€XXXDomainServiceï¼ˆé¢†åŸŸæœåŠ¡ï¼‰</td></tr><tr><td>åŸºç¡€è®¾æ–½å±‚</td><td>å°è£…æŠ€æœ¯ç»†èŠ‚ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€ç¬¬ä¸‰æ–¹æ¥å£ï¼‰ï¼Œä¸ºä¸Šå±‚æä¾›æŠ€æœ¯æ”¯æ’‘</td><td>Modelå±‚</td><td>DAOï¼ˆMapperï¼‰å±‚</td><td>Repositoryã€Mapperã€RedisTemplateã€Feignå®¢æˆ·ç«¯</td></tr></tbody></table></div><h3 id="2-å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡-é¢†åŸŸæœåŠ¡â€"><a href="#2-å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡-é¢†åŸŸæœåŠ¡â€" class="headerlink" title="2. å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡+é¢†åŸŸæœåŠ¡â€"></a>2. å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡+é¢†åŸŸæœåŠ¡â€</h3><p>DDDå¯¹Service+DAOåˆ†å±‚çš„æ ¸å¿ƒä¼˜åŒ–ï¼Œå°±æ˜¯æŠŠä¼ ç»Ÿâ€œåšServiceâ€æ‹†æˆäº†â€œè–„åº”ç”¨æœåŠ¡â€å’Œâ€œåšé¢†åŸŸæœåŠ¡â€ï¼Œè®©ä¸šåŠ¡é€»è¾‘çš„å½’å±æ›´æ˜ç¡®ï¼š</p><ul><li><p><strong>é¢†åŸŸæœåŠ¡</strong>ï¼šåªè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚â€œè®¢å•æ”¯ä»˜â€éœ€è¦æ ¡éªŒè®¢å•çŠ¶æ€ã€æ‰£å‡åº“å­˜ã€æ›´æ–°æ”¯ä»˜çŠ¶æ€ç­‰è·¨å®ä½“é€»è¾‘ï¼Œéƒ½æ”¾åœ¨é¢†åŸŸæœåŠ¡ï¼›</p></li><li><p><strong>åº”ç”¨æœåŠ¡</strong>ï¼šä¸ç¢°æ ¸å¿ƒä¸šåŠ¡ï¼Œåªåšâ€œåè°ƒå·¥ä½œâ€â€”â€”æ¯”å¦‚å¼€å¯äº‹åŠ¡ã€è°ƒç”¨é¢†åŸŸæœåŠ¡ã€æŠŠé¢†åŸŸå±‚çš„ç»“æœç»„è£…æˆå‰ç«¯éœ€è¦çš„æ ¼å¼ã€‚</p></li></ul><p>åŒæ—¶ï¼ŒDDDè¿˜å¼ºè°ƒâ€œä¸šåŠ¡é©±åŠ¨å»ºæ¨¡â€ï¼šå…ˆæ¢³ç†ä¸šåŠ¡é¢†åŸŸçš„è§„åˆ™ï¼ˆæ¯”å¦‚â€œæœªæ”¯ä»˜è®¢å•24å°æ—¶è‡ªåŠ¨å–æ¶ˆâ€ï¼‰ï¼Œå†æŠŠè¿™äº›è§„åˆ™å°è£…åˆ°å®ä½“ç±»ä¸­ï¼ˆæ¯”å¦‚Orderå®ä½“çš„canPay()ã€markAsPaid()æ–¹æ³•ï¼‰ï¼Œè€Œä¸æ˜¯åƒä¼ ç»ŸService+DAOé‚£æ ·ï¼ŒæŠŠæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½å†™åœ¨Serviceçš„if-elseé‡Œã€‚è¿™ç§æ–¹å¼è®©ä»£ç æ›´è´´åˆä¸šåŠ¡ï¼Œåç»­è¿­ä»£æ—¶ä¹Ÿæ›´å®¹æ˜“ç†è§£å’Œä¿®æ”¹ã€‚</p><h2 id="å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ"><a href="#å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ" class="headerlink" title="å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ"></a>å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ</h2><p>æ¢³ç†å®Œä»MVCåˆ°Service+DAOï¼Œå†åˆ°DDDçš„æ¼”è¿›è„‰ç»œï¼Œä¼šå‘ç°ä¸€ä¸ªæ ¸å¿ƒè§„å¾‹ï¼š<strong>æ‰€æœ‰æ¶æ„åˆ†å±‚çš„æœ€ç»ˆç›®æ ‡éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯é’ˆå¯¹ä¸åŒä¸šåŠ¡å¤æ‚åº¦ï¼Œé€‰æ‹©äº†ä¸åŒçš„æ‹†åˆ†ç²’åº¦</strong>ã€‚</p><ul><li><p>MVCï¼šè§£å†³â€œå±•ç¤ºä¸é€»è¾‘â€çš„è§£è€¦ï¼Œç»™å‡ºæœ€åŸºç¡€çš„åˆ†å±‚æ¡†æ¶ï¼›</p></li><li><p>Service+DAOï¼šè§£å†³MVC Modelå±‚çš„å†…éƒ¨è§£è€¦ï¼Œè®©æ•°æ®è®¿é—®å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œé€‚é…ç®€å•ä¸šåŠ¡ï¼›</p></li><li><p>DDDï¼šè§£å†³å¤æ‚ä¸šåŠ¡ä¸‹Modelå±‚çš„æ·±åº¦è§£è€¦ï¼Œè®©æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€åè°ƒé€»è¾‘ã€æŠ€æœ¯ç»†èŠ‚å½»åº•åˆ†ç¦»ï¼Œé€‚é…å¤æ‚ä¸šåŠ¡ã€‚</p></li></ul><p>å¾ˆå¤šäººä¼šè¯¯ä»¥ä¸ºâ€œDDDæ¯”MVCé«˜çº§â€â€œç”¨äº†DDDå°±ä¸èƒ½ç”¨MVCâ€ï¼Œè¿™å…¶å®æ˜¯è¯¯åŒºã€‚DDDå’ŒMVCä¸æ˜¯å¯¹ç«‹å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»â€”â€”MVCæä¾›äº†æ•´ä½“çš„æ¶æ„éª¨æ¶ï¼ŒDDDåˆ™æ˜¯å¯¹è¿™ä¸ªéª¨æ¶ä¸­â€œModelå±‚â€çš„ç²¾ç»†åŒ–è®¾è®¡æŒ‡å—ã€‚</p><h2 id="äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„"><a href="#äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„" class="headerlink" title="äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„"></a>äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„</h2><p>æ¶æ„æ²¡æœ‰â€œæœ€ä¼˜è§£â€ï¼Œåªæœ‰â€œæœ€åˆé€‚â€ã€‚ç»“åˆè‡ªå·±çš„å®è·µç»éªŒï¼Œç»™å‡ºå‡ ç‚¹é€‰æ‹©å»ºè®®ï¼š</p><ol><li><p><strong>ç®€å•CRUDåœºæ™¯ï¼ˆå°å‹ç®¡ç†åå°ã€ä¸ªäººå·¥å…·ï¼‰</strong>ï¼šç›´æ¥ç”¨â€œController+Service+DAOâ€ï¼Œå¼€å‘æ•ˆç‡é«˜ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œæ²¡å¿…è¦è¿‡åº¦è®¾è®¡ï¼›</p></li><li><p><strong>ä¸­ç­‰å¤æ‚åº¦åœºæ™¯ï¼ˆå¸¸è§„ä¸šåŠ¡ç³»ç»Ÿï¼‰</strong>ï¼šå¯ä»¥å€Ÿé‰´DDDçš„æ€æƒ³ï¼Œåœ¨Serviceå±‚å†…éƒ¨åšç®€å•æ‹†åˆ†ï¼ˆæ¯”å¦‚æŠŠæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æŠ½æˆå•ç‹¬çš„æ–¹æ³•æˆ–ç±»ï¼‰ï¼Œé¿å…Serviceå±‚è‡ƒè‚¿ï¼›</p></li><li><p><strong>é«˜å¤æ‚åº¦åœºæ™¯ï¼ˆç”µå•†ã€é‡‘èã€ä¾›åº”é“¾ï¼‰</strong>ï¼šæ¨èä½¿ç”¨DDDå››å±‚æ¶æ„ï¼Œé€šè¿‡é¢†åŸŸå»ºæ¨¡è®©å¤æ‚ä¸šåŠ¡é€»è¾‘æ›´æ¸…æ™°ï¼Œä¸ºé•¿æœŸè¿­ä»£æ‰“ä¸‹åŸºç¡€ï¼›</p></li><li><p><strong>æ¸è¿›å¼æ”¹é€ </strong>ï¼šä¸ç”¨ä¸€å¼€å§‹å°±å…¨ç›˜é‡æ„ä¸ºDDDï¼Œå¯ä»¥ä»â€œæ‹†åˆ†Serviceå±‚â€å¼€å§‹ï¼Œå…ˆæŠŠæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æŠ½æˆé¢†åŸŸæœåŠ¡ï¼Œå†é€æ­¥å®Œå–„åº”ç”¨å±‚å’ŒåŸºç¡€è®¾æ–½å±‚ï¼Œé™ä½æ”¹é€ é£é™©ã€‚</p></li></ol><h2 id="å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ</h2><p>DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æœ¬èº«ä¸å¼ºåˆ¶è§„å®š â€œå››å±‚æ¶æ„â€ã€‚DDD çš„æ ¸å¿ƒåœ¨äºæˆ˜ç•¥è®¾è®¡ï¼ˆé™ç•Œä¸Šä¸‹æ–‡ã€é¢†åŸŸæ¨¡å‹ï¼‰å’Œæˆ˜æœ¯è®¾è®¡ï¼ˆå®ä½“ã€å€¼å¯¹è±¡ã€èšåˆæ ¹ã€é¢†åŸŸæœåŠ¡ã€ä»“å‚¨ç­‰ï¼‰ï¼Œè€Œ â€œå››å±‚æ¶æ„â€ ç¡®å®æ˜¯ä¸ºäº†è®©è¿™äº›æˆ˜æœ¯è®¾è®¡æ¨¡å¼åœ¨ä»£ç å±‚é¢æ›´å¥½è½åœ°è€Œæ€»ç»“å‡ºçš„ä¸€å¥—ç»å…¸å·¥ç¨‹å®è·µã€‚</p><p>åœ¨å®é™…è½åœ° DDD æ—¶ï¼Œä»£ç æ¶æ„çš„é€‰æ‹©ç¡®å®éå¸¸é‡è¦ã€‚è™½ç„¶ DDD æ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸å¼ºæ±‚ç‰¹å®šç›®å½•ç»“æ„ï¼Œä½†ä¸šç•Œå·²ç»æ²‰æ·€å‡ºä¸¤å¥—æœ€ä¸»æµçš„æ¶æ„æ¨¡å¼ï¼š</p><ol><li><strong>ç»å…¸çš„å››å±‚æ¶æ„ï¼ˆLayered Architectureï¼‰</strong> â€”â€” æœ€å®¹æ˜“ç†è§£ï¼Œé€‚åˆèµ·æ­¥ã€‚</li><li><strong>æ•´æ´/å…­è¾¹å½¢æ¶æ„ï¼ˆClean / Hexagonal Architectureï¼‰</strong> â€”â€” ä¾èµ–å€’ç½®æ›´å½»åº•ï¼Œç°ä»£å¾®æœåŠ¡ä¸»æµã€‚</li></ol><p>æ­¤å¤–ï¼Œå›½å†… Java åœˆï¼ˆç‰¹åˆ«æ˜¯é˜¿é‡Œç³»ï¼‰è¿˜å¸¸ç”¨ <strong>COLA æ¶æ„</strong>ã€‚</p><p>ä¸‹é¢è¯¦ç»†æ‹†è§£è¿™å‡ ç§æ¶æ„çš„ä»£ç ç›®å½•ç»“æ„å’Œæ ¸å¿ƒè¦ç‚¹ã€‚</p><hr><h3 id="æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„-Standard-4-Layer"><a href="#æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„-Standard-4-Layer" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„ (Standard 4-Layer)"></a>æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„ (Standard 4-Layer)</h3><p>è¿™æ˜¯æœ€ç¬¦åˆä¸Šæ–‡æ‰€æå‡ºè§‚ç‚¹çš„ç†è§£çš„ç»“æ„ï¼Œç»“æ„æ¸…æ™°ï¼Œé€‚åˆä»ä¸‰å±‚æ¶æ„è½¬å‹è¿‡æ¥çš„å›¢é˜Ÿã€‚</p><h4 id="æ ¸å¿ƒåŸåˆ™"><a href="#æ ¸å¿ƒåŸåˆ™" class="headerlink" title="æ ¸å¿ƒåŸåˆ™"></a>æ ¸å¿ƒåŸåˆ™</h4><p><strong>ä¾èµ–å€’ç½®ï¼ˆDIPï¼‰</strong>ï¼šè™½ç„¶ç‰©ç†ä¸Šæ˜¯å››å±‚ï¼Œä½†åœ¨é€»è¾‘ä¸Šï¼Œ<strong>é¢†åŸŸå±‚ï¼ˆDomainï¼‰å¿…é¡»æ˜¯ç‹¬ç«‹çš„</strong>ã€‚</p><ul><li><strong>é”™è¯¯çš„åšæ³•</strong>ï¼šDomain å±‚ <code>import</code> Infrastructure å±‚çš„ä»£ç ã€‚</li><li><strong>æ­£ç¡®çš„åšæ³•</strong>ï¼šDomain å±‚å®šä¹‰æ¥å£ï¼ˆRepository Interfaceï¼‰ï¼ŒInfrastructure å±‚å»å®ç°å®ƒã€‚</li></ul><h4 id="ç›®å½•ç»“æ„ç¤ºä¾‹"><a href="#ç›®å½•ç»“æ„ç¤ºä¾‹" class="headerlink" title="ç›®å½•ç»“æ„ç¤ºä¾‹"></a>ç›®å½•ç»“æ„ç¤ºä¾‹</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">com.company.project</span><br><span class="line">â”œâ”€â”€ interfaces (ç”¨æˆ·æ¥å£å±‚ / Web)</span><br><span class="line">â”‚   â”œâ”€â”€ controller       // å¤„ç† HTTP è¯·æ±‚</span><br><span class="line">â”‚   â””â”€â”€ dto              // æ•°æ®ä¼ è¾“å¯¹è±¡ (Request/Response)</span><br><span class="line">â”œâ”€â”€ application (åº”ç”¨å±‚)</span><br><span class="line">â”‚   â”œâ”€â”€ service          // åº”ç”¨æœåŠ¡ (æµç¨‹ç¼–æ’)</span><br><span class="line">â”‚   â””â”€â”€ assembler        // DTO ä¸ Entity çš„è½¬æ¢å™¨</span><br><span class="line">â”œâ”€â”€ domain (é¢†åŸŸå±‚ - æ ¸å¿ƒ)</span><br><span class="line">â”‚   â”œâ”€â”€ model            // èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ aggregate    // èšåˆ</span><br><span class="line">â”‚   â”‚   â””â”€â”€ entity       // å®ä½“</span><br><span class="line">â”‚   â”œâ”€â”€ service          // é¢†åŸŸæœåŠ¡ (è·¨å®ä½“é€»è¾‘)</span><br><span class="line">â”‚   â””â”€â”€ repository       // ä»“å‚¨æ¥å£ (æ³¨æ„ï¼šè¿™é‡Œåªæ”¾æ¥å£ï¼)</span><br><span class="line">â””â”€â”€ infrastructure (åŸºç¡€è®¾æ–½å±‚)</span><br><span class="line">    â”œâ”€â”€ repository       // ä»“å‚¨å®ç° (Implï¼Œè¿™é‡Œä¾èµ– JPA/MyBatis)</span><br><span class="line">    â”œâ”€â”€ entity           // PO (Persistent Objectï¼Œå¯¹åº”æ•°æ®åº“è¡¨)</span><br><span class="line">    â””â”€â”€ util             // é€šç”¨å·¥å…·</span><br></pre></td></tr></table></figure><hr><h3 id="æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„-å…­è¾¹å½¢æ¶æ„-Clean-Hexagonal"><a href="#æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„-å…­è¾¹å½¢æ¶æ„-Clean-Hexagonal" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„ / å…­è¾¹å½¢æ¶æ„ (Clean / Hexagonal)"></a>æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„ / å…­è¾¹å½¢æ¶æ„ (Clean / Hexagonal)</h3><p>è¿™æ˜¯ç›®å‰ DDD ç¤¾åŒº<strong>æœ€æ¨è</strong>çš„æ¶æ„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾®æœåŠ¡åœºæ™¯ä¸‹ã€‚å®ƒä¸å†å¼ºè°ƒâ€œä¸Šä¸‹å±‚â€ï¼Œè€Œæ˜¯å¼ºè°ƒâ€œ<strong>å†…å¤–</strong>â€ã€‚</p><ul><li><strong>å†…æ ¸ï¼ˆInnerï¼‰</strong>ï¼šDomain + Applicationã€‚è¿™æ˜¯é›·æ‰“ä¸åŠ¨çš„ä¸šåŠ¡æ ¸å¿ƒã€‚</li><li><strong>å¤–å£³ï¼ˆOuterï¼‰</strong>ï¼šWebã€Databaseã€Redisã€MQã€‚è¿™äº›éƒ½æ˜¯â€œæ’ä»¶â€ã€‚</li></ul><h4 id="æ ¸å¿ƒåŸåˆ™-1"><a href="#æ ¸å¿ƒåŸåˆ™-1" class="headerlink" title="æ ¸å¿ƒåŸåˆ™"></a>æ ¸å¿ƒåŸåˆ™</h4><p><strong>ä¾èµ–åªèƒ½ç”±å¤–å‘å†…</strong>ã€‚å¤–å£³ï¼ˆWebã€DBï¼‰ä¾èµ–å†…æ ¸ï¼ˆDomainï¼‰ï¼Œå†…æ ¸è°ä¹Ÿä¸ä¾èµ–ã€‚</p><h4 id="ç›®å½•ç»“æ„ç¤ºä¾‹-1"><a href="#ç›®å½•ç»“æ„ç¤ºä¾‹-1" class="headerlink" title="ç›®å½•ç»“æ„ç¤ºä¾‹"></a>ç›®å½•ç»“æ„ç¤ºä¾‹</h4><p>è¿™ç§æ¶æ„é€šå¸¸ä¼šæŠŠæ–‡ä»¶å¤¹åˆ†ä¸º <code>adapter</code>ï¼ˆé€‚é…å™¨/å¤–å£³ï¼‰å’Œ <code>core</code>ï¼ˆå†…æ ¸ï¼‰ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">com.company.project</span><br><span class="line">â”œâ”€â”€ adapter (é€‚é…å™¨å±‚ - å¯¹åº”â€œå…­è¾¹å½¢â€çš„ç«¯å£)</span><br><span class="line">â”‚   â”œâ”€â”€ inbound (è¾“å…¥ç«¯ / é©±åŠ¨ç«¯)</span><br><span class="line">â”‚   â”‚   â””â”€â”€ web          // RestController</span><br><span class="line">â”‚   â””â”€â”€ outbound (è¾“å‡ºç«¯ / è¢«é©±åŠ¨ç«¯)</span><br><span class="line">â”‚       â”œâ”€â”€ persistence  // æ•°æ®åº“å®ç° (Repository Impl)</span><br><span class="line">â”‚       â””â”€â”€ thirdparty   // ç¬¬ä¸‰æ–¹è°ƒç”¨ (å¦‚è°ƒç”¨æ”¯ä»˜æ¥å£)</span><br><span class="line">â”œâ”€â”€ application (åº”ç”¨å±‚ - ä¸šåŠ¡æµç¨‹)</span><br><span class="line">â”‚   â”œâ”€â”€ service          // åº”ç”¨æœåŠ¡</span><br><span class="line">â”‚   â””â”€â”€ port             // ç«¯å£å®šä¹‰ (å¦‚æœæ˜¯ä¸¥æ ¼å…­è¾¹å½¢ï¼Œæ¥å£å®šä¹‰åœ¨è¿™é‡Œ)</span><br><span class="line">â””â”€â”€ domain (é¢†åŸŸå±‚ - ä¸šåŠ¡æ ¸å¿ƒ)</span><br><span class="line">    â”œâ”€â”€ model            // å®ä½“ã€èšåˆæ ¹</span><br><span class="line">    â”œâ”€â”€ service          // é¢†åŸŸæœåŠ¡</span><br><span class="line">    â””â”€â”€ repository       // ä»“å‚¨æ¥å£ (å®šä¹‰æ•°æ®è¯¥æ€ä¹ˆå­˜ï¼Œä½†ä¸å…³å¿ƒå­˜å“ªé‡Œ)</span><br></pre></td></tr></table></figure><p><strong>åŒºåˆ«ç‚¹</strong>ï¼š<br>ä½ ä¼šå‘ç° <code>Controller</code> å’Œ <code>RepositoryImpl</code> å˜æˆäº†å…„å¼Ÿå…³ç³»ï¼Œéƒ½å±äº <code>Adapter</code>ï¼ˆå¤–å›´è®¾æ–½ï¼‰ï¼Œè€Œ <code>Domain</code> è¢«å±‚å±‚ä¿æŠ¤åœ¨æœ€é‡Œé¢ã€‚</p><hr><h3 id="æ–¹æ¡ˆä¸‰ï¼šCOLA-æ¶æ„-Clean-Object-Oriented-and-Layered-Architecture"><a href="#æ–¹æ¡ˆä¸‰ï¼šCOLA-æ¶æ„-Clean-Object-Oriented-and-Layered-Architecture" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šCOLA æ¶æ„ (Clean Object-Oriented and Layered Architecture)"></a>æ–¹æ¡ˆä¸‰ï¼šCOLA æ¶æ„ (Clean Object-Oriented and Layered Architecture)</h3><p>å¦‚æœä½ æ˜¯ Java å¼€å‘è€…ï¼Œç‰¹åˆ«æ˜¯åœ¨å›½å†…å¤§å‚ç¯å¢ƒï¼Œé˜¿é‡Œå¼€æºçš„ <strong>COLA æ¶æ„</strong> æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ DDD è½åœ°æ¨¡æ¿ã€‚å®ƒç»“åˆäº†å››å±‚æ¶æ„å’Œæ•´æ´æ¶æ„çš„ä¼˜ç‚¹ã€‚</p><p>å®ƒçš„ç‰¹ç‚¹æ˜¯æŠŠ<strong>å¯¹å¤–æš´éœ²çš„æ¥å£ï¼ˆAPIï¼‰</strong>å•ç‹¬æŠ½ç¦»æˆä¸€ä¸ªæ¨¡å—ï¼Œæ–¹ä¾¿å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ã€‚</p><h4 id="Maven-æ¨¡å—ç»“æ„"><a href="#Maven-æ¨¡å—ç»“æ„" class="headerlink" title="Maven æ¨¡å—ç»“æ„"></a>Maven æ¨¡å—ç»“æ„</h4><p>COLA é€šå¸¸æ˜¯å¤š Module çš„ Maven é¡¹ç›®ï¼š</p><ol><li><strong><code>start</code> (å¯åŠ¨å±‚)</strong><ul><li>Spring Boot å¯åŠ¨ç±»ï¼Œå„ç§é…ç½®ã€‚</li></ul></li><li><strong><code>adapter</code> (é€‚é…å±‚)</strong><ul><li>Controller (Web), Consumer (MQ)ã€‚</li></ul></li><li><strong><code>client</code> (API å±‚ / SDK)</strong><ul><li><strong>é‡ç‚¹</strong>ï¼šè¿™é‡Œæ”¾ DTO å’Œ API æ¥å£å®šä¹‰ã€‚å¤–éƒ¨ç³»ç»Ÿåªéœ€è¦ä¾èµ–è¿™ä¸ª jar åŒ…ã€‚</li></ul></li><li><strong><code>app</code> (åº”ç”¨å±‚)</strong><ul><li>Application Service, Command Handlerã€‚</li></ul></li><li><strong><code>domain</code> (é¢†åŸŸå±‚)</strong><ul><li>Entity, ValueObject, DomainService, Repository Interfaceã€‚</li><li><strong>æœ€çº¯å‡€çš„ä¸€å±‚ï¼Œä¸ä¾èµ– Springï¼Œåªä¾èµ– JDKã€‚</strong></li></ul></li><li><strong><code>infrastructure</code> (åŸºç¡€è®¾æ–½å±‚)</strong><ul><li>MyBatis Mapper, Repository Impl, Redis Utilã€‚</li></ul></li></ol><hr><h3 id="æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ"><a href="#æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ" class="headerlink" title="æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ"></a>æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ</h3><ol><li><p><strong>å¦‚æœä½ æ˜¯åˆå­¦è€…ï¼Œæˆ–è€…é¡¹ç›®è§„æ¨¡ä¸å¤§</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆä¸€ï¼ˆç»å…¸çš„å››å±‚æ¶æ„ï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šæœ€ç¬¦åˆç›´è§‰ï¼Œæ–‡ä»¶å¤¹åˆ†å±‚æ¸…æ™°ï¼Œä» MVC è¿ç§»è¿‡æ¥è®¤çŸ¥è´Ÿæ‹…æœ€å°ã€‚</li><li><em>æ³¨æ„ç‚¹ï¼šä¸€å®šè¦åšæŒâ€œé¢†åŸŸå±‚å®šä¹‰æ¥å£ï¼ŒåŸºç¡€å±‚å®ç°æ¥å£â€ï¼Œä¸è¦è®©é¢†åŸŸå±‚ä¾èµ– MyBatisã€‚</em></li></ul></li><li><p><strong>å¦‚æœä½ åœ¨åšå¾®æœåŠ¡ï¼Œæˆ–è€…ä¸šåŠ¡é€»è¾‘æåº¦å¤æ‚</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆäºŒï¼ˆæ•´æ´/å…­è¾¹å½¢æ¶æ„ï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šèƒ½å¤Ÿå®Œç¾éš”ç¦»æŠ€æœ¯å®ç°çš„å˜åŠ¨ï¼ˆæ¯”å¦‚ä» MySQL æ¢åˆ° MongoDBï¼Œæ ¸å¿ƒä¸šåŠ¡ä»£ç ä¸€è¡Œéƒ½ä¸ç”¨æ”¹ï¼‰ã€‚</li></ul></li><li><p><strong>å¦‚æœä½ çš„å›¢é˜Ÿç”¨ Java ä¸”ç”±äºè§„èŒƒè¦æ±‚</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆä¸‰ï¼ˆCOLAï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šå›½å†…èµ„æ–™å¤šï¼Œè§„èŒƒçº¦æŸæ€§å¼ºï¼Œé€‚åˆå›¢é˜Ÿåä½œã€‚</li></ul></li></ol><h3 id="å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰"><a href="#å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰" class="headerlink" title="å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰"></a>å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰</h3><p>ä¸ç®¡ä½ é€‰å“ªä¸ªæ–‡ä»¶ç»“æ„ï¼ŒDDD è½åœ°çš„<strong>ç”Ÿæ­»çº¿</strong>åªæœ‰ä¸€æ¡ï¼š</p><blockquote><p><strong>Domain å±‚ï¼ˆé¢†åŸŸå±‚ï¼‰å¿…é¡»æ˜¯â€œçº¯å‡€â€çš„ã€‚</strong></p></blockquote><ul><li>å®ƒå¯ä»¥å¼•ç”¨ <code>java.util.List</code>ã€‚</li><li>å®ƒ<strong>ç»å¯¹ä¸èƒ½</strong>å¼•ç”¨ <code>javax.sql.DataSource</code>ã€<code>org.springframework.xxx</code>ã€<code>com.github.pagehelper</code>ã€‚</li><li>å®ƒåªè°ˆä¸šåŠ¡ï¼ˆè´¦å·ã€é‡‘é¢ã€å†»ç»“ï¼‰ï¼Œä¸è°ˆæŠ€æœ¯ï¼ˆè¡¨ã€JSONã€HTTPï¼‰ã€‚</li></ul><p>åªè¦å®ˆä½äº†è¿™æ¡çº¿ï¼Œä½ çš„æ¶æ„å°±æ˜¯åˆæ ¼çš„ DDD æ¶æ„ã€‚</p><h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>ä»MVCåˆ°Service+DAOï¼Œå†åˆ°DDDï¼Œä¸æ˜¯æ¶æ„çš„â€œæ›¿ä»£â€ï¼Œè€Œæ˜¯æ¶æ„çš„â€œæ¼”è¿›â€ã€‚å®ƒä»¬çš„æ ¸å¿ƒéƒ½æ˜¯é€šè¿‡åˆ†å±‚å®ç°è§£è€¦ï¼Œåªæ˜¯é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡å¤æ‚åº¦ï¼Œé€‰æ‹©äº†ä¸åŒçš„æ‹†åˆ†ç²’åº¦ã€‚</p><p>å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œä¸ç”¨ç›²ç›®è¿½æ±‚â€œé«˜å¤§ä¸Šâ€çš„æ¶æ„ï¼Œè€Œåº”è¯¥ç†è§£æ¯ç§æ¶æ„çš„æ ¸å¿ƒä»·å€¼å’Œé€‚ç”¨åœºæ™¯ï¼šç®€å•ä¸šåŠ¡ç”¨ç®€å•æ¶æ„ï¼Œå¤æ‚ä¸šåŠ¡ç”¨ç²¾ç»†æ¶æ„ã€‚åŒæ—¶ï¼Œè¦æŠ“ä½æ¶æ„è®¾è®¡çš„æœ¬è´¨â€”â€”è®©ä»£ç ç»“æ„æ¸…æ™°ã€èŒè´£æ˜ç¡®ï¼Œä¾¿äºç»´æŠ¤å’Œè¿­ä»£ã€‚è¿™æ‰æ˜¯æˆ‘ä»¬å­¦ä¹ å„ç§æ¶æ„æ€æƒ³çš„æœ€ç»ˆç›®çš„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot;&gt;&lt;a href=&quot;#MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot;&gt;&lt;/a&gt;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&lt;/</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œé—®é¢˜æ€»ç»“</title>
    <link href="https://nmcb666.vip/posts/a3a5550f.html"/>
    <id>https://nmcb666.vip/posts/a3a5550f.html</id>
    <published>2026-01-08T15:32:51.000Z</published>
    <updated>2026-01-26T13:39:36.091Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘"><a href="#å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘" class="headerlink" title="å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘"></a>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘</h2><h3 id="é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢"><a href="#é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢" class="headerlink" title="é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€  é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢ é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢"></a>é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€  é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢ é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸ä¸”å…³é”®çš„ç½‘ç»œé—®é¢˜ã€‚</p><p>ç®€å•ç›´æ¥çš„å›ç­”æ˜¯ï¼š<strong>ä½ ä¼šå¾—åˆ°ä½ æ‰€åœ¨å±€åŸŸç½‘çš„â€œç½‘å…³â€ï¼ˆGatewayï¼‰çš„ MAC åœ°å€ã€‚</strong></p><h4 id="è¯¦ç»†åŸç†è§£æ"><a href="#è¯¦ç»†åŸç†è§£æ" class="headerlink" title="è¯¦ç»†åŸç†è§£æ"></a>è¯¦ç»†åŸç†è§£æ</h4><p>å½“ä½ çš„ç”µè„‘ï¼ˆä¸»æœº Aï¼‰æƒ³è¦å‘é€æ•°æ®åŒ…ç»™ä¸€ä¸ª IP åœ°å€ï¼ˆä¸»æœº Bï¼‰æ—¶ï¼Œå®ƒä¼šç»å†ä»¥ä¸‹é€»è¾‘åˆ¤æ–­æµç¨‹ï¼š</p><ol><li><p><strong>åˆ¤æ–­ç›®æ ‡ IP æ˜¯å¦åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ï¼ˆå­ç½‘ï¼‰å†…ï¼š</strong></p><ul><li>ç”µè„‘ä¼šæŸ¥çœ‹è‡ªå·±çš„å­ç½‘æ©ç ï¼ˆSubnet Maskï¼‰ã€‚</li><li>å¦‚æœ <code>ç›®æ ‡IP</code> å’Œ <code>æœ¬æœºIP</code> åœ¨åŒä¸€ä¸ªç½‘æ®µå†…ï¼Œç”µè„‘è®¤ä¸ºå®ƒå¯ä»¥ç›´æ¥é€šä¿¡ã€‚</li><li><strong>å¦‚æœä¸åœ¨åŒä¸€ä¸ªç½‘æ®µå†…</strong>ï¼Œç”µè„‘è®¤ä¸ºâ€œæˆ‘å¤Ÿä¸ç€å®ƒâ€ï¼Œå¿…é¡»æ‰¾ä¸€ä¸ªâ€œä¸­ä»‹â€æ¥å¸®å¿™è½¬å‘ã€‚</li></ul></li><li><p><strong>å¯»æ‰¾â€œä¸­ä»‹â€ï¼ˆç½‘å…³ï¼‰ï¼š</strong></p><ul><li>è¿™ä¸ªâ€œä¸­ä»‹â€å°±æ˜¯ä½ é…ç½®çš„<strong>é»˜è®¤ç½‘å…³ï¼ˆDefault Gatewayï¼‰</strong>ã€‚é€šå¸¸è¿™æ˜¯ä½ è·¯ç”±å™¨ï¼ˆRouterï¼‰çš„å†…ç½‘ IP åœ°å€ï¼ˆä¾‹å¦‚ <code>192.168.1.1</code> æˆ– <code>192.168.0.1</code>ï¼‰ã€‚</li><li>ç”µè„‘ä¼šæŠŠæ•°æ®åŒ…å‘ç»™ç½‘å…³ï¼Œç”±ç½‘å…³è´Ÿè´£æŠŠæ•°æ®åŒ…æŠ•é€’åˆ°å¤–ç½‘ã€‚</li></ul></li><li><p><strong>ARP è§£æçš„å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼š</strong></p><ul><li>æ—¢ç„¶æ•°æ®åŒ…è¦å‘ç»™ç½‘å…³ï¼Œé‚£ä¹ˆåœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆäºŒå±‚ï¼‰ï¼Œç›®æ ‡ MAC åœ°å€å°±å¿…é¡»æ˜¯ç½‘å…³çš„ MAC åœ°å€ã€‚</li><li>å› æ­¤ï¼Œä½ çš„ç”µè„‘ä¼šå‘èµ·ä¸€ä¸ª <strong>ARP è¯·æ±‚</strong>ï¼Œä½†æ˜¯è¯·æ±‚çš„ç›®æ ‡ IP ä¸å†æ˜¯â€œç›®çš„ IPâ€ï¼Œè€Œæ˜¯ <strong>â€œç½‘å…³çš„ IPâ€</strong>ã€‚</li></ul></li><li><p><strong>è·å– MAC åœ°å€ï¼š</strong></p><ul><li>ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰æ”¶åˆ° ARP è¯·æ±‚åï¼Œå›å¤å®ƒçš„ MAC åœ°å€ã€‚</li><li>ä½ çš„ç”µè„‘å°†æ•°æ®åŒ…å°è£…ï¼Œ<strong>ç›®æ ‡ IP ä»ç„¶æ˜¯è¿œæ–¹çš„ IPï¼Œä½†ç›®æ ‡ MAC åœ°å€å˜æˆäº†ç½‘å…³çš„ MAC åœ°å€</strong>ã€‚</li></ul></li></ol><h4 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h4><p>å‡è®¾ä½ çš„ç½‘ç»œç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li><strong>ä½ çš„ç”µè„‘ IPï¼š</strong> <code>192.168.1.100</code></li><li><strong>ä½ çš„ç½‘å…³ IPï¼š</strong> <code>192.168.1.1</code> ï¼ˆMAC: <code>AA:AA:AA:AA:AA:AA</code>ï¼‰</li><li><strong>ä½ æƒ³è®¿é—®çš„ç™¾åº¦æœåŠ¡å™¨ IPï¼š</strong> <code>110.242.68.4</code> ï¼ˆè¿™æ˜¾ç„¶ä¸åœ¨ä½ çš„å±€åŸŸç½‘ï¼‰</li></ul><p><strong>å‘ç”Ÿçš„è¿‡ç¨‹ï¼š</strong></p><ol><li>ä½ è¦ ping <code>110.242.68.4</code>ã€‚</li><li>ä½ çš„ç”µè„‘è®¡ç®—ä¸€ä¸‹ï¼Œå‘ç° <code>110.242.68.4</code> ä¸åœ¨ <code>192.168.1.x</code> è¿™ä¸ªåœˆå­é‡Œã€‚</li><li>ä½ çš„ç”µè„‘å†³å®šï¼šâ€œæˆ‘è¦æŠŠè¿™ä¸ªåŒ…äº¤ç»™ç½‘å…³ <code>192.168.1.1</code> å¤„ç†ã€‚â€</li><li>ä½ çš„ç”µè„‘å‘å‡º ARP è¯·æ±‚ï¼šâ€œè°æ˜¯ <code>192.168.1.1</code>ï¼Ÿè¯·å‘Šè¯‰æˆ‘ä½ çš„ MAC åœ°å€ã€‚â€</li><li>è·¯ç”±å™¨å›å¤ï¼šâ€œæˆ‘æ˜¯ <code>192.168.1.1</code>ï¼Œæˆ‘çš„ MAC æ˜¯ <code>AA:AA:AA:AA:AA:AA</code>ã€‚â€</li><li>ä½ çš„ç”µè„‘å‘é€æ•°æ®åŒ…ï¼š<ul><li><strong>æº IPï¼š</strong> <code>192.168.1.100</code></li><li><strong>ç›®çš„ IPï¼š</strong> <code>110.242.68.4</code> ï¼ˆIP å¤´ä¸å˜ï¼‰</li><li><strong>æº MACï¼š</strong> <code>ä½ çš„ç”µè„‘ MAC</code></li><li><strong>ç›®çš„ MACï¼š</strong> <code>AA:AA:AA:AA:AA:AA</code> ï¼ˆå˜æˆäº†ç½‘å…³çš„ MACï¼‰</li></ul></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li><strong>åŒç½‘æ®µé€šä¿¡ï¼š</strong> ARP è§£æ <strong>ç›®æ ‡ IP</strong> çš„ MACã€‚</li><li><strong>è·¨ç½‘æ®µé€šä¿¡ï¼š</strong> ARP è§£æ <strong>ç½‘å…³ IP</strong> çš„ MACã€‚</li></ul><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“ä½ è®¿é—®äº’è”ç½‘ä¸Šä»»ä½•ç½‘ç«™æ—¶ï¼Œä½ ç”µè„‘çš„ ARP ç¼“å­˜è¡¨ä¸­ï¼Œä¸»è¦å˜åŠ¨çš„å…¶å®æ˜¯ç½‘å…³çš„è®°å½•ï¼Œè€Œä¸æ˜¯äº’è”ç½‘ä¸Šæ— æ•°æœåŠ¡å™¨çš„ MAC åœ°å€ï¼ˆä½ ä¹Ÿæ— æ³•ç›´æ¥è·å–äº’è”ç½‘æœåŠ¡å™¨çš„ MAC åœ°å€ï¼Œå› ä¸ºè·¯ç”±å™¨ä¼šéš”ç¦»å¹¿æ’­åŸŸï¼‰ã€‚</p><h3 id="å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ"><a href="#å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ" class="headerlink" title="å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ"></a>å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ</h3><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œâ€œå°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPâ€æ˜¯æœ€æ ¸å¿ƒçš„åŸºç¡€é—®é¢˜ä¹‹ä¸€ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠé“¾è·¯å±‚ã€ç½‘ç»œå±‚çš„ååŒå·¥ä½œï¼Œä»¥åŠäº¤æ¢æœºã€è·¯ç”±å™¨ç­‰è®¾å¤‡çš„æ ¸å¿ƒæœºåˆ¶ã€‚æœ¬æ–‡å°†ç»“åˆæ­¤å‰çš„è®¨è®ºï¼Œä»¥æŠ€æœ¯æ€è€ƒçš„è§†è§’ï¼Œå®Œæ•´æ¢³ç†ä»ç½‘ç»œåŒ…å°è£…å®Œæˆåˆ°æœ€ç»ˆé€è¾¾ç›®æ ‡IPçš„å…¨æµç¨‹ï¼Œæ‹†è§£å…¶ä¸­çš„å…³é”®é€»è¾‘ä¸è®¾å¤‡åˆ†å·¥ã€‚</p><h4 id="ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ "><a href="#ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ " class="headerlink" title="ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ "></a>ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ </h4><p>å½“æˆ‘ä»¬åœ¨ä¸»æœºä¸Šå®Œæˆç½‘ç»œåŒ…å°è£…åï¼ˆé€šå¸¸æ˜¯TCP/UDPå¤´éƒ¨+IPå¤´éƒ¨+æ•°æ®çš„å°è£…ï¼‰ï¼Œè¿™ä¸ªåŒ…è¦åœ¨ç‰©ç†ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¿…é¡»å…·å¤‡â€œä¸¤å±‚èº«ä»½æ ‡è¯†â€ï¼Œå¯¹åº”ç½‘ç»œåˆ†å±‚æ¨¡å‹çš„ä¸åŒèŒè´£ï¼š</p><ul><li><p><strong>ç½‘ç»œå±‚èº«ä»½</strong>ï¼šå³æºIPåœ°å€ï¼ˆå‘é€æ–¹ä¸»æœºIPï¼‰å’Œç›®æ ‡IPåœ°å€ï¼ˆæœ€ç»ˆæ¥æ”¶æ–¹IPï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯â€œè·¨ç½‘æ®µå¯¼èˆªâ€ï¼Œç¡®å®šæ•°æ®åŒ…çš„æœ€ç»ˆç›®çš„åœ°ï¼Œå…¨ç¨‹ä¸å˜ã€‚</p></li><li><p><strong>é“¾è·¯å±‚èº«ä»½</strong>ï¼šå³æºMACåœ°å€ï¼ˆå½“å‰å‘é€è®¾å¤‡ç½‘å¡MACï¼‰å’Œç›®æ ‡MACåœ°å€ï¼ˆå½“å‰é“¾è·¯ä¸‹ä¸€è·³è®¾å¤‡MACï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯â€œå±€åŸŸç½‘å†…å®šä½â€ï¼Œæ¯ç»è¿‡ä¸€è·³é“¾è·¯éƒ½ä¼šæ›´æ–°ï¼Œä»…åœ¨å½“å‰é“¾è·¯æœ‰æ•ˆã€‚</p></li></ul><p>æ ¸å¿ƒç»“è®ºï¼šIPåœ°å€è´Ÿè´£â€œæ‰¾æœ€ç»ˆç›®çš„åœ°åœ¨å“ªâ€ï¼ŒMACåœ°å€è´Ÿè´£â€œæ‰¾å½“å‰é“¾è·¯ä¸Šä¸‹ä¸€è·³æ˜¯è°â€ï¼Œä¸¤è€…ååŒå®Œæˆå…¨è·¯å¾„ä¼ è¾“ã€‚</p><h4 id="äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ"><a href="#äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ" class="headerlink" title="äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ"></a>äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ</h4><p>å°è£…å®Œæˆåï¼Œä¸»æœºçš„TCP/IPåè®®æ ˆé¦–å…ˆä¼šè¿›è¡Œä¸€ä¸ªæ ¸å¿ƒåˆ¤æ–­â€”â€”ç›®æ ‡IPæ˜¯å¦ä¸æœ¬æœºåœ¨åŒä¸€å±€åŸŸç½‘ï¼ˆé€šè¿‡å­ç½‘æ©ç è®¡ç®—ç½‘æ®µï¼‰ã€‚è¿™ä¸ªåˆ¤æ–­ç›´æ¥å†³å®šäº†åç»­çš„å‘é€é€»è¾‘ï¼šæ˜¯ç›´æ¥å‘é€ç»™ç›®æ ‡ä¸»æœºï¼Œè¿˜æ˜¯å…ˆå‘é€ç»™ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰ã€‚</p><h4 id="ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº"><a href="#ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº" class="headerlink" title="ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº"></a>ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº</h4><p>å½“ç›®æ ‡IPåœ¨åŒä¸€ç½‘æ®µæ—¶ï¼Œä¸»æœºéœ€è¦ç›´æ¥ä¸ç›®æ ‡ä¸»æœºé€šä¿¡ï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯â€œå¦‚ä½•è·å–ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€â€ï¼Œè¿™å°±éœ€è¦ARPåè®®çš„å‚ä¸ã€‚</p><h5 id="3-1-æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨"><a href="#3-1-æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨" class="headerlink" title="3.1 æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨"></a>3.1 æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨</h5><p>ä¸»æœºæœ¬åœ°ä¼šç»´æŠ¤ä¸€ä¸ªARPç¼“å­˜è¡¨ï¼Œå­˜å‚¨â€œIPåœ°å€-MACåœ°å€â€çš„æ˜ å°„å…³ç³»ã€‚åè®®æ ˆä¼šå…ˆæŸ¥è¯¢è¯¥è¡¨ï¼š</p><ul><li><p>è‹¥å­˜åœ¨ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€ï¼šç›´æ¥è¿›å…¥é“¾è·¯å±‚å°è£…ï¼Œå°†ç›®æ ‡MACå¡«å…¥ä»¥å¤ªç½‘å¸§å¤´ï¼ŒæºMACå¡«å…¥æœ¬æœºç½‘å¡MACï¼Œç„¶åå°†å¸§å‘é€è‡³äº¤æ¢æœºã€‚</p></li><li><p>è‹¥ä¸å­˜åœ¨ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€ï¼šè§¦å‘ARPå¹¿æ’­æµç¨‹ã€‚</p></li></ul><h5 id="3-2-æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC"><a href="#3-2-æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC" class="headerlink" title="3.2 æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC"></a>3.2 æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC</h5><p>ä¸»æœºå‘é€ARPè¯·æ±‚åŒ…ï¼ˆé“¾è·¯å±‚ç›®æ ‡MACä¸ºå¹¿æ’­åœ°å€FF:FF:FF:FF:FF:FFï¼‰ï¼Œè¯¥å¹¿æ’­åŒ…ä¼šè¢«äº¤æ¢æœºæ³›æ´ªè‡³å±€åŸŸç½‘å†…æ‰€æœ‰è®¾å¤‡ï¼š</p><ul><li><p>éç›®æ ‡è®¾å¤‡æ”¶åˆ°åï¼Œå‘ç°ç›®æ ‡IPä¸æ˜¯è‡ªå·±ï¼Œç›´æ¥ä¸¢å¼ƒï¼›</p></li><li><p>ç›®æ ‡è®¾å¤‡æ”¶åˆ°åï¼Œè¯†åˆ«å‡ºç›®æ ‡IPæ˜¯è‡ªå·±ï¼Œå›å¤ARPå“åº”åŒ…ï¼ŒåŒ…å«è‡ªèº«MACåœ°å€ï¼›</p></li><li><p>ä¸»æœºæ”¶åˆ°ARPå“åº”åï¼Œå°†â€œç›®æ ‡IP-ç›®æ ‡MACâ€æ˜ å°„å­˜å…¥ARPç¼“å­˜è¡¨ï¼Œåç»­é€šä¿¡å¯ç›´æ¥ä½¿ç”¨ã€‚</p></li></ul><h5 id="3-3-æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘"><a href="#3-3-æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘" class="headerlink" title="3.3 æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘"></a>3.3 æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘</h5><p>ä¸»æœºå°†å°è£…å¥½çš„ä»¥å¤ªç½‘å¸§å‘é€è‡³äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šé€šè¿‡è‡ªèº«çš„MACåœ°å€è¡¨ï¼ˆè®°å½•â€œMACåœ°å€-ç«¯å£â€æ˜ å°„ï¼‰è¿›è¡Œè½¬å‘ï¼š</p><ul><li><p>è‹¥MACåœ°å€è¡¨å­˜åœ¨ç›®æ ‡MACå¯¹åº”çš„ç«¯å£ï¼šç›´æ¥å°†å¸§ä»è¯¥ç«¯å£è½¬å‘ï¼ˆå•æ’­ï¼‰ï¼Œä»…ç›®æ ‡è®¾å¤‡èƒ½æ¥æ”¶ï¼›</p></li><li><p>è‹¥MACåœ°å€è¡¨ä¸å­˜åœ¨ç›®æ ‡MACå¯¹åº”çš„ç«¯å£ï¼šäº¤æ¢æœºæ‰§è¡Œâ€œæ³›æ´ªâ€ï¼Œå°†å¸§ä»é™¤æ¥æ”¶ç«¯å£å¤–çš„æ‰€æœ‰ç«¯å£è½¬å‘ï¼Œç›´åˆ°ç›®æ ‡è®¾å¤‡æ¥æ”¶åï¼Œäº¤æ¢æœºé€šè¿‡æºMACå­¦ä¹ ï¼Œå°†ç›®æ ‡MACä¸å¯¹åº”ç«¯å£çš„æ˜ å°„å­˜å…¥MACåœ°å€è¡¨ï¼Œåç»­é€šä¿¡ç›´æ¥å•æ’­ã€‚</p></li></ul><p>æ ¸å¿ƒè¦ç‚¹ï¼šäº¤æ¢æœºä»…è¯†åˆ«MACåœ°å€ï¼Œä¸å…³å¿ƒIPåœ°å€ï¼›ARPå¹¿æ’­ä»…åœ¨å½“å‰å±€åŸŸç½‘å†…ä¼ æ’­ï¼Œä¸ä¼šè·¨ç½‘æ®µã€‚</p><h4 id="å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP"><a href="#å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP" class="headerlink" title="å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP"></a>å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP</h4><p>å½“ç›®æ ‡IPä¸åœ¨åŒä¸€ç½‘æ®µæ—¶ï¼Œä¸»æœºæ— æ³•ç›´æ¥ä¸ç›®æ ‡ä¸»æœºé€šä¿¡ï¼Œå¿…é¡»é€šè¿‡ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰è½¬å‘â€”â€”ç½‘å…³æ˜¯è¿æ¥æœ¬åœ°å±€åŸŸç½‘ä¸å¤–éƒ¨ç½‘ç»œçš„â€œæ¡¥æ¢â€ï¼ŒåŒæ—¶å±äºä¸¤ä¸ªç½‘ç»œï¼ˆæœ¬åœ°å±€åŸŸç½‘å’Œå¤–ç½‘ï¼‰ï¼Œæ‹¥æœ‰ä¸¤ä¸ªIPå’Œä¸¤ä¸ªMACï¼ˆå±€åŸŸç½‘ä¾§IP/MACã€å¤–ç½‘ä¾§IP/MACï¼‰ã€‚</p><h5 id="4-1-æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€"><a href="#4-1-æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€" class="headerlink" title="4.1 æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€"></a>4.1 æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€</h5><ul><li><p>ç½‘å…³IPçš„è·å–ï¼šä¸»æœºé€šè¿‡DHCPè‡ªåŠ¨è·å–ï¼ˆå¸¸è§ï¼‰æˆ–æ‰‹åŠ¨é…ç½®ï¼Œå­˜å‚¨åœ¨æœ¬åœ°ç½‘ç»œè®¾ç½®ä¸­ï¼›</p></li><li><p>ç½‘å…³MACçš„è·å–ï¼šä¸åŒä¸€å±€åŸŸç½‘è·å–ç›®æ ‡MACé€»è¾‘ä¸€è‡´ï¼Œé€šè¿‡æŸ¥è¯¢ARPç¼“å­˜è¡¨æˆ–å‘é€ARPå¹¿æ’­è·å–ç½‘å…³IPå¯¹åº”çš„MACåœ°å€ã€‚</p></li></ul><h5 id="4-2-æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³"><a href="#4-2-æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³" class="headerlink" title="4.2 æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³"></a>4.2 æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³</h5><p>ä¸»æœºå°†ä»¥å¤ªç½‘å¸§çš„ç›®æ ‡MACå¡«å…¥ç½‘å…³çš„å±€åŸŸç½‘ä¾§MACï¼ŒæºMACå¡«å…¥æœ¬æœºMACï¼Œå‘é€è‡³äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºè½¬å‘è‡³ç½‘å…³ã€‚</p><h5 id="4-3-æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰"><a href="#4-3-æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰" class="headerlink" title="4.3 æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰"></a>4.3 æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰</h5><p>ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰æ”¶åˆ°å¸§åï¼Œä¼šæ‰§è¡Œâ€œå‰¥å¸§-è·¯ç”±-é‡æ–°å°è£…â€çš„æ ¸å¿ƒæµç¨‹ï¼š</p><ol><li><p>å‰¥å¸§ï¼šè·¯ç”±å™¨å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œä¼šå‰¥ç¦»é“¾è·¯å±‚ä»¥å¤ªç½‘å¸§å¤´ï¼ˆMACåœ°å€ä¿¡æ¯å¤±æ•ˆï¼‰ï¼ŒæŸ¥çœ‹IPå¤´éƒ¨çš„ç›®æ ‡IPï¼›</p></li><li><p>è·¯ç”±å†³ç­–ï¼šæŸ¥è¯¢è‡ªèº«è·¯ç”±è¡¨ï¼Œç¡®å®šç›®æ ‡IPå¯¹åº”çš„â€œä¸‹ä¸€è·³ç½‘å…³â€ï¼ˆå¯èƒ½æ˜¯è¿è¥å•†è·¯ç”±å™¨ã€éª¨å¹²ç½‘è·¯ç”±å™¨ç­‰ï¼‰ï¼›</p></li><li><p>é‡æ–°å°è£…ï¼šé€šè¿‡ARPè·å–ä¸‹ä¸€è·³ç½‘å…³çš„MACåœ°å€ï¼Œå°†æ–°çš„ä»¥å¤ªç½‘å¸§å¤´å°è£…ï¼ˆæºMACä¸ºç½‘å…³çš„å¤–ç½‘ä¾§MACï¼Œç›®æ ‡MACä¸ºä¸‹ä¸€è·³ç½‘å…³çš„MACï¼‰ï¼Œå‘é€è‡³ä¸‹ä¸€è·³ï¼›</p></li><li><p>é‡å¤è½¬å‘ï¼šæ•°æ®åŒ…åœ¨äº’è”ç½‘ä¸­ç»è¿‡å¤šä¸ªè·¯ç”±å™¨æ¥åŠ›è½¬å‘ï¼Œæ¯ä¸€è·³éƒ½é‡å¤â€œå‰¥å¸§-è·¯ç”±-é‡æ–°å°è£…â€ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡IPæ‰€åœ¨çš„å±€åŸŸç½‘ç½‘å…³ã€‚</p></li></ol><h5 id="4-4-æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­-ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰"><a href="#4-4-æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­-ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰" class="headerlink" title="4.4 æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­/ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰"></a>4.4 æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­/ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰</h5><p>å®¶åº­/ä¼ä¸šå†…ç½‘ä½¿ç”¨ç§æœ‰IPï¼ˆå¦‚192.168.x.xï¼‰ï¼Œæ— æ³•ç›´æ¥åœ¨äº’è”ç½‘ä¸­è·¯ç”±ã€‚å› æ­¤ï¼Œç½‘å…³åœ¨è½¬å‘æ—¶ä¼šè§¦å‘NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰ï¼š</p><ul><li><p>å‡ºå£è½¬æ¢ï¼šå°†æ•°æ®åŒ…çš„æºIPä»ç§æœ‰IPæ”¹ä¸ºç½‘å…³çš„å…¬ç½‘IPï¼ŒåŒæ—¶è®°å½•â€œç§æœ‰IP:ç«¯å£-å…¬ç½‘IP:ç«¯å£â€çš„æ˜ å°„å…³ç³»ï¼ˆNATè¡¨ï¼‰ï¼›</p></li><li><p>å…¥å£è½¬æ¢ï¼šå½“ç›®æ ‡IPçš„å“åº”åŒ…è¿”å›è‡³ç½‘å…³æ—¶ï¼Œç½‘å…³é€šè¿‡NATè¡¨åå‘æŸ¥è¯¢ï¼Œå°†ç›®æ ‡IPæ”¹ä¸ºå¯¹åº”çš„å†…ç½‘ç§æœ‰IPï¼Œç›®æ ‡MACæ”¹ä¸ºè¯¥ä¸»æœºçš„MACï¼Œè½¬å‘è‡³ç›®æ ‡ä¸»æœºã€‚</p></li></ul><p>æ ¸å¿ƒè¦ç‚¹ï¼šNATä»…å‘ç”Ÿåœ¨æœ¬åœ°ç½‘å…³çš„å‡ºå£å¤„ï¼Œæ˜¯ç§æœ‰IPè®¿é—®äº’è”ç½‘çš„å¿…è¦æ¡ä»¶ï¼›æºIPåœ¨NATè½¬æ¢åï¼Œåœ¨äº’è”ç½‘ä¼ è¾“è¿‡ç¨‹ä¸­ä¿æŒä¸å˜ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡å±€åŸŸç½‘ã€‚</p><h5 id="4-5-æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³"><a href="#4-5-æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³" class="headerlink" title="4.5 æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³"></a>4.5 æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³</h5><p>å½“æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡IPæ‰€åœ¨çš„å±€åŸŸç½‘ç½‘å…³åï¼Œç½‘å…³ä¼šå†æ¬¡æ‰§è¡Œâ€œå‰¥å¸§-è·¯ç”±â€ï¼Œå‘ç°ç›®æ ‡IPåœ¨å½“å‰å±€åŸŸç½‘å†…ï¼Œé€šè¿‡ARPè·å–ç›®æ ‡ä¸»æœºçš„MACåœ°å€ï¼Œé‡æ–°å°è£…å¸§åå‘é€è‡³ç›®æ ‡ä¸»æœºï¼Œå®Œæˆå…¨é“¾è·¯ä¼ è¾“ã€‚</p><h4 id="äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“"><a href="#äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“" class="headerlink" title="äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“"></a>äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“</h4><div class="table-container"><table><thead><tr><th>è®¾å¤‡</th><th>å·¥ä½œå±‚çº§</th><th>æ ¸å¿ƒèŒè´£</th><th>å…³é”®ç‰¹æ€§</th></tr></thead><tbody><tr><td>ä¸»æœº</td><td>ç½‘ç»œå±‚+é“¾è·¯å±‚</td><td>å°è£…ç½‘ç»œåŒ…ã€ARPæŸ¥è¯¢/å¹¿æ’­ã€åˆ¤æ–­ç›®æ ‡IPç½‘æ®µ</td><td>ç»´æŠ¤ARPç¼“å­˜è¡¨ï¼Œä¸ç›´æ¥è·¨ç½‘æ®µè½¬å‘</td></tr><tr><td>äº¤æ¢æœº</td><td>é“¾è·¯å±‚</td><td>æ ¹æ®MACåœ°å€è¡¨è½¬å‘å¸§ã€æ³›æ´ªæœªçŸ¥MACå¸§ã€å­¦ä¹ æºMAC</td><td>ä¸è¯†åˆ«IPåœ°å€ï¼Œä¸éš”ç¦»å¹¿æ’­åŸŸï¼ˆäºŒå±‚äº¤æ¢æœºï¼‰</td></tr><tr><td>è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰</td><td>ç½‘ç»œå±‚+é“¾è·¯å±‚</td><td>è·¯ç”±å†³ç­–ã€è·¨ç½‘æ®µè½¬å‘ã€NATè½¬æ¢ã€éš”ç¦»å¹¿æ’­åŸŸ</td><td>ä¸¢å¼ƒå¹¿æ’­åŒ…ï¼ŒåŒæ—¶å±äºå¤šä¸ªç½‘ç»œï¼Œç»´æŠ¤è·¯ç”±è¡¨</td></tr></tbody></table></div><h4 id="å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰"><a href="#å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰" class="headerlink" title="å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰"></a>å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å°è£…å®Œæˆç½‘ç»œåŒ…</span><br><span class="line">â”œâ”€ å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ</span><br><span class="line">â”‚  â”œâ”€ æ˜¯ï¼š</span><br><span class="line">â”‚  â”‚  â”œâ”€ æŸ¥è¯¢ARPç¼“å­˜è¡¨ â†’ æœ‰ç›®æ ‡MACï¼Ÿ</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ æ˜¯ï¼šå°è£…å¸§ï¼ˆç›®æ ‡MAC=ç›®æ ‡ä¸»æœºMACï¼‰â†’ äº¤æ¢æœºè½¬å‘ â†’ ç›®æ ‡ä¸»æœº</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ å¦ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC â†’ å­˜å…¥ç¼“å­˜ â†’ å°è£…è½¬å‘</span><br><span class="line">â”‚  â””â”€ å¦ï¼š</span><br><span class="line">â”‚     â”œâ”€ è·å–ç½‘å…³IPï¼ˆDHCP/æ‰‹åŠ¨é…ç½®ï¼‰</span><br><span class="line">â”‚     â”œâ”€ è·å–ç½‘å…³MACï¼ˆARPæŸ¥è¯¢/å¹¿æ’­ï¼‰</span><br><span class="line">â”‚     â”œâ”€ å°è£…å¸§ï¼ˆç›®æ ‡MAC=ç½‘å…³MACï¼‰â†’ äº¤æ¢æœºè½¬å‘ â†’ ç½‘å…³</span><br><span class="line">â”‚     â”œâ”€ ç½‘å…³NATï¼šæºIPä»ç§æœ‰IPæ”¹ä¸ºå…¬ç½‘IP</span><br><span class="line">â”‚     â”œâ”€ ç½‘å…³è·¯ç”±å†³ç­– â†’ è½¬å‘è‡³ä¸‹ä¸€è·³ï¼ˆäº’è”ç½‘å¤šè·¯ç”±å™¨æ¥åŠ›ï¼‰</span><br><span class="line">â”‚     â”œâ”€ åˆ°è¾¾ç›®æ ‡å±€åŸŸç½‘ç½‘å…³ â†’ å‰¥å¸§è·¯ç”± â†’ è·å–ç›®æ ‡ä¸»æœºMAC</span><br><span class="line">â”‚     â””â”€ è½¬å‘è‡³ç›®æ ‡ä¸»æœº</span><br><span class="line">â””â”€ æ ¸å¿ƒä¸å˜é‡ï¼šç›®æ ‡IPå…¨ç¨‹ä¸å˜ï¼›æ ¸å¿ƒå˜é‡ï¼šMACåœ°å€æ¯è·³æ›´æ–°</span><br></pre></td></tr></table></figure><h4 id="ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰"><a href="#ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰" class="headerlink" title="ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰"></a>ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰</h4><ul><li><p>Qï¼šå¦‚æœæŒ‡å®šçš„MACåœ°å€ä¸åœ¨å±€åŸŸç½‘å†…æ€ä¹ˆåŠï¼Ÿ<br>Aï¼šä¸»æœºå‘é€å‰ä¼šé€šè¿‡ARPéªŒè¯ï¼Œè‹¥ARPå¹¿æ’­æ— å“åº”ï¼Œä¼šåˆ¤å®šâ€œç›®æ ‡ä¸å¯è¾¾â€ï¼Œç›´æ¥æŠ¥é”™ï¼Œæ•°æ®åŒ…ä¸ä¼šå‘é€ã€‚</p></li><li><p>Qï¼šäº¤æ¢æœºæœ‰ARPå—ï¼ŸçŸ¥é“IPå¯¹åº”MACå—ï¼Ÿ<br>Aï¼šäºŒå±‚äº¤æ¢æœºæ— ARPï¼Œä¸è¯†åˆ«IPï¼Œä»…é€šè¿‡MACåœ°å€è½¬å‘ï¼›ä¸‰å±‚äº¤æ¢æœºé›†æˆè·¯ç”±åŠŸèƒ½ï¼Œæ‰ä¼šæœ‰ARPè¡¨ã€‚</p></li><li><p>Qï¼šARPæ˜¯å¹¿æ’­ï¼Œå¦‚ä½•éš”ç¦»å¹¿æ’­åŸŸï¼Ÿ<br>Aï¼šè·¯ç”±å™¨ä¼šä¸¢å¼ƒå¹¿æ’­åŒ…ï¼Œä¸è·¨ç½‘æ®µè½¬å‘ï¼Œå› æ­¤å¹¿æ’­åŸŸè¢«è·¯ç”±å™¨éš”ç¦»ï¼Œä»…åœ¨å½“å‰å±€åŸŸç½‘å†…ä¼ æ’­ã€‚</p></li></ul><h4 id="å…«ã€æ€»ç»“"><a href="#å…«ã€æ€»ç»“" class="headerlink" title="å…«ã€æ€»ç»“"></a>å…«ã€æ€»ç»“</h4><p>ç½‘ç»œåŒ…ä»å°è£…å®Œæˆåˆ°é€è¾¾ç›®æ ‡IPçš„è¿‡ç¨‹ï¼Œæœ¬è´¨æ˜¯â€œIPåœ°å€å¯¼èˆª+MACåœ°å€å®šä½â€çš„ååŒè¿‡ç¨‹ï¼Œæ¶‰åŠARPå¯»å€ã€äº¤æ¢æœºæ³›æ´ª/è½¬å‘ã€è·¯ç”±å™¨è·¯ç”±/NATç­‰æ ¸å¿ƒæœºåˆ¶ã€‚ç†è§£è¿™ä¸€è¿‡ç¨‹çš„å…³é”®ï¼Œæ˜¯åˆ†æ¸…ç½‘ç»œå±‚ä¸é“¾è·¯å±‚çš„èŒè´£è¾¹ç•Œï¼Œä»¥åŠå„è®¾å¤‡çš„åˆ†å·¥é€»è¾‘â€”â€”IPè´Ÿè´£â€œæ‰¾ç»ˆç‚¹â€ï¼ŒMACè´Ÿè´£â€œæ‰¾ä¸‹ä¸€è·³â€ï¼Œäº¤æ¢æœºç®¡â€œå±€åŸŸç½‘å†…æ¬è¿â€ï¼Œè·¯ç”±å™¨ç®¡â€œè·¨ç½‘æ®µå¯¼èˆª+éš”ç¦»å¹¿æ’­â€ï¼Œæœ€ç»ˆå®ç°æ•°æ®åŒ…çš„ç²¾å‡†ä¼ è¾“ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot;&gt;&lt;a href=&quot;#å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot; class=&quot;headerlink&quot; title=&quot;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot;&gt;&lt;/a&gt;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&lt;/h2&gt;&lt;h3 id=&quot;é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-</summary>
      
    
    
    
    
    <category term="å…«è‚¡" scheme="https://nmcb666.vip/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰</title>
    <link href="https://nmcb666.vip/posts/d323df1a.html"/>
    <id>https://nmcb666.vip/posts/d323df1a.html</id>
    <published>2026-01-05T18:03:11.000Z</published>
    <updated>2026-01-26T13:39:36.091Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰"><a href="#ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰" class="headerlink" title="ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰"></a>ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰</h1><h2 id="å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ"><a href="#å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ" class="headerlink" title="å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ"></a>å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ</h2><h3 id="å¼‚æˆ–è§£é‡Š"><a href="#å¼‚æˆ–è§£é‡Š" class="headerlink" title="å¼‚æˆ–è§£é‡Š"></a>å¼‚æˆ–è§£é‡Š</h3><ol><li>å¼‚æˆ–è¿ç®—ï¼Œç›¸åŒçš„å€¼å¼‚æˆ–ä¸º0ï¼Œä¸åŒçš„å€¼å¼‚æˆ–ä¸º1</li><li>ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ— è¿›ä½çš„åŠ æ³•</li><li>å¼‚æˆ–è¿ç®—æ»¡è¶³äº¤æ¢å¾‹ï¼Œç»“åˆå¾‹</li><li>ä¸€ä¸ªæ•°ç»„ä¸­æ‰€æœ‰æ•°çš„å¼‚æˆ–å’Œ è·Ÿ æŸäº›æ•°å¼‚æˆ–çš„ç»“æœ ç›¸å½“äº å‡å»æŸäº›æ•°çš„å¼‚æˆ–å’Œ</li></ol><h3 id="ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°"><a href="#ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°"></a>ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°</h3><ol><li>a = a^b</li><li>b = a^b (æ­¤æ—¶ç›¸å½“äºa^b^b = a , å°±è®©bç­‰äºa)</li><li>a = a^b (æ­¤æ—¶ç›¸å½“äºa^b^a = b , å°±è®©aç­‰äºb)</li></ol><p><em>å±€é™æ€§ï¼šæ³¨æ„è¿™ä¸ªäº¤æ¢ä¸èƒ½å¯¹åŒä¸€ä¸ªåœ°å€çš„ä¸¤ä¸ªå˜é‡è¿›è¡Œæ“ä½œã€‚å› ä¸ºç¬¬ä¸€æ­¥å°±ä¼šæŠŠä»–ä»¬éƒ½å˜ä¸º0</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> -<span class="number">2323</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">a = a ^ b;</span><br><span class="line">b = a ^ b;</span><br><span class="line">a = a ^ b;</span><br><span class="line">System.out.println(a);</span><br><span class="line">System.out.println(b);</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°"><a href="#ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°"></a>ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°</h3><p>å¤§ä½“æ€è·¯å°±æ˜¯æ ¹æ®a-bçš„ç¬¦å·ï¼Œæ¥åˆ¤æ–­aå’Œbçš„å¤§å°ã€‚<br>ä½†æ˜¯è¿™æ ·æœ‰æº¢å‡ºçš„é£é™©ï¼ˆa-bä¼šæº¢å‡ºï¼‰<br>ä¼˜åŒ–æ€è·¯ï¼š</p><ol><li>è·å–aå’Œbçš„ç¬¦å·</li><li>è·å–c=a-bçš„ç¬¦å·</li><li>ç»¼åˆåˆ¤æ–­</li><li>å¦‚æœa,bç¬¦å·ç›¸åŒï¼Œåˆ™ä¸å¯èƒ½æº¢å‡ºï¼Œç›´æ¥æ ¹æ®cçš„ç¬¦å·æ¥åˆ¤æ–­å¤§å°</li><li>å¦‚æœa,bç¬¦å·ä¸åŒï¼Œåˆ™a-bå¯èƒ½ä¼šæº¢å‡ºï¼Œåˆ¤æ–­açš„ç¬¦å· å¦‚æœaæ˜¯éè´Ÿçš„ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›aæ›´å¤§</li><li>é™¤äº†ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œå…¶ä½™æƒ…å†µéƒ½è¿”å›b</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å¿…é¡»ä¿è¯nä¸€å®šæ˜¯0æˆ–è€…1</span></span><br><span class="line"><span class="comment">// 0å˜1ï¼Œ1å˜0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">flip</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n ^ <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éè´Ÿæ•°è¿”å›1</span></span><br><span class="line"><span class="comment">// è´Ÿæ•°è¿”å›0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sign</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> flip(n &gt;&gt;&gt; <span class="number">31</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰æº¢å‡ºé£é™©çš„å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getMax1</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a - b;</span><br><span class="line"><span class="comment">// céè´Ÿï¼ŒreturnA -&gt; 1</span></span><br><span class="line"><span class="comment">// céè´Ÿï¼ŒreturnB -&gt; 0</span></span><br><span class="line"><span class="comment">// cè´Ÿæ•°ï¼ŒreturnA -&gt; 0</span></span><br><span class="line"><span class="comment">// cè´Ÿæ•°ï¼ŒreturnB -&gt; 1</span></span><br><span class="line"><span class="type">int</span> <span class="variable">returnA</span> <span class="operator">=</span> sign(c);</span><br><span class="line"><span class="type">int</span> <span class="variable">returnB</span> <span class="operator">=</span> flip(returnA);</span><br><span class="line"><span class="keyword">return</span> a * returnA + b * returnB;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ²¡æœ‰ä»»ä½•é—®é¢˜çš„å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getMax2</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="comment">// cå¯èƒ½æ˜¯æº¢å‡ºçš„</span></span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a - b;</span><br><span class="line"><span class="comment">// açš„ç¬¦å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sa</span> <span class="operator">=</span> sign(a);</span><br><span class="line"><span class="comment">// bçš„ç¬¦å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sb</span> <span class="operator">=</span> sign(b);</span><br><span class="line"><span class="comment">// cçš„ç¬¦å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sc</span> <span class="operator">=</span> sign(c);</span><br><span class="line"><span class="comment">// åˆ¤æ–­Aå’ŒBï¼Œç¬¦å·æ˜¯ä¸æ˜¯ä¸ä¸€æ ·ï¼Œå¦‚æœä¸ä¸€æ ·diffAB=1ï¼Œå¦‚æœä¸€æ ·diffAB=0</span></span><br><span class="line"><span class="type">int</span> <span class="variable">diffAB</span> <span class="operator">=</span> sa ^ sb;</span><br><span class="line"><span class="comment">// åˆ¤æ–­Aå’ŒBï¼Œç¬¦å·æ˜¯ä¸æ˜¯ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·sameAB=1ï¼Œå¦‚æœä¸ä¸€æ ·sameAB=0</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sameAB</span> <span class="operator">=</span> flip(diffAB);</span><br><span class="line"><span class="type">int</span> <span class="variable">returnA</span> <span class="operator">=</span> diffAB * sa + sameAB * sc;</span><br><span class="line"><span class="type">int</span> <span class="variable">returnB</span> <span class="operator">=</span> flip(returnA);</span><br><span class="line"><span class="keyword">return</span> a * returnA + b * returnB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"><a href="#ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"></a>ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰</h3><p>æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰çš„æ•°å¼‚æˆ–ä¸€éï¼Œæœ€åå‰©ä¸‹çš„æ•°å°±æ˜¯å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ã€‚<br>å› ä¸ºå¼‚æˆ–æ»¡è¶³äº¤æ¢å¾‹ã€‚å‡¡æ˜¯å‡ºç°å¶æ•°æ¬¡çš„æ•°ï¼Œå¼‚æˆ–ç»“æœéƒ½ä¸º0ï¼Œæœ€åç»“æœå°±æ˜¯å¥‡æ•°æ¬¡çš„æ•°^0 = å¥‡æ•°æ¬¡çš„æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">singleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">eor</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">eor ^= num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> eor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"><a href="#ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"></a>ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰</h3><p>æ€è·¯ï¼š(å‡è®¾é‚£ä¸¤ä¸ªæ•°ä¸ºaå’Œb)</p><ol><li>å…ˆå°†æ•°ç»„ä¸­æ‰€æœ‰æ•°å¼‚æˆ–ä¸€éï¼Œå¾—åˆ°ä¸€ä¸ªæ•°xor1=a^b</li><li>æ‰¾åˆ°xor1æœ€å³è¾¹çš„1ï¼Œå³xor1 &amp; (-xor1) (è§£é‡Šï¼šxor1 &amp; (-xor1)å¯ä»¥è·å–xor1æœ€å³è¾¹çš„1ã€‚å¹¶ä¸”è¿™ä¸ª1å°±æ˜¯aè·Ÿbè‚¯å®šä¸ä¸€æ ·çš„æ•°ä½ï¼ˆå½“ç„¶ä¸åªè¿™ä¸€ä¸ªï¼Œä½†æ˜¯åªéœ€è¦è¿™ä¸€ä¸ªæˆ‘ä»¬å°±å¯ä»¥åŒºåˆ†å®ƒä»¬äº†ï¼‰)</li><li>å°†æ•°ç»„ä¸­æ‰€æœ‰æ•°åˆ†ä¸ºä¸¤ç»„ï¼Œä¸€ç»„æ˜¯xor1æœ€å³è¾¹çš„1ä¸º1çš„æ•°ï¼Œä¸€ç»„æ˜¯xor1æœ€å³è¾¹çš„1ä¸º0çš„æ•° ï¼ˆa,bè‚¯å®šåœ¨ä¸åŒçš„ç»„ä¸­ï¼‰</li><li>å¯¹å…¶ä¸­ä¸€ç»„æ•°å¼‚æˆ–ï¼Œå¾—åˆ°XOR2  (XORå¯èƒ½æ˜¯aä¹Ÿæœ‰å¯èƒ½æ˜¯b) ï¼ˆæ¯ç»„è¿˜æ˜¯æ»¡è¶³é™¤äº†a,bä¹‹å¤–æ‰€æœ‰æ•°å‡ºç°æ¬¡æ•°éƒ½æ˜¯å¶æ•°ï¼‰</li><li>è®²XOR2ä¸XOR1å¼‚æˆ–ï¼Œå¾—åˆ°å¦ä¸€ä¸ªæ•° ï¼ˆXOR2^XOR1=a^b^b=a (å‡è®¾XORæ˜¯b)ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] singleNumber(<span class="type">int</span>[] nums) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">eor1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line"><span class="comment">// numsä¸­æœ‰2ç§æ•°aã€bå‡ºç°äº†å¥‡æ•°æ¬¡ï¼Œå…¶ä»–çš„æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡</span></span><br><span class="line">eor1 ^= num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// eor1 : a ^ b</span></span><br><span class="line"><span class="comment">// Brian Kernighanç®—æ³•</span></span><br><span class="line"><span class="comment">// æå–å‡ºäºŒè¿›åˆ¶é‡Œæœ€å³ä¾§çš„1</span></span><br><span class="line"><span class="type">int</span> <span class="variable">rightOne</span> <span class="operator">=</span> eor1 &amp; (-eor1);</span><br><span class="line"><span class="type">int</span> <span class="variable">eor2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line"><span class="keyword">if</span> ((num &amp; rightOne) == <span class="number">0</span>) &#123;</span><br><span class="line">eor2 ^= num;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; eor2, eor1 ^ eor2 &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ"><a href="#å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ" class="headerlink" title="å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ"></a>å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ</h2><h3 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚"><a href="#åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚"></a>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚</h3><p>åŸç†ï¼š å¦‚æœæ˜¯2çš„å¹‚ï¼Œé‚£ä¹ˆäºŒè¿›åˆ¶æ•°åªæœ‰ä¸€ä½ä¸º1ï¼Œå…¶ä»–ä¸º0 ã€‚è¿™æ—¶å€™æˆ‘ä»¬ç”¨a&amp;-a æ‹¿åˆ°åˆ°çš„æ•°ï¼Œå°±æ˜¯aæœ€å³è¾¹çš„1ã€‚ç„¶ååˆ¤æ–­aæ˜¯ä¸æ˜¯ç­‰äºa&amp;-a ç­‰äºçš„è¯ï¼Œé‚£ä¹ˆaå°±æ˜¯2çš„å¹‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPowerOfTwo</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a &gt; <span class="number">0</span> &amp;&amp; a==(a&amp;-a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚"><a href="#åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚"></a>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å¦‚æœä¸€ä¸ªæ•°å­—æ˜¯3çš„æŸæ¬¡å¹‚ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ä¸€å®šåªå«æœ‰3è¿™ä¸ªè´¨æ•°å› å­</span></span><br><span class="line"><span class="comment">// 1162261467æ˜¯intå‹èŒƒå›´å†…ï¼Œæœ€å¤§çš„3çš„å¹‚ï¼Œå®ƒæ˜¯3çš„19æ¬¡æ–¹</span></span><br><span class="line"><span class="comment">// è¿™ä¸ª1162261467åªå«æœ‰3è¿™ä¸ªè´¨æ•°å› å­ï¼Œå¦‚æœnä¹Ÿæ˜¯åªå«æœ‰3è¿™ä¸ªè´¨æ•°å› å­ï¼Œé‚£ä¹ˆ</span></span><br><span class="line"><span class="comment">// 1162261467 % n == 0</span></span><br><span class="line"><span class="comment">// åä¹‹å¦‚æœ1162261467 % n != 0 è¯´æ˜nä¸€å®šå«æœ‰å…¶ä»–å› å­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPowerOfThree</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; <span class="number">1162261467</span> % n == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹"><a href="#è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹" class="headerlink" title="è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹"></a>è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹</h3><p>å…ˆå¯¹n-1 ç„¶åæŠŠnæœ€å·¦è¾¹çš„1ä¸€ç›´è®©å³è¾¹å…¨å˜ä¸º1.æœ€åçš„ç­”æ¡ˆå°±æ˜¯n+1 (00111111 -&gt; 01000000)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">near2power</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (n &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">n--;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line"><span class="keyword">return</span> n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­—-amp-çš„ç»“æœ-è¿ç»­"><a href="#æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­—-amp-çš„ç»“æœ-è¿ç»­" class="headerlink" title="æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­— &amp; çš„ç»“æœ(è¿ç»­)"></a>æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­— &amp; çš„ç»“æœ(è¿ç»­)</h3><p>å½¢å¦‚ 0111001000 å¦‚æœæ­¤æ—¶è¿˜å­˜åœ¨ä¸€ä¸ªæ¯”è‡ªå·±è¿˜å°çš„æ•°ï¼Œé‚£ä¹ˆæˆ‘æœ€å³è¾¹çš„1è‚¯å®šä¼šè¢«ä¸è¿ç®—å˜æˆ0.ç›´åˆ°æœ€å°çš„æ•°éƒ½å¤§äºæˆ‘ï¼Œæˆ‘çš„æœ€å³ä¾§çš„1æ‰èƒ½ä¿ç•™ä¸‹æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">rangeBitwiseAnd</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">right -= right &amp; -right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"><a href="#ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°" class="headerlink" title="ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"></a>ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</h3><p>å…·ä½“æ€è·¯å‚è€ƒ ã€ç®—æ³•è®²è§£031ã€å¿…å¤‡ã€‘ä½è¿ç®—çš„éªšæ“ä½œã€‘<a href="https://www.bilibili.com/video/BV1ch4y1Q7vd?vd_source=c6cdeb45f015e4ab4447a6c61482633a">https://www.bilibili.com/video/BV1ch4y1Q7vd?vd_source=c6cdeb45f015e4ab4447a6c61482633a</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">cntOnes</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">n = (n &amp; <span class="number">0x55555555</span>) + ((n &gt;&gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x33333333</span>) + ((n &gt;&gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x0f0f0f0f</span>) + ((n &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f0f0f0f</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x00ff00ff</span>) + ((n &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0x00ff00ff</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x0000ffff</span>) + ((n &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x0000ffff</span>);</span><br><span class="line"><span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ"><a href="#ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ" class="headerlink" title="ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ"></a>ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MIN</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (a == MIN &amp;&amp; b == MIN) &#123;</span><br><span class="line"><span class="comment">// aå’Œbéƒ½æ˜¯æ•´æ•°æœ€å°</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (a != MIN &amp;&amp; b != MIN) &#123;</span><br><span class="line"><span class="comment">// aå’Œbéƒ½ä¸æ˜¯æ•´æ•°æœ€å°ï¼Œé‚£ä¹ˆæ­£å¸¸å»é™¤</span></span><br><span class="line"><span class="keyword">return</span> div(a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (b == MIN) &#123;</span><br><span class="line"><span class="comment">// aä¸æ˜¯æ•´æ•°æœ€å°ï¼Œbæ˜¯æ•´æ•°æœ€å°</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// aæ˜¯æ•´æ•°æœ€å°ï¼Œbæ˜¯-1ï¼Œè¿”å›æ•´æ•°æœ€å¤§ï¼Œå› ä¸ºé¢˜ç›®é‡Œæ˜ç¡®è¿™ä¹ˆè¯´äº†</span></span><br><span class="line"><span class="keyword">if</span> (b == neg(<span class="number">1</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// aæ˜¯æ•´æ•°æœ€å°ï¼Œbä¸æ˜¯æ•´æ•°æœ€å°ï¼Œbä¹Ÿä¸æ˜¯-1</span></span><br><span class="line">a = add(a, b &gt; <span class="number">0</span> ? b : neg(b));</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> div(a, b);</span><br><span class="line"><span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> b &gt; <span class="number">0</span> ? neg(<span class="number">1</span>) : <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> add(ans, offset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»ä¿è¯aå’Œbéƒ½ä¸æ˜¯æ•´æ•°æœ€å°å€¼ï¼Œè¿”å›aé™¤ä»¥bçš„ç»“æœ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> a &lt; <span class="number">0</span> ? neg(a) : a;</span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> b &lt; <span class="number">0</span> ? neg(b) : b;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">30</span>; i &gt;= <span class="number">0</span>; i = minus(i, <span class="number">1</span>)) &#123;</span><br><span class="line"><span class="keyword">if</span> ((x &gt;&gt; i) &gt;= y) &#123;</span><br><span class="line">ans |= (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">x = minus(x, y &lt;&lt; i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a &lt; <span class="number">0</span> ^ b &lt; <span class="number">0</span> ? neg(ans) : ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> a;</span><br><span class="line"><span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// ans : aå’Œbæ— è¿›ä½ç›¸åŠ çš„ç»“æœ</span></span><br><span class="line">ans = a ^ b;</span><br><span class="line"><span class="comment">// b : aå’Œbç›¸åŠ æ—¶çš„è¿›ä½ä¿¡æ¯</span></span><br><span class="line">b = (a &amp; b) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">a = ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minus</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> add(a, neg(b));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">neg</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> add(~n, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ç§ä¹˜æ³•åé¢æœ‰å¤§ç”¨å¤„ï¼Œå°¤å…¶æ˜¯æ±‚(açš„bæ¬¡æ–¹ % m)çš„ç»“æœï¼Œä¹Ÿå«é¾Ÿé€Ÿä¹˜</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> ((b &amp; <span class="number">1</span>) != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// è€ƒå¯Ÿbå½“å‰æœ€å³çš„çŠ¶æ€ï¼</span></span><br><span class="line">ans = add(ans, a);</span><br><span class="line">&#125;</span><br><span class="line">a &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">b &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&quot;&gt;&lt;a href=&quot;#ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&quot;&gt;&lt;/a&gt;ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ&quot;&gt;&lt;a href=&quot;#å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ&quot; class=&quot;headerli</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰</title>
    <link href="https://nmcb666.vip/posts/e33533c2.html"/>
    <id>https://nmcb666.vip/posts/e33533c2.html</id>
    <published>2026-01-02T15:26:44.000Z</published>
    <updated>2026-01-26T13:39:36.091Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰"><a href="#ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰" class="headerlink" title="ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰"></a>ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰</h1><h2 id="å½’å¹¶åˆ†æ²»"><a href="#å½’å¹¶åˆ†æ²»" class="headerlink" title="å½’å¹¶åˆ†æ²»"></a>å½’å¹¶åˆ†æ²»</h2><h3 id="ä½¿ç”¨æƒ…å†µ"><a href="#ä½¿ç”¨æƒ…å†µ" class="headerlink" title="ä½¿ç”¨æƒ…å†µ"></a>ä½¿ç”¨æƒ…å†µ</h3><ol><li>å·¦è¾¹ç»“æœ+å³è¾¹ç»“æœ+è·¨è¶Šä¸¤è¾¹çš„ç»“æœæ˜¯å¦ç­‰äºæœ€ç»ˆç»“æœ</li><li>å¯¹äºä¸¤è¾¹æ’åºä¹‹åå¯¹äºç»Ÿè®¡è·¨è¶Šä¸¤è¾¹çš„ç»“æœæ˜¯å¦æœ‰å¸®åŠ©</li></ol><h3 id="æ³¨æ„ä¸æ€»ç»“"><a href="#æ³¨æ„ä¸æ€»ç»“" class="headerlink" title="æ³¨æ„ä¸æ€»ç»“"></a>æ³¨æ„ä¸æ€»ç»“</h3><ol><li>ä¸»è¦æ€æƒ³è·Ÿå½’å¹¶æ’åºä¸€æ · åªä¸è¿‡æ˜¯åœ¨mergeçš„æ—¶å€™è¿›è¡Œä¸€äº›é¢å¤–ç»Ÿè®¡æ“ä½œï¼ˆç»Ÿè®¡è·¨è¶Šä¸¤è¾¹çš„ç»“æœï¼‰</li><li>å¦‚æœåªæ˜¯å•çº¯çš„æ¯”å¤§å°ï¼ˆæ¯”å¦‚ å°å’Œï¼Œé€†åºå¯¹ï¼‰å¯ä»¥ç›´æ¥åœ¨mergeçš„æ—¶å€™è¿›è¡Œæ¯”è¾ƒ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°å’Œ ç›´æ¥åœ¨åˆå¹¶çš„æ—¶å€™è¿›è¡Œæ¯”è¾ƒç»Ÿè®¡</span></span><br><span class="line">        <span class="keyword">while</span>(a &lt;=m &amp;&amp; b&lt;=r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[a]&lt;nums[b])&#123;</span><br><span class="line">                help[i++] = nums[a];</span><br><span class="line">                sum+= (nums[a]*(r-b+<span class="number">1</span>));</span><br><span class="line">                a++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                help[i++] = nums[b++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li><li>å¦‚æœä¸åªæ˜¯æ¯”å¤§å° è€Œæ˜¯æ¯”è¾ƒä¹˜ä»¥äºŒå€çš„ç»“æœï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨mergeçš„æ—¶å€™ æ·»åŠ é¢å¤–çš„ç»Ÿè®¡æ“ä½œ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“å·¦è¾¹çš„æ•°å¤§äºå³è¾¹çš„ä¸¤å€æ—¶è¿›è¡Œç»Ÿè®¡</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> ll=l,rr=m+<span class="number">1</span>;ll&lt;=m;ll++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(rr&lt;=r &amp;&amp; (<span class="type">long</span>)nums[ll]&gt;((<span class="type">long</span>)nums[rr]&lt;&lt;<span class="number">1</span>))&#123;</span><br><span class="line">                sum++;</span><br><span class="line">                rr++;</span><br><span class="line">            &#125;</span><br><span class="line">            ans+=sum;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><h3 id="ä¸¤ç§partition-æ™®é€š-è·å…°å›½æ——"><a href="#ä¸¤ç§partition-æ™®é€š-è·å…°å›½æ——" class="headerlink" title="ä¸¤ç§partition (æ™®é€š+è·å…°å›½æ——)"></a>ä¸¤ç§partition (æ™®é€š+è·å…°å›½æ——)</h3><ol><li>æ™®é€špartition ä¸€æ¬¡åªèƒ½ç¡®å®šä¸€ä¸ªæ•°çš„ä½ç½®</li></ol><p>æ ¸å¿ƒæ€æƒ³ï¼šåˆå§‹åŒ–ç´¢å¼•i a xi<br>1.1 éå†æ•°ç»„ï¼Œå¦‚æœå½“å‰æ•°å°äºç­‰äºxï¼Œåˆ™äº¤æ¢iå’Œaæ•° i++ a++<br>1.2 å¦‚æœå¤§äºxï¼Œåˆ™i++ aä¸åŠ¨<br>1.3 å¦‚æœé‡åˆ°nums[a] == x,ç”¨xiè®°å½•ä»–çš„ä½ç½®<br>1.4 éå†ç»“æŸåï¼Œäº¤æ¢xiå’Œa-1çš„ä½ç½®ï¼Œè®©xæ”¾åˆ°å¯¹åº”çš„ä½ç½®ã€‚<br>1.5 è¿”å›a-1ï¼ˆxåº”è¯¥åœ¨çš„ä½ç½®ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸¤ä¸ªåŒºå· å°äºç­‰äº   å¤§äº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition1</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> l;</span><br><span class="line">        <span class="type">int</span> <span class="variable">xi</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;=r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &lt;= x)&#123;</span><br><span class="line">                swap(nums,a,i);</span><br><span class="line">                <span class="keyword">if</span>(nums[a] == x)&#123;</span><br><span class="line">                    xi = a;</span><br><span class="line">                &#125;</span><br><span class="line">                a++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums,xi,a-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> a-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol><li>è·å…°å›½æ——partition ä¸€æ¬¡å¯ä»¥ç¡®å®šå¤šä¸ªç›¸åŒçš„æ•°çš„ä½ç½®</li></ol><p>æ ¸å¿ƒæ€è·¯ï¼šåˆå§‹åŒ–ç´¢å¼•i a(å°äºåŒºé—´) bï¼ˆå¤§äºåŒºé—´ï¼‰<br>1.1 éå†æ•°ç»„ï¼Œå¦‚æœå½“å‰æ•°å°äºxï¼Œåˆ™äº¤æ¢iå’Œaæ•° i++ a++<br>1.2 å¦‚æœå¤§äºxï¼Œåˆ™iä¸åŠ¨ bâ€”<br>1.3 å¦‚æœç­‰äºxï¼Œåˆ™i++<br>1.4 éå†ç»“æŸåï¼Œa-1ï¼ˆå°äºåŒºé—´çš„æœ«å°¾ï¼‰ b+1ï¼ˆå¤§äºåŒºé—´çš„å¼€å¤´ï¼‰ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> first,last;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‰ä¸ªåŒºé—´ å°äº  å¤§äº   ç­‰äº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">partition2</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> a=l;</span><br><span class="line">    <span class="type">int</span> b=r;</span><br><span class="line">    <span class="type">int</span> i=l;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i] &lt; x)&#123;</span><br><span class="line">            swap(nums,a++,i++);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums[i] &gt; x)&#123;</span><br><span class="line">            swap(nums,i,b--);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    first = a;</span><br><span class="line">    last = b;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰©å±•-å¿«é€Ÿé€‰æ‹©"><a href="#æ‰©å±•-å¿«é€Ÿé€‰æ‹©" class="headerlink" title="æ‰©å±• å¿«é€Ÿé€‰æ‹©"></a>æ‰©å±• å¿«é€Ÿé€‰æ‹©</h3><p>å¿«é€Ÿé€‰æ‹©ï¼šç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œè¿”å›ç¬¬kå°çš„æ•°</p><ol><li>å¿«é€Ÿæ’åºçš„æ€æƒ³ï¼Œpartitionä¹‹åï¼Œå¦‚æœåœ¨å½“å‰åŒºé—´å†…çš„æ’åå¤§äºæŒ‡å®šçš„æ’åï¼Œåˆ™é€’å½’quickselect(l,left-1,k)</li><li>å¿«é€Ÿæ’åºçš„æ€æƒ³ï¼Œpartitionä¹‹åï¼Œå¦‚æœåœ¨å½“å‰åŒºé—´å†…çš„æ’åå°äºæŒ‡å®šçš„æ’åï¼Œåˆ™é€’å½’quickselect(right+1,r,k-rightNow)  (rightNowæŒ‡å®šçš„æ•°åœ¨å½“å‰åŒºé—´å†…çš„æœ€é å³çš„æ’å)</li><li>å¿«é€Ÿæ’åºçš„æ€æƒ³ï¼Œpartitionä¹‹åï¼Œå¦‚æœåœ¨å½“å‰åŒºé—´å†…çš„æ’åç­‰äºæŒ‡å®šçš„æ’åï¼Œåˆ™è¿”å›ç”¨äºpartitionçš„æ•°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">quick</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=r)&#123;</span><br><span class="line">        <span class="keyword">return</span> nums[l];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">partitor</span> <span class="operator">=</span> nums[l+ (<span class="type">int</span>)(Math.random()*(r-l+<span class="number">1</span>))];</span><br><span class="line">    <span class="comment">//è·å…°å›½æ——</span></span><br><span class="line">    partition2(nums,l,r,partitor);</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> first;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> last;</span><br><span class="line">    <span class="type">int</span> <span class="variable">leftNow</span> <span class="operator">=</span> left -l +<span class="number">1</span>; <span class="comment">//å½“å‰åŒºé—´å†…partitoré å·¦çš„æ’åï¼ˆå¯èƒ½å­˜åœ¨å¤šä¸ªpartitorï¼‰</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">rightNow</span> <span class="operator">=</span> right -l+<span class="number">1</span>; <span class="comment">//å½“å‰åŒºé—´å†…partitoré å³çš„æ’å</span></span><br><span class="line">    <span class="keyword">if</span>(pos&lt;leftNow)&#123; <span class="comment">//è¦æ‰¾çš„ä½ç½®åœ¨å·¦è¾¹ å†å»å·¦è¾¹æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> quick(nums,l,left-<span class="number">1</span>,pos);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(pos&gt;rightNow)&#123; <span class="comment">//è¦æ‰¾çš„ä½ç½®åœ¨å³è¾¹ å†å»å³è¾¹æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> quick(nums,right+<span class="number">1</span>,r,pos-rightNow);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; <span class="comment">//è¦æ‰¾çš„ä½ç½®åœ¨ä¸­é—´ ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> nums[pos+l-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><p>å †æ’åºæœ¬èº«æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯åˆ©ç”¨å †è¿™ä¸ªæ•°æ®ç»“æ„è¿›è¡Œæ’åºã€‚è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹heapify è·Ÿ heapInsert</p><h3 id="heapify"><a href="#heapify" class="headerlink" title="heapify"></a>heapify</h3><p>å°†èŠ‚ç‚¹ä¸‹ç§»åˆ°åˆé€‚çš„ä½ç½®ï¼Œç›´æ¥è´´ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// iä½ç½®çš„æ•°ï¼Œå˜å°äº†ï¼Œåˆæƒ³ç»´æŒå¤§æ ¹å †ç»“æ„</span></span><br><span class="line"><span class="comment">// å‘ä¸‹è°ƒæ•´å¤§æ ¹å †</span></span><br><span class="line"><span class="comment">// å½“å‰å †çš„å¤§å°ä¸ºsize</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> size)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (l &lt; size) &#123;</span><br><span class="line"><span class="comment">// æœ‰å·¦å­©å­ï¼Œl</span></span><br><span class="line"><span class="comment">// å³å­©å­ï¼Œl+1</span></span><br><span class="line"><span class="comment">// è¯„é€‰ï¼Œæœ€å¼ºçš„å­©å­ï¼Œæ˜¯å“ªä¸ªä¸‹æ ‡çš„å­©å­</span></span><br><span class="line"><span class="type">int</span> <span class="variable">best</span> <span class="operator">=</span> l + <span class="number">1</span> &lt; size &amp;&amp; arr[l + <span class="number">1</span>] &gt; arr[l] ? l + <span class="number">1</span> : l;</span><br><span class="line"><span class="comment">// ä¸Šé¢å·²ç»è¯„é€‰äº†æœ€å¼ºçš„å­©å­ï¼Œæ¥ä¸‹æ¥ï¼Œå½“å‰çš„æ•°å’Œæœ€å¼ºçš„å­©å­ä¹‹å‰ï¼Œæœ€å¼ºä¸‹æ ‡æ˜¯è°</span></span><br><span class="line">best = arr[best] &gt; arr[i] ? best : i;</span><br><span class="line"><span class="keyword">if</span> (best == i) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">swap(arr, best, i);</span><br><span class="line">i = best;</span><br><span class="line">l = i * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¹Ÿæœ‰é€’å½’çš„ç‰ˆæœ¬ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œä¸è¯¦ç»†è¯´äº†ã€‚</p><p>æ­¤å¤–ä½¿ç”¨heapifyå¯ä»¥è‡ªåº•å‘ä¸Šçš„æ„å»ºå † æ—¶é—´å¤æ‚åº¦ä¸ºO(n)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n/<span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">heapify(arr, i, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="heapInsert"><a href="#heapInsert" class="headerlink" title="heapInsert"></a>heapInsert</h3><p>å°†èŠ‚ç‚¹ä¸Šç§»åˆ°åˆé€‚ä½ç½®ï¼Œç›´æ¥è´´ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// iä½ç½®çš„æ•°ï¼Œå˜å¤§äº†ï¼Œåˆæƒ³ç»´æŒå°æ ¹å †ç»“æ„</span></span><br><span class="line"><span class="comment">// å‘ä¸Šè°ƒæ•´å°æ ¹å †</span></span><br><span class="line"><span class="comment">// å½“å‰å †çš„å¤§å°ä¸ºsize</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapInsert</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (arr[i] &gt; arr[(i - <span class="number">1</span>) / <span class="number">2</span>]) &#123;</span><br><span class="line">swap(arr, i, (i - <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">i = (i - <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤å¤–ä½¿ç”¨heapInsertå¯ä»¥è‡ªä¸Šåˆ°ä¸‹çš„æ„å»ºå † æ—¶é—´å¤æ‚åº¦ä¸ºO(n*logn) (ä¸å¦‚ä¸Šé¢çš„æ–¹æ³•)<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">heapInsert(arr, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜"><a href="#åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜" class="headerlink" title="åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜"></a>åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜</h3><h4 id="1-åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨"><a href="#1-åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="1. åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨"></a>1. åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨</h4><ol><li>åˆ›å»ºä¸€ä¸ªæœ€å°å †ï¼Œå°†kä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹åŠ å…¥å †ä¸­</li><li>å¼¹å‡ºæœ€å°çš„èŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°ç»“æœé“¾è¡¨ä¸­</li><li>å¼¹å‡ºçš„èŠ‚ç‚¹çš„nextèŠ‚ç‚¹åŠ å…¥å †ä¸­</li><li>é‡å¤2-3ï¼Œç›´åˆ°å †ä¸ºç©º</li><li>è¿”å›ç»“æœé“¾è¡¨</li></ol><p>å¤æ‚åº¦ O(n*logk)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">    PriorityQueue&lt;ListNode&gt; heap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;a.val-b.val);</span><br><span class="line">    <span class="keyword">for</span> (ListNode listNode : lists) &#123;</span><br><span class="line">        <span class="keyword">if</span>(listNode!=<span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            heap.add(listNode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(heap.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">h</span> <span class="operator">=</span> heap.poll();</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span>h;</span><br><span class="line">    <span class="keyword">if</span>(pre.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        heap.add(pre.next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!heap.isEmpty())&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> heap.poll();</span><br><span class="line">        pre.next = node;</span><br><span class="line">        <span class="keyword">if</span>(node.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">            heap.add(node.next);</span><br><span class="line">        &#125;</span><br><span class="line">        pre = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜"><a href="#2-çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜" class="headerlink" title="2. çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜"></a>2. çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜</h4><p> çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜ï¼Œå°±æ˜¯ç»™å®šå¾ˆå¤šçº¿æ®µï¼Œæ±‚çº¿æ®µæœ€å¤šé‡åˆçš„æ¬¡æ•° </p><ol><li>å°†æ‰€æœ‰çº¿æ®µæŒ‰å¼€å§‹çš„ç‚¹è¿›è¡Œæ’åº</li><li>ä¾æ¬¡å¼€å§‹éå†çº¿æ®µ</li><li>å¼¹å‡ºå †ä¸­çš„æœ€å°ç‚¹ï¼Œå¦‚æœæœ€å°ç‚¹å°äºå½“å‰çº¿æ®µçš„å¼€å§‹ç‚¹ï¼Œåˆ™è¯´æ˜åœ¨å½“å‰çº¿æ®µå¼€å§‹æ—¶ï¼Œè¿™é‡Œé¢çš„çº¿æ®µå·²ç»ç»“æŸä¸ä¼šé‡åˆã€‚å¼¹å‡ºå †ä¸­çš„æœ€å°ç‚¹</li><li>å¾ªç¯3æ­¥ç›´åˆ°å †é‡Œé¢çš„å…ƒç´ ä¸å°äºå½“å‰çº¿æ®µçš„å¼€å§‹ç‚¹ã€‚</li><li>å°†å½“å‰çº¿æ®µçš„ç»“æŸç‚¹åŠ å…¥æœ€å°å †ä¸­</li><li>å½“å‰æœ€å°å †çš„sizeå°±æ˜¯ä»¥è¿™ä¸ªçº¿æ®µå¼€å§‹ä¸ºé‡åˆå¼€å§‹åŒºé—´çš„é‡åˆçš„æ¬¡æ•°ï¼Œç”¨è¿™ä¸ªè·Ÿè®°å½•çš„æœ€å¤§æ¬¡æ•°è¿›è¡Œæ¯”è¾ƒï¼Œæ›´æ–°æœ€å¤§æ¬¡æ•°</li><li>å¾ªç¯2-6ï¼Œç›´åˆ°æ‰€æœ‰çº¿æ®µéƒ½éå†ç»“æŸ</li><li>è¿”å›æœ€å¤§æ¬¡æ•°</li></ol><p>æ—¶é—´å¤æ‚åº¦  O(n*logn)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// å †çš„æ¸…ç©º</span></span><br><span class="line">size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿æ®µä¸€å…±æœ‰næ¡ï¼Œline[0...n-1][2] : line[i][0] line[i][1], å·¦é—­å³é—­</span></span><br><span class="line"><span class="comment">// æ‰€æœ‰çº¿æ®µï¼Œæ ¹æ®å¼€å§‹ä½ç½®æ’åºï¼Œç»“æŸä½ç½®æ— æ‰€è°“</span></span><br><span class="line"><span class="comment">// æ¯”è¾ƒå™¨çš„ç”¨æ³•</span></span><br><span class="line"><span class="comment">// line [0...n) æ’åº : æ‰€æœ‰å°æ•°ç»„ï¼Œå¼€å§‹ä½ç½®è°å°è°åœ¨å‰</span></span><br><span class="line">Arrays.sort(line, <span class="number">0</span>, n, (a, b) -&gt; a[<span class="number">0</span>] - b[<span class="number">0</span>]);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="comment">// i : line[i][0] line[i][1]</span></span><br><span class="line"><span class="keyword">while</span> (size &gt; <span class="number">0</span> &amp;&amp; heap[<span class="number">0</span>] &lt;= line[i][<span class="number">0</span>]) &#123;</span><br><span class="line">pop();</span><br><span class="line">&#125;</span><br><span class="line">add(line[i][<span class="number">1</span>]);</span><br><span class="line">ans = Math.max(ans, size);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°"><a href="#3-ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°" class="headerlink" title="3.ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°"></a>3.ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°</h4><p>ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ nums ã€‚æ¯ä¸€æ¬¡æ“ä½œä¸­ï¼Œä½ å¯ä»¥ä» nums ä¸­é€‰æ‹©ä»»æ„ä¸€ä¸ªæ•°å¹¶å°†å®ƒå‡å°åˆ°æ°å¥½ä¸€åŠã€‚ï¼ˆæ³¨æ„ï¼Œåœ¨åç»­æ“ä½œä¸­ä½ å¯ä»¥å¯¹å‡åŠè¿‡çš„æ•°ç»§ç»­æ‰§è¡Œæ“ä½œï¼‰<br>è¯·ä½ è¿”å›å°† nums æ•°ç»„å’Œè‡³å°‘å‡å°‘ä¸€åŠçš„æœ€å°‘æ“ä½œæ•°ã€‚</p><p>æ€è·¯ï¼š å…¶å®å°±æ˜¯è´ªå¿ƒç®—æ³•ï¼Œæ¯æ¬¡æŠŠæœ€å¤§çš„æ•°å‡åˆ°ä¸€åŠï¼Œç›´åˆ°å’Œå‡å°‘åˆ°ä¸€åŠã€‚å…¶ä¸­æ‰¾æœ€å¤§çš„æ•°å°±å¯ä»¥ç”¨å¤§æ ¹å †æ¥å®ç°ã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªå¤§æ ¹å †ï¼Œå°†æ•°ç»„ä¸­çš„æ•°æ”¾å…¥å¤§æ ¹å †ä¸­ã€‚</li><li>å–å‡ºæœ€å¤§çš„æ•°ï¼Œé™¤ä»¥2 ï¼Œæ“ä½œæ•°++ï¼Œå¹¶åˆ¤æ–­å’Œæ˜¯å¦å‡å°‘åˆ°ä¸€åŠã€‚å¦‚æœå’Œå‡å°‘åˆ°ä¸€åŠï¼Œåˆ™è¿”å›å½“å‰æ“ä½œæ•°ã€‚</li><li>å¾ªç¯ç¬¬äºŒæ­¥ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">halveArray1</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"><span class="comment">// å¤§æ ¹å †</span></span><br><span class="line">PriorityQueue&lt;Double&gt; heap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; b.compareTo(a));</span><br><span class="line"><span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">heap.add((<span class="type">double</span>) num);</span><br><span class="line">sum += num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// sumï¼Œæ•´ä½“ç´¯åŠ å’Œï¼Œ-&gt; è¦å‡å°‘çš„ç›®æ ‡ï¼</span></span><br><span class="line">sum /= <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">double</span> <span class="variable">minus</span> <span class="operator">=</span> <span class="number">0</span>, cur; minus &lt; sum; ans++, minus += cur) &#123;</span><br><span class="line">cur = heap.poll() / <span class="number">2</span>;</span><br><span class="line">heap.add(cur);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–æ€è·¯ï¼šå¯ä»¥è‡ªå·±å®ç°å¤§æ ¹å †ï¼Œå¹¶ä¸”ä¸ç”¨Doubleç±»å‹ï¼Œç”¨longç±»å‹å°†æ‰€æœ‰æ•°ä¹˜ä»¥2çš„20æ¬¡æ–¹ï¼Œç›¸å½“äºå°æ•°éƒ¨åˆ†å¯ä»¥ä¿ç•™20ä½ï¼Œå¯ä»¥ç²¾ç¡®åˆ°å°æ•°ç‚¹å20ä½ã€‚</p><h2 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h2><p>åŸç†å¾ˆç®€å• ä¸ç»†è¯´ ä¸»è¦è¯´è¯´æ„Ÿæ‚Ÿ</p><p>ä¸ºä»€ä¹ˆè¦é€†åºéå† Arrayï¼š</p><ol><li>æ’åºçš„ç¨³å®šæ€§ï¼š<br>åœ¨åŸºæ•°æ’åºçš„å®ç°ä¸­ï¼Œé€†åºè®¿é—®åŸæ•°ç»„ arr çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ’åºçš„ç¨³å®šæ€§ã€‚ç¨³å®šæ€§æ˜¯æŒ‡æ’åºç®—æ³•åœ¨å¤„ç†ç›¸ç­‰å…ƒç´ æ—¶èƒ½å¤Ÿä¿æŒå®ƒä»¬åœ¨åŸæ•°ç»„ä¸­çš„ç›¸å¯¹é¡ºåºä¸å˜ã€‚<br>åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬é€†åºéå†åŸæ•°ç»„ arrã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå½“å­˜åœ¨ç›¸ç­‰çš„å…ƒç´ æ—¶ï¼Œå…ˆå‡ºç°çš„å…ƒç´ ä¼šå…ˆæ”¾å…¥å¯¹åº”çš„ä½ç½®ï¼Œè€Œåå‡ºç°çš„ç›¸ç­‰å…ƒç´ ä¼šæ”¾åœ¨å®ƒä»¬ä¹‹åçš„ä½ç½®ã€‚è¿™æ ·å¯ä»¥ä¿è¯ç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹é¡ºåºä¸å˜ï¼Œä»è€Œä¿è¯äº†æ’åºçš„ç¨³å®šæ€§ã€‚<br>å¦‚æœæˆ‘ä»¬é‡‡ç”¨é¡ºåºè®¿é—® arr çš„æ–¹å¼ï¼Œé‚£ä¹ˆåœ¨å¤„ç†ç›¸ç­‰å…ƒç´ æ—¶ï¼Œåå‡ºç°çš„ç›¸ç­‰å…ƒç´ å¯èƒ½ä¼šå…ˆæ”¾å…¥å¯¹åº”çš„ä½ç½®ï¼Œä»è€Œæ‰“ç ´äº†å®ƒä»¬åœ¨åŸæ•°ç»„ä¸­çš„ç›¸å¯¹é¡ºåºï¼Œå¯¼è‡´æ’åºä¸ç¨³å®šã€‚<br>å› æ­¤ï¼Œä¸ºäº†ç¡®ä¿æ’åºçš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é€†åºéå†åŸæ•°ç»„ arr çš„æƒ…å†µä¸‹è¿›è¡Œå…ƒç´ çš„æ”¾ç½®æ“ä½œã€‚</li><li>è‡ªå·±çš„ç†è§£ï¼š<br>2.1 åŸºæ•°æ’åºï¼Œæ˜¯åŸºäºæ•°å­—çš„æ¯ä¸€ä½ï¼ˆä»ä½ä½åˆ°é«˜ä½ï¼‰è¿›è¡Œæ’åºï¼Œæ¯ä¸€ä½çš„æ’åº åŸºäº ä¸Šä¸€ä½ï¼ˆè¾ƒä½ä½ï¼‰æ’å¥½çš„åŸºç¡€ä¸Š<br>2.2 å…ˆå°†æ‰€æœ‰å…ƒç´ æŒ‰ç…§ä½ä½æ’åºï¼Œå†ä¿æŒä½ä½ä½åºä¸å˜çš„æƒ…å†µä¸‹å»æ’é«˜ä½çš„ä½åºï¼ˆèƒ½è®©å·²ç»æ’å¥½çš„ä½ä½çš„ä½åºå˜åŒ–çš„åŸå› åªèƒ½å—é«˜ä½æ•°å€¼çš„å½±å“ï¼‰<br>2.3 å¦‚æœæ˜¯é¡ºåºæ’åºï¼Œé‚£ä¹ˆä½ä½é¡ºåºçš„æ”¹å˜ä¸ä»…ä»…å—åˆ°é«˜ä½æ•°å€¼çš„å½±å“ï¼Œä¹Ÿå—åˆ°é”™ä½çš„å½±å“<br>2.4 é”™ä½çš„å½±å“ï¼šæœ‰æ•°ç»„ï¼šarrã€ 11 , 12 , 13 , 14 , 15ã€‘<br>ä½ä½åºå·²ç»æ’å¥½ï¼Œå¦‚æœæŒ‰ç…§é«˜ä½é¡ºåºéå†ï¼Œä¼šå¯¼è‡´æ•°ç»„å˜æˆ ã€15 , 14 , 13 , 12 , 11ã€‘<br>ä½¿å¾—åŸå…ˆåœ¨ 15 ä¹‹å‰çš„ 11 æ’åœ¨äº† 15 ä¹‹å<br>è¿™ç§é”™ä½çš„å½±å“æ˜¯ é¡ºåºéå† å’Œ ä½¿ç”¨è¯é¢‘ç»Ÿè®¡æ–¹æ³•å¾€Helpä¸­æ”¾å…ƒç´ (é€†åº) ç›¸äº’ä½œç”¨å†³å®šçš„</li></ol><h2 id="æ’åºç®—æ³•æ€»ç»“"><a href="#æ’åºç®—æ³•æ€»ç»“" class="headerlink" title="æ’åºç®—æ³•æ€»ç»“"></a>æ’åºç®—æ³•æ€»ç»“</h2><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/blog1.png" alt="ç¤ºä¾‹å›¾ç‰‡"/></div><span class="image-caption">ç¤ºä¾‹å›¾ç‰‡</span></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&quot;&gt;&lt;a href=&quot;#ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&quot;&gt;&lt;/a&gt;ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å½’å¹¶åˆ†æ²»&quot;&gt;&lt;a href=&quot;#å½’å¹¶åˆ†æ²»&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>feignçš„ä¸‰ç§å¼‚å¸¸å¤„ç†å…³ç³»</title>
    <link href="https://nmcb666.vip/posts/20b8d2ff.html"/>
    <id>https://nmcb666.vip/posts/20b8d2ff.html</id>
    <published>2025-12-31T10:00:37.000Z</published>
    <updated>2026-01-26T13:39:36.090Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜"><a href="#Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜" class="headerlink" title="Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜"></a>Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜</h1><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒFeignä½œä¸ºå£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼Œæ˜¯æœåŠ¡é—´è°ƒç”¨çš„æ ¸å¿ƒç»„ä»¶ã€‚è€Œå¼‚å¸¸å¤„ç†æ˜¯ä¿éšœå¾®æœåŠ¡ç¨³å®šæ€§çš„å…³é”®ç¯èŠ‚â€”â€”å½“Feignè°ƒç”¨ä¸‹æ¸¸æœåŠ¡æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬å¸¸é€šè¿‡ <code>ErrorDecoder</code>ã€å®¹é”™ç»„ä»¶çš„ <code>Fallback</code>ï¼ˆå¦‚Sentinel/Hystrixï¼‰ã€Springå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆ<code>@RestControllerAdvice</code>ï¼‰ä¸‰ç§æ–¹å¼å¤„ç†å¼‚å¸¸ã€‚ä½†ä¸‰è€…å¹¶å­˜æ—¶ï¼Œæ‰§è¡Œé¡ºåºå¦‚ä½•ï¼Ÿä¼˜å…ˆçº§èƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿç‰¹æ®Šåœºæ™¯ä¸‹åˆä¼šå‡ºç°å“ªäº›å˜åŒ–ï¼Ÿæœ¬æ–‡å°†ç»“åˆå®è·µæ‹†è§£è¿™ä¸€æ ¸å¿ƒé—®é¢˜ã€‚</p><h2 id="ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº"><a href="#ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº" class="headerlink" title="ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº"></a>ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº</h2><p>å½“Feignè°ƒç”¨å‘ç”Ÿå¼‚å¸¸ï¼ˆé2xx HTTPçŠ¶æ€ç ã€è¶…æ—¶ã€ç½‘ç»œå¼‚å¸¸ç­‰ï¼‰æ—¶ï¼Œä¸‰è€…çš„æ‰§è¡Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼š</p><p><strong>ErrorDecoderï¼ˆFeignåŸç”Ÿï¼‰ â†’ Fallbackï¼ˆå®¹é”™ç»„ä»¶ï¼‰ â†’ å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring MVCï¼‰</strong></p><p>å®Œæ•´æ‰§è¡Œé“¾è·¯å¯æ¦‚æ‹¬ä¸ºï¼š</p><blockquote><p>Feignè°ƒç”¨è§¦å‘å¼‚å¸¸ â†’ ResponseInterceptorï¼ˆOpenFeign 12.0+ å¯é€‰é¢„å¤„ç†ï¼‰ â†’ ErrorDecoderï¼ˆå¼‚å¸¸è§£ç /è½¬æ¢ï¼‰ â†’ å®¹é”™ç»„ä»¶æ‹¦æˆªå¼‚å¸¸ â†’ Fallbackï¼ˆå¼‚å¸¸å…œåº•ï¼Œè¿”å›æ­£å¸¸æ•°æ®ï¼‰ â†’ ï¼ˆFallbackå¤±æ•ˆæ—¶ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ â†’ ï¼ˆå‡æœªå¤„ç†æ—¶ï¼‰å‘ä¸ŠæŠ›å‡ºåŸå§‹å¼‚å¸¸</p></blockquote><p>å…¶ä¸­ï¼Œå‰ä¸¤è€…å±äºFeignè°ƒç”¨é“¾è·¯çš„â€œå‰ç½®å¤„ç†â€ï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨å±äºâ€œåç½®å…œåº•â€ï¼Œä¸”Fallbacké»˜è®¤ä¼šé˜»æ–­å¼‚å¸¸å‘ä¸Šä¼ æ’­ï¼Œä½¿å…¨å±€å¼‚å¸¸æ•è·å™¨æ— æ³•è§¦å‘ã€‚</p><h2 id="äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº"><a href="#äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº" class="headerlink" title="äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº"></a>äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº</h2><p>ä¸‰è€…ä¼˜å…ˆçº§çš„æœ¬è´¨çš„æ˜¯æ‰§è¡Œå±‚çº§å’ŒèŒè´£è¾¹ç•Œçš„å·®å¼‚ï¼Œä¸åŒå±‚çº§å¯¹åº”ä¸åŒçš„å¼‚å¸¸å¤„ç†ç›®æ ‡ï¼Œå½¢æˆäº†â€œå±‚å±‚æ‹¦æˆªã€å„å¸å…¶èŒâ€çš„é“¾è·¯ã€‚</p><h3 id="1-ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰"><a href="#1-ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰" class="headerlink" title="1. ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰"></a>1. ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰</h3><p><code>ErrorDecoder</code> æ˜¯FeignåŸç”Ÿæä¾›çš„å¼‚å¸¸è§£ç æ‰©å±•ç‚¹ï¼Œå±äºã€ŒFeignè°ƒç”¨å“åº”å¤„ç†å±‚çº§ã€ï¼Œæ˜¯å¼‚å¸¸è¿›å…¥ä¸šåŠ¡é“¾è·¯å‰çš„â€œç¬¬ä¸€é“å…³å£â€ã€‚</p><p>å…¶æ ¸å¿ƒèŒè´£æ˜¯ï¼šæ‹¦æˆªFeignè°ƒç”¨è¿”å›çš„é2xxå¼‚å¸¸å“åº”ï¼Œå°†Feigné»˜è®¤æŠ›å‡ºçš„ <code>FeignException</code>ï¼ˆåŒ…å«æ‚ä¹±çš„HTTPå“åº”ä¿¡æ¯ï¼‰è½¬æ¢ä¸ºæ ‡å‡†åŒ–çš„è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼ŒåŒæ—¶å¯è§£æå¼‚å¸¸å“åº”ä½“ã€æå–ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è¯¦æƒ…ï¼Œä¸ºåç»­å¤„ç†æä¾›ç»Ÿä¸€çš„å¼‚å¸¸æ ¼å¼ã€‚</p><p>ä¼˜å…ˆçº§æœ€é«˜çš„åŸå› çš„æ˜¯ï¼šå®ƒç›´æ¥åµŒå…¥Feignçš„å“åº”å¤„ç†æµç¨‹ï¼Œåœ¨å¼‚å¸¸è¢«ä¼ é€’ç»™ä¸šåŠ¡å±‚æˆ–å®¹é”™ç»„ä»¶å‰ï¼Œå°±å®Œæˆäº†è§£ç å’Œè½¬æ¢ã€‚åç»­çš„Fallbackå’Œå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼Œå¤„ç†çš„éƒ½æ˜¯ç»è¿‡å®ƒè½¬æ¢åçš„å¼‚å¸¸ï¼ˆæˆ–æœªè‡ªå®šä¹‰æ—¶çš„é»˜è®¤å¼‚å¸¸ï¼‰ã€‚</p><h3 id="2-ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰"><a href="#2-ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰" class="headerlink" title="2. ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰"></a>2. ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰</h3><p><code>Fallback</code> æ˜¯Sentinelã€Hystrixã€Resilience4jç­‰å®¹é”™ç»„ä»¶æä¾›çš„å…œåº•èƒ½åŠ›ï¼Œå±äºã€Œå¾®æœåŠ¡å®¹é”™é˜²æŠ¤å±‚çº§ã€ï¼Œæ˜¯å¼‚å¸¸ä¼ æ’­çš„â€œç¬¬äºŒé“å…³å£â€ã€‚</p><p>å…¶æ ¸å¿ƒèŒè´£æ˜¯ï¼šé€šè¿‡AOPæˆ–ä»£ç†æ¨¡å¼ï¼Œæ‹¦æˆªFeignè°ƒç”¨/ä¸šåŠ¡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆå·²è¢«ErrorDecoderå¤„ç†ï¼‰ï¼Œå°†â€œå¼‚å¸¸ç»“æœâ€è½¬æ¢ä¸ºâ€œåˆæ³•çš„ä¸šåŠ¡è¿”å›æ•°æ®â€ï¼Œæ¶ˆåŒ–å¼‚å¸¸ä»¥é˜²æ­¢æœåŠ¡é›ªå´©ï¼ŒåŒæ—¶é¿å…ä¸šåŠ¡å±‚æ‰‹åŠ¨try-catchã€‚</p><p>ä¼˜å…ˆçº§é«˜äºå…¨å±€å¼‚å¸¸æ•è·å™¨çš„åŸå› çš„æ˜¯ï¼šå®ƒåœ¨å¼‚å¸¸äº§ç”Ÿç‚¹é™„è¿‘ç›´æ¥æ‹¦æˆªï¼Œä¸”å¤„ç†åè¿”å›æ­£å¸¸æ•°æ®â€”â€”å¼‚å¸¸è¢«å®Œå…¨â€œæ¶ˆåŒ–â€ï¼Œä¸å†å‘ä¸Šä¼ æ’­ï¼Œå¯¼è‡´å…¨å±€å¼‚å¸¸æ•è·å™¨å¤±å»è§¦å‘å‰æï¼ˆå…¨å±€å¼‚å¸¸æ•è·å™¨ä»…å¤„ç†æœªè¢«æ‹¦æˆªçš„ä¼ æ’­å¼‚å¸¸ï¼‰ã€‚</p><h3 id="3-ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring-MVCå±‚çº§ï¼‰"><a href="#3-ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring-MVCå±‚çº§ï¼‰" class="headerlink" title="3. ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring MVCå±‚çº§ï¼‰"></a>3. ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring MVCå±‚çº§ï¼‰</h3><p>å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆåŸºäº <code>@RestControllerAdvice</code> + <code>@ExceptionHandler</code>ï¼‰æ˜¯Spring MVCæä¾›çš„å…¨å±€èƒ½åŠ›ï¼Œå±äºã€Œåº”ç”¨å±‚å¼‚å¸¸å…œåº•å±‚çº§ã€ï¼Œæ˜¯å¼‚å¸¸å¤„ç†çš„â€œæœ€åä¸€é“å…³å£â€ã€‚</p><p>å…¶æ ¸å¿ƒèŒè´£æ˜¯ï¼šæ•è·æ‰€æœ‰å‘ä¸Šä¼ æ’­åˆ°Controllerå±‚åŠä»¥ä¸Šçš„æœªå¤„ç†å¼‚å¸¸ï¼Œç»Ÿä¸€è¿”å›æ ‡å‡†åŒ–é”™è¯¯å“åº”ï¼Œé¿å…è£¸å¼‚å¸¸æš´éœ²ç»™å‰ç«¯ã€‚</p><p>ä¼˜å…ˆçº§æœ€ä½çš„åŸå› çš„æ˜¯ï¼šå®ƒçš„æ‰§è¡Œä¾èµ–â€œå¼‚å¸¸æœªè¢«å‰ç½®é€»è¾‘å¤„ç†ä¸”æˆåŠŸä¼ æ’­â€ï¼Œè€ŒFallbacké€šå¸¸ä¼šæå‰æ¶ˆåŒ–å¼‚å¸¸ï¼Œåªæœ‰åœ¨Fallbackå¤±æ•ˆæ—¶ï¼Œå®ƒæ‰ä¼šè¡¥ä½ç”Ÿæ•ˆã€‚</p><h2 id="ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº"><a href="#ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº" class="headerlink" title="ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº"></a>ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº</h2><p>æˆ‘ä»¬ä»¥ã€ŒOpenFeign 12.0+ + Sentinel + Spring Bootã€ä¸ºä¾‹ï¼Œé€šè¿‡ä»£ç éªŒè¯ä¸‰è€…çš„æ‰§è¡Œé¡ºåºï¼ŒåŒæ—¶è¦†ç›–æ­£å¸¸åœºæ™¯ä¸ç‰¹æ®Šåœºæ™¯ã€‚</p><h3 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. ç¯å¢ƒå‡†å¤‡"></a>1. ç¯å¢ƒå‡†å¤‡</h3><p>ä¾èµ–æ ¸å¿ƒç»„ä»¶ï¼šOpenFeignï¼ˆ12.0+ï¼‰ã€Spring Cloud Alibaba Sentinelã€Spring Webã€‚</p><h3 id="2-ä»£ç å®ç°"><a href="#2-ä»£ç å®ç°" class="headerlink" title="2. ä»£ç å®ç°"></a>2. ä»£ç å®ç°</h3><h4 id="ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰"><a href="#ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰"></a>ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Response;</span><br><span class="line"><span class="keyword">import</span> feign.Util;</span><br><span class="line"><span class="keyword">import</span> feign.codec.ErrorDecoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomErrorDecoder</span> <span class="keyword">implements</span> <span class="title class_">ErrorDecoder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ErrorDecoder</span> <span class="variable">defaultDecoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Default</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Exception <span class="title function_">decode</span><span class="params">(String methodKey, Response response)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =&quot;</span> + response.status());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">errorBody</span> <span class="operator">=</span> Util.toString(response.body().asReader(Util.UTF_8));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;æœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼ˆErrorDecoderè½¬æ¢ï¼‰ï¼š&quot;</span> + errorBody);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> defaultDecoder.decode(methodKey, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰"><a href="#ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰"></a>ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Feignæ¥å£</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;provider-service&quot;, fallback = ProviderFallback.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProviderClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/provider/getData&quot;)</span></span><br><span class="line">    String <span class="title function_">getData</span><span class="params">(<span class="meta">@RequestParam</span> String id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fallbackå…œåº•ç±»</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderFallback</span> <span class="keyword">implements</span> <span class="title class_">ProviderClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…œåº•æ•°æ®ï¼šid=&quot;</span> + id + <span class="string">&quot;ï¼ˆæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼‰&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰"><a href="#ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰"></a>ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleAllException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€3. æ‰§è¡Œå…¨å±€å¼‚å¸¸æ•è·å™¨ã€‘ï¼šæ•è·å¼‚å¸¸ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…¨å±€å…œåº•ï¼š&quot;</span> + e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚"><a href="#ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚" class="headerlink" title="ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚"></a>ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProviderClient providerClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getData&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(<span class="meta">@RequestParam</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> providerClient.getData(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åœºæ™¯æµ‹è¯•ç»“æœ"><a href="#3-åœºæ™¯æµ‹è¯•ç»“æœ" class="headerlink" title="3. åœºæ™¯æµ‹è¯•ç»“æœ"></a>3. åœºæ™¯æµ‹è¯•ç»“æœ</h3><h4 id="ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘"><a href="#ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘" class="headerlink" title="ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘"></a>ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘</h4><p>å½“ä¸‹æ¸¸æœåŠ¡æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæ§åˆ¶å°è¾“å‡ºé¡ºåºï¼š</p><figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =500</span><br><span class="line">ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®</span><br></pre></td></tr></table></figure><p>æ¥å£è¿”å›ï¼š<code>å…œåº•æ•°æ®ï¼šid=123ï¼ˆæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼‰</code>ï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨æœªè§¦å‘ï¼ˆè¢«Fallbacké˜»æ–­ï¼‰ã€‚</p><h4 id="ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸"><a href="#ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸"></a>ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸</h4><p>ä¿®æ”¹Fallbacké€»è¾‘ï¼Œæ•…æ„æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderFallback</span> <span class="keyword">implements</span> <span class="title class_">ProviderClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">nullStr</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        nullStr.length(); <span class="comment">// ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…œåº•æ•°æ®ï¼šid=&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°è¾“å‡ºé¡ºåºï¼š</p><figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =500</span><br><span class="line">ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®</span><br><span class="line">ã€3. æ‰§è¡Œå…¨å±€å¼‚å¸¸æ•è·å™¨ã€‘ï¼šæ•è·å¼‚å¸¸ï¼šnull</span><br></pre></td></tr></table></figure><p>æ¥å£è¿”å›ï¼š<code>å…¨å±€å…œåº•ï¼šnull</code>ï¼ŒFallbackå¼‚å¸¸å‘ä¸Šä¼ æ’­ï¼Œè§¦å‘å…¨å±€å¼‚å¸¸æ•è·å™¨ã€‚</p><h4 id="ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰"><a href="#ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰"></a>ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰</h4><p>è‹¥æœªå¼€å¯Sentinelä¸Feignçš„æ•´åˆï¼ˆæœªé…ç½® <code>feign.sentinel.enabled=true</code>ï¼‰ï¼ŒFallbacké…ç½®å¤±æ•ˆï¼Œæ§åˆ¶å°è¾“å‡ºé¡ºåºï¼š</p><figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =500</span><br><span class="line">ã€3. æ‰§è¡Œå…¨å±€å¼‚å¸¸æ•è·å™¨ã€‘ï¼šæ•è·å¼‚å¸¸ï¼šæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼ˆErrorDecoderè½¬æ¢ï¼‰ï¼šxxx</span><br></pre></td></tr></table></figure><p>æ¥å£è¿”å›ï¼š<code>å…¨å±€å…œåº•ï¼šæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼ˆErrorDecoderè½¬æ¢ï¼‰ï¼šxxx</code>ï¼ŒFallbackæœªè§¦å‘ï¼Œå¼‚å¸¸ä¼ æ’­è‡³å…¨å±€æ•è·å™¨ã€‚</p><h2 id="å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿"><a href="#å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿" class="headerlink" title="å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿"></a>å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿</h2><p>ä¸‰è€…å¹¶éäº’æ–¥å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»ï¼Œåˆç†æ­é…å¯å®ç°â€œå¼‚å¸¸æ ‡å‡†åŒ–+å®¹é”™å…œåº•+æœ€ç»ˆè¡¥ä½â€çš„ä¸‰å±‚é˜²æŠ¤ä½“ç³»ï¼Œæå‡å¾®æœåŠ¡ç¨³å®šæ€§ã€‚</p><h3 id="1-åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ"><a href="#1-åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ" class="headerlink" title="1. åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ"></a>1. åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ</h3><ul><li><p><strong>ErrorDecoder</strong>ï¼šä¸“æ³¨â€œå¼‚å¸¸æ ‡å‡†åŒ–â€ï¼Œç»Ÿä¸€è½¬æ¢FeignåŸç”Ÿå¼‚å¸¸ä¸ºä¸šåŠ¡å¼‚å¸¸ï¼Œè§£æå¼‚å¸¸è¯¦æƒ…ï¼Œä¸åšå…œåº•é€»è¾‘ï¼›</p></li><li><p><strong>Fallback</strong>ï¼šä¸“æ³¨â€œå®¹é”™å…œåº•â€ï¼Œé’ˆå¯¹æ ¸å¿ƒæœåŠ¡è°ƒç”¨ï¼Œè¿”å›é¢„è®¾å…œåº•æ•°æ®ï¼ˆå¦‚ç¼“å­˜æ•°æ®ã€é»˜è®¤å€¼ï¼‰ï¼Œé˜²æ­¢æœåŠ¡é›ªå´©ï¼›</p></li><li><p><strong>å…¨å±€å¼‚å¸¸æ•è·å™¨</strong>ï¼šä¸“æ³¨â€œæœ€ç»ˆè¡¥ä½â€ï¼Œæ•è·æ‰€æœ‰æ¼ç½‘å¼‚å¸¸ï¼ˆFallbackå¼‚å¸¸ã€é…ç½®é”™è¯¯å¯¼è‡´çš„å¼‚å¸¸ï¼‰ï¼Œç»Ÿä¸€è¿”å›å‰ç«¯å‹å¥½å“åº”ã€‚</p></li></ul><h3 id="2-è§„é¿å¸¸è§å‘ç‚¹"><a href="#2-è§„é¿å¸¸è§å‘ç‚¹" class="headerlink" title="2. è§„é¿å¸¸è§å‘ç‚¹"></a>2. è§„é¿å¸¸è§å‘ç‚¹</h3><ul><li><p>Fallbackæ–¹æ³•ç­¾åå¿…é¡»ä¸åŸæ–¹æ³•ä¸€è‡´ï¼ˆå‚æ•°ã€è¿”å›å€¼ç±»å‹åŒ¹é…ï¼‰ï¼Œå¦åˆ™é…ç½®å¤±æ•ˆï¼Œå¼‚å¸¸ç›´æ¥ä¼ æ’­ï¼›</p></li><li><p>Hystrixä¼šå¿½ç•¥ <code>HystrixBadRequestException</code> åŠ <code>ignoreExceptions</code> é…ç½®çš„å¼‚å¸¸ï¼Œè¿™ç±»å¼‚å¸¸ä¸è§¦å‘Fallbackï¼Œéœ€é€šè¿‡å…¨å±€æ•è·å™¨å¤„ç†ï¼›</p></li><li><p>ErrorDecoderä¸­é¿å…æŠ›å‡ºéä¸šåŠ¡å¼‚å¸¸ï¼Œå»ºè®®ç»Ÿä¸€è½¬æ¢ä¸ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œä¾¿äºFallbackå’Œå…¨å±€æ•è·å™¨è¯†åˆ«ã€‚</p></li></ul><h3 id="3-æ³¨æ„äº‹é¡¹"><a href="#3-æ³¨æ„äº‹é¡¹" class="headerlink" title="3.æ³¨æ„äº‹é¡¹"></a>3.æ³¨æ„äº‹é¡¹</h3><ul><li>å¼‚å¸¸å¤šå±‚åŒ…è£…ï¼ˆå« Error ç±»å‹ï¼‰ä¼šé˜»æ–­ Spring è‡ªåŠ¨ç©¿é€ã€‚å½“å¼‚å¸¸é“¾ä¸­å­˜åœ¨ AssertionError ç­‰ Error ç±»å‹å¼‚å¸¸æ—¶ï¼ˆå¦‚ Sentinel æ•´åˆ Feign åœºæ™¯ï¼Œåœ¨fallbackå‡½æ•°ä¸­æŠ›å‡ºRuntimeExceptionå¼‚å¸¸ä¼šè¢«Sentinelè‡ªåŠ¨åŒ…è£…ä¸ºAssertionError ç»§æ‰¿ Erroråˆ†æ”¯ï¼Œç„¶ååˆè¢«Spring MVC DispatcherServletè‡ªåŠ¨æŠ›å‡ºä¸ºNestedServletExceptionå¼‚å¸¸ï¼‰ï¼ŒSpring çš„ @ExceptionHandler è‡ªåŠ¨ç©¿é€åŠŸèƒ½ä»…æ”¯æŒ Exception åˆ†æ”¯ï¼Œæ— æ³•ç©¿é€ Error ç±»å‹å¼‚å¸¸ï¼Œå¯¼è‡´è‡ªå®šä¹‰å¼‚å¸¸ï¼ˆCommonExceptionï¼‰æ— æ³•è¢«ç²¾å‡†æ•è·ï¼Œæœ€ç»ˆè¢« Exception å…œåº•å¤„ç†å™¨æ•è·ï¼ˆæˆ–è€…è¢«NestedServletExceptionå¼‚å¸¸æ•è·å™¨æ•è·ï¼‰ï¼›</li><li><p>è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨è§£æå®Œæ•´çš„ Throwable é“¾ï¼ˆåŒ…å« Error å’Œ Exceptionï¼‰ï¼Œé€šè¿‡å¾ªç¯éå† cause é“¾ä¸»åŠ¨æå–ç›®æ ‡è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå†æ‰‹åŠ¨åˆ†å‘åˆ°å¯¹åº”å¼‚å¸¸å¤„ç†å™¨ï¼›</p></li><li><p>ä¸‹é¢æ˜¯springå¯¹äºå¼‚å¸¸å¤„ç†çš„æºç ã€‚å¯ä»¥çœ‹è§å¦‚æœé‡åˆ°éExceptionçš„Throwableã€‚å®ƒä¼šè‡ªåŠ¨æŠ›å‡ºNestedServletException</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨å¤„ç†å™¨æ–¹æ³•ï¼ˆControlleræ–¹æ³•ã€Feignè°ƒç”¨ã€Serviceæ–¹æ³•ç­‰éƒ½åœ¨è¿™ä¸€æ­¥æ‰§è¡Œï¼‰</span></span><br><span class="line">    mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">    <span class="comment">// æ•è·Exceptionç±»å‹å¼‚å¸¸ï¼Œç›´æ¥èµ‹å€¼ç»™dispatchExceptionï¼Œä¸åŒ…è£…</span></span><br><span class="line">    dispatchException = ex;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">    <span class="comment">// æ•è·Throwableç±»å‹ï¼ˆéExceptionï¼Œå¦‚Errorã€AssertionErrorç­‰ï¼‰ï¼ŒåŒ…è£…ä¸ºNestedServletException</span></span><br><span class="line">    dispatchException = <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler dispatch failed&quot;</span>, err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-ç»„ä»¶é€‰æ‹©å»ºè®®"><a href="#4-ç»„ä»¶é€‰æ‹©å»ºè®®" class="headerlink" title="4. ç»„ä»¶é€‰æ‹©å»ºè®®"></a>4. ç»„ä»¶é€‰æ‹©å»ºè®®</h3><p>Hystrixå·²è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œæ¨èä½¿ç”¨ <strong>Resilience4j</strong>ï¼ˆè½»é‡ã€Springå®˜æ–¹æ¨èï¼‰æˆ– <strong>Sentinel</strong>ï¼ˆé˜¿é‡Œç”Ÿæ€ï¼Œæ”¯æŒæµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ç­‰ä¸°å¯Œç‰¹æ€§ï¼‰ä½œä¸ºFallbackè½½ä½“ï¼›OpenFeign 12.0+ å»ºè®®æ­é… <code>ResponseInterceptor</code> åšå“åº”æ—¥å¿—é¢„å¤„ç†ï¼Œä¸ErrorDecoderååŒæå‡å¼‚å¸¸æ’æŸ¥æ•ˆç‡ã€‚</p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>Feignå¼‚å¸¸å¤„ç†çš„ä¸‰é‡æœºåˆ¶ï¼Œæœ¬è´¨æ˜¯ä¸åŒå±‚çº§çš„â€œå¼‚å¸¸æ‹¦æˆª-å¤„ç†â€é“¾è·¯ï¼šErrorDecoderè´Ÿè´£â€œå…¥å£æ ‡å‡†åŒ–â€ï¼ŒFallbackè´Ÿè´£â€œä¸­é—´å®¹é”™â€ï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨è´Ÿè´£â€œæœ€ç»ˆè¡¥ä½â€ã€‚ä¼˜å…ˆçº§çš„æ ¸å¿ƒé€»è¾‘æ˜¯â€œå…ˆå¤„ç†å¼‚å¸¸ã€å†æ¶ˆåŒ–å¼‚å¸¸ã€æœ€åè¡¥ä½å¼‚å¸¸â€ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸‰è€…ååŒä½¿ç”¨ï¼Œæ—¢èƒ½ä¿è¯å¼‚å¸¸å¤„ç†çš„è§„èŒƒæ€§å’Œçµæ´»æ€§ï¼Œåˆèƒ½æå‡å¾®æœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼Œé¿å…å› å•ä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶å¤±æ•ˆå¯¼è‡´çš„æœåŠ¡ä¸ç¨³å®šé—®é¢˜ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜&quot;&gt;&lt;a href=&quot;#Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜&quot; class=&quot;headerlink&quot; tit</summary>
      
    
    
    
    
    <category term="spring cloud" scheme="https://nmcb666.vip/tags/spring-cloud/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡ä¹‹é—´çš„å…¨å±€å¼‚å¸¸æ•è·</title>
    <link href="https://nmcb666.vip/posts/df97f9d4.html"/>
    <id>https://nmcb666.vip/posts/df97f9d4.html</id>
    <published>2025-12-24T02:09:18.000Z</published>
    <updated>2026-01-26T13:39:36.090Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å•ä½“æ¶æ„ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆå¦‚@ControllerAdvice+@ExceptionHandlerï¼‰å°±èƒ½ä¼˜é›…åœ°å¤„ç†å„ç±»å¼‚å¸¸ï¼Œè‡ªå®šä¹‰å“åº”çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ã€‚ä½†è¿ç§»åˆ°Spring Cloudå¾®æœåŠ¡æ¶æ„åï¼Œå´é‡åˆ°äº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šæ— è®ºå‘ç”Ÿä½•ç§å¼‚å¸¸ï¼Œæ¥å£è¿”å›çš„çŠ¶æ€ç å§‹ç»ˆæ˜¯500ï¼Œé”™è¯¯ä¿¡æ¯å›ºå®šä¸ºINTERNAL_SERVER_ERRORï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨å½¢åŒè™šè®¾ï¼Œå°¤å…¶åœ¨å¾®æœåŠ¡é—´é€šè¿‡OpenFeignè°ƒç”¨APIæ—¶ï¼Œè¯¥é—®é¢˜æ›´ä¸ºçªå‡ºã€‚æœ¬æ–‡å°†å›´ç»•è¿™ä¸€é—®é¢˜ï¼Œä»åŸå› åˆ†æã€è§£å†³æ–¹æ¡ˆåˆ°ç‰¹æ®Šåœºæ™¯é€‚é…ï¼Œé€æ­¥æ‹†è§£å®æˆ˜è¿‡ç¨‹ä¸­çš„æ€è€ƒä¸è¸©å‘ã€‚</p><h2 id="ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ"><a href="#ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ" class="headerlink" title="ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ"></a>ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ</h2><p>åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç¼–å†™å¦‚ä¸‹å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼Œé’ˆå¯¹ä¸åŒä¸šåŠ¡å¼‚å¸¸è¿”å›è‡ªå®šä¹‰çŠ¶æ€ç å’Œä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleBusinessException</span><span class="params">(BusinessException e)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(e.getCode(), e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleGlobalException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="number">500</span>, <span class="string">&quot;ç³»ç»Ÿå¼‚å¸¸&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå½“æœåŠ¡Aé€šè¿‡OpenFeignè°ƒç”¨æœåŠ¡Bï¼ŒæœåŠ¡BæŠ›å‡ºBusinessExceptionå¹¶è¢«è‡ªèº«å…¨å±€å¼‚å¸¸æ•è·å™¨å¤„ç†ï¼Œè¿”å›400çŠ¶æ€ç å’Œè‡ªå®šä¹‰ä¿¡æ¯æ—¶ï¼ŒæœåŠ¡Aæ¥æ”¶åˆ°çš„å“åº”å´ä¾ç„¶æ˜¯500 INTERNAL_SERVER_ERRORï¼Œæ— æ³•è·å–æœåŠ¡Bè¿”å›çš„çœŸå®å¼‚å¸¸ä¿¡æ¯ï¼Œå¯¼è‡´å¼‚å¸¸æ’æŸ¥å›°éš¾ï¼Œä¹Ÿæ— æ³•æ ¹æ®çœŸå®å¼‚å¸¸ç±»å‹åšåç»­ä¸šåŠ¡å¤„ç†ã€‚</p><h2 id="äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶"><a href="#äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶" class="headerlink" title="äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶"></a>äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶</h2><p>é—®é¢˜çš„æ ¸å¿ƒåœ¨äºå¾®æœåŠ¡é—´çš„è°ƒç”¨æ–¹å¼â€”â€”OpenFeignçš„å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚å½“è¢«è°ƒç”¨æ–¹ï¼ˆæœåŠ¡Bï¼‰æŠ›å‡ºå¼‚å¸¸åï¼Œå…¶è‡ªèº«çš„å…¨å±€å¼‚å¸¸æ•è·å™¨ä¼šæ­£å¸¸å·¥ä½œï¼Œè¿”å›è‡ªå®šä¹‰çš„é2XXçŠ¶æ€ç ï¼ˆå¦‚400ã€502ï¼‰å’Œé”™è¯¯ä¿¡æ¯ã€‚ä½†è°ƒç”¨æ–¹ï¼ˆæœåŠ¡Aï¼‰é€šè¿‡OpenFeignè°ƒç”¨æ—¶ï¼ŒOpenFeignæœ‰ä¸€ä¸ªé»˜è®¤è§„åˆ™ï¼š<strong>å¯¹æ‰€æœ‰é2XXçš„HTTPå“åº”ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠ›å‡ºFeignExceptionå¼‚å¸¸</strong>ã€‚</p><p>è¿™å°±å¯¼è‡´æœåŠ¡Aæ— æ³•ç›´æ¥è·å–æœåŠ¡Bè¿”å›çš„è‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯ï¼Œåªèƒ½æ•è·åˆ°OpenFeignå°è£…çš„FeignExceptionï¼Œè€Œè¯¥å¼‚å¸¸é»˜è®¤å¯¹åº”500 INTERNAL_SERVER_ERRORçŠ¶æ€ç ï¼Œæœ€ç»ˆå‘ˆç°å‡ºâ€œæ‰€æœ‰å¼‚å¸¸éƒ½è¿”å›500â€çš„ç°è±¡ã€‚æœ¬è´¨ä¸Šæ˜¯OpenFeignçš„é»˜è®¤å¼‚å¸¸è½¬æ¢ï¼Œè¦†ç›–äº†è¢«è°ƒç”¨æ–¹çš„è‡ªå®šä¹‰å¼‚å¸¸å“åº”ã€‚</p><h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸</h2><p>è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ErrorDecoderæ¥å£å®ç°ï¼Œè¦†å†™decodeæ–¹æ³•ï¼Œå¯¹ä¸åŒçŠ¶æ€ç çš„å“åº”è¿›è¡Œå·®å¼‚åŒ–å¤„ç†ï¼Œè¿˜åŸè¢«è°ƒç”¨æ–¹çš„çœŸå®å¼‚å¸¸ä¿¡æ¯ï¼Œç”šè‡³è¿”å›è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹ã€‚</p><h3 id="3-1-è‡ªå®šä¹‰ErrorDecoderå®ç°"><a href="#3-1-è‡ªå®šä¹‰ErrorDecoderå®ç°" class="headerlink" title="3.1 è‡ªå®šä¹‰ErrorDecoderå®ç°"></a>3.1 è‡ªå®šä¹‰ErrorDecoderå®ç°</h3><p>æ³¨æ„ï¼šdecodeæ–¹æ³•çš„æ ¸å¿ƒæ˜¯<strong>è¿”å›FeignExceptionï¼Œè€Œéç›´æ¥æŠ›å‡ºå¼‚å¸¸</strong>ï¼ŒOpenFeignä¼šå¯¹è¯¥è¿”å›å€¼åšè¿›ä¸€æ­¥å¤„ç†å¹¶ä¼ é€’ç»™è°ƒç”¨æ–¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomErrorDecoder</span> <span class="keyword">implements</span> <span class="title class_">ErrorDecoder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ErrorDecoder</span> <span class="variable">defaultErrorDecoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Default</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Exception <span class="title function_">decode</span><span class="params">(String methodKey, Response response)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> response.body().asInputStream()) &#123;</span><br><span class="line">            responseBody = IOUtils.toString(inputStream, StandardCharsets.UTF_8);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FeignException</span>.InternalServerError(methodKey, response, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®å“åº”çŠ¶æ€ç è‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">switch</span> (response.status()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">400</span>:</span><br><span class="line">                <span class="comment">// è§£æå“åº”ä½“ï¼Œå°è£…è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">                <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> JSON.parseObject(responseBody, ErrorResponse.class);</span><br><span class="line">                <span class="keyword">return</span> FeignException.badRequest(methodKey, response, responseBody.getBytes(), <span class="literal">null</span>)</span><br><span class="line">                        .reason(errorResponse.getMsg());</span><br><span class="line">            <span class="keyword">case</span> <span class="number">502</span>:</span><br><span class="line">                <span class="keyword">return</span> FeignException.serviceUnavailable(methodKey, response, responseBody.getBytes(), <span class="literal">null</span>);</span><br><span class="line">            <span class="comment">// å…¶ä»–çŠ¶æ€ç å¯æŒ‰éœ€æ‰©å±•</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// é»˜è®¤ä½¿ç”¨OpenFeignåŸç”Ÿè§£ç å™¨</span></span><br><span class="line">                <span class="keyword">return</span> defaultErrorDecoder.decode(methodKey, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-é…ç½®FeignConfigæ³¨å†ŒBean"><a href="#3-2-é…ç½®FeignConfigæ³¨å†ŒBean" class="headerlink" title="3.2 é…ç½®FeignConfigæ³¨å†ŒBean"></a>3.2 é…ç½®FeignConfigæ³¨å†ŒBean</h3><p>å°†è‡ªå®šä¹‰çš„CustomErrorDecoderé…ç½®ä¸ºSpring Beanï¼Œçº³å…¥Feignçš„é…ç½®ä½“ç³»ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ErrorDecoder <span class="title function_">errorDecoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomErrorDecoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œå½“æœåŠ¡Aé€šè¿‡OpenFeignè°ƒç”¨æœåŠ¡Bæ—¶ï¼Œè‹¥æœåŠ¡Bè¿”å›é2XXçŠ¶æ€ç ï¼ŒCustomErrorDecoderä¼šè§£æå“åº”ä½“ï¼Œè¿”å›å¯¹åº”çŠ¶æ€ç çš„FeignExceptionï¼Œå¹¶æºå¸¦çœŸå®é”™è¯¯ä¿¡æ¯ï¼ŒæœåŠ¡Aå³å¯é€šè¿‡æ•è·FeignExceptionè·å–è¯¦ç»†å¼‚å¸¸å†…å®¹ï¼Œå†ç»“åˆè‡ªèº«å…¨å±€å¼‚å¸¸æ•è·å™¨åšè¿›ä¸€æ­¥å¤„ç†ã€‚</p><h2 id="å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†"><a href="#å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†" class="headerlink" title="å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†"></a>å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†</h2><p>ä¸Šè¿°æ–¹æ¡ˆé€‚ç”¨äºHTTPçŠ¶æ€ç åŒºåˆ†å¼‚å¸¸çš„åœºæ™¯ï¼Œä½†åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¾ˆå¤šå›¢é˜Ÿä¼šé‡‡ç”¨â€œç»Ÿä¸€HTTPçŠ¶æ€ç â€çš„è®¾è®¡ï¼šæ‰€æœ‰æ¥å£å‡è¿”å›200 OKï¼Œå¼‚å¸¸ä¿¡æ¯é€šè¿‡å“åº”ä½“ä¸­çš„è‡ªå®šä¹‰ä¸šåŠ¡çŠ¶æ€ç ï¼ˆå¦‚codeå­—æ®µï¼‰ã€msgå­—æ®µåŒºåˆ†ï¼Œdataå­—æ®µå­˜å‚¨ä¸šåŠ¡æ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">10001</span><span class="punctuation">,</span> <span class="comment">// 10001ä»£è¡¨ä¸šåŠ¡å¼‚å¸¸ï¼Œ200ä»£è¡¨æˆåŠŸ</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å‚æ•°æ ¡éªŒå¤±è´¥&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ç§åœºæ™¯ä¸‹ï¼ŒErrorDecoderå°†å®Œå…¨å¤±æ•ˆâ€”â€”å› ä¸ºErrorDecoderä»…æ‹¦æˆªHTTPçŠ¶æ€ç ä¸º4XXã€5XXçš„å“åº”ï¼Œè€Œå½“å‰æ‰€æœ‰è¯·æ±‚çš„HTTPçŠ¶æ€ç éƒ½æ˜¯200ï¼Œæ— æ³•è§¦å‘è‡ªå®šä¹‰è§£ç é€»è¾‘ã€‚æ­¤æ—¶éœ€è¦å¯»æ‰¾æ–°çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰"><a href="#äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰" class="headerlink" title="äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰"></a>äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰</h2><p>é’ˆå¯¹HTTP 200å“åº”ä¸­åµŒå…¥ä¸šåŠ¡çŠ¶æ€ç çš„åœºæ™¯ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰ResponseInterceptoræ¥å£å®ç°ï¼Œè¦†å†™interceptæ–¹æ³•ï¼Œåœ¨å“åº”è¿”å›åè§£æä¸šåŠ¡çŠ¶æ€ç ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸å¹¶å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomResponseInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ResponseInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">intercept</span><span class="params">(Response response, Chain chain)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£æå“åº”ä½“</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> response.body().asInputStream()) &#123;</span><br><span class="line">            responseBody = IOUtils.toString(inputStream, StandardCharsets.UTF_8);</span><br><span class="line">            <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> JSON.parseObject(responseBody, ErrorResponse.class);</span><br><span class="line">            <span class="comment">// æ ¹æ®ä¸šåŠ¡çŠ¶æ€ç åˆ¤æ–­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (errorResponse.getCode() != <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorResponse.getCode(), errorResponse.getMsg());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(<span class="string">&quot;å“åº”è§£æå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        chain.proceed(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·éœ€è¦åœ¨FeignConfigä¸­é…ç½®è¯¥æ‹¦æˆªå™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ResponseInterceptor <span class="title function_">responseInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomResponseInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¯¥æ–¹æ¡ˆå­˜åœ¨æ˜æ˜¾å±€é™æ€§ï¼š<strong>ResponseInterceptoræ¥å£ä»…åœ¨OpenFeign 12.0+ç‰ˆæœ¬ä¸­æä¾›</strong>ï¼Œå¯¹äºä¸€äº›åŸºäºä½ç‰ˆæœ¬OpenFeignï¼ˆå¦‚Spring Cloud Netflixæ—©æœŸç‰ˆæœ¬ï¼‰çš„è€é¡¹ç›®ï¼Œæ— æ³•ä½¿ç”¨è¯¥æ–¹æ¡ˆï¼Œå…¼å®¹æ€§è¾ƒå·®ã€‚</p><h2 id="å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰"><a href="#å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰" class="headerlink" title="å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰"></a>å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰</h2><p>é’ˆå¯¹ä½ç‰ˆæœ¬OpenFeignæ— æ³•ä½¿ç”¨ResponseInterceptorçš„é—®é¢˜ï¼Œæˆ‘å°è¯•é€šè¿‡AOPåˆ‡é¢ï¼Œåœ¨Feignå®¢æˆ·ç«¯è°ƒç”¨APIåï¼Œå¯¹å“åº”ç»“æœè¿›è¡Œè§£æï¼Œæ ¹æ®ä¸šåŠ¡çŠ¶æ€ç æŠ›å‡ºå¯¹åº”å¼‚å¸¸ã€‚ä½†å®é™…æµ‹è¯•å‘ç°ï¼ŒAOPåˆ‡é¢å®Œå…¨ä¸ç”Ÿæ•ˆï¼Œæ— æ³•æ‹¦æˆªFeignå®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨ã€‚</p><p>æŸ¥é˜…èµ„æ–™åï¼Œæ˜ç¡®äº†å¤±æ•ˆçš„æ ¸å¿ƒåŸå› ï¼š</p><ol><li><p><strong>Feignå®¢æˆ·ç«¯çš„åˆ›å»ºæœºåˆ¶</strong>ï¼šFeignå®¢æˆ·ç«¯æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ï¼Œè€ŒéSpringå®¹å™¨ç®¡ç†çš„æ™®é€šBeanï¼Œå…¶ä»£ç†é€»è¾‘ç”±Feignè‡ªèº«æ§åˆ¶ã€‚</p></li><li><p><strong>Spring AOPçš„æ‹¦æˆªé™åˆ¶</strong>ï¼šSpring AOPé»˜è®¤é‡‡ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œä»…èƒ½æ‹¦æˆªSpringå®¹å™¨ç®¡ç†çš„Beançš„æ–¹æ³•è°ƒç”¨ï¼Œæ— æ³•ç›´æ¥æ‹¦æˆªFeignç”Ÿæˆçš„åŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</p></li><li><p><strong>ä»£ç†ä¼˜å…ˆçº§é—®é¢˜</strong>ï¼šFeignåŠ¨æ€ä»£ç†çš„ä¼˜å…ˆçº§é«˜äºSpring AOPä»£ç†ï¼Œå¯¼è‡´AOPåˆ‡é¢æ— æ³•åˆ‡å…¥Feignå®¢æˆ·ç«¯çš„æ–¹æ³•æ‰§è¡Œæµç¨‹ã€‚</p></li></ol><p>å³ä¾¿å°è¯•åˆ‡æ¢ä¸ºCGLIBä»£ç†ï¼Œä¹Ÿæ— æ³•æœ‰æ•ˆæ‹¦æˆªFeignå®¢æˆ·ç«¯çš„è°ƒç”¨ï¼Œè¯¥æ–¹æ¡ˆæœ€ç»ˆå®£å‘Šå¤±è´¥ã€‚</p><h2 id="ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹"><a href="#ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹" class="headerlink" title="ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹"></a>ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹</h2><p>ç»¼åˆä»¥ä¸Šå®è·µï¼Œç›®å‰é’ˆå¯¹å¾®æœåŠ¡é—´å¼‚å¸¸æ•è·çš„è§£å†³æ–¹æ¡ˆå­˜åœ¨æ˜æ˜¾çš„åœºæ™¯å±€é™æ€§ï¼š</p><ul><li><p>åŸºäºErrorDecoderçš„æ–¹æ¡ˆï¼šé€‚ç”¨äºHTTPçŠ¶æ€ç åŒºåˆ†å¼‚å¸¸çš„åœºæ™¯ï¼Œå…¼å®¹æ€§å¥½ï¼Œæ— ç‰ˆæœ¬é™åˆ¶ï¼Œæ˜¯ç›®å‰æœ€æˆç†Ÿçš„æ–¹æ¡ˆã€‚</p></li><li><p>åŸºäºResponseInterceptorçš„æ–¹æ¡ˆï¼šé€‚ç”¨äºHTTP 200+ä¸šåŠ¡çŠ¶æ€ç çš„åœºæ™¯ï¼Œä½†ä»…æ”¯æŒOpenFeign 12.0+ç‰ˆæœ¬ï¼Œè€é¡¹ç›®æ— æ³•é€‚é…ã€‚</p></li><li><p>AOPæ–¹æ¡ˆï¼šç†è®ºä¸Šå¯é€‚é…æ‰€æœ‰ç‰ˆæœ¬ï¼Œä½†å› FeignåŠ¨æ€ä»£ç†æœºåˆ¶é™åˆ¶ï¼Œæ— æ³•ç”Ÿæ•ˆï¼Œæš‚æ— å¯è¡Œçš„ä¼˜åŒ–æ–¹å‘ã€‚</p></li></ul><p>å¯¹äºâ€œä½ç‰ˆæœ¬OpenFeign + HTTP 200 + ä¸šåŠ¡çŠ¶æ€ç â€çš„ç»„åˆåœºæ™¯ï¼Œç›®å‰ä»æ²¡æœ‰ä¼˜é›…ä¸”å…¼å®¹çš„è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥è€ƒè™‘åœ¨è°ƒç”¨apiçš„æ–¹æ³•ä¸­ï¼Œå»æ¥å—apiè¿”å›çš„å“åº”ç»“æœï¼Œæ ¹æ®ä¸šåŠ¡çŠ¶æ€ç åˆ¤æ–­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œä½†è¿™ç§æ–¹æ¡ˆä¾µå…¥æ€§å¼ºï¼Œè¿èƒŒäº†é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ€æƒ³ã€‚</p><p>åœ¨æ­¤ä¹Ÿæ¬¢è¿å„ä½åŒè¡Œåˆ†äº«å®è·µç»éªŒï¼Œæ¢è®¨æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆï¼Œå…±åŒå®Œå–„å¾®æœåŠ¡å¼‚å¸¸å¤„ç†ä½“ç³»ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¾®æœåŠ¡é—´çš„å¼‚å¸¸æ•è·ç›¸æ¯”å•ä½“æ¶æ„æ›´å¤æ‚ï¼Œæ ¸å¿ƒéš¾ç‚¹åœ¨äºOpenFeignçš„ä»£ç†æœºåˆ¶å’Œå“åº”å¤„ç†é€»è¾‘ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®ä¼˜å…ˆé‡‡ç”¨â€œHTTPçŠ¶æ€ç +è‡ªå®šä¹‰å“åº”ä½“â€çš„æ–¹å¼è®¾è®¡æ¥å£ï¼Œé€šè¿‡CustomErrorDecoderå®ç°å¼‚å¸¸é€ä¼ ï¼Œå…¼é¡¾å…¼å®¹æ€§å’Œä¼˜é›…æ€§ï¼›è‹¥å› ä¸šåŠ¡éœ€æ±‚å¿…é¡»ä½¿ç”¨ç»Ÿä¸€HTTP 200çŠ¶æ€ç ï¼Œåˆ™éœ€è¯„ä¼°å‡çº§OpenFeignç‰ˆæœ¬çš„å¯è¡Œæ€§ï¼Œæˆ–æƒè¡¡ä¾µå…¥æ€§æ–¹æ¡ˆçš„å–èˆã€‚åç»­å°†æŒç»­å…³æ³¨OpenFeignçš„ç‰ˆæœ¬æ›´æ–°å’Œç¤¾åŒºå®è·µï¼Œå¯»æ‰¾æ›´å®Œå–„çš„è§£å†³æ–¹æ¡ˆã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨å•ä½“æ¶æ„ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆå¦‚@ControllerAdvice+@ExceptionHandlerï¼‰å°±èƒ½ä¼˜é›…åœ°å¤„ç†å„ç±»å¼‚å¸¸ï¼Œè‡ªå®šä¹‰å“åº”çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ã€‚ä½†è¿ç§»åˆ°Spring Cloudå¾®æœåŠ¡æ¶æ„åï¼Œå´é‡åˆ°äº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šæ— è®ºå‘ç”Ÿä½•ç§å¼‚å¸¸ï¼Œæ¥å£è¿”å›çš„çŠ¶æ€ç å§‹ç»ˆæ˜¯</summary>
      
    
    
    
    
    <category term="spring cloud" scheme="https://nmcb666.vip/tags/spring-cloud/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis-Plusçš„åˆ†é¡µæŸ¥è¯¢åŸç†</title>
    <link href="https://nmcb666.vip/posts/3ecdcd9c.html"/>
    <id>https://nmcb666.vip/posts/3ecdcd9c.html</id>
    <published>2025-12-11T22:27:30.000Z</published>
    <updated>2026-01-26T13:39:36.089Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†"><a href="#MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†" class="headerlink" title="MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†"></a>MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†</h1><h3 id="ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸-MP-çš„è§£å†³æ–¹æ¡ˆ"><a href="#ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸-MP-çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸ MP çš„è§£å†³æ–¹æ¡ˆ"></a>ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸ MP çš„è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨ä¼ ç»Ÿ MyBatis å¼€å‘ä¸­ï¼Œåˆ†é¡µå®ç°å¾€å¾€éœ€è¦æ‰‹åŠ¨æ‹¼æ¥<code>LIMIT</code>è¯­å¥ï¼ˆMySQLï¼‰æˆ–<code>ROWNUM</code>ï¼ˆOracleï¼‰ï¼Œä¸ä»…ç¹çä¸”æ˜“å‡ºé”™ï¼Œè¿˜å­˜åœ¨ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š</p><ol><li><p><strong>SQL ä¾µå…¥æ€§å¼º</strong>ï¼šä¸šåŠ¡ SQL ä¸åˆ†é¡µè¯­æ³•è€¦åˆï¼Œåˆ‡æ¢æ•°æ®åº“æ—¶éœ€æ‰¹é‡ä¿®æ”¹ï¼›</p></li><li><p><strong>æ€»æ¡æ•°ç»Ÿè®¡å†—ä½™</strong>ï¼šéœ€æ‰‹åŠ¨ç¼–å†™ count æŸ¥è¯¢ï¼Œä¸”éœ€å¤„ç†å¤æ‚æŸ¥è¯¢ï¼ˆå¦‚å¤šè¡¨å…³è”ã€åˆ†ç»„ç»Ÿè®¡ï¼‰çš„ count é€‚é…ã€‚</p></li></ol><p>MyBatis-Plusï¼ˆä»¥ä¸‹ç®€ç§° MPï¼‰çš„åˆ†é¡µæ’ä»¶é€šè¿‡<strong>æ‹¦æˆªå™¨æœºåˆ¶</strong>+<strong>æ•°æ®åº“æ–¹è¨€é€‚é…</strong>ï¼Œå®ç°äº† â€œæ— ä¾µå…¥å¼åˆ†é¡µâ€ï¼Œå…¶æ ¸å¿ƒè®¾è®¡æ€è·¯æ˜¯ï¼š<strong>åœ¨ SQL æ‰§è¡Œå‰åŠ¨æ€æ”¹å†™ SQLï¼Œè‡ªåŠ¨æ·»åŠ åˆ†é¡µè¯­æ³•å’Œ count æŸ¥è¯¢ï¼ŒåŒæ—¶å°è£…åˆ†é¡µç»“æœ</strong>ã€‚</p><h3 id="äºŒã€MP-åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»"><a href="#äºŒã€MP-åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»" class="headerlink" title="äºŒã€MP åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»"></a>äºŒã€MP åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»</h3><p>MP åˆ†é¡µåŠŸèƒ½çš„å®ç°ä¾èµ– 3 ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬çš„åä½œæµç¨‹å†³å®šäº†åˆ†é¡µçš„åº•å±‚é€»è¾‘ï¼š</p><div class="table-container"><table><thead><tr><th>ç»„ä»¶åç§°</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>PaginationInnerInterceptor</code></td><td>æ ¸å¿ƒæ‹¦æˆªå™¨ï¼Œè´Ÿè´£æ‹¦æˆª SQL æ‰§è¡Œã€æ”¹å†™ SQLã€ç»Ÿè®¡æ€»æ¡æ•°ï¼ˆMP 3.4.0 + æ¨èä½¿ç”¨ï¼‰</td></tr><tr><td><code>Page</code></td><td>åˆ†é¡µå‚æ•°è½½ä½“ï¼Œå°è£…é¡µç ã€æ¯é¡µæ¡æ•°ã€æ€»æ¡æ•°ã€åˆ†é¡µç»“æœé›†ç­‰ä¿¡æ¯</td></tr><tr><td><code>Dialect</code></td><td>æ•°æ®åº“æ–¹è¨€æ¥å£ï¼Œé€‚é…ä¸åŒæ•°æ®åº“çš„åˆ†é¡µè¯­æ³•ï¼ˆå¦‚ MySQL çš„ LIMITã€PostgreSQL çš„ OFFSETï¼‰</td></tr></tbody></table></div><p><strong>ä¾èµ–å…³ç³»</strong>ï¼š<code>Page</code>ä¼ é€’åˆ†é¡µå‚æ•° â†’ <code>PaginationInnerInterceptor</code>æ‹¦æˆª SQL â†’ è°ƒç”¨<code>Dialect</code>ç”Ÿæˆé€‚é… SQL â†’ æ‰§è¡ŒæŸ¥è¯¢å¹¶å°è£…ç»“æœã€‚</p><h3 id="ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä»-SQL-æ‹¦æˆªåˆ°ç»“æœè¿”å›"><a href="#ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä»-SQL-æ‹¦æˆªåˆ°ç»“æœè¿”å›" class="headerlink" title="ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä» SQL æ‹¦æˆªåˆ°ç»“æœè¿”å›"></a>ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä» SQL æ‹¦æˆªåˆ°ç»“æœè¿”å›</h3><h4 id="1-æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶"><a href="#1-æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶" class="headerlink" title="1. æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶"></a>1. æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶</h4><p>MP çš„åˆ†é¡µæ’ä»¶æœ¬è´¨æ˜¯ MyBatis çš„<code>Interceptor</code>æ¥å£å®ç°ç±»ï¼Œé€šè¿‡<code>@Intercepts</code>æ³¨è§£æŒ‡å®šæ‹¦æˆª<code>StatementHandler</code>çš„<code>prepare</code>æ–¹æ³•ï¼ˆSQL é¢„å¤„ç†é˜¶æ®µï¼‰å’Œ<code>query</code>æ–¹æ³•ï¼ˆç»“æœæŸ¥è¯¢é˜¶æ®µï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">   @Signature(type = StatementHandler.class, method = &quot;prepare&quot;, args = &#123;Connection.class, Integer.class&#125;),</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">   @Signature(type = StatementHandler.class, method = &quot;query&quot;, args = &#123;Statement.class, ResultHandler.class&#125;)</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaginationInnerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">InnerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ ¸å¿ƒé€»è¾‘å®ç°</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œ<code>mapper.selectPage(page, queryWrapper)</code>æ—¶ï¼ŒMyBatis çš„æ’ä»¶é“¾ä¼šè§¦å‘è¯¥æ‹¦æˆªå™¨ã€‚</p><h4 id="2-SQL-åŠ¨æ€æ”¹å†™åŸç†"><a href="#2-SQL-åŠ¨æ€æ”¹å†™åŸç†" class="headerlink" title="2. SQL åŠ¨æ€æ”¹å†™åŸç†"></a>2. SQL åŠ¨æ€æ”¹å†™åŸç†</h4><p>è¿™æ˜¯åˆ†é¡µåŠŸèƒ½çš„æ ¸å¿ƒæ­¥éª¤ï¼ŒMP ä¼šæ ¹æ®æ•°æ®åº“æ–¹è¨€ï¼Œå°†åŸå§‹æŸ¥è¯¢ SQL æ”¹å†™æˆ â€œåˆ†é¡µæŸ¥è¯¢ SQLâ€ å’Œ â€œæ€»æ¡æ•°æŸ¥è¯¢ SQLâ€ï¼š</p><h5 id="ï¼ˆ1ï¼‰åŸå§‹-SQL-ç¤ºä¾‹ï¼ˆMySQLï¼‰"><a href="#ï¼ˆ1ï¼‰åŸå§‹-SQL-ç¤ºä¾‹ï¼ˆMySQLï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰åŸå§‹ SQL ç¤ºä¾‹ï¼ˆMySQLï¼‰"></a>ï¼ˆ1ï¼‰åŸå§‹ SQL ç¤ºä¾‹ï¼ˆMySQLï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, age FROM user WHERE age &gt; 18</span><br></pre></td></tr></table></figure><h5 id="ï¼ˆ2ï¼‰åˆ†é¡µ-SQL-æ”¹å†™ï¼ˆæ·»åŠ -LIMITï¼‰"><a href="#ï¼ˆ2ï¼‰åˆ†é¡µ-SQL-æ”¹å†™ï¼ˆæ·»åŠ -LIMITï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰åˆ†é¡µ SQL æ”¹å†™ï¼ˆæ·»åŠ  LIMITï¼‰"></a>ï¼ˆ2ï¼‰åˆ†é¡µ SQL æ”¹å†™ï¼ˆæ·»åŠ  LIMITï¼‰</h5><p>MP é€šè¿‡<code>BoundSql</code>è§£æåŸå§‹ SQLï¼Œæ‹¼æ¥åˆ†é¡µè¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, age FROM user WHERE age &gt; 18 LIMIT 0, 10  -- ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡</span><br></pre></td></tr></table></figure><p><strong>å…³é”®é€»è¾‘</strong>ï¼šåœ¨<code>prepare</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>Dialect.buildPaginationSql</code>ç”Ÿæˆé€‚é… SQLï¼Œä¸åŒæ•°æ®åº“çš„æ–¹è¨€å®ç°ä¸åŒï¼š</p><ul><li><p>MySQLï¼š<code>LIMIT offset, size</code></p></li><li><p>Oracleï¼š<code>SELECT * FROM (SELECT t.*, ROWNUM rn FROM (...) t WHERE ROWNUM  ?) WHERE rn &gt; ?</code></p></li><li><p>PostgreSQLï¼š<code>OFFSET ? LIMIT ?</code></p></li></ul><h5 id="ï¼ˆ3ï¼‰æ€»æ¡æ•°-SQL-è‡ªåŠ¨ç”Ÿæˆ"><a href="#ï¼ˆ3ï¼‰æ€»æ¡æ•°-SQL-è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="ï¼ˆ3ï¼‰æ€»æ¡æ•° SQL è‡ªåŠ¨ç”Ÿæˆ"></a>ï¼ˆ3ï¼‰æ€»æ¡æ•° SQL è‡ªåŠ¨ç”Ÿæˆ</h5><p>MP ä¼šè‡ªåŠ¨å‰¥ç¦»åŸå§‹ SQL çš„<code>SELECT</code>å­—æ®µå’Œ<code>ORDER BY</code>ï¼ˆé¿å… count ç»Ÿè®¡é”™è¯¯ï¼‰ï¼Œç”Ÿæˆ count æŸ¥è¯¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(1) FROM user WHERE age &gt; 18</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–ç‚¹</strong>ï¼š</p><ul><li><p>è‹¥åŸå§‹ SQL å«<code>GROUP BY</code>ï¼Œcount ä¼šæ”¹ä¸º<code>COUNT(DISTINCT åˆ†ç»„å­—æ®µ)</code>ï¼›</p></li><li><p>å¯é€šè¿‡<code>page.setSearchCount(false)</code>å…³é—­æ€»æ¡æ•°ç»Ÿè®¡ï¼ˆé€‚ç”¨äºæ— éœ€æ€»é¡µæ•°çš„åœºæ™¯ï¼‰ã€‚</p></li></ul><h4 id="3-åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…"><a href="#3-åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…" class="headerlink" title="3. åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…"></a>3. åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…</h4><ul><li><p><strong>å‚æ•°ä¼ é€’</strong>ï¼š<code>Page</code>å¯¹è±¡ä¸­çš„<code>current</code>ï¼ˆå½“å‰é¡µï¼‰å’Œ<code>size</code>ï¼ˆæ¯é¡µæ¡æ•°ï¼‰ä¼šè¢«è½¬æ¢ä¸º<code>offset = (current - 1) * size</code>ï¼Œä½œä¸ºåˆ†é¡µå‚æ•°æ³¨å…¥æ”¹å†™åçš„ SQLï¼›</p></li><li><p><strong>ç»“æœå°è£…</strong>ï¼šæ‰§è¡Œåˆ†é¡µ SQL åï¼ŒæŸ¥è¯¢ç»“æœä¼šè¢«è®¾ç½®åˆ°<code>page.getRecords()</code>ï¼›æ‰§è¡Œ countSQL åï¼Œæ€»æ¡æ•°ä¼šè®¾ç½®åˆ°<code>page.setTotal(total)</code>ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—<code>pages = (total + size - 1) / size</code>ï¼ˆæ€»é¡µæ•°ï¼‰ã€‚</p></li></ul><h3 id="å››ã€ç‰©ç†åˆ†é¡µ-vs-é€»è¾‘åˆ†é¡µï¼šMP-ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ"><a href="#å››ã€ç‰©ç†åˆ†é¡µ-vs-é€»è¾‘åˆ†é¡µï¼šMP-ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ" class="headerlink" title="å››ã€ç‰©ç†åˆ†é¡µ vs é€»è¾‘åˆ†é¡µï¼šMP ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ"></a>å››ã€ç‰©ç†åˆ†é¡µ vs é€»è¾‘åˆ†é¡µï¼šMP ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ</h3><p>å¾ˆå¤šäººä¼šç–‘æƒ‘ï¼šMP ä¸ºä½•é‡‡ç”¨ â€œç‰©ç†åˆ†é¡µâ€ï¼ˆä¾èµ–æ•°æ®åº“ SQL è¯­æ³•ï¼‰è€Œé â€œé€»è¾‘åˆ†é¡µâ€ï¼ˆæŸ¥è¯¢å…¨é‡æ•°æ®åå†…å­˜æˆªå–ï¼‰ï¼Ÿ</p><div class="table-container"><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>ç‰©ç†åˆ†é¡µï¼ˆMP å®ç°ï¼‰</th><th>é€»è¾‘åˆ†é¡µï¼ˆå†…å­˜æˆªå–ï¼‰</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>åªæŸ¥è¯¢å½“å‰é¡µæ•°æ®ï¼Œæ•°æ®åº“å‹åŠ›å°</td><td>æŸ¥è¯¢å…¨é‡æ•°æ®ï¼Œå¤§æ•°æ®é‡ä¸‹å†…å­˜æº¢å‡º</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å¤§æ•°æ®é‡ã€è·¨åº“å…¼å®¹</td><td>å°æ•°æ®é‡ã€æœ¬åœ°æµ‹è¯•</td></tr><tr><td>ä¾èµ–</td><td>æ•°æ®åº“æ–¹è¨€æ”¯æŒ</td><td>æ— ä¾èµ–ï¼Œçº¯ Java é€»è¾‘</td></tr></tbody></table></div><p>MP é€‰æ‹©ç‰©ç†åˆ†é¡µçš„æ ¸å¿ƒåŸå› æ˜¯<strong>æ€§èƒ½ä¼˜åŒ–</strong>â€”â€” å¯¹äºç™¾ä¸‡çº§æ•°æ®ï¼Œé€»è¾‘åˆ†é¡µä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œè€Œç‰©ç†åˆ†é¡µé€šè¿‡æ•°æ®åº“çš„ç´¢å¼•ä¼˜åŒ–ï¼Œä»…è¿”å›å½“å‰é¡µæ•°æ®ï¼Œå¤§å¹…é™ä½ IO å¼€é”€ã€‚</p><h3 id="äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP-3-5-3-ç‰ˆæœ¬ï¼‰"><a href="#äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP-3-5-3-ç‰ˆæœ¬ï¼‰" class="headerlink" title="äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP 3.5.3 ç‰ˆæœ¬ï¼‰"></a>äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP 3.5.3 ç‰ˆæœ¬ï¼‰</h3><h4 id="1-åˆ†é¡µ-SQL-æ”¹å†™æ ¸å¿ƒä»£ç "><a href="#1-åˆ†é¡µ-SQL-æ”¹å†™æ ¸å¿ƒä»£ç " class="headerlink" title="1. åˆ†é¡µ SQL æ”¹å†™æ ¸å¿ƒä»£ç "></a>1. åˆ†é¡µ SQL æ”¹å†™æ ¸å¿ƒä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PaginationInnerInterceptor.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforePrepare</span><span class="params">(StatementHandler sh, Connection conn, Integer transactionTimeout)</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1. è·å–åŸå§‹BoundSqlï¼ˆå°è£…SQLå’Œå‚æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line">   <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> sh.getBoundSql();</span><br><span class="line"></span><br><span class="line">   <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> boundSql.getSql();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†é¡µï¼ˆæ˜¯å¦åŒ…å«Pageå‚æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line">   <span class="type">Page</span> <span class="variable">page</span> <span class="operator">=</span> getPage(sh);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (page != <span class="literal">null</span> &amp;&amp; page.isNeedPagination()) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. è·å–æ•°æ®åº“æ–¹è¨€ï¼ˆæ ¹æ®Connectionè‡ªåŠ¨è¯†åˆ«ï¼‰</span></span><br><span class="line"></span><br><span class="line">       <span class="type">Dialect</span> <span class="variable">dialect</span> <span class="operator">=</span> getDialect(conn);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. æ”¹å†™åˆ†é¡µSQL</span></span><br><span class="line"></span><br><span class="line">       <span class="type">String</span> <span class="variable">paginationSql</span> <span class="operator">=</span> dialect.buildPaginationSql(sql, page.getOffset(), page.getSize());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 5. æ›¿æ¢åŸå§‹SQL</span></span><br><span class="line"></span><br><span class="line">      ReflectUtil.setFieldValue(boundSql, <span class="string">&quot;sql&quot;</span>, paginationSql);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç "><a href="#2-æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç " class="headerlink" title="2. æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç "></a>2. æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PaginationInnerInterceptor.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="title function_">count</span><span class="params">(Connection conn, String sql, List Class</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">   // <span class="number">1.</span> ç”Ÿæˆcount SQL</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">   String countSql = DialectBuilder.buildCountSql(sql)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. æ‰§è¡ŒcountæŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> SqlHelper.executeQuery(conn, countSql, paramList, rs -&gt; &#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> rs.getLong(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ"><a href="#å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ" class="headerlink" title="å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ"></a>å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ</h3><h4 id="1-åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€”-æ‹¦æˆªå™¨æœªæ³¨å†Œ"><a href="#1-åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€”-æ‹¦æˆªå™¨æœªæ³¨å†Œ" class="headerlink" title="1. åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€” æ‹¦æˆªå™¨æœªæ³¨å†Œ"></a>1. åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€” æ‹¦æˆªå™¨æœªæ³¨å†Œ</h4><p>è‹¥åˆ†é¡µ SQL æœªæ·»åŠ  LIMITï¼Œå¤§æ¦‚ç‡æ˜¯åˆ†é¡µæ’ä»¶æœªæ³¨å…¥ Spring å®¹å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­£ç¡®é…ç½®ï¼ˆSpring Bootï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ·»åŠ åˆ†é¡µæ‹¦æˆªå™¨ï¼Œå¹¶æŒ‡å®šæ•°æ®åº“ç±»å‹</span></span><br><span class="line"></span><br><span class="line">       interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> interceptor;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šæœªæ³¨å†Œæ‹¦æˆªå™¨æ—¶ï¼ŒSQL ä¸ä¼šè¢«æ”¹å†™ï¼Œè‡ªç„¶æ— æ³•å®ç°åˆ†é¡µã€‚</p><h4 id="2-æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€”-SQL-è§£æå¼‚å¸¸"><a href="#2-æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€”-SQL-è§£æå¼‚å¸¸" class="headerlink" title="2. æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€” SQL è§£æå¼‚å¸¸"></a>2. æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€” SQL è§£æå¼‚å¸¸</h4><p>è‹¥ count ç»“æœä¸å®é™…ä¸ç¬¦ï¼Œå¯èƒ½æ˜¯åŸå§‹ SQL å«å¤æ‚è¯­æ³•ï¼ˆå¦‚<code>UNION</code>ã€<code>å­æŸ¥è¯¢</code>ï¼‰ï¼Œå¯¼è‡´ MP çš„ SQL è§£æå¤±è´¥ã€‚æ­¤æ—¶å¯æ‰‹åŠ¨æŒ‡å®š countSQLï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page.setCountSql(&quot;SELECT COUNT(1) FROM (åŸå§‹å¤æ‚SQL) t&quot;);</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šMP çš„è‡ªåŠ¨ countSQL ç”Ÿæˆä¾èµ– SQL è§£æå™¨ï¼Œå¤æ‚è¯­æ³•å¯èƒ½å¯¼è‡´è§£æåå·®ï¼Œæ‰‹åŠ¨æŒ‡å®šå¯ç»•è¿‡è§£æé€»è¾‘ã€‚</p><h4 id="3-è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€”-æ–¹è¨€æœªé€‚é…"><a href="#3-è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€”-æ–¹è¨€æœªé€‚é…" class="headerlink" title="3. è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€” æ–¹è¨€æœªé€‚é…"></a>3. è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€” æ–¹è¨€æœªé€‚é…</h4><p>åˆ‡æ¢æ•°æ®åº“ååˆ†é¡µå¤±æ•ˆï¼Œéœ€ç¡®ä¿<code>DbType</code>ä¸å®é™…æ•°æ®åº“ä¸€è‡´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// é€‚é…PostgreSQL</span><br><span class="line"></span><br><span class="line">interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.POSTGRE\_SQL));</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šä¸åŒæ•°æ®åº“çš„åˆ†é¡µè¯­æ³•å·®å¼‚ï¼Œæ–¹è¨€æ˜¯è¿æ¥ SQL æ”¹å†™ä¸æ•°æ®åº“çš„æ¡¥æ¢ã€‚</p><h3 id="ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ"><a href="#ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ" class="headerlink" title="ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ"></a>ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ</h3><p>MyBatis-Plus çš„åˆ†é¡µåŠŸèƒ½ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œæ ¸å¿ƒåœ¨äº **â€œæ— ä¾µå…¥å¼è®¾è®¡â€ å’Œ â€œæ•°æ®åº“æ–¹è¨€é€‚é…â€**ï¼š</p><ol><li><p>åŸºäº MyBatis æ‹¦æˆªå™¨æœºåˆ¶ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ SQLï¼Œå®ç°åˆ†é¡µé€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼›</p></li><li><p>é€šè¿‡æ–¹è¨€æ¥å£å°è£…ä¸åŒæ•°æ®åº“çš„åˆ†é¡µè¯­æ³•ï¼Œè§£å†³è·¨åº“å…¼å®¹é—®é¢˜ï¼›</p></li><li><p>è‡ªåŠ¨ç”Ÿæˆ countSQLï¼Œå‡å°‘é‡å¤ç¼–ç ï¼ŒåŒæ—¶æ”¯æŒçµæ´»é…ç½®ï¼ˆå…³é—­ç»Ÿè®¡ã€æ‰‹åŠ¨æŒ‡å®š countSQLï¼‰ã€‚</p></li></ol><p>ä»åº•å±‚åŸç†æ¥çœ‹ï¼ŒMP çš„åˆ†é¡µæ’ä»¶æœ¬è´¨æ˜¯ â€œSQL è§£æä¸æ”¹å†™çš„è‡ªåŠ¨åŒ–å·¥å…·â€ï¼Œå…¶è®¾è®¡æ€è·¯å€¼å¾—å€Ÿé‰´ï¼š<strong>å°†é€šç”¨é€»è¾‘ï¼ˆåˆ†é¡µï¼‰æŠ½ç¦»ä¸ºæ’ä»¶ï¼Œé€šè¿‡æ‹¦æˆªå™¨åµŒå…¥æ¡†æ¶æµç¨‹ï¼Œæ—¢ä¸ç ´ååŸæœ‰æ¶æ„ï¼Œåˆèƒ½æå‡å¼€å‘æ•ˆç‡</strong>ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œéœ€æ³¨æ„ï¼š</p><ul><li><p>å¤æ‚ SQL åœºæ™¯ä¸‹ï¼Œå»ºè®®æ‰‹åŠ¨éªŒè¯åˆ†é¡µ SQL å’Œ countSQL çš„æ­£ç¡®æ€§ï¼›</p></li><li><p>å¤§æ•°æ®é‡åˆ†é¡µï¼ˆå¦‚åƒä¸‡çº§æ•°æ®ï¼‰ï¼Œå¯ç»“åˆ<code>PageHelper</code>çš„ â€œåˆç†åŒ–åˆ†é¡µâ€ æˆ– MP çš„<code>page.setReasonable(true)</code>é¿å…é¡µç è¶Šç•Œï¼›</p></li><li><p>æ— éœ€æ€»æ¡æ•°æ—¶ï¼Œå…³é—­<code>searchCount</code>å¯æå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&quot;&gt;&lt;a href=&quot;#MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&quot; class=&quot;headerlink&quot; title=&quot;MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&quot;&gt;&lt;/a&gt;MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&lt;/h1&gt;&lt;</summary>
      
    
    
    
    
    <category term="MyBatis-Plus" scheme="https://nmcb666.vip/tags/MyBatis-Plus/"/>
    
  </entry>
  
  <entry>
    <title>bitMapå®ç°ç­¾åˆ°åŠŸèƒ½</title>
    <link href="https://nmcb666.vip/posts/61e739c3.html"/>
    <id>https://nmcb666.vip/posts/61e739c3.html</id>
    <published>2025-12-07T17:44:51.000Z</published>
    <updated>2026-01-26T13:39:36.089Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç”¨æˆ·ç­¾åˆ°æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚APPçš„æ¯æ—¥ç­¾åˆ°é¢†ç§¯åˆ†ã€è¿ç»­ç­¾åˆ°å¥–åŠ±ç­‰ã€‚é¢å¯¹æµ·é‡ç”¨æˆ·çš„ç­¾åˆ°æ•°æ®ï¼Œå¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ï¼Œä¸ä»…ä¼šå ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”åœ¨ç»Ÿè®¡ç­¾åˆ°æƒ…å†µæ—¶æ•ˆç‡ä¹Ÿä¼šæ¯”è¾ƒä½ä¸‹ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´é«˜æ•ˆã€æ›´èŠ‚çœç©ºé—´çš„æ–¹æ¡ˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé‚£å°±æ˜¯åˆ©ç”¨Redisä¸­çš„Bitmapï¼ˆä½å›¾ï¼‰æ¥å®ç°ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½ã€‚æœ¬æ–‡å°±æ¥è¯¦ç»†æ¢è®¨ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Redis Bitmapç»“åˆJavaå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Œå¹¶åˆ†æå…¶ä¼˜åŠ¿å’Œæ³¨æ„äº‹é¡¹ã€‚</p><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ"></a>ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ</h2><p>åœ¨ä»‹ç»å…·ä½“å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆRedis Bitmapé€‚åˆç”¨æ¥å®ç°ç”¨æˆ·ç­¾åˆ°ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹Bitmapçš„åŸºæœ¬æ¦‚å¿µï¼šBitmapæ˜¯ä¸€ç§åŸºäºä½çš„æ•°æ®ç»“æ„ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªä½ï¼ˆbitï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„çŠ¶æ€ï¼Œ0è¡¨ç¤ºä¸å­˜åœ¨æˆ–æœªå‘ç”Ÿï¼Œ1è¡¨ç¤ºå­˜åœ¨æˆ–å·²å‘ç”Ÿã€‚åœ¨ç”¨æˆ·ç­¾åˆ°åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä½æ¥è¡¨ç¤ºç”¨æˆ·æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæå¤§åœ°èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰1000ä¸‡ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·æ¯å¹´ç­¾åˆ°æ•°æ®éœ€è¦365ä¸ª bit æ¥å­˜å‚¨ï¼Œé‚£ä¹ˆä¸€å¹´çš„ç­¾åˆ°æ•°æ®æ€»å­˜å‚¨ç©ºé—´ä¸ºï¼š1000ä¸‡ <em> 365 bit = 10000000 </em> 365 / 8 / 1024 / 1024 â‰ˆ 430MBã€‚å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„æ•°æ®åº“è¡¨ï¼Œæ¯ä¸ªç­¾åˆ°è®°å½•è‡³å°‘éœ€è¦å­˜å‚¨ç”¨æˆ·IDã€ç­¾åˆ°æ—¥æœŸç­‰å­—æ®µï¼Œå‡è®¾æ¯æ¡è®°å½•å ç”¨20å­—èŠ‚ï¼Œé‚£ä¹ˆ1000ä¸‡ç”¨æˆ·ä¸€å¹´çš„ç­¾åˆ°æ•°æ®å­˜å‚¨ç©ºé—´ä¸ºï¼š1000ä¸‡ <em> 365 </em> 20 byte = 10000000 <em> 365 </em> 20 / 1024 / 1024 / 1024 â‰ˆ 6.8GBã€‚é€šè¿‡å¯¹æ¯”å¯ä»¥æ˜æ˜¾çœ‹å‡ºï¼ŒBitmapåœ¨å­˜å‚¨ç©ºé—´ä¸Šå…·æœ‰å·¨å¤§çš„ä¼˜åŠ¿ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒRedis Bitmapè¿˜æä¾›äº†ä¸°å¯Œçš„ä½æ“ä½œå‘½ä»¤ï¼Œæ¯”å¦‚<code>SETBIT</code>ï¼ˆè®¾ç½®æŸä¸€ä½çš„å€¼ï¼‰ã€<code>GETBIT</code>ï¼ˆè·å–æŸä¸€ä½çš„å€¼ï¼‰ã€<code>BITCOUNT</code>ï¼ˆç»Ÿè®¡å€¼ä¸º1çš„ä½çš„ä¸ªæ•°ï¼‰ã€<code>BITOP</code>ï¼ˆä½è¿ç®—ï¼‰ç­‰ï¼Œè¿™äº›å‘½ä»¤èƒ½å¤Ÿé«˜æ•ˆåœ°æ»¡è¶³ç­¾åˆ°åŠŸèƒ½ä¸­çš„ç­¾åˆ°æ ‡è®°ã€ç­¾åˆ°æŸ¥è¯¢ã€è¿ç»­ç­¾åˆ°ç»Ÿè®¡ç­‰éœ€æ±‚ï¼Œæ“ä½œæ•ˆç‡éå¸¸é«˜ã€‚</p><h2 id="äºŒã€Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ"><a href="#äºŒã€Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ" class="headerlink" title="äºŒã€Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ"></a>äºŒã€Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ</h2><h3 id="2-1-é”®çš„è®¾è®¡"><a href="#2-1-é”®çš„è®¾è®¡" class="headerlink" title="2.1 é”®çš„è®¾è®¡"></a>2.1 é”®çš„è®¾è®¡</h3><p>è¦ä½¿ç”¨Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Œé¦–å…ˆéœ€è¦è®¾è®¡åˆç†çš„é”®åã€‚ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ä¸åŒç”¨æˆ·ã€ä¸åŒå¹´ä»½å’Œæœˆä»½çš„ç­¾åˆ°æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¿™æ ·çš„é”®åæ ¼å¼ï¼š<code>user:checkin:uid:year:month</code>ã€‚å…¶ä¸­ï¼Œ<code>uid</code>æ˜¯ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œ<code>year</code>æ˜¯å¹´ä»½ï¼Œ<code>month</code>æ˜¯æœˆä»½ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œæ¯ä¸ªç”¨æˆ·æ¯ä¸ªæœˆçš„ç­¾åˆ°æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç‹¬ç«‹çš„Bitmapä¸­ï¼Œæ—¢æ–¹ä¾¿ç®¡ç†ï¼Œåˆèƒ½é¿å…å•ä¸ªBitmapè¿‡å¤§å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</p><h3 id="2-2-ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰"><a href="#2-2-ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰" class="headerlink" title="2.2 ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰"></a>2.2 ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰</h3><p>å½“ç”¨æˆ·è¿›è¡Œç­¾åˆ°æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å¯¹åº”æ—¥æœŸçš„ä½è®¾ç½®ä¸º1ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>è·å–å½“å‰æ—¥æœŸï¼Œå¹¶è®¡ç®—å‡ºè¯¥æ—¥æœŸåœ¨å½“æœˆæ˜¯ç¬¬å‡ å¤©ï¼ˆå‡è®¾ä¸ºdayï¼Œå–å€¼èŒƒå›´1-31ï¼‰ã€‚</p></li><li><p>ç”±äºBitmapçš„ä½æ˜¯ä»0å¼€å§‹è®¡æ•°çš„ï¼Œæ‰€ä»¥éœ€è¦å°†dayå‡1å¾—åˆ°å¯¹åº”çš„ä½ç´¢å¼•ï¼ˆindex = day - 1ï¼‰ã€‚</p></li><li><p>ä½¿ç”¨Redisçš„<code>SETBIT</code>å‘½ä»¤ï¼Œå°†é”®<code>user:checkin:uid:year:month</code>å¯¹åº”indexä½ç½®çš„ä½è®¾ç½®ä¸º1ã€‚</p></li></ol><p><code>SETBIT</code>å‘½ä»¤çš„è¯­æ³•ä¸ºï¼š<code>SETBIT key offset value</code>ï¼Œå…¶ä¸­offsetæ˜¯ä½ç´¢å¼•ï¼Œvalueæ˜¯è¦è®¾ç½®çš„å€¼ï¼ˆ0æˆ–1ï¼‰ã€‚è¯¥å‘½ä»¤çš„è¿”å›å€¼æ˜¯è¯¥ä½åœ¨è®¾ç½®å‰çš„å€¼ã€‚</p><h3 id="2-3-ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰"><a href="#2-3-ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰" class="headerlink" title="2.3 ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰"></a>2.3 ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰</h3><p>å½“éœ€è¦æŸ¥è¯¢ç”¨æˆ·æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>GETBIT</code>å‘½ä»¤ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>è·å–è¦æŸ¥è¯¢çš„æ—¥æœŸï¼Œå¹¶è®¡ç®—å‡ºè¯¥æ—¥æœŸåœ¨å½“æœˆæ˜¯ç¬¬å‡ å¤©ï¼ˆdayï¼‰ã€‚</p></li><li><p>è®¡ç®—ä½ç´¢å¼•index = day - 1ã€‚</p></li><li><p>ä½¿ç”¨<code>GETBIT</code>å‘½ä»¤ï¼Œè·å–é”®<code>user:checkin:uid:year:month</code>å¯¹åº”indexä½ç½®çš„ä½å€¼ã€‚å¦‚æœè¿”å›1ï¼Œè¡¨ç¤ºç”¨æˆ·å½“å¤©å·²ç­¾åˆ°ï¼›å¦‚æœè¿”å›0ï¼Œè¡¨ç¤ºç”¨æˆ·å½“å¤©æœªç­¾åˆ°ã€‚</p></li></ol><p><code>GETBIT</code>å‘½ä»¤çš„è¯­æ³•ä¸ºï¼š<code>GETBIT key offset</code>ã€‚</p><h3 id="2-4-ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰"><a href="#2-4-ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰" class="headerlink" title="2.4 ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰"></a>2.4 ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰</h3><p>åœ¨ç­¾åˆ°åŠŸèƒ½ä¸­ï¼Œç»å¸¸éœ€è¦ç»Ÿè®¡ç”¨æˆ·åœ¨æŸä¸ªæ—¶é—´æ®µå†…çš„ç­¾åˆ°å¤©æ•°ï¼Œæ¯”å¦‚å½“æœˆç­¾åˆ°å¤©æ•°ã€è¿‘7å¤©ç­¾åˆ°å¤©æ•°ç­‰ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>BITCOUNT</code>å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç”¨äºç»Ÿè®¡Bitmapä¸­å€¼ä¸º1çš„ä½çš„ä¸ªæ•°ã€‚</p><p><code>BITCOUNT</code>å‘½ä»¤çš„è¯­æ³•ä¸ºï¼š<code>BITCOUNT key [start end]</code>ï¼Œå…¶ä¸­startå’Œendæ˜¯å­—èŠ‚çš„ç´¢å¼•ï¼ˆæ³¨æ„ä¸æ˜¯ä½çš„ç´¢å¼•ï¼‰ï¼Œç”¨äºæŒ‡å®šç»Ÿè®¡çš„èŒƒå›´ã€‚å¦‚æœä¸æŒ‡å®šstartå’Œendï¼Œåˆ™ç»Ÿè®¡æ•´ä¸ªBitmapã€‚</p><p>ä¾‹å¦‚ï¼Œè¦ç»Ÿè®¡ç”¨æˆ·å½“æœˆçš„ç­¾åˆ°å¤©æ•°ï¼Œç›´æ¥ä½¿ç”¨<code>BITCOUNT user:checkin:uid:year:month</code>å³å¯ã€‚å¦‚æœè¦ç»Ÿè®¡ç”¨æˆ·è¿‘7å¤©çš„ç­¾åˆ°å¤©æ•°ï¼Œéœ€è¦å…ˆç¡®å®šè¿™7å¤©å¯¹åº”çš„ä½ç´¢å¼•èŒƒå›´ï¼Œç„¶åå°†ä½ç´¢å¼•è½¬æ¢ä¸ºå­—èŠ‚ç´¢å¼•ï¼ˆå­—èŠ‚ç´¢å¼• = ä½ç´¢å¼• / 8ï¼‰ï¼Œå†ä½¿ç”¨<code>BITCOUNT</code>å‘½ä»¤è¿›è¡Œç»Ÿè®¡ã€‚</p><h3 id="2-5-è¿ç»­ç­¾åˆ°ç»Ÿè®¡"><a href="#2-5-è¿ç»­ç­¾åˆ°ç»Ÿè®¡" class="headerlink" title="2.5 è¿ç»­ç­¾åˆ°ç»Ÿè®¡"></a>2.5 è¿ç»­ç­¾åˆ°ç»Ÿè®¡</h3><p>è¿ç»­ç­¾åˆ°ç»Ÿè®¡æ˜¯ç­¾åˆ°åŠŸèƒ½ä¸­çš„ä¸€ä¸ªéš¾ç‚¹ï¼Œæ¯”å¦‚ç»Ÿè®¡ç”¨æˆ·å½“å‰çš„è¿ç»­ç­¾åˆ°å¤©æ•°ã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li><p>ä»å½“å‰æ—¥æœŸå¼€å§‹ï¼Œä¾æ¬¡å‘å‰æŸ¥è¯¢æ¯å¤©çš„ç­¾åˆ°çŠ¶æ€ï¼ˆä½¿ç”¨<code>GETBIT</code>å‘½ä»¤ï¼‰ã€‚</p></li><li><p>å¦‚æœæŸ¥è¯¢åˆ°æŸä¸€å¤©æœªç­¾åˆ°ï¼Œåˆ™åœæ­¢æŸ¥è¯¢ï¼Œè¿ç»­ç­¾åˆ°å¤©æ•°ä¸ºå·²æŸ¥è¯¢åˆ°çš„ç­¾åˆ°å¤©æ•°ã€‚</p></li><li><p>å¦‚æœæŸ¥è¯¢åˆ°æœ¬æœˆç¬¬ä¸€å¤©éƒ½å·²ç­¾åˆ°ï¼Œåˆ™ç»§ç»­æŸ¥è¯¢ä¸Šä¸€ä¸ªæœˆçš„ç­¾åˆ°æ•°æ®ï¼Œç›´åˆ°æŸ¥è¯¢åˆ°æœªç­¾åˆ°çš„æ—¥æœŸä¸ºæ­¢ã€‚</p></li></ol><p>åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„è·¨æœˆä»½çš„æƒ…å†µï¼Œéœ€è¦åˆ†åˆ«å¤„ç†ä¸åŒæœˆä»½çš„Bitmapã€‚</p><h2 id="ä¸‰ã€Javaä»£ç å®ç°"><a href="#ä¸‰ã€Javaä»£ç å®ç°" class="headerlink" title="ä¸‰ã€Javaä»£ç å®ç°"></a>ä¸‰ã€Javaä»£ç å®ç°</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡Javaä»£ç æ¥å…·ä½“å®ç°Redis Bitmapç”¨æˆ·ç­¾åˆ°åŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥Redisçš„Javaå®¢æˆ·ç«¯ä¾èµ–ï¼Œè¿™é‡Œä»¥Jedisä¸ºä¾‹ã€‚</p><h3 id="3-1-ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰"><a href="#3-1-ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰" class="headerlink" title="3.1 ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰"></a>3.1 ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2-ç­¾åˆ°å·¥å…·ç±»å®ç°"><a href="#3-2-ç­¾åˆ°å·¥å…·ç±»å®ç°" class="headerlink" title="3.2 ç­¾åˆ°å·¥å…·ç±»å®ç°"></a>3.2 ç­¾åˆ°å·¥å…·ç±»å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckinUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_KEY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;user:checkin:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">YEAR_MONTH_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMM&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CheckinUtil</span><span class="params">(Jedis jedis)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jedis = jedis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç­¾åˆ°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date ç­¾åˆ°æ—¥æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç­¾åˆ°å‰çš„çŠ¶æ€ï¼ˆ0ï¼šæœªç­¾åˆ°ï¼Œ1ï¼šå·²ç­¾åˆ°ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">checkin</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> getCheckinKey(uid, date);</span><br><span class="line">        <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> date.getDayOfMonth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> dayOfMonth - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> jedis.setbit(key, offset, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç”¨æˆ·æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date æŸ¥è¯¢æ—¥æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueï¼šå·²ç­¾åˆ°ï¼Œfalseï¼šæœªç­¾åˆ°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">isCheckin</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> getCheckinKey(uid, date);</span><br><span class="line">        <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> date.getDayOfMonth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> dayOfMonth - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> jedis.getbit(key, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»Ÿè®¡ç”¨æˆ·å½“æœˆç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date å½“æœˆä»»æ„ä¸€å¤©</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">countMonthCheckin</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> getCheckinKey(uid, date);</span><br><span class="line">        <span class="keyword">return</span> jedis.bitcount(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»Ÿè®¡ç”¨æˆ·å½“å‰è¿ç»­ç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿ç»­ç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countContinuousCheckin</span><span class="params">(Long uid)</span> &#123;</span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">currentDate</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">        <span class="type">int</span> <span class="variable">continuousDays</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">tempDate</span> <span class="operator">=</span> currentDate;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">Boolean</span> <span class="variable">isCheckin</span> <span class="operator">=</span> isCheckin(uid, tempDate);</span><br><span class="line">            <span class="keyword">if</span> (isCheckin) &#123;</span><br><span class="line">                continuousDays++;</span><br><span class="line">                tempDate = tempDate.minusDays(<span class="number">1</span>);</span><br><span class="line">                <span class="comment">// é¿å…æ— é™å¾ªç¯ï¼Œå½“æŸ¥è¯¢åˆ°ä¸€å¹´å‰ä»æœªæ–­ç­¾æ—¶ï¼Œåœæ­¢æŸ¥è¯¢</span></span><br><span class="line">                <span class="keyword">if</span> (tempDate.isBefore(currentDate.minusYears(<span class="number">1</span>))) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> continuousDays;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç­¾åˆ°Redisé”®å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date æ—¥æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é”®å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getCheckinKey</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">yearMonth</span> <span class="operator">=</span> date.format(YEAR_MONTH_FORMATTER);</span><br><span class="line">        <span class="keyword">return</span> REDIS_KEY_PREFIX + uid + <span class="string">&quot;:&quot;</span> + yearMonth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€æ³¨æ„äº‹é¡¹"><a href="#å››ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€æ³¨æ„äº‹é¡¹"></a>å››ã€æ³¨æ„äº‹é¡¹</h2><ul><li><p><strong>Bitmapçš„å¤§å°é™åˆ¶</strong>ï¼šRedisä¸­å•ä¸ªBitMapçš„åç§»é‡æœ€å¤§ä¸º 2^32-1ã€‚åœ¨è®¾è®¡é”®åæ—¶ï¼ŒæŒ‰ç”¨æˆ·æ¯æœˆæ‹†åˆ†Bitmapï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶å•ä¸ªBitmapçš„å¤§å°ï¼Œé¿å…å› Bitmapè¿‡å¤§å¯¼è‡´æŠ¥é”™ã€‚</p></li><li><p><strong>æ—¥æœŸå¤„ç†çš„å‡†ç¡®æ€§</strong>ï¼šåœ¨è®¡ç®—ä½ç´¢å¼•æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ—¥æœŸçš„å‡†ç¡®æ€§ï¼Œç‰¹åˆ«æ˜¯è·¨æœˆä»½å’Œé—°å¹´çš„æƒ…å†µã€‚ä½¿ç”¨Java 8çš„<code>LocalDate</code>ç±»å¯ä»¥æ–¹ä¾¿ã€å‡†ç¡®åœ°å¤„ç†æ—¥æœŸç›¸å…³æ“ä½œã€‚</p></li><li><p><strong>Redisè¿æ¥ç®¡ç†</strong>ï¼šåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸èƒ½æ¯æ¬¡æ“ä½œéƒ½åˆ›å»ºæ–°çš„Jedisè¿æ¥ï¼Œåº”è¯¥ä½¿ç”¨è¿æ¥æ± æ¥ç®¡ç†Redisè¿æ¥ï¼Œä»¥æé«˜æ€§èƒ½å’Œé¿å…èµ„æºæ³„éœ²ã€‚ï¼ˆè¿™ä¸ªæ— éœ€æ‹…å¿ƒï¼Œå®é™…å¼€å‘å¤§å¤šé‡‡ç”¨spring-data-redisè¿›è¡Œæ“ä½œ ä¼šè‡ªè¡Œç®¡ç†ï¼‰</p></li><li><p><strong>æ•°æ®æŒä¹…åŒ–</strong>ï¼šRedisæ”¯æŒRDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œä¸ºäº†é˜²æ­¢ç­¾åˆ°æ•°æ®ä¸¢å¤±ï¼Œéœ€è¦åˆç†é…ç½®Redisçš„æŒä¹…åŒ–ç­–ç•¥ã€‚</p></li><li><p><strong>è¿‡æœŸç­–ç•¥</strong>ï¼šå¯¹äºä¸€äº›è¿‡æœŸçš„ç­¾åˆ°æ•°æ®ï¼ˆæ¯”å¦‚å‡ å¹´å‰çš„ç­¾åˆ°æ•°æ®ï¼‰ï¼Œå¦‚æœä¸šåŠ¡ä¸Šä¸å†éœ€è¦ï¼Œå¯ä»¥è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ï¼Œè®©Redisè‡ªåŠ¨æ¸…ç†è¿™äº›æ•°æ®ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p></li></ul><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>ä½¿ç”¨Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½ï¼Œå…·æœ‰å­˜å‚¨ç©ºé—´å°ã€æ“ä½œæ•ˆç‡é«˜ã€å‘½ä»¤ä¸°å¯Œç­‰ä¼˜ç‚¹ï¼Œéå¸¸é€‚åˆå¤„ç†æµ·é‡ç”¨æˆ·çš„ç­¾åˆ°æ•°æ®ã€‚é€šè¿‡åˆç†çš„é”®åè®¾è®¡å’ŒJavaä»£ç å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®Œæˆç­¾åˆ°æ ‡è®°ã€ç­¾åˆ°æŸ¥è¯¢ã€ç­¾åˆ°ç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚åŒæ—¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦æ³¨æ„Bitmapçš„å¤§å°é™åˆ¶ã€æ—¥æœŸå¤„ç†ã€Redisè¿æ¥ç®¡ç†ç­‰é—®é¢˜ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒRedis Bitmapæ˜¯å®ç°ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½çš„ä¸€ç§ä¼˜ç§€æ–¹æ¡ˆï¼Œå€¼å¾—åœ¨é¡¹ç›®ä¸­æ¨å¹¿å’Œåº”ç”¨ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç”¨æˆ·ç­¾åˆ°æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚APPçš„æ¯æ—¥ç­¾åˆ°é¢†ç§¯åˆ†ã€è¿ç»­ç­¾åˆ°å¥–åŠ±ç­‰ã€‚é¢å¯¹æµ·é‡ç”¨æˆ·çš„ç­¾åˆ°æ•°æ®ï¼Œå¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ï¼Œä¸ä»…ä¼šå ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”åœ¨ç»Ÿè®¡ç­¾åˆ°æƒ…å†µæ—¶æ•ˆç‡ä¹Ÿä¼šæ¯”è¾ƒä½ä¸‹ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´é«˜æ•ˆã€æ›´èŠ‚çœç©ºé—´çš„æ–¹æ¡ˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé‚£å°±æ˜¯åˆ©</summary>
      
    
    
    
    
    <category term="redis" scheme="https://nmcb666.vip/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨Redis Sorted Setå®ç°Javaæ»šåŠ¨åˆ†é¡µæŸ¥è¯¢</title>
    <link href="https://nmcb666.vip/posts/7be5306f.html"/>
    <id>https://nmcb666.vip/posts/7be5306f.html</id>
    <published>2025-12-06T19:13:16.000Z</published>
    <updated>2026-01-26T13:39:36.090Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆ†é¡µæŸ¥è¯¢æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ã€‚ä¼ ç»Ÿçš„åŸºäºæ•°æ®åº“çš„Limit Offsetåˆ†é¡µæ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†åœ¨æ•°æ®é‡è¾ƒå¤§æˆ–æ•°æ®å®æ—¶å˜åŠ¨ï¼ˆå¦‚æ’å…¥æ–°æ•°æ®ï¼‰çš„åœºæ™¯ä¸‹ï¼Œä¼šå‡ºç°<strong>é‡å¤æ•°æ®</strong>æˆ–<strong>æ•°æ®é—æ¼</strong>çš„é—®é¢˜ã€‚æœ¬æ–‡å°†æ¢è®¨å¦‚ä½•åˆ©ç”¨Redisçš„Sorted Setï¼ˆæœ‰åºé›†åˆï¼‰æ•°æ®ç»“æ„æ¥å®ç°é«˜æ•ˆã€å‡†ç¡®çš„æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶ç»“åˆå…·ä½“Javaä»£ç è¿›è¡Œè¯¦ç»†è§£æã€‚</p><h2 id="ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ"><a href="#ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ" class="headerlink" title="ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ"></a>ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ</h2><p>æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ä¼ ç»Ÿçš„Limit Offsetåˆ†é¡µã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¼ åšå®¢è¡¨ï¼Œè¦æŸ¥è¯¢ç¬¬2é¡µæ•°æ®ï¼ˆæ¯é¡µ2æ¡ï¼‰ï¼ŒSQLé€šå¸¸æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> blog <span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time <span class="keyword">DESC</span> LIMIT <span class="number">2</span> <span class="keyword">OFFSET</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºï¼šå¦‚æœåœ¨æŸ¥è¯¢ç¬¬1é¡µåã€ç¬¬2é¡µå‰ï¼Œæœ‰ä¸€æ¡æ–°çš„åšå®¢æ’å…¥ï¼ˆcreate_timeæ¯”ç¬¬1é¡µçš„éƒ¨åˆ†æ•°æ®æ›´æ–°ï¼‰ï¼Œé‚£ä¹ˆç¬¬2é¡µçš„ç»“æœå°±ä¼šåŒ…å«åŸæœ¬ç¬¬1é¡µçš„æœ€åä¸€æ¡æ•°æ®ï¼Œå¯¼è‡´é‡å¤æŸ¥è¯¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ul><li><p>åˆå§‹æ•°æ®ï¼š[A(æ—¶é—´10), B(æ—¶é—´9), C(æ—¶é—´8), D(æ—¶é—´7)]</p></li><li><p>ç¬¬1é¡µï¼ˆLIMIT 2 OFFSET 0ï¼‰ï¼š[A, B]</p></li><li><p>æ’å…¥æ–°æ•°æ®E(æ—¶é—´11)ï¼Œæ•°æ®å˜ä¸ºï¼š[E(11), A(10), B(9), C(8), D(7)]</p></li><li><p>ç¬¬2é¡µï¼ˆLIMIT 2 OFFSET 2ï¼‰ï¼š[B, C] â†’ Bé‡å¤å‡ºç°</p></li></ul><p>æ»šåŠ¨åˆ†é¡µï¼ˆä¹Ÿå«æ¸¸æ ‡åˆ†é¡µï¼‰åˆ™é€šè¿‡<strong>ä¸Šä¸€é¡µçš„æœ€åä¸€ä¸ªæ ‡è®°ï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰</strong>æ¥å®šä½ä¸‹ä¸€é¡µçš„èµ·å§‹ä½ç½®ï¼Œé¿å…äº†Offsetå¸¦æ¥çš„é—®é¢˜ã€‚è€ŒRedisçš„Sorted Setæ°å¥½èƒ½å®Œç¾æ”¯æŒè¿™ç§åœºæ™¯ã€‚</p><h2 id="äºŒã€Redis-Sorted-Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ"><a href="#äºŒã€Redis-Sorted-Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ" class="headerlink" title="äºŒã€Redis Sorted Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ"></a>äºŒã€Redis Sorted Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ</h2><p>Redisçš„Sorted Setï¼ˆæœ‰åºé›†åˆï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå®ƒä¸ºæ¯ä¸ªå…ƒç´ åˆ†é…ä¸€ä¸ª<strong>åˆ†æ•°ï¼ˆScoreï¼‰</strong>ï¼Œå¹¶æŒ‰ç…§åˆ†æ•°å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚å…¶æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</p><ol><li><p><strong>æœ‰åºæ€§</strong>ï¼šå…ƒç´ å¤©ç„¶æŒ‰ç…§Scoreå‡åºæˆ–é™åºæ’åˆ—ï¼Œæ— éœ€é¢å¤–æ’åºæ“ä½œã€‚</p></li><li><p><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šæ”¯æŒé€šè¿‡ScoreèŒƒå›´ï¼ˆå¦‚0åˆ°maxScoreï¼‰æŸ¥è¯¢å…ƒç´ ï¼Œè¿™æ˜¯å®ç°æ»šåŠ¨åˆ†é¡µçš„å…³é”®ã€‚</p></li><li><p><strong>é«˜æ•ˆæ€§</strong>ï¼šæ— è®ºæ˜¯æ’å…¥ã€æŸ¥è¯¢è¿˜æ˜¯åˆ é™¤æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å‡ä¸ºO(logN)ï¼Œé€‚åˆå¤§æ•°æ®é‡åœºæ™¯ã€‚</p></li></ol><p>åœ¨æ»šåŠ¨åˆ†é¡µåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†<strong>ä¸šåŠ¡æ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚åšå®¢IDï¼‰</strong>ä½œä¸ºSorted Setçš„å…ƒç´ ï¼ˆValueï¼‰ï¼Œå°†<strong>æ’åºå­—æ®µï¼ˆå¦‚åˆ›å»ºæ—¶é—´æˆ³ï¼‰</strong>ä½œä¸ºå…ƒç´ çš„åˆ†æ•°ï¼ˆScoreï¼‰ã€‚è¿™æ ·ï¼Œé€šè¿‡ScoreèŒƒå›´å°±èƒ½å¿«é€Ÿå®šä½ä¸‹ä¸€é¡µæ•°æ®ã€‚</p><h2 id="ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ"><a href="#ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ" class="headerlink" title="ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ"></a>ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ</h2><p>ä¸‹é¢ç»“åˆæä¾›çš„Javaä»£ç ï¼Œè¯¦ç»†æ‹†è§£åˆ©ç”¨Redis Sorted Setå®ç°æ»šåŠ¨åˆ†é¡µçš„å®Œæ•´æµç¨‹ã€‚æœ¬æ–‡ä»¥â€œæŸ¥è¯¢å…³æ³¨çš„åšå®¢åŠ¨æ€â€ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="3-1-æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ"><a href="#3-1-æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ" class="headerlink" title="3.1 æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ"></a>3.1 æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ</h3><p>æ»šåŠ¨åˆ†é¡µçš„æ ¸å¿ƒæ˜¯é€šè¿‡â€œä¸Šä¸€é¡µçš„æœ€å°æ—¶é—´æˆ³ï¼ˆminTimeï¼‰â€å’Œâ€œåç§»é‡ï¼ˆoffsetï¼‰â€æ¥å®šä½ä¸‹ä¸€é¡µæ•°æ®ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>å®šä¹‰Redisçš„Sorted Seté”®ï¼šä»¥ç”¨æˆ·IDä¸ºç»´åº¦ï¼Œå­˜å‚¨è¯¥ç”¨æˆ·å…³æ³¨çš„åšå®¢IDé›†åˆï¼ˆå¦‚<code>feed:1001</code>è¡¨ç¤ºç”¨æˆ·1001çš„å…³æ³¨åŠ¨æ€ï¼‰ã€‚</p></li><li><p>æŸ¥è¯¢ä¸Šä¸€é¡µæ•°æ®ï¼šé€šè¿‡<code>reverseRangeByScoreWithScores</code>æ–¹æ³•ï¼ŒæŸ¥è¯¢Scoreåœ¨0åˆ°maxï¼ˆä¸Šä¸€é¡µçš„minTimeï¼‰ä¹‹é—´çš„å…ƒç´ ï¼ŒåŒæ—¶æŒ‡å®šåç§»é‡å’Œæ¯é¡µæ•°é‡ã€‚</p></li><li><p>å¤„ç†æŸ¥è¯¢ç»“æœï¼šæå–åšå®¢IDã€è®¡ç®—å½“å‰é¡µçš„æœ€å°æ—¶é—´æˆ³å’Œåç§»é‡ï¼Œç”¨äºä¸‹ä¸€é¡µæŸ¥è¯¢ã€‚</p></li><li><p>å°è£…å¹¶è¿”å›ç»“æœï¼šå°†åšå®¢è¯¦æƒ…ã€minTimeã€offsetè¿”å›ç»™å‰ç«¯ï¼Œä½œä¸ºä¸‹ä¸€é¡µè¯·æ±‚çš„å‚æ•°ã€‚</p></li></ol><h3 id="3-2-ä»£ç é€è¡Œè§£æ"><a href="#3-2-ä»£ç é€è¡Œè§£æ" class="headerlink" title="3.2 ä»£ç é€è¡Œè§£æ"></a>3.2 ä»£ç é€è¡Œè§£æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(Long max, Integer offset)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;feed:&quot;</span> + userId; <span class="comment">// Redisé”®ï¼šfeed:ç”¨æˆ·ID</span></span><br><span class="line">    <span class="comment">// 2. ä»RedisæŸ¥è¯¢blogIdåˆ—è¡¨</span></span><br><span class="line">    <span class="comment">// reverseRangeByScoreWithScoresï¼šå€’åºæŸ¥è¯¢Scoreåœ¨[0, max]ä¹‹é—´çš„å…ƒç´ </span></span><br><span class="line">    <span class="comment">// å‚æ•°è¯´æ˜ï¼škey, æœ€å°Score, æœ€å¤§Score, åç§»é‡, æ¯é¡µæ•°é‡</span></span><br><span class="line">    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; result = stringRedisTemplate.opsForZSet()</span><br><span class="line">            .reverseRangeByScoreWithScores(key, <span class="number">0</span>, max, offset, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 3. å¤„ç†ç©ºç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span>(result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;æ— æ–°æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. æå–åšå®¢IDã€è®¡ç®—å½“å‰é¡µçš„minTimeå’Œoffset</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">minTime</span> <span class="operator">=</span> System.currentTimeMillis(); <span class="comment">// åˆå§‹åŒ–ä¸ºå½“å‰æ—¶é—´</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">offset1</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// åˆå§‹åç§»é‡ä¸º1</span></span><br><span class="line">    List&lt;Long&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(result.size());</span><br><span class="line">    <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; tuple : result) &#123;</span><br><span class="line">        <span class="comment">// æå–åšå®¢ID</span></span><br><span class="line">        ids.add(Long.valueOf(Objects.requireNonNull(tuple.getValue())));</span><br><span class="line">        <span class="comment">// æå–Scoreï¼ˆå³åšå®¢åˆ›å»ºæ—¶é—´æˆ³ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> Objects.requireNonNull(tuple.getScore()).longValue();</span><br><span class="line">        <span class="comment">// å¤„ç†ç›¸åŒæ—¶é—´æˆ³çš„æƒ…å†µï¼šè‹¥æ—¶é—´ç­‰äºå½“å‰minTimeï¼Œåç§»é‡+1ï¼›å¦åˆ™æ›´æ–°minTimeå’Œåç§»é‡</span></span><br><span class="line">        <span class="keyword">if</span>(time == minTime) &#123;</span><br><span class="line">            offset1++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            minTime = time;</span><br><span class="line">            offset1 = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5. æŸ¥è¯¢åšå®¢è¯¦æƒ…ï¼ˆæ‰¹é‡æŸ¥è¯¢é¿å…N+1é—®é¢˜ï¼Œæ­¤å¤„ä¸ºç®€åŒ–ç¤ºä¾‹ï¼‰</span></span><br><span class="line">    List&lt;Blog&gt; blogs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(ids.size());</span><br><span class="line">    ids.forEach(id -&gt; &#123;</span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id); <span class="comment">// ä»æ•°æ®åº“æŸ¥è¯¢åšå®¢è¯¦æƒ…</span></span><br><span class="line">        setBlogIsLiked(blog); <span class="comment">// å¤„ç†åšå®¢ç‚¹èµçŠ¶æ€</span></span><br><span class="line">        queryUser(blog); <span class="comment">// å¡«å……åšå®¢ä½œè€…ä¿¡æ¯</span></span><br><span class="line">        blogs.add(blog);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 6. å°è£…æ»šåŠ¨åˆ†é¡µç»“æœ</span></span><br><span class="line">    ScrollResult&lt;Blog&gt; scrollResult = <span class="keyword">new</span> <span class="title class_">ScrollResult</span>&lt;&gt;();</span><br><span class="line">    scrollResult.setList(blogs); <span class="comment">// å½“å‰é¡µåšå®¢åˆ—è¡¨</span></span><br><span class="line">    scrollResult.setMinTime(minTime); <span class="comment">// å½“å‰é¡µæœ€å°æ—¶é—´æˆ³ï¼ˆä¸‹ä¸€é¡µçš„maxå‚æ•°ï¼‰</span></span><br><span class="line">    scrollResult.setOffset(offset1); <span class="comment">// å½“å‰é¡µæœ€å°æ—¶é—´æˆ³å¯¹åº”çš„åç§»é‡</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(scrollResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-å…³é”®ç»†èŠ‚è¯´æ˜"><a href="#3-3-å…³é”®ç»†èŠ‚è¯´æ˜" class="headerlink" title="3.3 å…³é”®ç»†èŠ‚è¯´æ˜"></a>3.3 å…³é”®ç»†èŠ‚è¯´æ˜</h3><div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">**ä¸ºä»€ä¹ˆç”¨reverseRangeByScoreWithScoresï¼Ÿ**å› ä¸ºæˆ‘ä»¬é€šå¸¸éœ€è¦æŒ‰æ—¶é—´å€’åºå±•ç¤ºæ•°æ®ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰ï¼Œè¯¥æ–¹æ³•ä¼šæŒ‰ç…§Scoreä»å¤§åˆ°å°è¿”å›å…ƒç´ ï¼Œæ­£å¥½ç¬¦åˆéœ€æ±‚ã€‚</p></div><div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">**maxå’Œoffsetå‚æ•°çš„ä½œç”¨ï¼Ÿ**- `max`ï¼šä¸Šä¸€é¡µè¿”å›çš„minTimeï¼Œä»£è¡¨ä¸‹ä¸€é¡µæ•°æ®çš„Scoreä¸èƒ½è¶…è¿‡è¿™ä¸ªå€¼ï¼ˆå³æ—¶é—´ä¸èƒ½æ™šäºè¿™ä¸ªå€¼ï¼‰ã€‚- `offset`ï¼šå½“å­˜åœ¨å¤šä¸ªScoreç›¸åŒçš„å…ƒç´ æ—¶ï¼Œç”¨äºè·³è¿‡å‰Nä¸ªå…ƒç´ ï¼Œé¿å…é‡å¤ã€‚</p></div><div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">**å¦‚ä½•å¤„ç†ç›¸åŒæ—¶é—´æˆ³çš„æ•°æ®ï¼Ÿ**å¦‚æœå¤šæ¡åšå®¢çš„åˆ›å»ºæ—¶é—´æˆ³ç›¸åŒï¼ˆScoreç›¸åŒï¼‰ï¼Œä¸‹ä¸€é¡µæŸ¥è¯¢æ—¶éœ€è¦é€šè¿‡offsetè·³è¿‡è¿™äº›é‡å¤çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå½“å‰é¡µæœ‰3æ¡æ•°æ®çš„Scoreéƒ½æ˜¯1620000000ï¼Œé‚£ä¹ˆminTime=1620000000ï¼Œoffset=3ï¼Œä¸‹ä¸€é¡µæŸ¥è¯¢æ—¶ä¼šä»ç¬¬4ä¸ªScore=1620000000çš„å…ƒç´ å¼€å§‹ã€‚</p></div><h2 id="å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹"><a href="#å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹"></a>å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹</h2><h3 id="4-1-ä¼˜åŠ¿"><a href="#4-1-ä¼˜åŠ¿" class="headerlink" title="4.1 ä¼˜åŠ¿"></a>4.1 ä¼˜åŠ¿</h3><ul><li><p><strong>æ— é‡å¤æ— é—æ¼</strong>ï¼šåŸºäºæ—¶é—´æˆ³å®šä½ï¼Œå³ä½¿ä¸­é—´æ’å…¥æ–°æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“ä¸‹ä¸€é¡µçš„æŸ¥è¯¢ç»“æœã€‚</p></li><li><p><strong>é«˜æ€§èƒ½</strong>ï¼šRedisçš„Sorted SetæŸ¥è¯¢æ•ˆç‡é«˜ï¼Œå°¤å…¶é€‚åˆå¤§æ•°æ®é‡åœºæ™¯ï¼Œé¿å…äº†æ•°æ®åº“Limit Offsetçš„å…¨è¡¨æ‰«æé—®é¢˜ã€‚</p></li><li><p><strong>å®æ—¶æ€§å¥½</strong>ï¼šæ•°æ®æ’å…¥Redisåå¯ç«‹å³æŸ¥è¯¢ï¼Œæ— éœ€ç­‰å¾…æ•°æ®åº“åŒæ­¥ã€‚</p></li></ul><h3 id="4-2-æ³¨æ„äº‹é¡¹"><a href="#4-2-æ³¨æ„äº‹é¡¹" class="headerlink" title="4.2 æ³¨æ„äº‹é¡¹"></a>4.2 æ³¨æ„äº‹é¡¹</h3><ul><li><p><strong>Scoreçš„å”¯ä¸€æ€§é—®é¢˜</strong>ï¼šå¦‚æœæ’åºå­—æ®µï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰å­˜åœ¨å¤§é‡é‡å¤ï¼Œéœ€è¦é€šè¿‡offsetæ¥å¤„ç†ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ•°æ®æ¼æŸ¥ã€‚</p></li><li><p><strong>Redisæ•°æ®ä¸€è‡´æ€§</strong>ï¼šéœ€è¦ä¿è¯ä¸šåŠ¡æ•°æ®ï¼ˆå¦‚åšå®¢ï¼‰ä¸Redisä¸­çš„Sorted SetåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œåšå®¢åˆ é™¤æ—¶ï¼Œè¦åŠæ—¶ä»Redisä¸­ç§»é™¤å¯¹åº”çš„å…ƒç´ ã€‚</p></li><li><p><strong>åˆ†é¡µå‚æ•°çš„ä¼ é€’</strong>ï¼šå‰ç«¯éœ€è¦å°†ä¸Šä¸€é¡µè¿”å›çš„minTimeå’Œoffsetä½œä¸ºä¸‹ä¸€é¡µè¯·æ±‚çš„å‚æ•°ï¼Œå› æ­¤éœ€è¦åœ¨æ¥å£è®¾è®¡ä¸­æ˜ç¡®è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p></li></ul><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>ç›¸æ¯”ä¼ ç»Ÿçš„Limit Offsetåˆ†é¡µï¼ŒåŸºäºRedis Sorted Setçš„æ»šåŠ¨åˆ†é¡µåœ¨å®æ—¶æ€§ã€å‡†ç¡®æ€§å’Œé«˜æ€§èƒ½æ–¹é¢éƒ½æœ‰æ˜æ˜¾ä¼˜åŠ¿ï¼Œå°¤å…¶é€‚åˆåŠ¨æ€æ•°æ®ï¼ˆå¦‚å…³æ³¨åŠ¨æ€ã€æ¶ˆæ¯æµï¼‰çš„åˆ†é¡µåœºæ™¯ã€‚å…¶æ ¸å¿ƒæ˜¯åˆ©ç”¨Sorted Setçš„Scoreæœ‰åºæ€§å’ŒèŒƒå›´æŸ¥è¯¢èƒ½åŠ›ï¼Œé€šè¿‡â€œä¸Šä¸€é¡µçš„æœ€å°æ—¶é—´æˆ³+åç§»é‡â€æ¥å®šä½ä¸‹ä¸€é¡µæ•°æ®ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»Ÿåˆ†é¡µçš„é‡å¤å’Œé—æ¼é—®é¢˜ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¼˜åŒ–ç»†èŠ‚ï¼Œä¾‹å¦‚ç»“åˆRedisçš„è¿‡æœŸç­–ç•¥æ¸…ç†å†å²æ•°æ®ã€ä½¿ç”¨ç®¡é“ï¼ˆPipelineï¼‰å‡å°‘Redisäº¤äº’æ¬¡æ•°ç­‰ï¼Œè¿›ä¸€æ­¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆ†é¡µæŸ¥è¯¢æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ã€‚ä¼ ç»Ÿçš„åŸºäºæ•°æ®åº“çš„Limit Offsetåˆ†é¡µæ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†åœ¨æ•°æ®é‡è¾ƒå¤§æˆ–æ•°æ®å®æ—¶å˜åŠ¨ï¼ˆå¦‚æ’å…¥æ–°æ•°æ®ï¼‰çš„åœºæ™¯ä¸‹ï¼Œä¼šå‡ºç°&lt;strong&gt;é‡å¤æ•°æ®&lt;/strong&gt;æˆ–&lt;strong&gt;æ•°æ®é—æ¼&lt;/strong&gt;çš„é—®é¢˜ã€‚æœ¬æ–‡å°†æ¢è®¨å¦‚ä½•åˆ©</summary>
      
    
    
    
    
    <category term="redis" scheme="https://nmcb666.vip/tags/redis/"/>
    
  </entry>
  
</feed>
