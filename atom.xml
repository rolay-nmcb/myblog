<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>çº³æ–¯å¡å¯`Blog</title>
  <icon>https://www.gravatar.com/avatar/feb67af737a34cba9363ed2d415c9ae9</icon>
  <subtitle>ğŸ˜¶â€ğŸŒ«ï¸</subtitle>
  <link href="https://nmcb666.vip/atom.xml" rel="self"/>
  
  <link href="https://nmcb666.vip/"/>
  <updated>2026-01-31T14:36:26.050Z</updated>
  <id>https://nmcb666.vip/</id>
  
  <author>
    <name>çº³æ–¯å¡å¯</name>
    <email>2843035026@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç®—æ³•ï¼ˆåäºŒï¼‰å¹¶æŸ¥é›†</title>
    <link href="https://nmcb666.vip/posts/19844410.html"/>
    <id>https://nmcb666.vip/posts/19844410.html</id>
    <published>2026-01-31T16:05:26.000Z</published>
    <updated>2026-01-31T14:36:26.050Z</updated>
    
    <content type="html"><![CDATA[<div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-31%20172011.png" alt="ç”¨æ³•"/></div><span class="image-caption">ç”¨æ³•</span></div><h2 id="å¹¶æŸ¥é›†æ¨¡æ¿-æ‰å¹³åŒ–-å°æŒ‚å¤§"><a href="#å¹¶æŸ¥é›†æ¨¡æ¿-æ‰å¹³åŒ–-å°æŒ‚å¤§" class="headerlink" title="å¹¶æŸ¥é›†æ¨¡æ¿ æ‰å¹³åŒ–+å°æŒ‚å¤§"></a>å¹¶æŸ¥é›†æ¨¡æ¿ æ‰å¹³åŒ–+å°æŒ‚å¤§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">1000001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] father = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] size = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] stack = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">father[i] = i;</span><br><span class="line">size[i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// iå·èŠ‚ç‚¹ï¼Œå¾€ä¸Šä¸€ç›´æ‰¾ï¼Œæ‰¾åˆ°ä»£è¡¨èŠ‚ç‚¹è¿”å›ï¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line"><span class="comment">// æ²¿é€”æ”¶é›†äº†å‡ ä¸ªç‚¹</span></span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (i != father[i]) &#123;</span><br><span class="line">stack[size++] = i;</span><br><span class="line">i = father[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ²¿é€”èŠ‚ç‚¹æ”¶é›†å¥½äº†ï¼Œiå·²ç»è·³åˆ°ä»£è¡¨èŠ‚ç‚¹äº†</span></span><br><span class="line"><span class="keyword">while</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">father[stack[--size]] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSameSet</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> find(x) == find(y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">fx</span> <span class="operator">=</span> find(x);</span><br><span class="line"><span class="type">int</span> <span class="variable">fy</span> <span class="operator">=</span> find(y);</span><br><span class="line"><span class="keyword">if</span> (fx != fy) &#123;</span><br><span class="line"><span class="comment">// fxæ˜¯é›†åˆçš„ä»£è¡¨ï¼šæ‹¿å¤§å°</span></span><br><span class="line"><span class="comment">// fyæ˜¯é›†åˆçš„ä»£è¡¨ï¼šæ‹¿å¤§å°</span></span><br><span class="line"><span class="keyword">if</span> (size[fx] &gt;= size[fy]) &#123;</span><br><span class="line">size[fx] += size[fy];</span><br><span class="line">father[fy] = fx;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">size[fy] += size[fx];</span><br><span class="line">father[fx] = fy;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ¿2-åªæœ‰æ‰å¹³åŒ–"><a href="#æ¨¡æ¿2-åªæœ‰æ‰å¹³åŒ–" class="headerlink" title="æ¨¡æ¿2 åªæœ‰æ‰å¹³åŒ–"></a>æ¨¡æ¿2 åªæœ‰æ‰å¹³åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">200001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] father = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">father[i] = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i != father[i]) &#123;</span><br><span class="line">father[i] = find(father[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> father[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSameSet</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> find(x) == find(y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">father[find(x)] = find(y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æƒ…ä¾£ç‰µæ‰‹"><a href="#æƒ…ä¾£ç‰µæ‰‹" class="headerlink" title="æƒ…ä¾£ç‰µæ‰‹"></a>æƒ…ä¾£ç‰µæ‰‹</h2><p>leetcode 765</p><p>æ€è·¯ï¼šæŠŠç¼–å·iï¼Œi+1çš„æƒ…ä¾£çœ‹å‡ºç¼–å·ä¸ºi/2çš„æƒ…ä¾£å¯¹.æŒ‰é¡ºåºæ¯æ¬¡è®©ä¸¤ä¸ªäººçš„æƒ…ä¾£ç¼–å·ä¸¤ä¸¤è¿›è¡Œåˆå¹¶ï¼Œå¦‚æœæ˜¯ä¸€å¯¹æƒ…ä¾£ï¼ˆæƒ…ä¾£ç¼–å·ä¸€æ ·ï¼‰é‚£ä¹ˆé›†åˆä¸ªæ•°ä¸ä¼šå˜ï¼Œå¦‚æœä¸æ˜¯æ¯”å¦‚ç¬¬ä¸€ä¸ªäººå±äºç¬¬3å¯¹ï¼Œç¬¬äºŒä¸ªäººå±äºç¬¬5å¯¹ï¼Œé‚£ä¹ˆæŠŠ3ï¼Œ5åˆæˆä¸€ä¸ªé›†åˆã€‚æœ€ååŸå§‹çš„æƒ…ä¾£å¯¹æ•°å‡å»å‰©ä¸‹çš„é›†åˆä¸ªæ•°å°±æ˜¯ç­”æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] father = <span class="keyword">new</span> <span class="title class_">int</span>[MAX];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span> m)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">        father[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i != father[i]) &#123;</span><br><span class="line">        father[i] = find(father[i]); <span class="comment">// è·¯å¾„å‹ç¼©ï¼šé€’å½’æ›´æ–°çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> father[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">fx</span> <span class="operator">=</span> find(x);</span><br><span class="line">    <span class="type">int</span> <span class="variable">fy</span> <span class="operator">=</span> find(y);</span><br><span class="line">    <span class="keyword">if</span>(fx!=fy)&#123;</span><br><span class="line">        father[fx] = fy;</span><br><span class="line">        cnts--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnts;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minSwapsCouples</span><span class="params">(<span class="type">int</span>[] row)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span>row.length;</span><br><span class="line">    cnts = n/<span class="number">2</span>;</span><br><span class="line">    build(n/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        union(row[i]/<span class="number">2</span>,row[i+<span class="number">1</span>]/<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n/<span class="number">2</span> - cnts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›¸ä¼¼å­—ç¬¦ä¸²ç»„"><a href="#ç›¸ä¼¼å­—ç¬¦ä¸²ç»„" class="headerlink" title="ç›¸ä¼¼å­—ç¬¦ä¸²ç»„"></a>ç›¸ä¼¼å­—ç¬¦ä¸²ç»„</h2><p>leetcode 839</p><p>æ€è·¯ï¼šä¸¤å±‚forå¾ªç¯æ¯æ¬¡åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ä¼¼ï¼Œç›¸ä¼¼çš„è¯å°±åˆå¹¶ä¸¤ä¸ªå­—ç¬¦ä¸²çš„é›†åˆã€‚æœ€åè¿”å›é›†åˆä¸ªæ•°å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">301</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] father = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> sets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">father[i] = i;</span><br><span class="line">&#125;</span><br><span class="line">sets = n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i != father[i]) &#123;</span><br><span class="line">father[i] = find(father[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> father[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">fx</span> <span class="operator">=</span> find(x);</span><br><span class="line"><span class="type">int</span> <span class="variable">fy</span> <span class="operator">=</span> find(y);</span><br><span class="line"><span class="keyword">if</span> (fx != fy) &#123;</span><br><span class="line">father[fx] = fy;</span><br><span class="line">sets--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">numSimilarGroups</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> strs.length;</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> strs[<span class="number">0</span>].length();</span><br><span class="line">build(n);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (find(i) != find(j)) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">diff</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; m &amp;&amp; diff &lt; <span class="number">3</span>; k++) &#123;</span><br><span class="line"><span class="keyword">if</span> (strs[i].charAt(k) != strs[j].charAt(k)) &#123;</span><br><span class="line">diff++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (diff == <span class="number">0</span> || diff == <span class="number">2</span>) &#123;</span><br><span class="line">union(i, j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sets;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å²›å±¿æ•°é‡"><a href="#å²›å±¿æ•°é‡" class="headerlink" title="å²›å±¿æ•°é‡"></a>å²›å±¿æ•°é‡</h2><p>leetcode 200</p><p>æ€è·¯ï¼šå…¶å®è¿™é“é¢˜æœ€ä¼˜è§£æ˜¯æ´ªæ°´å¡«å……ï¼Œä½†æ˜¯è¿™é‡Œç”¨å¹¶æŸ¥é›†ä¹Ÿå¯ä»¥åšã€‚æŠŠäºŒç»´ä¸‹æ ‡è½¬ä¸ºä¸€ç»´ç¼–å· i*n+jã€‚ç„¶åä¾æ¬¡éå†ï¼Œå¦‚æœè‡ªå·±æ˜¯1 çš„è¯å°± æŸ¥çœ‹ å³è¾¹ è·Ÿ ä¸‹è¾¹æ˜¯ä¸æ˜¯1ï¼Œå¦‚æœæ˜¯çš„è¯å°±åˆå¹¶ã€‚æœ€åè¿”å›é›†åˆä¸ªæ•°å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">char</span>[][] grid,<span class="type">int</span> m,<span class="type">int</span> n)</span>&#123;</span><br><span class="line">    cnts = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j] == <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                father[i*n+j] = i*n+j;</span><br><span class="line">                cnts++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i != father[i])&#123;</span><br><span class="line">        father[i] = find(father[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> father[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">fx</span> <span class="operator">=</span> find(x);</span><br><span class="line">    <span class="type">int</span> <span class="variable">fy</span> <span class="operator">=</span> find(y);</span><br><span class="line">    <span class="keyword">if</span>(fx!=fy)&#123;</span><br><span class="line">        father[fx] = fy;</span><br><span class="line">        cnts--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numIslands</span><span class="params">(<span class="type">char</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> grid.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> grid[<span class="number">0</span>].length;</span><br><span class="line">    build(grid,m,n);</span><br><span class="line">    <span class="comment">//åˆå¹¶å²›å±¿</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j] == <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                <span class="comment">//åªç”¨åˆå¹¶å³è¾¹è·Ÿä¸‹è¾¹å³å¯</span></span><br><span class="line">                <span class="keyword">if</span>( i!=m-<span class="number">1</span> &amp;&amp; grid[i+<span class="number">1</span>][j] == <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                    union(i*n+j,(i+<span class="number">1</span>)*n+j);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>( j!=n-<span class="number">1</span> &amp;&amp; grid[i][j+<span class="number">1</span>]==<span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                    union(i*n+j,i*n+j+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸“å®¶å¼€ä¼š"><a href="#ä¸“å®¶å¼€ä¼š" class="headerlink" title="ä¸“å®¶å¼€ä¼š"></a>ä¸“å®¶å¼€ä¼š</h2><p>leetcode 2092</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">100001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] father = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="comment">// é›†åˆçš„æ ‡ç­¾ä¿¡æ¯ : è®¾ç½®é›†åˆçš„ä¸€äº›å±æ€§</span></span><br><span class="line"><span class="comment">// å±æ€§åœ¨å“ªï¼Ÿsecret[ä»£è¡¨å…ƒç´ ] ä»£è¡¨é›†åˆçš„å±æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span>[] secret = <span class="keyword">new</span> <span class="title class_">boolean</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> first)</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">father[i] = i;</span><br><span class="line">secret[i] = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">father[first] = <span class="number">0</span>;</span><br><span class="line">secret[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i != father[i]) &#123;</span><br><span class="line">father[i] = find(father[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> father[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">fx</span> <span class="operator">=</span> find(x);</span><br><span class="line"><span class="type">int</span> <span class="variable">fy</span> <span class="operator">=</span> find(y);</span><br><span class="line"><span class="keyword">if</span> (fx != fy) &#123;</span><br><span class="line">father[fx] = fy;</span><br><span class="line">secret[fy] |= secret[fx];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼šè®®æ’åº : m * log m</span></span><br><span class="line"><span class="comment">// å¤„ç†è¿‡ç¨‹ : O(m)</span></span><br><span class="line"><span class="comment">// æ”¶é›†ç­”æ¡ˆ : O(n)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">findAllPeople</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[][] meetings, <span class="type">int</span> first)</span> &#123;</span><br><span class="line">build(n, first);</span><br><span class="line"><span class="comment">// &#123;0 : ä¸“å®¶   1 : ä¸“å®¶ç¼–å·   2 : æ—¶åˆ»&#125;</span></span><br><span class="line">Arrays.sort(meetings, (a, b) -&gt; a[<span class="number">2</span>] - b[<span class="number">2</span>]);</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> meetings.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r; l &lt; m;) &#123;</span><br><span class="line">r = l;</span><br><span class="line"><span class="keyword">while</span> (r + <span class="number">1</span> &lt; m &amp;&amp; meetings[l][<span class="number">2</span>] == meetings[r + <span class="number">1</span>][<span class="number">2</span>]) &#123;</span><br><span class="line">r++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// l....rè¿™äº›ä¼šè®®ï¼Œä¸€å®šæ˜¯ä¸€ä¸ªæ—¶åˆ»</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l; i &lt;= r; i++) &#123;</span><br><span class="line">union(meetings[i][<span class="number">0</span>], meetings[i][<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ‰å°çš„æ’¤é”€è¡Œä¸ºï¼Œä½†è¿™ä¸æ˜¯å¯æ’¤é”€å¹¶æŸ¥é›†</span></span><br><span class="line"><span class="comment">// åªæ˜¯æ¯ä¸€æ‰¹æ²¡æœ‰çŸ¥é“ç§˜å¯†çš„ä¸“å®¶é‡æ–°å»ºç«‹é›†åˆè€Œå·²</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, a, b; i &lt;= r; i++) &#123;</span><br><span class="line">a = meetings[i][<span class="number">0</span>];</span><br><span class="line">b = meetings[i][<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (!secret[find(a)]) &#123;</span><br><span class="line">father[a] = a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!secret[find(b)]) &#123;</span><br><span class="line">father[b] = b;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">l = r + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">List&lt;Integer&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (secret[find(i)]) &#123;</span><br><span class="line">ans.add(i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;img-wrap&quot;&gt;&lt;div class=&quot;img-bg&quot;&gt;&lt;img class=&quot;img&quot; src=&quot;https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>AQSæ˜¯ä»€ä¹ˆï¼Ÿ</title>
    <link href="https://nmcb666.vip/posts/6079905e.html"/>
    <id>https://nmcb666.vip/posts/6079905e.html</id>
    <published>2026-01-31T01:30:22.000Z</published>
    <updated>2026-01-31T14:36:26.047Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ã€Javaå¹¶å‘ã€‘AQSè¯¦è§£ï¼šJUCåŒ…èƒŒåçš„â€œå¹•åå¤§ä½¬â€"><a href="#ã€Javaå¹¶å‘ã€‘AQSè¯¦è§£ï¼šJUCåŒ…èƒŒåçš„â€œå¹•åå¤§ä½¬â€" class="headerlink" title="ã€Javaå¹¶å‘ã€‘AQSè¯¦è§£ï¼šJUCåŒ…èƒŒåçš„â€œå¹•åå¤§ä½¬â€"></a>ã€Javaå¹¶å‘ã€‘AQSè¯¦è§£ï¼šJUCåŒ…èƒŒåçš„â€œå¹•åå¤§ä½¬â€</h1><p>åœ¨ Java å¹¶å‘ç¼–ç¨‹ï¼ˆJUCï¼‰çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ <code>ReentrantLock</code>ã€<code>CountDownLatch</code>ã€<code>Semaphore</code> è¿™äº›èµ«èµ«æœ‰åçš„å·¥å…·ç±»ã€‚</p><p>ä½†ä½ æ˜¯å¦æƒ³è¿‡ï¼Œè¿™äº›åŠŸèƒ½å„å¼‚çš„å·¥å…·èƒŒåï¼Œå…¶å®å…±ç”¨ç€åŒä¸€å¥—â€œåº•ç›˜â€ï¼Ÿ</p><p>è¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦èŠçš„ä¸»è§’â€”â€”<strong>AQS (AbstractQueuedSynchronizerï¼ŒæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨)</strong>ã€‚å®ƒæ˜¯ JUC åŒ…çš„å¿ƒè„ï¼ŒæŒæ¡äº†å®ƒï¼Œä½ å°±æŒæ¡äº† Java å¹¶å‘çš„åŠå£æ±Ÿå±±ã€‚</p><h2 id="ä¸€ã€-ä»€ä¹ˆæ˜¯-AQSï¼Ÿ"><a href="#ä¸€ã€-ä»€ä¹ˆæ˜¯-AQSï¼Ÿ" class="headerlink" title="ä¸€ã€ ä»€ä¹ˆæ˜¯ AQSï¼Ÿ"></a>ä¸€ã€ ä»€ä¹ˆæ˜¯ AQSï¼Ÿ</h2><p><strong>AQS æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶ã€‚</strong></p><p>å¦‚æœæŠŠ <code>ReentrantLock</code>ã€<code>CountDownLatch</code> ç­‰æ¯”ä½œæ˜¯<strong>æˆå“çš„æ±½è½¦</strong>ï¼ˆè·‘è½¦ã€å¡è½¦ã€å…¬äº¤è½¦ï¼‰ï¼Œé‚£ä¹ˆ AQS å°±æ˜¯é€šç”¨çš„<strong>æ±½è½¦åº•ç›˜å’Œå¼•æ“</strong>ã€‚</p><ul><li><strong>AQS è´Ÿè´£è„æ´»ç´¯æ´»</strong>ï¼šå®ƒå¤„ç†äº†çº¿ç¨‹çš„æ’é˜Ÿã€é˜»å¡ã€å”¤é†’ã€çº¿ç¨‹å®‰å…¨ç­‰æœ€å¤æ‚çš„åº•å±‚é€»è¾‘ã€‚</li><li><strong>åŒæ­¥å™¨è´Ÿè´£ä¸šåŠ¡é€»è¾‘</strong>ï¼šå…·ä½“çš„å·¥å…·ç±»åªéœ€è¦å‘Šè¯‰ AQSï¼Œâ€œä»€ä¹ˆæ—¶å€™ç®—è·å–é”æˆåŠŸâ€ï¼Œâ€œèµ„æºä¸€å…±æœ‰å¤šå°‘â€ï¼Œå‰©ä¸‹çš„äº¤ç»™ AQS å³å¯ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œ<strong>AQS æ˜¯ä¸€ä¸ªâ€œåŸææ–™â€ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®ƒåŠ å·¥å‡ºå„ç§å„æ ·çš„åŒæ­¥å™¨ã€‚</strong></p><h2 id="äºŒã€-AQS-çš„æ ¸å¿ƒæ¶æ„"><a href="#äºŒã€-AQS-çš„æ ¸å¿ƒæ¶æ„" class="headerlink" title="äºŒã€ AQS çš„æ ¸å¿ƒæ¶æ„"></a>äºŒã€ AQS çš„æ ¸å¿ƒæ¶æ„</h2><p>AQS çš„å†…éƒ¨å¹¶æ²¡æœ‰å¤šä¹ˆç¥ç§˜ï¼Œå®ƒçš„æ ¸å¿ƒé€»è¾‘ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><h3 id="1-æ ¸å¿ƒèµ„æºï¼šState-volatile-int"><a href="#1-æ ¸å¿ƒèµ„æºï¼šState-volatile-int" class="headerlink" title="1. æ ¸å¿ƒèµ„æºï¼šState (volatile int)"></a>1. æ ¸å¿ƒèµ„æºï¼šState (volatile int)</h3><p>AQS å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª <code>state</code> å˜é‡ï¼Œç”¨æ¥è¡¨ç¤º<strong>â€œåŒæ­¥çŠ¶æ€â€</strong>ã€‚</p><ul><li>è¿™æ˜¯ä¸€ä¸ª <code>volatile</code> ä¿®é¥°çš„ <code>int</code> å˜é‡ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¸‹çš„å¯è§æ€§ã€‚</li><li>AQS æä¾›äº† CAS (Compare And Swap) æ–¹æ³•æ¥åŸå­æ€§åœ°ä¿®æ”¹è¿™ä¸ªå€¼ã€‚</li></ul><p><strong>è¿™ä¸ª state å…·ä½“ä»£è¡¨ä»€ä¹ˆï¼ŸAQS ä¸å…³å¿ƒï¼Œç”±å­ç±»å®šä¹‰ï¼š</strong></p><ul><li>åœ¨ <strong>ReentrantLock</strong> ä¸­ï¼Œ<code>state=0</code> ä»£è¡¨æ²¡é”ï¼Œ<code>state=1</code> ä»£è¡¨ä¸Šé”ã€‚</li><li>åœ¨ <strong>CountDownLatch</strong> ä¸­ï¼Œ<code>state</code> ä»£è¡¨å€’è®¡æ—¶çš„æ•°å€¼ã€‚</li><li>åœ¨ <strong>Semaphore</strong> ä¸­ï¼Œ<code>state</code> ä»£è¡¨å‰©ä½™çš„è®¸å¯è¯æ•°é‡ã€‚</li></ul><h3 id="2-ç­‰å¾…é˜Ÿåˆ—ï¼šCLH-é˜Ÿåˆ—"><a href="#2-ç­‰å¾…é˜Ÿåˆ—ï¼šCLH-é˜Ÿåˆ—" class="headerlink" title="2. ç­‰å¾…é˜Ÿåˆ—ï¼šCLH é˜Ÿåˆ—"></a>2. ç­‰å¾…é˜Ÿåˆ—ï¼šCLH é˜Ÿåˆ—</h3><p>å¦‚æœæœ‰çº¿ç¨‹æƒ³æŠ¢èµ„æºï¼ˆä¿®æ”¹ stateï¼‰å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿæ€»ä¸èƒ½è®©å®ƒä¸€ç›´æ­»å¾ªç¯ç©ºè½¬ï¼ˆè‡ªæ—‹ï¼‰å§ï¼Ÿ</p><p>AQS ä¼šæŠŠè¿™äº›ç«äº‰å¤±è´¥çš„çº¿ç¨‹åŒ…è£…æˆä¸€ä¸ª <strong>Node èŠ‚ç‚¹</strong>ï¼ŒåŠ å…¥åˆ°ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼ˆCLHé˜Ÿåˆ—ï¼‰çš„å°¾éƒ¨ï¼Œå¹¶å°†çº¿ç¨‹<strong>é˜»å¡</strong>ï¼ˆParkï¼‰ã€‚ç­‰å¾…æŒæœ‰èµ„æºçš„çº¿ç¨‹é‡Šæ”¾åï¼Œå†å”¤é†’é˜Ÿåˆ—å¤´éƒ¨çš„çº¿ç¨‹ã€‚</p><h3 id="3-é˜»å¡ä¸å”¤é†’å·¥å…·"><a href="#3-é˜»å¡ä¸å”¤é†’å·¥å…·" class="headerlink" title="3. é˜»å¡ä¸å”¤é†’å·¥å…·"></a>3. é˜»å¡ä¸å”¤é†’å·¥å…·</h3><p>AQS åº•å±‚åˆ©ç”¨ <code>LockSupport</code> ç±»ä¸­çš„ <code>park()</code> å’Œ <code>unpark()</code> æ–¹æ³•ï¼ŒçœŸæ­£å®ç°äº†æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹æŒ‚èµ·å’Œå”¤é†’ã€‚</p><hr><h2 id="ä¸‰ã€-AQS-æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿï¼ˆä»¥æŠ¢é”ä¸ºä¾‹ï¼‰"><a href="#ä¸‰ã€-AQS-æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿï¼ˆä»¥æŠ¢é”ä¸ºä¾‹ï¼‰" class="headerlink" title="ä¸‰ã€ AQS æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿï¼ˆä»¥æŠ¢é”ä¸ºä¾‹ï¼‰"></a>ä¸‰ã€ AQS æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿï¼ˆä»¥æŠ¢é”ä¸ºä¾‹ï¼‰</h2><p>æˆ‘ä»¬å¯ä»¥æŠŠ AQS çš„å·¥ä½œæµç¨‹æƒ³è±¡æˆ<strong>â€œå»é“¶è¡ŒæŸœå°åŠç†ä¸šåŠ¡â€</strong>ï¼š</p><ol><li><strong>å°è¯•è·å– (TryAcquire)</strong>ï¼š<ul><li>çº¿ç¨‹ A æ¥äº†ï¼Œçœ‹åˆ°æŸœå°çª—å£ï¼ˆStateï¼‰æ˜¯ç©ºçš„ï¼ˆ0ï¼‰ï¼Œç«‹é©¬åä¸‹åŠç†ï¼ŒæŠŠçª—å£çŠ¶æ€æ”¹ä¸ºâ€œå¿™ç¢Œâ€ï¼ˆ1ï¼‰ã€‚</li></ul></li><li><strong>å…¥é˜Ÿ (Enqueue)</strong>ï¼š<ul><li>çº¿ç¨‹ B æ¥äº†ï¼Œå‘ç°çª—å£çŠ¶æ€æ˜¯â€œå¿™ç¢Œâ€ï¼ˆ1ï¼‰ã€‚</li><li>AQS è¿™ä½å¤§å ‚ç»ç†å°±ä¼šæŠŠçº¿ç¨‹ B é¢†åˆ°æ—è¾¹çš„<strong>ç­‰å¾…åŒºï¼ˆCLH é˜Ÿåˆ—ï¼‰</strong>ï¼Œè®©å®ƒæ’åœ¨é˜Ÿä¼åé¢ï¼Œå¹¶å‘Šè¯‰å®ƒï¼šâ€œä½ å…ˆç¡ä¼šå„¿ï¼ˆBlockï¼‰ï¼Œè½®åˆ°ä½ äº†å«ä½ â€ã€‚</li></ul></li><li><strong>é‡Šæ”¾ä¸å”¤é†’ (Release &amp; Unpark)</strong>ï¼š<ul><li>çº¿ç¨‹ A åŠå®Œä¸šåŠ¡äº†ï¼Œç¦»å¼€æŸœå°ï¼ŒæŠŠçª—å£çŠ¶æ€æ”¹å›â€œç©ºé—²â€ï¼ˆ0ï¼‰ã€‚</li><li>AQS å¤§å ‚ç»ç†å‘ç°çª—å£ç©ºäº†ï¼Œå°±å»ç­‰å¾…åŒºå«é†’æ’åœ¨æœ€å‰é¢çš„çº¿ç¨‹ Bï¼šâ€œé†’é†’ï¼Œè½®åˆ°ä½ äº†â€ã€‚</li><li>çº¿ç¨‹ B é†’æ¥ï¼Œé«˜é«˜å…´å…´å»æŸœå°åŠç†ä¸šåŠ¡ã€‚</li></ul></li></ol><hr><h2 id="å››ã€-AQS-çš„è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#å››ã€-AQS-çš„è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="å››ã€ AQS çš„è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>å››ã€ AQS çš„è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>AQS ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œæ˜¯å› ä¸ºå®ƒä½¿ç”¨äº†<strong>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</strong>ã€‚</p><p>AQS æŠŠâ€œæ’é˜Ÿâ€ã€â€œé˜»å¡â€ã€â€œå”¤é†’â€è¿™äº›é€šç”¨çš„é€»è¾‘éƒ½å†™æ­»äº†ï¼ˆ<code>acquire</code>ã€<code>release</code> æ–¹æ³•ï¼‰ã€‚ä½†æ˜¯ï¼Œ<strong>â€œå¦‚ä½•åˆ¤æ–­èµ„æºæ˜¯å¦è¶³å¤Ÿâ€</strong>ã€<strong>â€œå¦‚ä½•ä¿®æ”¹ stateâ€</strong> è¿™äº›é€»è¾‘æ˜¯ç•™ç»™å­ç±»å»å®ç°çš„ã€‚</p><p><strong>ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è‡ªå®šä¹‰ä¸€ä¸ªé”ï¼Œåªéœ€è¦ç»§æ‰¿ AQS å¹¶é‡å†™ä»¥ä¸‹å‡ ä¸ªâ€œé’©å­æ–¹æ³•â€ï¼š</strong></p><ul><li><code>tryAcquire(int)</code>: ç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</li><li><code>tryRelease(int)</code>: ç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºã€‚</li><li><code>tryAcquireShared(int)</code>: å…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚</li><li><code>tryReleaseShared(int)</code>: å…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºã€‚</li><li><code>isHeldExclusively()</code>: è¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚</li></ul><h2 id="äº”ã€-AQS-çš„â€œæˆå“â€å±•ç¤º"><a href="#äº”ã€-AQS-çš„â€œæˆå“â€å±•ç¤º" class="headerlink" title="äº”ã€ AQS çš„â€œæˆå“â€å±•ç¤º"></a>äº”ã€ AQS çš„â€œæˆå“â€å±•ç¤º</h2><p>è®©æˆ‘ä»¬çœ‹çœ‹ Java å¤§ä½¬ä»¬æ˜¯å¦‚ä½•åˆ©ç”¨ AQS è¿™ä¸ªâ€œåŸææ–™â€åŠ å·¥å‡ºè‘—åå·¥å…·ç±»çš„ï¼š</p><h3 id="1-ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰"><a href="#1-ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰" class="headerlink" title="1. ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰"></a>1. ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰</h3><ul><li><strong>æ¨¡å¼</strong>ï¼šç‹¬å æ¨¡å¼ã€‚</li><li><strong>åŠ å·¥é€»è¾‘</strong>ï¼š<ul><li><code>state</code> åˆå§‹åŒ–ä¸º 0ã€‚</li><li>çº¿ç¨‹ A æŠ¢é”ï¼Œé€šè¿‡ CAS æŠŠ <code>state</code> å˜æˆ 1ã€‚</li><li>å¦‚æœæ˜¯åŒä¸€ä¸ªçº¿ç¨‹ A å†æ¬¡æŠ¢é”ï¼ˆé‡å…¥ï¼‰ï¼Œå°±æŠŠ <code>state</code> åŠ  1ï¼ˆå˜æˆ 2, 3â€¦ï¼‰ã€‚</li><li>é‡Šæ”¾é”æ—¶ï¼Œ<code>state</code> å‡ 1ï¼Œç›´åˆ°å‡ä¸º 0 æ—¶æ‰çœŸæ­£é‡Šæ”¾ã€‚</li></ul></li></ul><h3 id="2-CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰"><a href="#2-CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰" class="headerlink" title="2. CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰"></a>2. CountDownLatchï¼ˆå€’è®¡æ—¶å™¨ï¼‰</h3><ul><li><strong>æ¨¡å¼</strong>ï¼šå…±äº«æ¨¡å¼ã€‚</li><li><strong>åŠ å·¥é€»è¾‘</strong>ï¼š<ul><li><code>state</code> åˆå§‹åŒ–ä¸º Nï¼ˆæ¯”å¦‚ 5ï¼‰ã€‚</li><li>ä¸»çº¿ç¨‹è°ƒç”¨ <code>await()</code>ï¼Œå¦‚æœ <code>state &gt; 0</code>ï¼Œå°±è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚</li><li>å…¶ä»–çº¿ç¨‹è°ƒç”¨ <code>countDown()</code>ï¼Œé€šè¿‡ CAS æŠŠ <code>state</code> å‡ 1ã€‚</li><li>å½“ <code>state</code> å‡åˆ° 0 æ—¶ï¼ŒAQS å”¤é†’é˜Ÿåˆ—é‡Œæ‰€æœ‰ç­‰å¾…çš„ä¸»çº¿ç¨‹ã€‚</li></ul></li></ul><h3 id="3-Semaphoreï¼ˆä¿¡å·é‡ï¼‰"><a href="#3-Semaphoreï¼ˆä¿¡å·é‡ï¼‰" class="headerlink" title="3. Semaphoreï¼ˆä¿¡å·é‡ï¼‰"></a>3. Semaphoreï¼ˆä¿¡å·é‡ï¼‰</h3><ul><li><strong>æ¨¡å¼</strong>ï¼šå…±äº«æ¨¡å¼ã€‚</li><li><strong>åŠ å·¥é€»è¾‘</strong>ï¼š<ul><li><code>state</code> åˆå§‹åŒ–ä¸ºè®¸å¯è¯æ•°é‡ï¼ˆæ¯”å¦‚ 3ï¼‰ã€‚</li><li>çº¿ç¨‹æ¥è·å–è®¸å¯ï¼Œ<code>state</code> å‡ 1ã€‚</li><li>å¦‚æœ <code>state</code> å˜ä¸ºè´Ÿæ•°æˆ–è€…ä¸è¶³ï¼Œçº¿ç¨‹è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ã€‚</li><li>é‡Šæ”¾è®¸å¯æ—¶ï¼Œ<code>state</code> åŠ  1ã€‚</li></ul></li></ul><hr><h2 id="å…­ã€-æ€»ç»“"><a href="#å…­ã€-æ€»ç»“" class="headerlink" title="å…­ã€ æ€»ç»“"></a>å…­ã€ æ€»ç»“</h2><p>AQS æ˜¯ Java å¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ã€‚</p><ul><li><strong>å®è§‚ä¸Š</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œé€šè¿‡<strong>Stateï¼ˆèµ„æºçŠ¶æ€ï¼‰</strong>å’Œ<strong>CLH Queueï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰</strong>æ¥ç®¡ç†çº¿ç¨‹çš„åŒæ­¥ã€‚</li><li><strong>è®¾è®¡ä¸Š</strong>ï¼šå®ƒé‡‡ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå°†å¤æ‚çš„é˜Ÿåˆ—ç®¡ç†å°è£…èµ·æ¥ï¼Œåªæš´éœ²ç®€å•çš„çŠ¶æ€ä¿®æ”¹æ¥å£ç»™å­ç±»ã€‚</li><li><strong>åº”ç”¨ä¸Š</strong>ï¼šå®ƒæ˜¯ <code>ReentrantLock</code>ã€<code>Semaphore</code>ã€<code>CountDownLatch</code> ç­‰å·¥å…·ç±»çš„çˆ¶ç±»ï¼ˆçš„å†…éƒ¨å®ç°ï¼‰ã€‚</li></ul><p>ç†è§£äº† AQSï¼Œä½ å°±ç†è§£äº† Java é”æœºåˆ¶çš„çµé­‚ã€‚ä¸‹æ¬¡é¢è¯•å®˜é—®ä½ ï¼šâ€œReentrantLock æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿâ€ä½ å°±å¯ä»¥è‡ªä¿¡åœ°ä» AQS çš„ <code>state</code> å’Œé˜Ÿåˆ—è®²èµ·äº†ï¼</p><p>AQSçš„å…·ä½“åŸç†å¯ä»¥å‚è€ƒï¼š <a href="https://javaguide.cn/java/concurrent/aqs.html">https://javaguide.cn/java/concurrent/aqs.html</a></p><hr><p><em>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ å½»åº•ææ‡‚ AQSï¼å¦‚æœæœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ã€‚</em></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ã€Javaå¹¶å‘ã€‘AQSè¯¦è§£ï¼šJUCåŒ…èƒŒåçš„â€œå¹•åå¤§ä½¬â€&quot;&gt;&lt;a href=&quot;#ã€Javaå¹¶å‘ã€‘AQSè¯¦è§£ï¼šJUCåŒ…èƒŒåçš„â€œå¹•åå¤§ä½¬â€&quot; class=&quot;headerlink&quot; title=&quot;ã€Javaå¹¶å‘ã€‘AQSè¯¦è§£ï¼šJUCåŒ…èƒŒåçš„â€œå¹•åå¤§ä½¬â€&quot;&gt;&lt;/a&gt;ã€Java</summary>
      
    
    
    
    
    <category term="å…«è‚¡" scheme="https://nmcb666.vip/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆåä¸€ï¼‰ å•è°ƒé˜Ÿåˆ—</title>
    <link href="https://nmcb666.vip/posts/435449ef.html"/>
    <id>https://nmcb666.vip/posts/435449ef.html</id>
    <published>2026-01-30T16:41:51.000Z</published>
    <updated>2026-01-31T14:36:26.050Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç»å…¸ç”¨æ³•"><a href="#ç»å…¸ç”¨æ³•" class="headerlink" title="ç»å…¸ç”¨æ³•"></a>ç»å…¸ç”¨æ³•</h1><p>é…åˆæ»‘åŠ¨çª—å£ï¼Œå¯ä»¥å¿«é€Ÿå¾—åˆ°æ»‘åŠ¨çª—å£å†…çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ã€‚å¦‚æœè¦æœ€å¤§å€¼ï¼Œé‚£ç»´æŠ¤ä¸€ä¸ªå¤§åˆ°å°é˜Ÿåˆ—ï¼ˆå­˜çš„æ˜¯ä¸‹æ ‡ï¼‰ï¼Œå¦‚æœè¦æœ€å°å€¼ï¼Œé‚£ç»´æŠ¤ä¸€ä¸ªå°åˆ°å¤§çš„é˜Ÿåˆ—ã€‚</p><p>æ‹¿æœ€å¤§å€¼ä¸¾ä¾‹ï¼š</p><p>æ‰©å¤§çª—å£çš„æ—¶å€™ï¼Œåˆ¤æ–­æ–°åŠ å…¥çš„å…ƒç´ è·Ÿé˜Ÿå°¾å…ƒç´ çš„å¤§å°ï¼Œåªè¦é˜Ÿå°¾å…ƒç´ å°äºç­‰äºæ–°å€¼ï¼Œåˆ™é˜Ÿå°¾å…ƒç´ å‡ºé˜Ÿï¼Œç›´åˆ°é˜Ÿå°¾å…ƒç´ å¤§äºæ–°å€¼æˆ–è€…é˜Ÿåˆ—ä¸ºç©ºã€‚ç„¶åè¿™ä¸ªæ–°å€¼çš„ä¸‹æ ‡ä»é˜Ÿå°¾å…¥é˜Ÿ</p><p>ç¼©å°çª—å£æ—¶ï¼Œåˆ¤æ–­è¿™ä¸ªè¦å‡ºå»çš„å…ƒç´ ä¸‹æ ‡è·Ÿå•è°ƒé˜Ÿåˆ—é˜Ÿå¤´çš„ä¸‹æ ‡æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™é˜Ÿå¤´å…ƒç´ å‡ºé˜Ÿã€‚l++.å¦åˆ™å°±ä¸ç§»é™¤é˜Ÿå¤´ã€‚</p><p>å¦‚æœè¦æœ€å¤§å€¼ï¼Œå°±æ˜¯æ•°ç»„çš„é˜Ÿå¤´å…ƒç´ ä½ç½®çš„å€¼ã€‚ nums[deque[l]]</p><h2 id="æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a>æ»‘åŠ¨çª—å£æœ€å¤§å€¼</h2><p>leetcode 239</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] arr, <span class="type">int</span> k) &#123;</span><br><span class="line">h = t = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line"><span class="comment">// å…ˆå½¢æˆé•¿åº¦ä¸ºk-1çš„çª—å£</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k - <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="comment">// å¤§ -&gt; å°</span></span><br><span class="line"><span class="keyword">while</span> (h &lt; t &amp;&amp; arr[deque[t - <span class="number">1</span>]] &lt;= arr[i]) &#123;</span><br><span class="line">t--;</span><br><span class="line">&#125;</span><br><span class="line">deque[t++] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> n - k + <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line"><span class="comment">// å½“å‰çª—å£k-1é•¿åº¦</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = k - <span class="number">1</span>; l &lt; m; l++, r++) &#123;</span><br><span class="line"><span class="comment">// å°‘ä¸€ä¸ªï¼Œè¦è®©rä½ç½®çš„æ•°è¿›æ¥</span></span><br><span class="line"><span class="keyword">while</span> (h &lt; t &amp;&amp; arr[deque[t - <span class="number">1</span>]] &lt;= arr[r]) &#123;</span><br><span class="line">t--;</span><br><span class="line">&#125;</span><br><span class="line">deque[t++] = r;</span><br><span class="line"><span class="comment">// æ”¶é›†ç­”æ¡ˆ</span></span><br><span class="line">ans[l] = arr[deque[h]];</span><br><span class="line"><span class="comment">// lä½ç½®çš„æ•°å‡ºå»</span></span><br><span class="line"><span class="keyword">if</span> (deque[h] == l) &#123;</span><br><span class="line">h++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­æ•°ç»„"><a href="#ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­æ•°ç»„" class="headerlink" title="ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­æ•°ç»„"></a>ç»å¯¹å·®ä¸è¶…è¿‡é™åˆ¶çš„æœ€é•¿è¿ç»­æ•°ç»„</h2><p>leetcode 1438</p><p>æ€è·¯ï¼šåˆ©ç”¨ä¸¤ä¸ªå•è°ƒé˜Ÿåˆ—ï¼Œä¸€ä¸ªè®°å½•çª—å£çš„æœ€å°å€¼ï¼Œä¸€ä¸ªè®°å½•çª—å£çš„æœ€å¤§å€¼ã€‚çª—å£å¼€å§‹æ»‘åŠ¨ï¼Œæ¯æ–°åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå°±ç»´æŠ¤é˜Ÿåˆ—ã€‚ç„¶åä¸€ç›´ç¼©çª—å£ç›´åˆ°çª—å£å†…æœ€å¤§å€¼å’Œæœ€å°å€¼ä¹‹å·®å°äºç­‰äºlimitã€‚ä¹‹åè®°å½•ç­”æ¡ˆï¼Œj-i+1ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestSubarray</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">    l = <span class="number">0</span>;</span><br><span class="line">    r = <span class="number">0</span>;</span><br><span class="line">    l2 = <span class="number">0</span>;</span><br><span class="line">    r2 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> , j = <span class="number">0</span>;j &lt; n; j++)&#123;</span><br><span class="line">        <span class="comment">//è¿›é˜Ÿ</span></span><br><span class="line">        <span class="keyword">while</span>( r &gt; l &amp;&amp; nums[queue[r-<span class="number">1</span>]] &lt;= nums[j])&#123;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        queue[r++] = j;</span><br><span class="line">        <span class="keyword">while</span>( r2 &gt; l2 &amp;&amp; nums[queue2[r2-<span class="number">1</span>]] &gt;= nums[j])&#123;</span><br><span class="line">            r2--;</span><br><span class="line">        &#125;</span><br><span class="line">        queue2[r2++] = j;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>( nums[queue[l]] - nums[queue2[l2]] &gt; limit )&#123;</span><br><span class="line">            <span class="keyword">if</span>(queue[l] == i)&#123;</span><br><span class="line">                l++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(queue2[l2] == i)&#123;</span><br><span class="line">                l2++;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = Math.max(j - i + <span class="number">1</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="éç»å…¸ç”¨æ³•"><a href="#éç»å…¸ç”¨æ³•" class="headerlink" title="éç»å…¸ç”¨æ³•"></a>éç»å…¸ç”¨æ³•</h1><h2 id="å’Œè‡³å°‘ä¸ºKçš„æœ€çŸ­å­æ•°ç»„"><a href="#å’Œè‡³å°‘ä¸ºKçš„æœ€çŸ­å­æ•°ç»„" class="headerlink" title="å’Œè‡³å°‘ä¸ºKçš„æœ€çŸ­å­æ•°ç»„"></a>å’Œè‡³å°‘ä¸ºKçš„æœ€çŸ­å­æ•°ç»„</h2><p>leetcode 862</p><p>æ€è·¯ï¼šè®¡ç®—ä»¥æ¯ä¸ªä½ç½®ç»“å°¾çš„æœ€å°é•¿åº¦ã€‚è¿™é‡Œæœ€å…³é”®çš„æ˜¯å¦‚æœå·²ç»ç®—å‡ºä¸€ä¸ªç­”æ¡ˆçš„æ—¶å€™ï¼Œä½ çš„çª—å£å³æ‰©ï¼Œä½ æƒ³æ‰¾åˆ°æ›´çŸ­çš„å°±åªèƒ½å·¦ç¼©çª—å£æ‰è¡Œï¼ˆä¸ç”¨ä»å¤´å¼€å§‹ç¼©ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortestSubarray</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    l=<span class="number">0</span>;</span><br><span class="line">    r=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="comment">// å‰ç¼€å’Œ</span></span><br><span class="line">    <span class="type">long</span>[] prefix = <span class="keyword">new</span> <span class="title class_">long</span>[n + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        prefix[i + <span class="number">1</span>] = prefix[i] + nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä»¥ä¸€ä¸ªä½ç½®ç»“å°¾ï¼Œå‘å‰é¢èµ°å¤šè¿œèƒ½è¾¾æ ‡</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>,j=<span class="number">0</span>;j&lt;=n;j++)&#123;</span><br><span class="line">        <span class="comment">//åŠ å…¥çª—å£</span></span><br><span class="line">        <span class="keyword">while</span>( l&lt;r &amp;&amp; prefix[queue[r-<span class="number">1</span>]] &gt;= prefix[j])&#123;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        queue[r++] = j;</span><br><span class="line">        <span class="comment">//çœ‹å½“å‰æ˜¯å¦æ»¡è¶³</span></span><br><span class="line">        <span class="keyword">if</span>(prefix[j] - prefix[queue[l]] &gt;= k)&#123;</span><br><span class="line">            <span class="comment">//ç¼©å°çª—å£ï¼Œç›´åˆ°ä¸è¡Œ</span></span><br><span class="line">            <span class="keyword">while</span> (prefix[j] - prefix[queue[l]] &gt;= k)&#123;</span><br><span class="line">                <span class="comment">//å·¦è¾¹ç¼©å°</span></span><br><span class="line">                <span class="keyword">if</span>(queue[l] == i)&#123;</span><br><span class="line">                    l++;</span><br><span class="line">                &#125;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// iå‰é¢é‚£ä¸ªä½ç½®å°±æ˜¯è‡³å°‘çš„ä½ç½®</span></span><br><span class="line">            ans = Math.min(ans,j-i+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans == Integer.MAX_VALUE ? -<span class="number">1</span> : ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ»¡è¶³ä¸ç­‰å¼çš„æœ€å¤§å€¼"><a href="#æ»¡è¶³ä¸ç­‰å¼çš„æœ€å¤§å€¼" class="headerlink" title="æ»¡è¶³ä¸ç­‰å¼çš„æœ€å¤§å€¼"></a>æ»¡è¶³ä¸ç­‰å¼çš„æœ€å¤§å€¼</h2><p>leetcode 1499</p><p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ points å’Œä¸€ä¸ªæ•´æ•° k ã€‚æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½è¡¨ç¤ºäºŒç»´å¹³é¢ä¸Šçš„ç‚¹çš„åæ ‡ï¼Œå¹¶æŒ‰ç…§æ¨ªåæ ‡ x çš„å€¼ä»å°åˆ°å¤§æ’åºã€‚ä¹Ÿå°±æ˜¯è¯´ points[i] = [xi, yi] ï¼Œå¹¶ä¸”åœ¨ 1 &lt;= i &lt; j &lt;= points.length çš„å‰æä¸‹ï¼Œ xi &lt; xj æ€»æˆç«‹ã€‚</p><p>è¯·ä½ æ‰¾å‡º yi + yj + |xi - xj| çš„ æœ€å¤§å€¼ï¼Œå…¶ä¸­ |xi - xj| &lt;= k ä¸” 1 &lt;= i &lt; j &lt;= points.lengthã€‚</p><p>é¢˜ç›®æµ‹è¯•æ•°æ®ä¿è¯è‡³å°‘å­˜åœ¨ä¸€å¯¹èƒ½å¤Ÿæ»¡è¶³ |xi - xj| &lt;= k çš„ç‚¹ã€‚</p><p>æ€è·¯ï¼šè¿˜æ˜¯ä»¥æ¯ä¸ªç‚¹ä¸ºç»“å°¾ã€‚çª—å£å·¦è¾¹ä»0ä¸‹æ ‡å¼€å§‹ï¼Œåˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•å°±å·¦ç¼©çª—å£ï¼Œç›´åˆ°åˆæ³•ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€ç›´è®°å½•çª—å£å†…ç‚¹çš„y-xçš„æœ€å¤§å€¼ã€‚åˆæ³•ä¹‹åï¼Œç”¨ç»“å°¾çš„ç‚¹åŠ ä¸Šè¿™ä¸ªçª—å£å†…çš„æœ€å¤§å€¼å°±æ˜¯è¿™ä¸ªç‚¹çš„å¯¹åº”çš„æœ€å¤§å€¼ï¼Œç„¶åæŠŠè¿™ä¸ªç‚¹ä¹ŸåŠ å…¥çª—å£ï¼Œå¹¶ä¸”æ›´æ–°å•è°ƒé˜Ÿåˆ—ï¼Œå•è°ƒé˜Ÿåˆ—ä»¥y-xä¸ºå•è°ƒé€’å‡ã€‚å³å¤´éƒ¨ä¸ºy-xæœ€å¤§çš„ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMaxValueOfEquation</span><span class="params">(<span class="type">int</span>[][] points, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span>points.length;</span><br><span class="line">    r=<span class="number">0</span>;</span><br><span class="line">    l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">    <span class="comment">//æŠŠç¬¬ä¸€ä¸ªç‚¹æ”¾è¿›å»</span></span><br><span class="line">    queue[r++] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>,j=<span class="number">1</span>;j&lt;n;j++)&#123;</span><br><span class="line">        <span class="comment">//ç¼©å°çª—å£åˆ°åˆæ³•</span></span><br><span class="line">        <span class="keyword">while</span>( j&gt;i &amp;&amp; points[j][<span class="number">0</span>] - points[i][<span class="number">0</span>] &gt;k)&#123;</span><br><span class="line">            <span class="keyword">if</span>(queue[l] == i)&#123;</span><br><span class="line">                l++;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¾—åˆ°ç­”æ¡ˆ</span></span><br><span class="line">        <span class="keyword">if</span>(i!=j)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">best</span> <span class="operator">=</span> queue[l];</span><br><span class="line">            ans = Math.max(ans,points[j][<span class="number">0</span>]+points[j][<span class="number">1</span>]-points[best][<span class="number">0</span>]+points[best][<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å°† j åŠ å…¥</span></span><br><span class="line">        <span class="keyword">while</span> ( l&lt;r &amp;&amp; (points[j][<span class="number">1</span>] - points[j][<span class="number">0</span>]) &gt;= (points[queue[r-<span class="number">1</span>]][<span class="number">1</span>]-points[queue[r-<span class="number">1</span>]][<span class="number">0</span>]))&#123;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        queue[r++] = j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢„ç®—å†…æœ€å¤šæœºå™¨äººçš„æ•°ç›®"><a href="#é¢„ç®—å†…æœ€å¤šæœºå™¨äººçš„æ•°ç›®" class="headerlink" title="é¢„ç®—å†…æœ€å¤šæœºå™¨äººçš„æ•°ç›®"></a>é¢„ç®—å†…æœ€å¤šæœºå™¨äººçš„æ•°ç›®</h2><p>leetcode 2389</p><p>æ€è·¯ï¼šå•è°ƒé˜Ÿåˆ—ç®—çª—å£å†…çš„æœ€å¤§å€¼ï¼Œå‰ç¼€å’Œç®—çª—å£çš„å’Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">50001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] queue  =<span class="keyword">new</span> <span class="title class_">int</span>[MAX];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> l ;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> r;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumRobots</span><span class="params">(<span class="type">int</span>[] chargeTimes, <span class="type">int</span>[] runningCosts, <span class="type">long</span> budget)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> chargeTimes.length;</span><br><span class="line">    r = <span class="number">0</span>;</span><br><span class="line">    l = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//æä¸€ä¸ªå‰ç¼€å’Œï¼Œå¿«é€Ÿè®¡ç®—å­æ•°ç»„çš„å’Œ</span></span><br><span class="line">    <span class="type">long</span>[] prefix = <span class="keyword">new</span> <span class="title class_">long</span>[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        prefix[i+<span class="number">1</span>] = prefix[i] + runningCosts[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¼€å§‹æ»‘</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;j&lt;n;j++)&#123;</span><br><span class="line">        <span class="comment">//æŠŠ j æ”¾è¿›å»</span></span><br><span class="line">        <span class="keyword">while</span> ( l&lt;r &amp;&amp; chargeTimes[queue[r-<span class="number">1</span>]] &lt;= chargeTimes[j])&#123;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        queue[r++] = j;</span><br><span class="line">        <span class="comment">// å·¦ç§»ç›´åˆ°åˆæ³•</span></span><br><span class="line">        <span class="keyword">while</span>( i&lt;=j &amp;&amp; chargeTimes[queue[l]]+ (<span class="type">long</span>) (j - i + <span class="number">1</span>) *(prefix[j+<span class="number">1</span>]-prefix[i]) &gt; budget)&#123;</span><br><span class="line">            <span class="keyword">if</span>(queue[l] == i)&#123;</span><br><span class="line">                l++;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»Ÿè®¡ç­”æ¡ˆ</span></span><br><span class="line">        ans = Math.max(ans,j-i+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç»å…¸ç”¨æ³•&quot;&gt;&lt;a href=&quot;#ç»å…¸ç”¨æ³•&quot; class=&quot;headerlink&quot; title=&quot;ç»å…¸ç”¨æ³•&quot;&gt;&lt;/a&gt;ç»å…¸ç”¨æ³•&lt;/h1&gt;&lt;p&gt;é…åˆæ»‘åŠ¨çª—å£ï¼Œå¯ä»¥å¿«é€Ÿå¾—åˆ°æ»‘åŠ¨çª—å£å†…çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ã€‚å¦‚æœè¦æœ€å¤§å€¼ï¼Œé‚£ç»´æŠ¤ä¸€ä¸ªå¤§åˆ°å°é˜Ÿåˆ—ï¼ˆå­˜çš„æ˜¯ä¸‹æ ‡ï¼‰ï¼Œå¦‚æœè¦æœ€å°å€¼ï¼Œé‚£ç»´</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆåï¼‰ å•è°ƒæ ˆ</title>
    <link href="https://nmcb666.vip/posts/b11a54f5.html"/>
    <id>https://nmcb666.vip/posts/b11a54f5.html</id>
    <published>2026-01-29T21:32:22.000Z</published>
    <updated>2026-01-31T14:36:26.050Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç»å…¸ç”¨æ³•"><a href="#ç»å…¸ç”¨æ³•" class="headerlink" title="ç»å…¸ç”¨æ³•"></a>ç»å…¸ç”¨æ³•</h1><p>å•è°ƒæ ˆé—®é¢˜ï¼Œå°±æ˜¯å½“ä½ åˆ†æé—®é¢˜æ—¶ï¼Œéœ€è¦ä½ æ‰¾åˆ°ä¸€ä¸ªç´¢å¼•å·¦å³ä¸¤è¾¹å¤§äºæˆ–è€…å°äºè‡ªå·±çš„æœ€è¿‘ç´¢å¼•æ—¶ï¼Œå°±ä½¿ç”¨å•è°ƒæ ˆï¼</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-29%20232614.png" alt="æ€»ç»“"/></div><span class="image-caption">æ€»ç»“</span></div><h2 id="æ¯æ—¥æœ€é«˜æ¸©åº¦"><a href="#æ¯æ—¥æœ€é«˜æ¸©åº¦" class="headerlink" title="æ¯æ—¥æœ€é«˜æ¸©åº¦"></a>æ¯æ—¥æœ€é«˜æ¸©åº¦</h2><p>leetcode 739</p><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ temperatures ï¼Œè¡¨ç¤ºæ¯å¤©çš„æ¸©åº¦ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ answer ï¼Œå…¶ä¸­ answer[i] æ˜¯æŒ‡å¯¹äºç¬¬ i å¤©ï¼Œä¸‹ä¸€ä¸ªæ›´é«˜æ¸©åº¦å‡ºç°åœ¨å‡ å¤©åã€‚å¦‚æœæ°”æ¸©åœ¨è¿™ä¹‹åéƒ½ä¸ä¼šå‡é«˜ï¼Œè¯·åœ¨è¯¥ä½ç½®ç”¨ 0 æ¥ä»£æ›¿ã€‚</p><p>æ€è·¯ï¼šå°†ä¸‹æ ‡ä¸€æ¬¡æ”¾å…¥æ ˆï¼Œä½†éµå¾ªä»¥ä¸‹è¦æ±‚ï¼Œå¦‚æœå½“å‰çš„æ¸©åº¦å¤§äºæ ˆé¡¶çš„æ¸©åº¦ï¼Œåˆ™æ ˆé¡¶çš„ç´¢å¼•å‡ºæ ˆï¼Œå¹¶è®°å½•å½“å‰ç´¢å¼•ä¸æ ˆé¡¶ç´¢å¼•çš„å·®å€¼ï¼Œå³å½“å‰ç´¢å¼•ä¸æ ˆé¡¶ç´¢å¼•çš„å·®å€¼å°±æ˜¯å½“å‰ç´¢å¼•å¯¹åº”çš„å¤©æ•°ã€‚å¾ªç¯å¼¹å‡ºï¼Œç›´åˆ°æ ˆä¸ºç©ºæˆ–è€…æ ˆé¡¶çš„ç´¢å¼•å¯¹åº”çš„æ¸©åº¦å¤§äºç­‰äºå½“å‰ç´¢å¼•å¯¹åº”çš„æ¸©åº¦ã€‚åˆ™å½“å‰ç´¢å¼•å…¥æ ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] dailyTemperatures(<span class="type">int</span>[] temperatures) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> temperatures.length;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>( size&gt;<span class="number">0</span> &amp;&amp; temperatures[stack[size-<span class="number">1</span>]] &lt; temperatures[i])&#123;</span><br><span class="line">            ans[stack[size-<span class="number">1</span>]] = i - stack[size-<span class="number">1</span>];</span><br><span class="line">            size --;</span><br><span class="line">        &#125;</span><br><span class="line">        stack[size++] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ"><a href="#å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ" class="headerlink" title="å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ"></a>å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œ</h2><p>leetcode 907</p><p>æ€è·¯ï¼šæ ¹æ®å•è°ƒæ ˆï¼Œå¯ä»¥çŸ¥é“æ¯ä¸ªç´¢å¼•å·¦è¾¹è·Ÿå³è¾¹å°äºä»–çš„æœ€è¿‘ç´¢å¼•ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªç´¢å¼•ï¼Œå·¦è¾¹å°äºå®ƒçš„æœ€è¿‘ç´¢å¼•ä¸ºleft[i]ï¼Œå³è¾¹å°äºå®ƒçš„æœ€è¿‘ç´¢å¼•ä¸ºright[i]ï¼Œåˆ™å¯¹äºç´¢å¼•iï¼Œæœ€å°å€¼ä¹‹å’Œä¸º(right[i] - i) <em> (i - left[i]) </em> arr[i]ã€‚ï¼ˆè¿™å°±æ˜¯åŒ…å«äº†içš„ä¸”iä¸ºæœ€å°å€¼çš„æ‰€æœ‰å­æ•°ç»„çš„æœ€å°å€¼ä¹‹å’Œï¼‰ã€‚æœ€åå‰©åœ¨æ ˆé‡Œé¢çš„å®ƒçš„å³è¾¹ç´¢å¼•å°±åœ¨nçš„ä½ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sumSubarrayMins</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line"><span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">r = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// æ³¨æ„è¯¾ä¸Šè®²çš„ç›¸ç­‰æƒ…å†µçš„ä¿®æ­£</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="keyword">while</span> (r &gt; <span class="number">0</span> &amp;&amp; arr[stack[r - <span class="number">1</span>]] &gt;= arr[i]) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> stack[--r];</span><br><span class="line"><span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> r == <span class="number">0</span> ? -<span class="number">1</span> : stack[r - <span class="number">1</span>];</span><br><span class="line">ans = (ans + (<span class="type">long</span>) (cur - left) * (i - cur) * arr[cur]) % MOD;</span><br><span class="line">&#125;</span><br><span class="line">stack[r++] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (r &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> stack[--r];</span><br><span class="line"><span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> r == <span class="number">0</span> ? -<span class="number">1</span> : stack[r - <span class="number">1</span>];</span><br><span class="line">ans = (ans + (<span class="type">long</span>) (cur - left) * (arr.length - cur) * arr[cur]) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">int</span>) ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æŸ±çŠ¶å›¾ä¸­æœ€å¤§çŸ©å½¢"><a href="#æŸ±çŠ¶å›¾ä¸­æœ€å¤§çŸ©å½¢" class="headerlink" title="æŸ±çŠ¶å›¾ä¸­æœ€å¤§çŸ©å½¢"></a>æŸ±çŠ¶å›¾ä¸­æœ€å¤§çŸ©å½¢</h2><p>leetcode 84</p><p>æ€è·¯ï¼šå•è°ƒæ ˆï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•ï¼Œå·¦è¾¹å°äºå®ƒæœ€è¿‘ç´¢å¼•ä¸ºleft[i]ï¼Œå³è¾¹å°äºå®ƒæœ€è¿‘ç´¢å¼•ä¸ºright[i]ï¼Œåˆ™å¯¹äºç´¢å¼•iï¼Œæœ€å¤§çŸ©å½¢ä¸º(right[i] - left[i] - 1) * heights[i]ã€‚è¿™é“é¢˜å°±æ˜¯ä¸€ä¸ªéå¸¸æ ‡å‡†çš„å•è°ƒæ ˆé—®é¢˜ã€‚</p><p>æ ‡å‡†æ¨¡æ¿<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">largestRectangleArea</span><span class="params">(<span class="type">int</span>[] heights)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span>heights.length;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(size&gt;<span class="number">0</span> &amp;&amp; heights[stack[size-<span class="number">1</span>]] &gt;= heights[i])&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> stack[--size];</span><br><span class="line">            ansArr[temp][<span class="number">0</span>] = size == <span class="number">0</span> ? -<span class="number">1</span> : stack[size-<span class="number">1</span>];</span><br><span class="line">            ansArr[temp][<span class="number">1</span>] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        stack[size++] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> stack[--size];</span><br><span class="line">        ansArr[temp][<span class="number">0</span>] = size==<span class="number">0</span>? -<span class="number">1</span> :stack[size-<span class="number">1</span>];</span><br><span class="line">        ansArr[temp][<span class="number">1</span>] = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¿®æ­£å³è¾¹</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">2</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(ansArr[i][<span class="number">1</span>] != n &amp;&amp; heights[ansArr[i][<span class="number">1</span>]] == heights[i])&#123;</span><br><span class="line">            ansArr[i][<span class="number">1</span>] = ansArr[ansArr[i][<span class="number">1</span>]][<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è®¡ç®—ç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        ans = Math.max((ansArr[i][<span class="number">1</span>] - ansArr[i][<span class="number">0</span>] -<span class="number">1</span>)*heights[i],ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç®€åŒ–åˆ†æç›¸ç­‰æƒ…å†µ  å› ä¸ºå°±ç®—ç›¸ç­‰ä½ ä¹Ÿç»™æˆ‘å¼¹å‡ºï¼Œå¯èƒ½è¿™æ—¶ä½ æ— æ³•å¾—åˆ°ä½ å¯¹åº”çš„æœ€å¤§å€¼ã€‚ä½†ä½ çš„é‚£ä¸ªæœ€åä¸€ä¸ªç›¸ç­‰çš„å°±ä¼šå¸®ä½ ç»“ç®—ä½ çš„æœ€å¤§å€¼ï¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">largestRectangleArea</span><span class="params">(<span class="type">int</span>[] heights)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span>heights.length;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(size&gt;<span class="number">0</span> &amp;&amp; heights[stack[size-<span class="number">1</span>]] &gt;= heights[i])&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> stack[--size];</span><br><span class="line">            <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> size == <span class="number">0</span> ? -<span class="number">1</span> : stack[size-<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> i;</span><br><span class="line">            ans = Math.max((right-left-<span class="number">1</span>)*heights[temp],ans);</span><br><span class="line">        &#125;</span><br><span class="line">        stack[size++] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> stack[--size];</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> size==<span class="number">0</span>? -<span class="number">1</span> :stack[size-<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> n;</span><br><span class="line">        ans = Math.max((right-left-<span class="number">1</span>)*heights[temp],ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æœ€å¤§çŸ©å½¢"><a href="#æœ€å¤§çŸ©å½¢" class="headerlink" title="æœ€å¤§çŸ©å½¢"></a>æœ€å¤§çŸ©å½¢</h2><p>leetcode 85</p><p>æ€è·¯ï¼šå‹ç¼©æ•°ç»„ï¼æŠŠé—®é¢˜è½¬åŒ–ä¸ºä»¥æ¯ä¸€è¡Œä½œä¸ºåº•éƒ¨æ—¶çš„æœ€å¤§çŸ©å½¢é—®é¢˜ è·Ÿä¸Šä¸€é¢˜ä¸€æ ·ã€‚æ¯ä¸€ä¸ªçš„é«˜åº¦å°±æ˜¯ä»è¯¥è¡Œå¼€å§‹è¿ç»­çš„1çš„ä¸ªæ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maximalRectangle</span><span class="params">(<span class="type">char</span>[][] grid)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> grid.length;</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> grid[<span class="number">0</span>].length;</span><br><span class="line">Arrays.fill(height, <span class="number">0</span>, m, <span class="number">0</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="comment">// æ¥åˆ°iè¡Œï¼Œé•¿æ–¹å½¢ä¸€å®šè¦ä»¥iè¡Œåšåº•ï¼</span></span><br><span class="line"><span class="comment">// åŠ å·¥é«˜åº¦æ•°ç»„(å‹ç¼©æ•°ç»„)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">height[j] = grid[i][j] == <span class="string">&#x27;0&#x27;</span> ? <span class="number">0</span> : height[j] + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">ans = Math.max(largestRectangleArea(m), ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">largestRectangleArea</span><span class="params">(<span class="type">int</span> m)</span> &#123;</span><br><span class="line">r = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>, cur, left;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line"><span class="comment">// i -&gt; arr[i]</span></span><br><span class="line"><span class="keyword">while</span> (r &gt; <span class="number">0</span> &amp;&amp; height[stack[r - <span class="number">1</span>]] &gt;= height[i]) &#123;</span><br><span class="line">cur = stack[--r];</span><br><span class="line">left = r == <span class="number">0</span> ? -<span class="number">1</span> : stack[r - <span class="number">1</span>];</span><br><span class="line">ans = Math.max(ans, height[cur] * (i - left - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line">stack[r++] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (r &gt; <span class="number">0</span>) &#123;</span><br><span class="line">cur = stack[--r];</span><br><span class="line">left = r == <span class="number">0</span> ? -<span class="number">1</span> : stack[r - <span class="number">1</span>];</span><br><span class="line">ans = Math.max(ans, height[cur] * (m - left - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="éç»å…¸ç”¨æ³•"><a href="#éç»å…¸ç”¨æ³•" class="headerlink" title="éç»å…¸ç”¨æ³•"></a>éç»å…¸ç”¨æ³•</h1><p><strong>ä¸‹é¢çš„é¢˜ç›®åˆ©ç”¨å•è°ƒæ ˆæ€æƒ³ï¼Œè€Œä¸æ˜¯ç»å…¸çš„ç”¨æ³•ã€‚</strong></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-29%20232336.png" alt="æ€»ç»“"/></div><span class="image-caption">æ€»ç»“</span></div><h2 id="æœ€å¤§å®½åº¦å¡"><a href="#æœ€å¤§å®½åº¦å¡" class="headerlink" title="æœ€å¤§å®½åº¦å¡"></a>æœ€å¤§å®½åº¦å¡</h2><p>leetcode 962</p><p>æ€è·¯ï¼šå…ˆè¿›è¡Œä¸€æ¬¡éå†æŠŠå¯èƒ½ä½œä¸ºå¡çš„èµ·ç‚¹çš„ä¸‹æ ‡æ‰¾åˆ°ã€‚æ€ä¹ˆæ‰¾ï¼Ÿ æ¯æ¬¡åªå…¥æ ˆæ¯”å½“å‰æ ˆé¡¶å…ƒç´ æ›´å°çš„å…ƒç´ ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå¦‚æœæˆ‘æ¯”æ ˆé¡¶å¤§ï¼Œæˆ‘æ‰¾åˆ°ä¸€ä¸ªå¡çš„ç»ˆç‚¹ï¼Œé‚£ä¹ˆæ ˆé¡¶å…ƒç´ å®ƒæ¯”æˆ‘çš„ä¸‹æ ‡è¿˜è¦å°ï¼Œé‚£ä»–è·Ÿè¿™ä¸ªå¡çš„ç»ˆç‚¹æ„æˆçš„å¡å®½åº¦è‚¯å®šæ¯”æˆ‘å¤§ï¼Œæ‰€ä»¥æˆ‘æ²¡èµ„æ ¼å…¥æ ˆã€‚</p><p>ç„¶åå€’ç€éå†æ‰¾å¡çš„ç»ˆç‚¹ã€‚ä¸€æ—¦æ ˆé¡¶çš„å…ƒç´ å‘ç°ä¸€ä¸ªå€¼å¯ä»¥ä½œä¸ºè‡ªå·±ç»ˆç‚¹é‚£ä¹ˆå¼¹å‡ºï¼Œå¹¶ä¸”è¿™ä¸ªå¡å°±æ˜¯ä»¥è‡ªå·±ä¸ºèµ·ç‚¹çš„æœ€å¤§å¡ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå½“å‰ç»ˆç‚¹å·²ç»æ˜¯æœ€é å³è¾¹çš„ç´¢å¼•äº†ï¼Œå†å¾€å‰éå†å¾—åˆ°çš„ç»“æœåªä¼šæ›´å°ï¼ å¾ªç¯ä¸€ç›´æŠŠæ ˆé‡Œé¢çš„å…ƒç´ å…¨éƒ¨å¼¹å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxWidthRamp</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    stack[size++] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//æ‰¾å¯èƒ½çš„èµ·ç‚¹å…¥æ ˆ</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i] &lt; nums[stack[size-<span class="number">1</span>]])&#123;</span><br><span class="line">            stack[size++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å€’ç€éå†æ‰¾ç»ˆç‚¹</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(size &gt; <span class="number">0</span> &amp;&amp; i&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>( size &gt; <span class="number">0</span> &amp;&amp; nums[stack[size-<span class="number">1</span>]] &lt;= nums[i])&#123;</span><br><span class="line">            ans = Math.max(ans,i-stack[size-<span class="number">1</span>]);</span><br><span class="line">            size--;</span><br><span class="line">        &#125;</span><br><span class="line">        i--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å»é™¤é‡å¤å­—æ¯"><a href="#å»é™¤é‡å¤å­—æ¯" class="headerlink" title="å»é™¤é‡å¤å­—æ¯"></a>å»é™¤é‡å¤å­—æ¯</h2><p>leetcode 316</p><p>æ€è·¯ï¼š å•è°ƒæ ˆå¤§å‹å°ï¼Œé‡åˆ°æ›´å°çš„å°½é‡å¾€å‰é¢èµ°ï¼Œä½†æœ‰æ¡ä»¶é™åˆ¶ï¼Œå³è¢«å¼¹å‡ºçš„å…ƒç´ è¿˜æœ‰å‰©ä½™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">removeDuplicateLetters</span><span class="params">(String str)</span> &#123;</span><br><span class="line">r = <span class="number">0</span>;</span><br><span class="line">Arrays.fill(cnts, <span class="number">0</span>);</span><br><span class="line">Arrays.fill(enter, <span class="literal">false</span>);</span><br><span class="line"><span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">char</span> cha : s) &#123;</span><br><span class="line">cnts[cha - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">char</span> cur : s) &#123;</span><br><span class="line"><span class="comment">// ä»å·¦å¾€å³ä¾æ¬¡éå†å­—ç¬¦ï¼Œa -&gt; 0 b -&gt; 1 ... z -&gt; 25</span></span><br><span class="line"><span class="comment">// cur -&gt; cur - &#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (!enter[cur - <span class="string">&#x27;a&#x27;</span>]) &#123;</span><br><span class="line">                <span class="comment">// æ ˆé¡¶å…ƒç´ æ¯”å½“å‰å…ƒç´ å¤§ï¼Œå¹¶ä¸”æ ˆé¡¶å…ƒç´ è¿˜æœ‰å‰©ä½™ï¼Œé‚£ä¹ˆå¼¹å‡ºæ ˆé¡¶å…ƒç´ </span></span><br><span class="line"><span class="keyword">while</span> (r &gt; <span class="number">0</span> &amp;&amp; stack[r - <span class="number">1</span>] &gt; cur &amp;&amp; cnts[stack[r - <span class="number">1</span>] - <span class="string">&#x27;a&#x27;</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">enter[stack[r - <span class="number">1</span>] - <span class="string">&#x27;a&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">r--;</span><br><span class="line">&#125;</span><br><span class="line">stack[r++] = cur;</span><br><span class="line">enter[cur - <span class="string">&#x27;a&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">cnts[cur - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> String.valueOf(stack, <span class="number">0</span>, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤§é±¼åƒå°é±¼"><a href="#å¤§é±¼åƒå°é±¼" class="headerlink" title="å¤§é±¼åƒå°é±¼"></a>å¤§é±¼åƒå°é±¼</h2><p>leetcode 2289</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">Max</span> <span class="operator">=</span> <span class="number">100001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][] stackT = <span class="keyword">new</span> <span class="title class_">int</span>[Max][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> r ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">totalSteps</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span>nums.length;</span><br><span class="line">    r = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span>n-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>( r &gt; <span class="number">0</span> &amp;&amp; stackT[r-<span class="number">1</span>][<span class="number">0</span>] &lt; nums[i])&#123;</span><br><span class="line">            cnt = Math.max(cnt+<span class="number">1</span>,stackT[r-<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        stackT[r][<span class="number">0</span>] = nums[i];</span><br><span class="line">        stackT[r++][<span class="number">1</span>] = cnt;</span><br><span class="line">        ans = Math.max(ans,cnt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç»å…¸ç”¨æ³•&quot;&gt;&lt;a href=&quot;#ç»å…¸ç”¨æ³•&quot; class=&quot;headerlink&quot; title=&quot;ç»å…¸ç”¨æ³•&quot;&gt;&lt;/a&gt;ç»å…¸ç”¨æ³•&lt;/h1&gt;&lt;p&gt;å•è°ƒæ ˆé—®é¢˜ï¼Œå°±æ˜¯å½“ä½ åˆ†æé—®é¢˜æ—¶ï¼Œéœ€è¦ä½ æ‰¾åˆ°ä¸€ä¸ªç´¢å¼•å·¦å³ä¸¤è¾¹å¤§äºæˆ–è€…å°äºè‡ªå·±çš„æœ€è¿‘ç´¢å¼•æ—¶ï¼Œå°±ä½¿ç”¨å•è°ƒæ ˆï¼&lt;/p&gt;
&lt;div c</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Javaå®ç°åŸºäºraftç®—æ³•çš„kvå­˜å‚¨ç³»ç»Ÿ</title>
    <link href="https://nmcb666.vip/posts/6eb88918.html"/>
    <id>https://nmcb666.vip/posts/6eb88918.html</id>
    <published>2026-01-29T02:02:09.000Z</published>
    <updated>2026-01-31T14:36:26.048Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸å¹¶å‘æ¨¡å‹ä¼˜åŒ–"><a href="#Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸å¹¶å‘æ¨¡å‹ä¼˜åŒ–" class="headerlink" title="Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸å¹¶å‘æ¨¡å‹ä¼˜åŒ–"></a>Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸å¹¶å‘æ¨¡å‹ä¼˜åŒ–</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ˜¯ä¸€ç¯‡åŸºäºJavaå®ç°raftåˆ†å¸ƒå¼KVå­˜å‚¨ç³»ç»Ÿçš„åšå®¢ã€‚æœ¬é¡¹ç›®åŸºäº <a href="https://github.com/stateIs0/lu-raft-kv">https://github.com/stateIs0/lu-raft-kv</a> è¯¥å¼€æºé¡¹ç›®è¿›è¡Œçš„äºŒæ¬¡å¼€å‘ã€‚ä¸»è¦æŒ‰ç…§Raftåè®®çš„ç”Ÿå‘½å‘¨æœŸï¼ˆé€‰ä¸»ã€æ—¥å¿—å¤åˆ¶ã€å®‰å…¨æ€§ã€ä¸€è‡´æ€§è¯»ï¼‰è¿›è¡Œäº†æ”¹é€ ã€‚æœ¬ç¯‡åšå®¢è®°å½•äº†æˆ‘çš„æ”¹é€ æ€è·¯ï¼Œä»¥åŠä¸€äº›å€¼å¾—æ³¨æ„çš„åœ°æ–¹ã€‚Raft ç®—æ³•ä½œä¸ºåˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®çš„æ ‡å‡†è§£æ³•ï¼Œä»¥å…¶æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡è‘—ç§°ã€‚æœ¬æ–‡å°†åŸºäºæˆ‘å¦‚ä½•æ”¹é€ åŸå¼€æºé¡¹ç›®ï¼Œæ·±å…¥å‰–æå…¶ä¸­çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä»é€‰ä¸»é€»è¾‘ã€æ—¥å¿—å¤åˆ¶çš„ç»†èŠ‚ï¼Œåˆ°è§£å†³â€œå¹½çµå¤ç°â€é—®é¢˜çš„ No-Op æ—¥å¿—ï¼Œå†åˆ°åˆ©ç”¨ <code>CompletableFuture</code> å¯¹å¹¶å‘æ¨¡å‹çš„é‡æ„ï¼Œä»¥æ­¤è®°å½•æ„å»ºé«˜ä¸€è‡´æ€§åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„æ€è€ƒè¿‡ç¨‹ã€‚</p><hr><h2 id="ä¸€ã€-é€‰ä¸¾æœºåˆ¶-Leader-Election"><a href="#ä¸€ã€-é€‰ä¸¾æœºåˆ¶-Leader-Election" class="headerlink" title="ä¸€ã€ é€‰ä¸¾æœºåˆ¶ (Leader Election)"></a>ä¸€ã€ é€‰ä¸¾æœºåˆ¶ (Leader Election)</h2><p>é€‰ä¸»æ˜¯é›†ç¾¤å¯åŠ¨æˆ– Leader å®•æœºåçš„é¦–è¦ä»»åŠ¡ã€‚åœ¨æ­¤é˜¶æ®µï¼Œä¸ä»…è¦ä¿è¯ç¥¨æ•°è¿‡åŠï¼Œæ›´è¦ä¸¥æ ¼æ ¡éªŒèŠ‚ç‚¹èµ„æ ¼ã€‚</p><h3 id="1-çŠ¶æ€æµè½¬ä¸æ‹‰ç¥¨"><a href="#1-çŠ¶æ€æµè½¬ä¸æ‹‰ç¥¨" class="headerlink" title="1. çŠ¶æ€æµè½¬ä¸æ‹‰ç¥¨"></a>1. çŠ¶æ€æµè½¬ä¸æ‹‰ç¥¨</h3><p>å½“ Follower çš„å¿ƒè·³å€’è®¡æ—¶ç»“æŸï¼ˆåœ¨ä¸€å®šèŒƒå›´å†…éšæœºæ—¶é—´ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯è·Ÿæœ€å¤§é€‰ä¸¾æ—¶é—´åˆ°å®ƒçš„ä¸¤å€è¿™ä¸ªèŒƒå›´ï¼Œé¿å…åŒæ—¶å­˜åœ¨å¤šä¸ªå€™é€‰äººå¯¼è‡´æ•ˆç‡ä¸‹é™ï¼‰ä»æœªæ”¶åˆ° Leader æ¶ˆæ¯æ—¶ï¼Œå°†è§¦å‘é€‰ä¸¾æµç¨‹ï¼š</p><ul><li><strong>è‡ªå¢ä»»æœŸ</strong>ï¼šå°† <code>term + 1</code>ï¼Œå¹¶å°†çŠ¶æ€æµè½¬ä¸º Candidateã€‚</li><li><strong>ç»™è‡ªå·±æŠ•ç¥¨</strong>ï¼šå…ˆæŠ•è‡ªå·±ä¸€ç¥¨ï¼Œé¿å… split voteã€‚</li><li><strong>å¹¿æ’­è¯·æ±‚</strong>ï¼šå‘æ‰€æœ‰èŠ‚ç‚¹å‘èµ·æ‹‰ç¥¨è¯·æ±‚ï¼Œè¯·æ±‚ä¸­å¿…é¡»æºå¸¦ <code>lastLogTerm</code> å’Œ <code>lastLogIndex</code>ï¼Œä»¥ä¾¿å…¶ä»–èŠ‚ç‚¹æ ¡éªŒâ€œæ—¥å¿—æ˜¯å¦è¶³å¤Ÿæ–°â€ã€‚</li></ul><h3 id="2-æŠ•ç¥¨æ–¹é€»è¾‘ä¸å¹¶å‘æ§åˆ¶"><a href="#2-æŠ•ç¥¨æ–¹é€»è¾‘ä¸å¹¶å‘æ§åˆ¶" class="headerlink" title="2. æŠ•ç¥¨æ–¹é€»è¾‘ä¸å¹¶å‘æ§åˆ¶"></a>2. æŠ•ç¥¨æ–¹é€»è¾‘ä¸å¹¶å‘æ§åˆ¶</h3><p>èŠ‚ç‚¹æ”¶åˆ°æŠ•ç¥¨è¯·æ±‚æ—¶çš„å¤„ç†é€»è¾‘éå¸¸å…³é”®ï¼š</p><ul><li><strong>Term æ›´æ–°</strong>ï¼šå¦‚æœè¯·æ±‚ä¸­çš„ Term ä¸¥æ ¼å¤§äºè‡ªèº«ï¼Œéœ€å°†ä¹‹å‰çš„æŠ•ç¥¨è®°å½•ï¼ˆvotedForï¼‰ç½®ç©ºï¼Œé˜²æ­¢å› æŒæœ‰æ—§é”å¯¼è‡´æ— æ³•æŠ•ç¥¨ï¼Œè¿™æ ·ä¹Ÿå°½å¯èƒ½çš„ä¿è¯åœ¨ä¸€ä¸ªæŠ•ç¥¨é—´éš”ä¸­èƒ½é€‰å‡ºLeaderã€‚</li><li><strong>åŠ é”é˜²é‡</strong>ï¼šæ•´ä¸ªæŠ•ç¥¨åˆ¤æ–­è¿‡ç¨‹éœ€è¦ä¸Šé”ï¼Œé¿å…é«˜å¹¶å‘ä¸‹çš„é‡å¤æŠ•ç¥¨ã€‚</li><li><strong>èµ„æ ¼æ ¡éªŒ</strong>ï¼šåªæœ‰å½“è¯·æ±‚è€…çš„ Term &gt;= è‡ªèº« Termï¼Œä¸”æ—¥å¿—æ¯”è‡ªå·±æ–°ï¼ˆLog Completenessï¼‰ï¼Œä¸”è‡ªå·±åœ¨æœ¬ä»»æœŸæœªæŠ•è¿‡ç¥¨æ—¶ï¼Œæ‰äºˆä»¥æŠ•ç¥¨ã€‚</li><li><strong>æ”¶å°¾</strong>ï¼šæ›´æ–°æœ¬åœ° Term å’ŒæŠ•ç¥¨ä¿¡æ¯ï¼Œé‡Šæ”¾é”ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> RvoteResult <span class="title function_">requestVote</span><span class="params">(RvoteParam param)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        RvoteResult.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> RvoteResult.newBuilder();</span><br><span class="line">        <span class="keyword">if</span> (!voteLock.tryLock()) &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.term(node.getCurrentTerm()).voteGranted(<span class="literal">false</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹æ–¹ä»»æœŸæ²¡æœ‰è‡ªå·±æ–°</span></span><br><span class="line">        <span class="keyword">if</span> (param.getTerm() &lt; node.getCurrentTerm()) &#123;</span><br><span class="line">            <span class="keyword">return</span> builder.term(node.getCurrentTerm()).voteGranted(<span class="literal">false</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–°çš„æŠ•ç¥¨termæ¥ä¸´ï¼Œåº”è¯¥æ”¾å¼ƒä¹‹å‰çš„æŠ•ç¥¨</span></span><br><span class="line">        <span class="keyword">if</span> (param.getTerm() &gt; node.getCurrentTerm()) &#123;</span><br><span class="line">            node.setCurrentTerm(param.getTerm());</span><br><span class="line">            node.setVotedFor(<span class="literal">null</span>);</span><br><span class="line">            node.status = NodeStatus.FOLLOWER; <span class="comment">// ä»»æœŸå‡çº§åå›å½’Follower</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (å½“å‰èŠ‚ç‚¹å¹¶æ²¡æœ‰æŠ•ç¥¨ æˆ–è€… å·²ç»æŠ•ç¥¨è¿‡äº†ä¸”æ˜¯å¯¹æ–¹èŠ‚ç‚¹) &amp;&amp; å¯¹æ–¹æ—¥å¿—å’Œè‡ªå·±ä¸€æ ·æ–°</span></span><br><span class="line">        LOGGER.info(<span class="string">&quot;node &#123;&#125; current vote for [&#123;&#125;], param candidateId : &#123;&#125;&quot;</span>, node.peerSet.getSelf(), node.getVotedFor(), param.getCandidateId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((StringUtil.isNullOrEmpty(node.getVotedFor()) || node.getVotedFor().equals(param.getCandidateId()))) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (node.getLogModule().getLast() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å¯¹æ–¹æ²¡æœ‰è‡ªå·±æ–°</span></span><br><span class="line">                <span class="keyword">if</span> (node.getLogModule().getLast().getTerm() &gt; param.getLastLogTerm()) &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;èŠ‚ç‚¹&#123;&#125; æ‹’ç»ç»™ å€™é€‰äºº &#123;&#125; æŠ•ç¥¨,å› ä¸ºæ—¥å¿—çš„termå€¼æ›´å¤§&quot;</span>,node.peerSet.getSelf(),param.getCandidateId());</span><br><span class="line">                    <span class="keyword">return</span> RvoteResult.fail();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¯¹æ–¹æ²¡æœ‰è‡ªå·±æ–°</span></span><br><span class="line">                <span class="keyword">if</span> (node.getLogModule().getLastIndex() &gt; param.getLastLogIndex()) &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;èŠ‚ç‚¹&#123;&#125; æ‹’ç»ç»™ å€™é€‰äºº &#123;&#125; æŠ•ç¥¨,å› ä¸ºæ—¥å¿—çš„Indexæ›´å¤§&quot;</span>,node.peerSet.getSelf(),param.getCandidateId());</span><br><span class="line">                    <span class="keyword">return</span> RvoteResult.fail();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ‡æ¢çŠ¶æ€</span></span><br><span class="line">            node.status = NodeStatus.FOLLOWER;</span><br><span class="line">            <span class="comment">// æ›´æ–°</span></span><br><span class="line">            node.peerSet.setLeader(<span class="keyword">new</span> <span class="title class_">Peer</span>(param.getCandidateId()));</span><br><span class="line">            node.setCurrentTerm(param.getTerm());</span><br><span class="line">            node.setVotedFor(param.getCandidateId());</span><br><span class="line">            log.warn(<span class="string">&quot;èŠ‚ç‚¹ &#123;&#125; åœ¨ç¬¬ &#123;&#125; è½®ä¸­ ï¼Œ æŠ•ç»™äº† &#123;&#125; èŠ‚ç‚¹&quot;</span>,node.peerSet.getSelf(),node.currentTerm,node.getVotedFor());</span><br><span class="line">            <span class="comment">// è¿”å›æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">return</span> builder.term(node.currentTerm).voteGranted(<span class="literal">true</span>).build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> builder.term(node.currentTerm).voteGranted(<span class="literal">false</span>).build();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        voteLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-å¼‚æ­¥å¹¶å‘æ¨¡å‹çš„ä¼˜åŒ–"><a href="#3-å¼‚æ­¥å¹¶å‘æ¨¡å‹çš„ä¼˜åŒ–" class="headerlink" title="3. å¼‚æ­¥å¹¶å‘æ¨¡å‹çš„ä¼˜åŒ–"></a>3. å¼‚æ­¥å¹¶å‘æ¨¡å‹çš„ä¼˜åŒ–</h3><p>åœ¨å®ç°æ‹‰ç¥¨è¯·æ±‚æ—¶ï¼Œæˆ‘å¯¹å¹¶å‘æ¨¡å‹è¿›è¡Œäº†é‡æ„ï¼š</p><ul><li><strong>æ—§æ–¹æ¡ˆ</strong>ï¼š<code>çº¿ç¨‹æ±  + Future + CountDownLatch</code>ã€‚<code>Future.get()</code> ä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œä¸” CountDownLatch ä»£ç å†—ä½™ã€‚</li><li><strong>æ–°æ–¹æ¡ˆ</strong>ï¼š<code>CompletableFuture + çº¿ç¨‹æ± </code>ã€‚<ul><li>ä½¿ç”¨ <code>List&lt;CompletableFuture&lt;&gt;&gt;</code> ä¿å­˜æ‰€æœ‰ RPC è¯·æ±‚ã€‚</li><li>åˆ©ç”¨ <code>CompletableFuture.allOf(...)</code> å®ç°å¤šçº¿ç¨‹çš„éé˜»å¡åŒæ­¥ã€‚</li><li>é…åˆ <code>AtomicInteger</code> è®°å½•è·èƒœç¥¨æ•°ï¼Œçº¿ç¨‹å®‰å…¨ä¸”ä»£ç æ›´ä¼˜é›…ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (status == NodeStatus.LEADER) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="comment">// åŸºäº RAFT çš„éšæœºæ—¶é—´,è§£å†³å†²çª.ï¼ˆèŒƒå›´ä¸º[electiontimeout, 2 * electiontimeout - 1]ï¼‰</span></span><br><span class="line"><span class="type">long</span> <span class="variable">myElectionTime</span> <span class="operator">=</span> electionTime + ThreadLocalRandom.current().nextInt(<span class="number">10000</span>);</span><br><span class="line"><span class="keyword">if</span> (current - preElectionTime &lt; myElectionTime) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">status = NodeStatus.CANDIDATE;</span><br><span class="line">log.error(<span class="string">&quot;node &#123;&#125; will become CANDIDATE and start election leader, current term : [&#123;&#125;], LastEntry : [&#123;&#125;]&quot;</span>,</span><br><span class="line">        peerSet.getSelf(), currentTerm, logModule.getLast());</span><br><span class="line"></span><br><span class="line">preElectionTime = System.currentTimeMillis() + ThreadLocalRandom.current().nextInt(<span class="number">200</span>) + <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">currentTerm = currentTerm + <span class="number">1</span>;</span><br><span class="line"><span class="comment">// æ¨èè‡ªå·±.</span></span><br><span class="line">votedFor = peerSet.getSelf().getAddr();</span><br><span class="line"></span><br><span class="line">List&lt;Peer&gt; peers = peerSet.getPeersWithOutSelf();</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ©ç”¨CompletableFuture æ”¹é€ </span></span><br><span class="line">ArrayList&lt;CompletableFuture&lt;RvoteResult&gt;&gt; futureList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//æˆåŠŸæ¬¡æ•°</span></span><br><span class="line"><span class="type">AtomicInteger</span> <span class="variable">NumberOfVotesInFavor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">log.info(<span class="string">&quot;peerList size : &#123;&#125;, peer list content : &#123;&#125;&quot;</span>, peers.size(), peers);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Peer peer : peers) &#123;</span><br><span class="line"></span><br><span class="line">    futureList.add(CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°è£…è‡ªå·±æœ€åä¸€ä¸ªæ—¥å¿—çš„term</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">lastTerm</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="type">LogEntry</span> <span class="variable">last</span> <span class="operator">=</span> logModule.getLast();</span><br><span class="line">        <span class="keyword">if</span> (last != <span class="literal">null</span>) &#123;</span><br><span class="line">            lastTerm = last.getTerm();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä»¥åŠæœ€åä¸€æ¡æ—¥å¿—çš„ç´¢å¼•</span></span><br><span class="line">        <span class="type">RvoteParam</span> <span class="variable">param</span> <span class="operator">=</span> RvoteParam.builder().</span><br><span class="line">                term(currentTerm).</span><br><span class="line">                candidateId(peerSet.getSelf().getAddr()).</span><br><span class="line">                lastLogIndex(LongConvert.convert(logModule.getLastIndex())).</span><br><span class="line">                lastLogTerm(lastTerm).</span><br><span class="line">                build();</span><br><span class="line"></span><br><span class="line">        <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> Request.builder()</span><br><span class="line">                .cmd(Request.R_VOTE)</span><br><span class="line">                .obj(param)</span><br><span class="line">                .url(peer.getAddr())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å‘é€æŠ•ç¥¨è¯·æ±‚ï¼Œ500msè¶…æ—¶</span></span><br><span class="line">            <span class="keyword">return</span> getRpcClient().&lt;RvoteResult&gt;send(request,<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RaftRemotingException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ElectionTask RPC Fail , URL : &quot;</span> + request.getUrl());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,RaftThreadPool.giveMePool())</span><br><span class="line">            .whenComplete((result,throwable) -&gt;&#123;</span><br><span class="line">                <span class="keyword">if</span>(result == <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">isVoteGranted</span> <span class="operator">=</span> result.isVoteGranted();</span><br><span class="line">                <span class="keyword">if</span> (isVoteGranted) &#123;</span><br><span class="line">                    <span class="comment">//å¢åŠ é€‰ç¥¨</span></span><br><span class="line">                    NumberOfVotesInFavor.incrementAndGet();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// å¯¹æ–¹æ‹’ç»æŠ•ç¥¨ã€‚</span></span><br><span class="line">                    <span class="comment">// æ›´æ–°è‡ªå·±çš„ä»»æœŸã€‚</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">resTerm</span> <span class="operator">=</span> result.getTerm();</span><br><span class="line">                    <span class="keyword">if</span> (resTerm &gt;= currentTerm) &#123;</span><br><span class="line">                        currentTerm = resTerm;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰å¾…æ‰€æœ‰ç»“æœå‡ºæ¥</span></span><br><span class="line"><span class="keyword">try</span>  &#123;</span><br><span class="line">    <span class="comment">//å¤šä¸ªä»»åŠ¡</span></span><br><span class="line">    CompletableFuture[] futureArray = futureList.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">//å°†å¤šä¸ªä»»åŠ¡ï¼Œæ±‡æ€»æˆä¸€ä¸ªä»»åŠ¡ï¼Œæ€»å…±è€—æ—¶ä¸è¶…æ—¶2ç§’</span></span><br><span class="line">    CompletableFuture.allOf(futureArray).get(<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    log.error(<span class="string">&quot;CompletableFuture.allOf Exception error.&quot;</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»Ÿè®¡ç»“æœ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">success</span> <span class="operator">=</span> NumberOfVotesInFavor.get();</span><br><span class="line">log.warn(<span class="string">&quot;node &#123;&#125; maybe become leader , success count = &#123;&#125; , status : &#123;&#125;&quot;</span>, peerSet.getSelf(), success, NodeStatus.Enum.value(status));</span><br><span class="line"><span class="comment">// å¦‚æœæŠ•ç¥¨æœŸé—´,æœ‰å…¶ä»–æœåŠ¡å™¨å‘é€ appendEntry æˆ–è€…å¿ƒè·³ , å°±å¯èƒ½å˜æˆ follower ,è¿™æ—¶,åº”è¯¥åœæ­¢.</span></span><br><span class="line"><span class="keyword">if</span> (status == NodeStatus.FOLLOWER) &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;èŠ‚ç‚¹ &#123;&#125; ç›®å‰ä¸æ˜¯å€™é€‰äºº ï¼Œæ— æ³•æˆä¸ºé¢†å¯¼è€…&quot;</span>, peerSet.getSelf().getAddr());</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŠ ä¸Šè‡ªèº«.</span></span><br><span class="line"><span class="keyword">if</span> (success &gt;= (peers.size()+<span class="number">1</span>) / <span class="number">2</span>) &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;node &#123;&#125; become leader ä»–çš„é€‰ç¥¨æœ‰ &#123;&#125; ç¥¨&quot;</span>, peerSet.getSelf(),success+<span class="number">1</span>);</span><br><span class="line">    status = NodeStatus.LEADER;</span><br><span class="line">    peerSet.setLeader(peerSet.getSelf());</span><br><span class="line">    votedFor = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªä¼šé©¬ä¸Šæ’å…¥ä¸€æ¡ç©ºæ—¥å¿—</span></span><br><span class="line">    becomeLeaderToDoThing();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// else é‡æ–°é€‰ä¸¾</span></span><br><span class="line">    votedFor = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    log.warn(<span class="string">&quot;èŠ‚ç‚¹ &#123;&#125; åœ¨ &#123;&#125; è½®è½é€‰,ä»–è·å¾—çš„é€‰ç¥¨æœ‰ &#123;&#125; ç¥¨&quot;</span>,peerSet.getSelf(),currentTerm,success+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å†æ¬¡æ›´æ–°é€‰ä¸¾æ—¶é—´ éšæœºæ›´æ–°</span></span><br><span class="line">preElectionTime = System.currentTimeMillis() + ThreadLocalRandom.current().nextInt(<span class="number">200</span>) + <span class="number">150</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h2 id="äºŒã€-æ—¥å¿—å¤åˆ¶ä¸å¿ƒè·³-Log-Replication-amp-Heartbeat"><a href="#äºŒã€-æ—¥å¿—å¤åˆ¶ä¸å¿ƒè·³-Log-Replication-amp-Heartbeat" class="headerlink" title="äºŒã€ æ—¥å¿—å¤åˆ¶ä¸å¿ƒè·³ (Log Replication &amp; Heartbeat)"></a>äºŒã€ æ—¥å¿—å¤åˆ¶ä¸å¿ƒè·³ (Log Replication &amp; Heartbeat)</h2><p>Leader ç¡®ç«‹åï¼Œè¿›å…¥æ­£å¸¸çš„æ—¥å¿—åŒæ­¥é˜¶æ®µã€‚</p><h3 id="1-å¿ƒè·³ä¸æ—¥å¿—åŒæ­¥çš„åˆå¹¶"><a href="#1-å¿ƒè·³ä¸æ—¥å¿—åŒæ­¥çš„åˆå¹¶" class="headerlink" title="1. å¿ƒè·³ä¸æ—¥å¿—åŒæ­¥çš„åˆå¹¶"></a>1. å¿ƒè·³ä¸æ—¥å¿—åŒæ­¥çš„åˆå¹¶</h3><p>ä¸ºäº†ç®€åŒ–é€»è¾‘ï¼Œæˆ‘å°†â€œåŒæ­¥æ—¥å¿—â€ä¸â€œå‘é€å¿ƒè·³â€åˆå¹¶å¤„ç†ï¼š</p><ul><li>Leader å‘¨æœŸæ€§éå†æ‰€æœ‰ Followerã€‚</li><li><strong>åˆ¤æ–­åŒæ­¥éœ€æ±‚</strong>ï¼šæ£€æŸ¥ <code>Leader.lastIndex &gt;= Follower.nextIndex</code>ã€‚<ul><li>å¦‚æœæ»¡è¶³ï¼Œè¯´æ˜æœ‰æ–°æ—¥å¿—ï¼Œå‘é€ä» <code>nextIndex</code> å¼€å§‹çš„æ—¥å¿—æ¡ç›®ã€‚</li><li>å¦‚æœä¸æ»¡è¶³ï¼Œè¯´æ˜æ—¥å¿—å·²ç»åŒæ­¥ï¼Œä»…å‘é€ç©ºçš„å¿ƒè·³åŒ…ä¿æ´»(æ ¹æ®å¿ƒè·³ç»“æœï¼Œåˆ¤æ–­è‡ªå·±æ˜¯å¦è¿˜èƒ½ç»§ç»­å½“leader)ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HeartBeatTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (status != NodeStatus.LEADER) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            <span class="keyword">if</span> (current - preHeartBeatTime &lt; heartBeatTick) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(<span class="string">&quot;=========== NextIndex =============&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Peer peer : peerSet.getPeersWithOutSelf()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;Peer &#123;&#125; nextIndex=&#123;&#125;&quot;</span>, peer.getAddr(), nextIndexs.get(peer));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            preHeartBeatTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">            List&lt;CompletableFuture&lt;Boolean&gt;&gt; futureList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            List&lt;Boolean&gt; resultList = Collections.synchronizedList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ—¥å¿—è·Ÿå¿ƒè·³æ”¾åœ¨ä¸€èµ·</span></span><br><span class="line">            <span class="keyword">for</span> (Peer peer : peerSet.getPeersWithOutSelf()) &#123;</span><br><span class="line">                <span class="type">Long</span> <span class="variable">nextIndex</span> <span class="operator">=</span> nextIndexs.get(peer);</span><br><span class="line">                <span class="comment">//æˆ‘çš„æœ€åä¸€æ¡æ—¥å¿—å¤§äºä½ åº”è¯¥å†™å…¥çš„æ—¥å¿—ä½ç½®ï¼Œé‚£æˆ‘å°±è¦å¤åˆ¶ç»™ä½ æ—¥å¿—</span></span><br><span class="line">                <span class="keyword">if</span>(logModule.getLastIndex() &gt;= nextIndex)&#123;</span><br><span class="line">                    CompletableFuture&lt;Boolean&gt; future = CompletableFuture.supplyAsync(</span><br><span class="line">                            () -&gt; replication(peer), RaftThreadPool.giveMePool()</span><br><span class="line">                    ).exceptionally( ex -&gt;&#123;</span><br><span class="line">                        log.error(<span class="string">&quot;&#123;&#125; èŠ‚ç‚¹å‘é€æ—¥å¿—å¤±è´¥&quot;</span>, peer.getAddr());</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line">                    ).whenComplete((result, throwable) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">                            resultList.add(result);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (throwable != <span class="literal">null</span>) &#123;</span><br><span class="line">                            log.error(<span class="string">&quot;&#123;&#125; èŠ‚ç‚¹å‘é€æ—¥å¿—å¤±è´¥&quot;</span>, peer.getAddr());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    futureList.add(future);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//å‘é€å¿ƒè·³</span></span><br><span class="line">                    <span class="type">AentryParam</span> <span class="variable">param</span> <span class="operator">=</span> AentryParam.builder()</span><br><span class="line">                            .entries(<span class="literal">null</span>)<span class="comment">// å¿ƒè·³,ç©ºæ—¥å¿—.</span></span><br><span class="line">                            .leaderId(peerSet.getSelf().getAddr())</span><br><span class="line">                            .serverId(peer.getAddr())</span><br><span class="line">                            .term(currentTerm)</span><br><span class="line">                            .leaderCommit(commitIndex) <span class="comment">// å¿ƒè·³æ—¶ä¸è·Ÿéšè€…åŒæ­¥ commit index</span></span><br><span class="line">                            .build();</span><br><span class="line"></span><br><span class="line">                    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(</span><br><span class="line">                            Request.A_ENTRIES,</span><br><span class="line">                            param,</span><br><span class="line">                            peer.getAddr());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    CompletableFuture.supplyAsync(()-&gt; getRpcClient().&lt;AentryResult&gt;send(request,<span class="number">450</span>),RaftThreadPool.giveMePool())</span><br><span class="line">                            .exceptionally( ex -&gt; <span class="literal">null</span>).whenComplete((result, throwable)-&gt;&#123;</span><br><span class="line">                        <span class="keyword">if</span>(result == <span class="literal">null</span>)&#123;</span><br><span class="line">                            log.error(<span class="string">&quot;æ— æ³•æ”¶åˆ°&#123;&#125; èŠ‚ç‚¹çš„å¿ƒè·³å›åº”ï¼Œè¯¥èŠ‚ç‚¹å¯èƒ½å·²ç»å®•æœº&quot;</span>,peer.getAddr());</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="type">long</span> <span class="variable">term</span> <span class="operator">=</span> result.getTerm();</span><br><span class="line">                        <span class="keyword">if</span> (term &gt; currentTerm) &#123;</span><br><span class="line">                            log.error(<span class="string">&quot;self will become follower, he&#x27;s term : &#123;&#125;, my term : &#123;&#125;&quot;</span>, term, currentTerm);</span><br><span class="line">                            currentTerm = term;</span><br><span class="line">                            votedFor = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                            status = NodeStatus.FOLLOWER;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ç­‰å¾…æ‰€æœ‰æ—¥å¿—å®Œæˆ</span></span><br><span class="line">            <span class="keyword">try</span>  &#123;</span><br><span class="line">                <span class="comment">//å¤šä¸ªä»»åŠ¡</span></span><br><span class="line">                CompletableFuture[] futureArray = futureList.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]);</span><br><span class="line">                <span class="comment">//å°†å¤šä¸ªä»»åŠ¡ï¼Œæ±‡æ€»æˆä¸€ä¸ªä»»åŠ¡ï¼Œæ€»å…±è€—æ—¶ä¸è¶…æ—¶2ç§’</span></span><br><span class="line">                CompletableFuture.allOf(futureArray).get(<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;CompletableFuture.allOf Exception error.&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœå­˜åœ¨ä¸€ä¸ªæ»¡è¶³N &gt; commitIndexçš„ Nï¼Œå¹¶ä¸”å¤§å¤šæ•°çš„matchIndex[i] â‰¥ Næˆç«‹ï¼Œ</span></span><br><span class="line">            <span class="comment">// å¹¶ä¸”log[N].term == currentTermæˆç«‹ï¼Œé‚£ä¹ˆä»¤ commitIndex ç­‰äºè¿™ä¸ª N ï¼ˆ5.3 å’Œ 5.4 èŠ‚ï¼‰</span></span><br><span class="line">            List&lt;Long&gt; matchIndexList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(matchIndexs.values());</span><br><span class="line">            <span class="comment">// å°äº 2, æ²¡æœ‰æ„ä¹‰</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">median</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (matchIndexList.size() &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                Collections.sort(matchIndexList);</span><br><span class="line">                median = matchIndexList.size() / <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">N</span> <span class="operator">=</span> matchIndexList.get(median);</span><br><span class="line">            <span class="keyword">if</span> (N &gt; commitIndex) &#123;</span><br><span class="line">                <span class="type">LogEntry</span> <span class="variable">entry</span> <span class="operator">=</span> logModule.read(N);</span><br><span class="line">                <span class="keyword">if</span> (entry != <span class="literal">null</span> &amp;&amp; entry.getTerm() == currentTerm) &#123;</span><br><span class="line">                    commitIndex = N;</span><br><span class="line">                    <span class="comment">// åº”ç”¨åˆ°çŠ¶æ€æœº</span></span><br><span class="line">                    RaftThreadPool.execute(()-&gt;&#123;</span><br><span class="line">                        commitLock.lock();</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="type">long</span> <span class="variable">myCommitIndex</span> <span class="operator">=</span> commitIndex;</span><br><span class="line">                            <span class="comment">//åº”è¯¥ä»lastAppliedå¼€å§‹åº”ç”¨ï¼Œç›´åˆ°å¼‚æ­¥å¼€å§‹æ—¶çš„commitIndexï¼ˆé˜²æ­¢é‡å¤æäº¤ï¼‰</span></span><br><span class="line">                            <span class="keyword">for</span>(<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> lastApplied + <span class="number">1</span>; i &lt;= myCommitIndex; i++)&#123;</span><br><span class="line">                                getStateMachine().apply(logModule.read(i));</span><br><span class="line">                                log.info(<span class="string">&quot;å¼‚æ­¥åº”ç”¨æ—¥å¿—æˆåŠŸ,  logEntry info : &#123;&#125;&quot;</span>, logModule.read(i));</span><br><span class="line">                            &#125;</span><br><span class="line">                            lastApplied = myCommitIndex;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                            log.error(<span class="string">&quot;leader èŠ‚ç‚¹ &#123;&#125; æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºå¤±è´¥&quot;</span>,peerSet.getSelf());</span><br><span class="line">                        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                            commitLock.unlock();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ‰¹é‡å‘é€ä¸å›æº¯"><a href="#2-æ‰¹é‡å‘é€ä¸å›æº¯" class="headerlink" title="2. æ‰¹é‡å‘é€ä¸å›æº¯"></a>2. æ‰¹é‡å‘é€ä¸å›æº¯</h3><ul><li><strong>æ‰¹é‡ä¼˜åŒ–</strong>ï¼šå‘é€æ—¥å¿—æ—¶ï¼Œä¼šæŠŠä» <code>nextIndex</code> åˆ° Leader <code>lastIndex</code> çš„æ‰€æœ‰æ—¥å¿—æ‰“åŒ…å‘é€ã€‚Follower åŒ¹é…æˆåŠŸåå¯æ‰¹é‡å†™å…¥ï¼Œæå¤§æå‡åŒæ­¥ååã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AentryParam</span> <span class="variable">aentryParam</span> <span class="operator">=</span> AentryParam.builder().build();</span><br><span class="line">aentryParam.setTerm(currentTerm);</span><br><span class="line">aentryParam.setServerId(peer.getAddr());</span><br><span class="line">aentryParam.setLeaderId(peerSet.getSelf().getAddr());</span><br><span class="line"></span><br><span class="line">aentryParam.setLeaderCommit(commitIndex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥æˆ‘è¿™è¾¹ä¸ºå‡†ã€‚</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">nextIndex</span> <span class="operator">=</span> nextIndexs.get(peer);</span><br><span class="line"><span class="type">Long</span> <span class="variable">myNewIndex</span> <span class="operator">=</span> logModule.getLastIndex();</span><br><span class="line">LinkedList&lt;LogEntry&gt; logEntries = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (myNewIndex &gt;= nextIndex) &#123;</span><br><span class="line">    <span class="comment">// æŠŠnextIndex åˆ° è‡ªå·±çš„æœ€åä¸€æ¡æ—¥å¿—éƒ½å¤åˆ¶ç»™follower</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> nextIndex; i &lt;= myNewIndex; i++) &#123;</span><br><span class="line">        <span class="type">LogEntry</span> <span class="variable">l</span> <span class="operator">=</span> logModule.read(i);</span><br><span class="line">        <span class="keyword">if</span> (l != <span class="literal">null</span>) &#123;</span><br><span class="line">            logEntries.add(l);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹‹å‰çš„æ—¥å¿—(å¦‚æœnextIndexä¸º0 ï¼Œä¼šè¿”å›ä¸€æ¡termä¸º-1ï¼Œindexä¸º-1çš„æ—¥å¿—ï¼Œfolloweræ”¶åˆ°åä¼šè·³è¿‡åŒ¹é…å› ä¸ºå·²ç»åˆ°åº•äº†)</span></span><br><span class="line"><span class="type">LogEntry</span> <span class="variable">preLog</span> <span class="operator">=</span> getPreLog(logEntries.getFirst());</span><br><span class="line">aentryParam.setPreLogTerm(preLog.getTerm());</span><br><span class="line">aentryParam.setPrevLogIndex(preLog.getIndex());</span><br><span class="line"></span><br><span class="line">aentryParam.setEntries(logEntries.toArray(<span class="keyword">new</span> <span class="title class_">LogEntry</span>[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line"><span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> Request.builder()</span><br><span class="line">        .cmd(Request.A_ENTRIES)</span><br><span class="line">        .obj(aentryParam)</span><br><span class="line">        .url(peer.getAddr())</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure></li></ul><p>getPreLog() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> LogEntry <span class="title function_">getPreLog</span><span class="params">(LogEntry logEntry)</span> &#123;</span><br><span class="line"></span><br><span class="line">    LogEntry entry;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(logEntry.getIndex() == <span class="number">0</span>)&#123;</span><br><span class="line">        log.warn(<span class="string">&quot;å·²ç»åŒ¹é…åˆ°åº•äº†ï¼Œéœ€è¦ä»å¤´å¼€å§‹è¦†ç›–&quot;</span>);</span><br><span class="line">        entry = LogEntry.builder().index(-<span class="number">1L</span>).term(-<span class="number">1</span>).command(<span class="literal">null</span>).build();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        entry = logModule.read(logEntry.getIndex() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entry;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å¤±è´¥å›æº¯</strong>ï¼šå‘é€è¯·æ±‚ä¼šæºå¸¦ <code>prevLogTerm</code> å’Œ <code>prevLogIndex</code>ã€‚å¦‚æœ Follower è¿”å›å¤±è´¥ï¼ˆæ—¥å¿—ä¸åŒ¹é…æˆ– Leader Term è¿‡æ—§ï¼‰ï¼š<ul><li>å¦‚æœæ˜¯Leader Term è¿‡æ—§ï¼Œé‚£å°±é™çº§ä¸ºFollowerã€‚</li><li>å¦‚æœä¸æ˜¯å› ä¸ºTermè¿‡æ—§ï¼ŒLeader å°±å°†è¯¥ Follower çš„ <code>nextIndex</code> å‡ä¸€ã€‚</li><li>ä¸‹æ¬¡å¿ƒè·³æ—¶é‡è¯•å‰ä¸€æ¡æ—¥å¿—ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…ç‚¹ï¼ˆMatchIndexï¼‰ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">AentryResult</span> <span class="variable">result</span> <span class="operator">=</span> getRpcClient().send(request,<span class="number">450</span>);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result.isSuccess()) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;append follower entry success , follower=[&#123;&#125;], entry=[&#123;&#125;]&quot;</span>, peer, aentryParam.getEntries());</span><br><span class="line">        <span class="comment">// update è¿™ä¸¤ä¸ªè¿½è¸ªå€¼</span></span><br><span class="line">        nextIndexs.put(peer, myNewIndex+<span class="number">1</span>);</span><br><span class="line">        matchIndexs.put(peer, myNewIndex);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!result.isSuccess()) &#123;</span><br><span class="line">        <span class="comment">// å¯¹æ–¹æ¯”æˆ‘å¤§</span></span><br><span class="line">        <span class="keyword">if</span> (result.getTerm() &gt; currentTerm) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;follower [&#123;&#125;] term [&#123;&#125;] than more self, and my term = [&#123;&#125;], so, I will become follower&quot;</span>,</span><br><span class="line">                    peer, result.getTerm(), currentTerm);</span><br><span class="line">            currentTerm = result.getTerm();</span><br><span class="line">            <span class="comment">// è®¤æ€‚, å˜æˆè·Ÿéšè€…</span></span><br><span class="line">            status = NodeStatus.FOLLOWER;</span><br><span class="line">        &#125; <span class="comment">// æ²¡æˆ‘å¤§, å´å¤±è´¥äº†,è¯´æ˜ index ä¸å¯¹.æˆ–è€… term ä¸å¯¹.</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//å°†nextIndex å‡ä¸€ ä¸‹ä¸€æ¬¡å¿ƒè·³ç»§ç»­åŒ¹é…ã€‚</span></span><br><span class="line">            nextIndexs.put(peer, nextIndex - <span class="number">1</span>);</span><br><span class="line">            log.warn(<span class="string">&quot;follower &#123;&#125; nextIndex not match, will reduce nextIndex and retry RPC append, nextIndex : [&#123;&#125;]&quot;</span>, peer.getAddr(),</span><br><span class="line">                    nextIndex);</span><br><span class="line">            <span class="comment">// ä¸‹æ¬¡å¿ƒè·³é‡æ¥, ç›´åˆ°æˆåŠŸ.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;å½“å‰æ¥å—èŠ‚ç‚¹ &#123;&#125; å·²å®•æœº&quot;</span>, peer.getAddr());</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h3 id="3-Follower-çš„å¤„ç†é€»è¾‘"><a href="#3-Follower-çš„å¤„ç†é€»è¾‘" class="headerlink" title="3. Follower çš„å¤„ç†é€»è¾‘"></a>3. Follower çš„å¤„ç†é€»è¾‘</h3><p>Follower åœ¨æ¥æ”¶ç«¯çš„å¤„ç†ä¹Ÿåšäº†ç»†è‡´çš„é”ç®¡ç†ï¼š</p><ul><li><strong>æ—¥å¿—å†™å…¥</strong>ï¼šæ”¶åˆ°æ—¥å¿—åä¸¥æ ¼æ ¡éªŒåŒ¹é…æ€§ã€‚åŒ¹é…æˆåŠŸåˆ™<strong>åŠ é”</strong>å†™å…¥æœ¬åœ°æ—¥å¿—,ä¹‹åæ ¹æ®leader çš„ <code>commitIndex</code>è·Ÿè‡ªå·±çš„ <code>lastIndex</code> æ›´æ–°è‡ªå·± <code>commitIndex</code>ï¼Œå¼‚æ­¥åº”ç”¨åˆ°çŠ¶æ€æœºï¼Œå¹¶è¿”å›æˆåŠŸã€‚</li><li><strong>å¿ƒè·³å¤„ç†</strong>ï¼šæ”¶åˆ°å¿ƒè·³æ—¶ï¼Œè‹¥ Leader Term å°äºè‡ªå·±ï¼Œåˆ™æ‹’ç»å¹¶å‘ŠçŸ¥å¯¹æ–¹é€€ä½ã€‚è‹¥ Term åˆæ³•ï¼Œé‡ç½®é€‰ä¸¾è¶…æ—¶ï¼Œè½¬ä¸º Followerï¼ˆå› ä¸ºè‡ªå·±ä¹‹å‰å¯èƒ½æ˜¯å€™é€‰äººï¼Œæˆ–è€…åˆ†åŒºä¹‹ååˆåˆåŒºçš„è€leaderï¼‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AentryResult <span class="title function_">appendEntries</span><span class="params">(AentryParam param)</span> &#123;</span><br><span class="line">        <span class="type">AentryResult</span> <span class="variable">result</span> <span class="operator">=</span> AentryResult.fail();</span><br><span class="line">        <span class="comment">// åŸappendLockä»…ä¿æŠ¤æ—¥å¿—å†™å…¥/åˆ é™¤ç­‰ä¸´ç•Œæ“ä½œï¼Œé”èŒƒå›´ç¼©å°</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!appendLock.tryLock()) &#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            result.setTerm(node.getCurrentTerm());</span><br><span class="line">            <span class="comment">// 1. ä»»æœŸæ£€æŸ¥ï¼šå¯¹æ–¹ä»»æœŸæ›´å°ï¼Œç›´æ¥è¿”å›å¤±è´¥</span></span><br><span class="line">            <span class="keyword">if</span> (param.getTerm() &lt; node.getCurrentTerm()) &#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. æ›´æ–°èŠ‚ç‚¹çŠ¶æ€ï¼ˆFollowerï¼‰å’Œæ—¶é—´æˆ³</span></span><br><span class="line">            node.preHeartBeatTime = System.currentTimeMillis();</span><br><span class="line">            node.preElectionTime = System.currentTimeMillis();</span><br><span class="line">            node.peerSet.setLeader(<span class="keyword">new</span> <span class="title class_">Peer</span>(param.getLeaderId()));</span><br><span class="line">            <span class="keyword">if</span> (param.getTerm() &gt;= node.getCurrentTerm()) &#123;</span><br><span class="line">                LOGGER.debug(<span class="string">&quot;node &#123;&#125; become FOLLOWER, currentTerm : &#123;&#125;, param Term : &#123;&#125;, param serverId = &#123;&#125;&quot;</span>,</span><br><span class="line">                        node.peerSet.getSelf(), node.currentTerm, param.getTerm(), param.getServerId());</span><br><span class="line">                <span class="comment">// é€€ä¸ºè·Ÿéšè€…</span></span><br><span class="line">                node.status = NodeStatus.FOLLOWER;</span><br><span class="line">            &#125;</span><br><span class="line">            node.setCurrentTerm(param.getTerm());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. å¤„ç†å¿ƒè·³è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">if</span> (param.getEntries() == <span class="literal">null</span> || param.getEntries().length == <span class="number">0</span>) &#123;</span><br><span class="line">                LOGGER.info(<span class="string">&quot;node &#123;&#125; append heartbeat success , he&#x27;s term : &#123;&#125;, my term : &#123;&#125;&quot;</span>,</span><br><span class="line">                        param.getLeaderId(), param.getTerm(), node.getCurrentTerm());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¿ƒè·³ä»…æ›´æ–°commitIndexï¼ŒçŠ¶æ€æœºæäº¤å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">                <span class="keyword">if</span> (param.getLeaderCommit() &gt; node.getCommitIndex()) &#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">newCommitIndex</span> <span class="operator">=</span> Math.min(param.getLeaderCommit(), node.getLogModule().getLastIndex());</span><br><span class="line">                    node.setCommitIndex(newCommitIndex);</span><br><span class="line">                    <span class="comment">// å¼‚æ­¥æäº¤çŠ¶æ€æœºï¼ˆæ ¸å¿ƒæ”¹é€ ç‚¹ï¼‰</span></span><br><span class="line">                    submitToStateMachineAsync();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¿ƒè·³ç›´æ¥è¿”å›æˆåŠŸï¼Œæ— éœ€ç­‰å¾…æäº¤</span></span><br><span class="line">                <span class="keyword">return</span> AentryResult.newBuilder().term(node.getCurrentTerm()).success(<span class="literal">true</span>).build();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. å¤„ç†çœŸå®æ—¥å¿—åŒæ­¥è¯·æ±‚</span></span><br><span class="line">            <span class="comment">// 4.1 å‰ç½®æ—¥å¿—æ£€æŸ¥ï¼šprevLogIndex/prevLogTermä¸åŒ¹é…åˆ™è¿”å›å¤±è´¥</span></span><br><span class="line">            <span class="comment">// å¦‚æœprevLogIndex=-1ï¼Œåˆ™ä»£è¡¨è¯¥æ—¥å¿—æ˜¯leaderçš„ç¬¬ä¸€æ¡æ—¥å¿—ï¼Œæ­¤æ—¶ä¸éœ€è¦åŒ¹é…ï¼Œå› ä¸ºå·²ç»æ˜¯ç¬¬ä¸€ä¸ªäº†ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (param.getPrevLogIndex() != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">LogEntry</span> <span class="variable">logEntry</span> <span class="operator">=</span> node.getLogModule().read(param.getPrevLogIndex());</span><br><span class="line">                <span class="keyword">if</span> (logEntry == <span class="literal">null</span> || logEntry.getTerm() != param.getPreLogTerm()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.2 å†²çªæ—¥å¿—å¤„ç†ï¼šç´¢å¼•ç›¸åŒä½†ä»»æœŸä¸åŒåˆ™åˆ é™¤åç»­æ‰€æœ‰æ—¥å¿—</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">nextLogIndex</span> <span class="operator">=</span> param.getPrevLogIndex() + <span class="number">1</span>;</span><br><span class="line">            <span class="type">LogEntry</span> <span class="variable">existLog</span> <span class="operator">=</span> node.getLogModule().read(nextLogIndex);</span><br><span class="line">            <span class="keyword">if</span> (existLog != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (existLog.getTerm() != param.getEntries()[<span class="number">0</span>].getTerm()) &#123;</span><br><span class="line">                    <span class="comment">// åˆ é™¤å†²çªæ—¥å¿—åŠåç»­</span></span><br><span class="line">                    node.getLogModule().removeOnStartIndex(nextLogIndex);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// æ—¥å¿—å·²å­˜åœ¨ï¼Œæ— éœ€é‡å¤å†™å…¥ï¼Œç›´æ¥è¿”å›æˆåŠŸ</span></span><br><span class="line">                    result.setSuccess(<span class="literal">true</span>);</span><br><span class="line">                    result.setTerm(node.getCurrentTerm());</span><br><span class="line">                    <span class="keyword">return</span> result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.3 å†™å…¥æ—¥å¿—ï¼ˆæ ¸å¿ƒï¼šå†™å…¥å®Œæˆå³å¯è¿”å›æˆåŠŸï¼‰</span></span><br><span class="line">            <span class="keyword">for</span> (LogEntry entry : param.getEntries()) &#123;</span><br><span class="line">                node.getLogModule().write(entry);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ—¥å¿—å†™å…¥æˆåŠŸï¼Œå…ˆæ ‡è®°ç»“æœä¸ºæˆåŠŸ</span></span><br><span class="line">            result.setSuccess(<span class="literal">true</span>);</span><br><span class="line">            result.setTerm(node.getCurrentTerm());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.4 æ›´æ–°commitIndexï¼ŒçŠ¶æ€æœºæäº¤å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (param.getLeaderCommit() &gt; node.getCommitIndex()) &#123;</span><br><span class="line">                <span class="comment">// æ›´æ–°commitIndexä¸ºleaderCommitè·Ÿæœ¬èŠ‚ç‚¹çš„lastIndexå–æœ€å°å€¼</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">newCommitIndex</span> <span class="operator">=</span> Math.min(param.getLeaderCommit(), node.getLogModule().getLastIndex());</span><br><span class="line">                node.setCommitIndex(newCommitIndex);</span><br><span class="line">                <span class="comment">// å¼‚æ­¥æäº¤çŠ¶æ€æœºï¼ˆæ ¸å¿ƒæ”¹é€ ç‚¹ï¼‰</span></span><br><span class="line">                submitToStateMachineAsync();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.5 ç«‹å³è¿”å›æˆåŠŸï¼Œæ— éœ€ç­‰å¾…çŠ¶æ€æœºæäº¤</span></span><br><span class="line">            node.status = NodeStatus.FOLLOWER;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// é‡Šæ”¾æ—¥å¿—æ“ä½œé”</span></span><br><span class="line">            <span class="keyword">if</span> (appendLock.isHeldByCurrentThread()) &#123;</span><br><span class="line">                appendLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å¼‚æ­¥åº”ç”¨ (Async Apply)</strong>ï¼š<ul><li>å¿ƒè·³åŒ…ä¸­åŒ…å« Leader çš„ <code>commitIndex</code>ã€‚</li><li>Follower å– <code>min(leaderCommit, lastLogIndex)</code> ä½œä¸ºæœ¬åœ°æäº¤ç‚¹ã€‚</li><li><strong>ä¼˜åŒ–ç‚¹</strong>ï¼šå†™å…¥æœ¬åœ°æ—¥å¿—åï¼Œæˆ–è€…æ›´æ–° commitIndex åï¼Œé‡‡ç”¨<strong>å¼‚æ­¥æ–¹å¼</strong>å°†æ—¥å¿—åº”ç”¨ï¼ˆApplyï¼‰åˆ°çŠ¶æ€æœºï¼Œé¿å…é˜»å¡ IO çº¿ç¨‹ï¼Œæå‡æ•ˆç‡ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">submitToStateMachineAsync</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æäº¤åˆ°ä¸“ç”¨çº¿ç¨‹æ± ï¼Œå¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">        commitExecutor.submit(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// åŠ é”ä¿è¯ä¸²è¡Œæäº¤ï¼Œé¿å…é‡å¤/å¹¶å‘æäº¤</span></span><br><span class="line">            commitLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// åŸºäºlastAppliedè®¡ç®—ä¸‹ä¸€ä¸ªè¦æäº¤çš„ç´¢å¼•ï¼ˆæ–­ç‚¹ç»­ä¼ æ ¸å¿ƒï¼‰</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">nextCommit</span> <span class="operator">=</span> node.getLastApplied() + <span class="number">1</span>;</span><br><span class="line">                <span class="type">long</span> <span class="variable">commitIndex</span> <span class="operator">=</span> node.getCommitIndex();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (nextCommit &gt; commitIndex) &#123;</span><br><span class="line">                    LOGGER.debug(<span class="string">&quot;æš‚æ— éœ€è¦æäº¤çš„æ—¥å¿—ï¼ŒlastApplied=&#123;&#125;, commitIndex=&#123;&#125;&quot;</span>, nextCommit-<span class="number">1</span>, commitIndex);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                LOGGER.info(<span class="string">&quot;å¼€å§‹å¼‚æ­¥æäº¤æ—¥å¿—ï¼Œä»ç´¢å¼•&#123;&#125;åˆ°&#123;&#125;&quot;</span>, nextCommit, commitIndex);</span><br><span class="line">                <span class="comment">// å¾ªç¯æäº¤æ—¥å¿—åˆ°çŠ¶æ€æœº</span></span><br><span class="line">                <span class="keyword">while</span> (nextCommit &lt;= commitIndex) &#123;</span><br><span class="line">                    <span class="type">LogEntry</span> <span class="variable">logEntry</span> <span class="operator">=</span> node.getLogModule().read(nextCommit);</span><br><span class="line">                    <span class="keyword">if</span> (logEntry != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            node.stateMachine.apply(logEntry);</span><br><span class="line">                            <span class="comment">// æ¯æäº¤ä¸€æ¡æ›´æ–°ä¸€æ¬¡lastAppliedï¼Œä¿è¯æ–­ç‚¹ç»­ä¼ </span></span><br><span class="line">                            node.setLastApplied(nextCommit);</span><br><span class="line">                            LOGGER.info(<span class="string">&quot;å¼‚æ­¥æäº¤æ—¥å¿—æˆåŠŸï¼Œç´¢å¼•=&#123;&#125;&quot;</span>, nextCommit);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                            LOGGER.error(<span class="string">&quot;å¼‚æ­¥æäº¤æ—¥å¿—åˆ°çŠ¶æ€æœºå¤±è´¥ï¼Œç´¢å¼•=&#123;&#125;&quot;</span>, nextCommit, e);</span><br><span class="line">                            <span class="comment">// æäº¤å¤±è´¥åˆ™ç»ˆæ­¢ï¼Œé¿å…åç»­æ—¥å¿—é”™ä½</span></span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        LOGGER.warn(<span class="string">&quot;æ—¥å¿—ä¸å­˜åœ¨ï¼Œç´¢å¼•=&#123;&#125;&quot;</span>, nextCommit);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    nextCommit++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// é‡Šæ”¾æäº¤é”</span></span><br><span class="line">                commitLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€-CommitIndex-çš„è®¡ç®—ä¸å®‰å…¨æ€§"><a href="#ä¸‰ã€-CommitIndex-çš„è®¡ç®—ä¸å®‰å…¨æ€§" class="headerlink" title="ä¸‰ã€ CommitIndex çš„è®¡ç®—ä¸å®‰å…¨æ€§"></a>ä¸‰ã€ CommitIndex çš„è®¡ç®—ä¸å®‰å…¨æ€§</h2><p>å¦‚ä½•ç¡®å®šä¸€æ¡æ—¥å¿—å¯ä»¥è¢«å®‰å…¨æäº¤ï¼Ÿ</p><h3 id="1-åŸºäºä¸­ä½æ•°çš„-CommitIndex-è®¡ç®—"><a href="#1-åŸºäºä¸­ä½æ•°çš„-CommitIndex-è®¡ç®—" class="headerlink" title="1. åŸºäºä¸­ä½æ•°çš„ CommitIndex è®¡ç®—"></a>1. åŸºäºä¸­ä½æ•°çš„ CommitIndex è®¡ç®—</h3><p>ä¸å†ç®€å•ä¾èµ–å•æ¬¡ RPC çš„æˆåŠŸç‡ï¼Œè€Œæ˜¯åŸºäºå…¨å±€è§†å›¾ï¼š</p><ul><li>åœ¨æ¯æ¬¡å¿ƒè·³/æ—¥å¿—å‘é€å®Œæˆï¼ˆ<code>CompletableFuture.allOf</code> ç»“æŸï¼‰åï¼Œç»Ÿè®¡æ‰€æœ‰èŠ‚ç‚¹çš„ <code>matchIndex</code>ã€‚</li><li><strong>æ±‚ä¸­ä½æ•°</strong>ï¼šé€šè¿‡æ’åºæˆ–ç»Ÿè®¡ç®—æ³•ï¼Œæ‰¾å‡ºè¶…è¿‡åŠæ•°èŠ‚ç‚¹éƒ½æ‹¥æœ‰çš„æœ€å¤§ç´¢å¼•å€¼ã€‚</li><li><strong>ä»»æœŸæ£€æŸ¥</strong>ï¼šRaft è§„å®šåªèƒ½æäº¤å½“å‰ä»»æœŸçš„æ—¥å¿—ã€‚å› æ­¤ï¼Œè®¡ç®—å‡ºçš„ç´¢å¼•å¯¹åº”çš„æ—¥å¿— term å¿…é¡»ç­‰äº <code>currentTerm</code> æ‰èƒ½æ›´æ–° <code>commitIndex</code>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç­‰å¾…æ‰€æœ‰æ—¥å¿—å®Œæˆ</span></span><br><span class="line"><span class="keyword">try</span>  &#123;</span><br><span class="line">    <span class="comment">//å¤šä¸ªä»»åŠ¡</span></span><br><span class="line">    CompletableFuture[] futureArray = futureList.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">//å°†å¤šä¸ªä»»åŠ¡ï¼Œæ±‡æ€»æˆä¸€ä¸ªä»»åŠ¡ï¼Œæ€»å…±è€—æ—¶ä¸è¶…æ—¶2ç§’</span></span><br><span class="line">    CompletableFuture.allOf(futureArray).get(<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    log.error(<span class="string">&quot;CompletableFuture.allOf Exception error.&quot;</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå­˜åœ¨ä¸€ä¸ªæ»¡è¶³N &gt; commitIndexçš„ Nï¼Œå¹¶ä¸”å¤§å¤šæ•°çš„matchIndex[i] â‰¥ Næˆç«‹ï¼Œ</span></span><br><span class="line"><span class="comment">// å¹¶ä¸”log[N].term == currentTermæˆç«‹ï¼Œé‚£ä¹ˆä»¤ commitIndex ç­‰äºè¿™ä¸ª N ï¼ˆ5.3 å’Œ 5.4 èŠ‚ï¼‰</span></span><br><span class="line">List&lt;Long&gt; matchIndexList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(matchIndexs.values());</span><br><span class="line"><span class="comment">// å°äº 2, æ²¡æœ‰æ„ä¹‰</span></span><br><span class="line"><span class="type">int</span> <span class="variable">median</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (matchIndexList.size() &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    Collections.sort(matchIndexList);</span><br><span class="line">    median = matchIndexList.size() / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Long</span> <span class="variable">N</span> <span class="operator">=</span> matchIndexList.get(median);</span><br><span class="line"><span class="keyword">if</span> (N &gt; commitIndex) &#123;</span><br><span class="line">    <span class="type">LogEntry</span> <span class="variable">entry</span> <span class="operator">=</span> logModule.read(N);</span><br><span class="line">    <span class="comment">// åªèƒ½æäº¤å½“å‰ä»»æœŸæ—¥å¿—</span></span><br><span class="line">    <span class="keyword">if</span> (entry != <span class="literal">null</span> &amp;&amp; entry.getTerm() == currentTerm) &#123;</span><br><span class="line">        commitIndex = N;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥åº”ç”¨åˆ°çŠ¶æ€æœº</span></span><br><span class="line">        RaftThreadPool.execute(()-&gt;&#123;</span><br><span class="line">            commitLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">myCommitIndex</span> <span class="operator">=</span> commitIndex;</span><br><span class="line">                <span class="comment">//åº”è¯¥ä»lastAppliedå¼€å§‹åº”ç”¨ï¼Œç›´åˆ°å¼‚æ­¥å¼€å§‹æ—¶çš„commitIndexï¼ˆé˜²æ­¢é‡å¤æäº¤ï¼‰</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> lastApplied + <span class="number">1</span>; i &lt;= myCommitIndex; i++)&#123;</span><br><span class="line">                    getStateMachine().apply(logModule.read(i));</span><br><span class="line">                    log.info(<span class="string">&quot;å¼‚æ­¥åº”ç”¨æ—¥å¿—æˆåŠŸ,  logEntry info : &#123;&#125;&quot;</span>, logModule.read(i));</span><br><span class="line">                &#125;</span><br><span class="line">                lastApplied = myCommitIndex;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;leader èŠ‚ç‚¹ &#123;&#125; æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºå¤±è´¥&quot;</span>,peerSet.getSelf());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                commitLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-è§£å†³â€œå¹½çµå¤ç°â€ï¼šNo-Op-Log"><a href="#2-è§£å†³â€œå¹½çµå¤ç°â€ï¼šNo-Op-Log" class="headerlink" title="2. è§£å†³â€œå¹½çµå¤ç°â€ï¼šNo-Op Log"></a>2. è§£å†³â€œå¹½çµå¤ç°â€ï¼šNo-Op Log</h3><p>é’ˆå¯¹â€œåªèƒ½æäº¤å½“å‰ä»»æœŸæ—¥å¿—â€å¯¼è‡´æ—§æ—¥å¿—å¯èƒ½æ— æ³•åŠæ—¶æäº¤çš„é—®é¢˜ï¼ˆå¦‚æœå…è®¸æäº¤å¯èƒ½ä¼šå¯¼è‡´åŒä¸€ä¸ªä½ç½®çš„æ—¥å¿—é‡å¤æäº¤ï¼‰ï¼Œé‡‡ç”¨äº†<strong>æ’å…¥ç©ºæ—¥å¿—</strong>ç­–ç•¥ï¼š</p><ul><li>æ–° Leader ä¸Šä»»åï¼Œç«‹å³appendä¸€æ¡ç©ºæ—¥å¿—ï¼ˆNo-Op Logï¼‰ã€‚</li><li>ä¸€æ—¦è¿™æ¡å½“å‰ä»»æœŸçš„ç©ºæ—¥å¿—è¢«æäº¤ï¼Œæ ¹æ®æ—¥å¿—è¿ç»­æ€§åŸåˆ™ï¼Œä¹‹å‰æ‰€æœ‰æœªæäº¤çš„æ—§æ—¥å¿—ä¹Ÿä¼šè¢«é—´æ¥æäº¤ã€‚</li><li>åˆå§‹åŒ–ï¼šæ–° Leader å°†æ‰€æœ‰ Follower çš„ <code>nextIndex</code> åˆå§‹åŒ–ä¸º <code>lastIndex + 1</code>ï¼Œ <code>matchIndex</code> åˆå§‹åŒ–ä¸º <code>0</code>ã€‚åˆ©ç”¨åç»­çš„å¿ƒè·³å›æº¯æœºåˆ¶è‡ªåŠ¨å¯¹å…¶ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">becomeLeaderToDoThing</span><span class="params">()</span> &#123;</span><br><span class="line">        nextIndexs = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        matchIndexs = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Peer peer : peerSet.getPeersWithOutSelf()) &#123;</span><br><span class="line">            nextIndexs.put(peer, logModule.getLastIndex() + <span class="number">1</span>);</span><br><span class="line">            matchIndexs.put(peer, <span class="number">0L</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»º[ç©ºæ—¥å¿—]å¹¶æäº¤ï¼Œç”¨äºå¤„ç†å‰ä»»é¢†å¯¼è€…æœªæäº¤çš„æ—¥å¿—</span></span><br><span class="line">        <span class="type">LogEntry</span> <span class="variable">logEntry</span> <span class="operator">=</span> LogEntry.builder()</span><br><span class="line">                .command(<span class="literal">null</span>)</span><br><span class="line">                .term(currentTerm)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åªç”¨æäº¤åˆ°æœ¬åœ°æ—¥å¿— ï¼Œ åŒæ­¥æ“ä½œåœ¨ä¸‹ä¸€æ¬¡å‘é€å¿ƒè·³æ—¶è¿›è¡Œã€‚</span></span><br><span class="line">        logModule.write(logEntry);</span><br><span class="line">        log.info(<span class="string">&quot;write logModule success, logEntry info : &#123;&#125;, log index : &#123;&#125;&quot;</span>, logEntry, logEntry.getIndex());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="å››ã€-çº¿æ€§ä¸€è‡´æ€§è¯»-Linearizable-Read"><a href="#å››ã€-çº¿æ€§ä¸€è‡´æ€§è¯»-Linearizable-Read" class="headerlink" title="å››ã€ çº¿æ€§ä¸€è‡´æ€§è¯» (Linearizable Read)"></a>å››ã€ çº¿æ€§ä¸€è‡´æ€§è¯» (Linearizable Read)</h2><p>ä¸ºäº†é˜²æ­¢è¯»å–åˆ°æ—§æ•°æ®ï¼ˆStale Readï¼‰ï¼Œå®ç°äº† Follower Read å’Œ Leader Readã€‚</p><ul><li><strong>Leader Read</strong>ï¼šLeader æ”¶åˆ°è¯»è¯·æ±‚åï¼Œä¸èƒ½ç›´æ¥è¿”å›ã€‚éœ€å…ˆå¹¿æ’­ä¸€è½®å¿ƒè·³ï¼ˆåŒæ ·ä½¿ç”¨ <code>CompletableFuture</code> æœºåˆ¶ï¼‰ï¼Œç¡®è®¤è‡ªå·±ä»æŒæœ‰è¿‡åŠæ•°é€‰ç¥¨ï¼ˆæœªå‘ç”Ÿè„‘è£‚ï¼‰ã€‚ç¡®è®¤æˆåŠŸåï¼Œç­‰å¾…çŠ¶æ€æœºåº”ç”¨åˆ° <code>commitIndex</code> åè¿”å›ç»“æœã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­è‡ªå·±æ˜¯å¦è¿˜æ˜¯leader</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isStillLeader</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">Agree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">        List&lt;CompletableFuture&lt;AentryResult&gt;&gt; futureList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Peer peer : peerSet.getPeersWithOutSelf()) &#123;</span><br><span class="line">            <span class="type">AentryParam</span> <span class="variable">param</span> <span class="operator">=</span> AentryParam.builder()</span><br><span class="line">                    .entries(<span class="literal">null</span>)<span class="comment">// å¿ƒè·³,ç©ºæ—¥å¿—.</span></span><br><span class="line">                    .leaderId(peerSet.getSelf().getAddr())</span><br><span class="line">                    .serverId(peer.getAddr())</span><br><span class="line">                    .term(currentTerm)</span><br><span class="line">                    .leaderCommit(commitIndex) <span class="comment">// å¿ƒè·³æ—¶ä¸è·Ÿéšè€…åŒæ­¥ commit index</span></span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(</span><br><span class="line">                    Request.A_ENTRIES,</span><br><span class="line">                    param,</span><br><span class="line">                    peer.getAddr());</span><br><span class="line">            futureList.add(CompletableFuture.supplyAsync(()-&gt; getRpcClient().&lt;AentryResult&gt;send(request,<span class="number">300</span>)</span><br><span class="line">                    ,RaftThreadPool.giveMePool()).exceptionally(ex -&gt; <span class="literal">null</span>)</span><br><span class="line">                    .whenComplete((result,throwable)-&gt;&#123;</span><br><span class="line">                        <span class="keyword">if</span>(result == <span class="literal">null</span>)&#123;</span><br><span class="line">                            log.error(<span class="string">&quot;æ— æ³•æ”¶åˆ° &#123;&#125; èŠ‚ç‚¹çš„å¿ƒè·³å›åº”ï¼Œè¯¥èŠ‚ç‚¹å¯èƒ½å·²ç»å®•æœº&quot;</span>,peer.getAddr());</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="type">long</span> <span class="variable">term</span> <span class="operator">=</span> result.getTerm();</span><br><span class="line">                            <span class="keyword">if</span>(term &gt; currentTerm)&#123;</span><br><span class="line">                                log.error(<span class="string">&quot;æ”¶åˆ°æ›´å¤§çš„termæ¥è‡ªèŠ‚ç‚¹&#123;&#125;  å½“å‰èŠ‚ç‚¹&#123;&#125;ç›®å‰å·²ä¸é€‚åˆå½“leader&quot;</span>,peer.getAddr(),peerSet.getSelf().getAddr());</span><br><span class="line">                                currentTerm = term;</span><br><span class="line">                                votedFor = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                                status = NodeStatus.FOLLOWER;</span><br><span class="line">                            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                <span class="comment">//æˆåŠŸå›å¤</span></span><br><span class="line">                                <span class="keyword">if</span>(result.isSuccess())&#123;</span><br><span class="line">                                    log.info(<span class="string">&quot;æˆåŠŸæ”¶åˆ°æ¥è‡ªèŠ‚ç‚¹&#123;&#125;çš„å¿ƒè·³å›å¤ä¸”åˆæ³•&quot;</span>,peer.getAddr());</span><br><span class="line">                                    Agree.incrementAndGet();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç­‰å¾…æ‰€æœ‰å¿ƒè·³å›åº”</span></span><br><span class="line">        <span class="keyword">try</span>  &#123;</span><br><span class="line">            <span class="comment">//å¤šä¸ªä»»åŠ¡</span></span><br><span class="line">            CompletableFuture[] futureArray = futureList.toArray(<span class="keyword">new</span> <span class="title class_">CompletableFuture</span>[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//å°†å¤šä¸ªä»»åŠ¡ï¼Œæ±‡æ€»æˆä¸€ä¸ªä»»åŠ¡ï¼Œæ€»å…±è€—æ—¶ä¸è¶…æ—¶2ç§’</span></span><br><span class="line">            CompletableFuture.allOf(futureArray).get(<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;CompletableFuture.allOf Exception error.&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç°åœ¨è‡ªå·±è¿˜æ˜¯ä¸æ˜¯leader</span></span><br><span class="line">        <span class="keyword">if</span>(status!=NodeStatus.LEADER)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ”¶åˆ°çš„å›å¤æ•°æ˜¯å¦å¤§äºç­‰äºä¸€åŠï¼ˆåŠ ä¸Šè‡ªå·±å³å¤§äºä¸€åŠï¼‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">agreeNum</span> <span class="operator">=</span> Agree.get();</span><br><span class="line">        <span class="keyword">if</span>(agreeNum &gt;= (peerSet.getPeersWithOutSelf().size()+<span class="number">1</span>)/<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><strong>Follower Read</strong>ï¼š<ol><li>Follower æ”¶åˆ°è¯»è¯·æ±‚ï¼Œå‘ Leader å‘é€ <code>ReadIndex</code> RPCã€‚</li><li>Leader æ”¶åˆ°åï¼Œæ‰§è¡Œä¸Šè¿°â€œç¡®è®¤é¢†å¯¼æƒâ€æµç¨‹ï¼Œè¿”å›å½“å‰çš„ <code>commitIndex</code>ã€‚</li><li>Follower æ‹¿åˆ° <code>commitIndex</code> åï¼Œç­‰å¾…æœ¬åœ° <code>appliedIndex &gt;= commitIndex</code>ï¼Œå†å°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol></li></ul><p>å“åº”å®¢æˆ·ç«¯è¯·æ±‚çš„æ¥å£ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>  ClientKVAck <span class="title function_">handlerClientRequest</span><span class="params">(ClientKVReq request)</span> &#123;</span><br><span class="line"></span><br><span class="line">    log.warn(<span class="string">&quot;handlerClientRequest handler &#123;&#125; operation,  and key : [&#123;&#125;], value : [&#123;&#125;]&quot;</span>,</span><br><span class="line">            ClientKVReq.Type.value(request.getType()), request.getKey(), request.getValue());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å†™è¯·æ±‚å¿…é¡»è½¬ç»™leader</span></span><br><span class="line">    <span class="keyword">if</span> (status != NodeStatus.LEADER &amp;&amp; request.getType() == ClientKVReq.PUT) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;I not am leader , only invoke redirect write method, leader addr : &#123;&#125;, my addr : &#123;&#125;&quot;</span>,</span><br><span class="line">                peerSet.getLeader(), peerSet.getSelf().getAddr());</span><br><span class="line">        <span class="keyword">return</span> redirect(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// leaderæ”¶åˆ°è¯»è¯·æ±‚ã€‚</span></span><br><span class="line">    <span class="comment">//ä¸ºäº†æ»¡è¶³é¡ºåºä¸€è‡´æ€§è¦æ±‚ï¼Œå¿…é¡»è®©lastApplied == commitIndexæ‰è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (request.getType() == ClientKVReq.GET &amp;&amp; status == NodeStatus.LEADER) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­è‡ªå·±æ˜¯å¦è¿˜æ˜¯leader</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLeader</span> <span class="operator">=</span> isStillLeader();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!isLeader)&#123;</span><br><span class="line">            <span class="keyword">return</span> ClientKVAck.fail();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¿è¯è‡ªå·±çš„lastApplied == commitIndex</span></span><br><span class="line">        <span class="keyword">if</span>(lastApplied != commitIndex)&#123;</span><br><span class="line">            commitLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//åº”è¯¥ä»lastAppliedå¼€å§‹åº”ç”¨ï¼Œç›´åˆ°commitIndex</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> lastApplied + <span class="number">1</span>; i &lt;= commitIndex; i++)&#123;</span><br><span class="line">                    getStateMachine().apply(logModule.read(i));</span><br><span class="line">                    log.info(<span class="string">&quot;å¼‚æ­¥åº”ç”¨æ—¥å¿—æˆåŠŸ,  logEntry info : &#123;&#125;&quot;</span>, logModule.read(i));</span><br><span class="line">                &#125;</span><br><span class="line">                lastApplied = commitIndex;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;leader èŠ‚ç‚¹ &#123;&#125; æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºå¤±è´¥&quot;</span>,peerSet.getSelf());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                commitLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">LogEntry</span> <span class="variable">logEntry</span> <span class="operator">=</span> stateMachine.get(request.getKey());</span><br><span class="line">        <span class="keyword">if</span> (logEntry != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClientKVAck</span>(logEntry);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClientKVAck</span>(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœæ˜¯followeræ”¶åˆ°è¯»è¯·æ±‚</span></span><br><span class="line">    <span class="comment">//å¯ä»¥å®ç°follower read , followerå‘leaderå‘é€æŸ¥è¯¢å½“å‰readIndexçš„è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (request.getType() == ClientKVReq.GET &amp;&amp; status == NodeStatus.FOLLOWER)&#123;</span><br><span class="line">        <span class="comment">//å‘leaderå‘é€è·å–å½“å‰æœ€æ–°commitIndexçš„è¯·æ±‚</span></span><br><span class="line">        <span class="type">Request</span> <span class="variable">request1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(</span><br><span class="line">                Request.GET_READ_INDEX,</span><br><span class="line">                <span class="literal">null</span>,</span><br><span class="line">                peerSet.getLeader().getAddr());</span><br><span class="line"></span><br><span class="line">        GetCommitIndexResult result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">             result = getRpcClient().send(request1,<span class="number">300</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ— æ³•ä¸leader &#123;&#125; å–å¾—è¿ç»­ï¼Œæ— æ³•è¿”å›è¯»è¯·æ±‚&quot;</span>,peerSet.getLeader().getAddr());</span><br><span class="line">            <span class="keyword">return</span> ClientKVAck.fail();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!result.isSuccess())&#123;</span><br><span class="line">            <span class="comment">//è¯´æ˜å½“å‰å‘é€çš„å·²ç»ä¸æ˜¯leader</span></span><br><span class="line">            <span class="keyword">return</span> ClientKVAck.fail();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">readIndex</span> <span class="operator">=</span> result.getReadIndex();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¿…é¡»åœ¨2så†…å“åº”</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        commitLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(System.currentTimeMillis() - start &lt;= <span class="number">2</span>*<span class="number">1000</span>)&#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">lastIndex</span> <span class="operator">=</span> logModule.getLastIndex();</span><br><span class="line">                <span class="type">long</span> <span class="variable">shouldCommit</span> <span class="operator">=</span> Math.min(readIndex,lastIndex);</span><br><span class="line">                <span class="comment">//åº”è¯¥ä»lastAppliedå¼€å§‹åº”ç”¨ï¼Œç›´åˆ°shouldCommit</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> lastApplied + <span class="number">1</span>; i &lt;= shouldCommit; i++)&#123;</span><br><span class="line">                    getStateMachine().apply(logModule.read(i));</span><br><span class="line">                    log.info(<span class="string">&quot;åº”ç”¨æ—¥å¿—æˆåŠŸ,  logEntry info : &#123;&#125;&quot;</span>, logModule.read(i));</span><br><span class="line">                &#125;</span><br><span class="line">                lastApplied = shouldCommit;</span><br><span class="line">                <span class="comment">//æ»¡è¶³è¦æ±‚</span></span><br><span class="line">                <span class="keyword">if</span>(lastApplied == readIndex)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç»§ç»­</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    commitLock.unlock();</span><br><span class="line">                    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    log.error(<span class="string">&quot;åŒæ­¥ ReadIndex æ—¶çº¿ç¨‹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> ClientKVAck.fail();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    commitLock.lock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ClientKVAck.fail();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            commitLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ç§’è¿‡åè¿˜æ˜¯æ²¡åŒæ­¥</span></span><br><span class="line">        <span class="keyword">if</span>(lastApplied!=readIndex)&#123;</span><br><span class="line">            <span class="keyword">return</span> ClientKVAck.fail();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">LogEntry</span> <span class="variable">logEntry</span> <span class="operator">=</span> stateMachine.get(request.getKey());</span><br><span class="line">        <span class="keyword">if</span> (logEntry != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClientKVAck</span>(logEntry);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClientKVAck</span>(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¦‚æœæ˜¯å€™é€‰äººå“åº”è¯»è¯·æ±‚ï¼Œåˆ™è¿”å›å¤±è´¥ï¼Œå› ä¸ºè‡ªå·±æ˜¯ä¸ç¨³å®šçš„</span></span><br><span class="line">    <span class="keyword">if</span>(request.getType() == ClientKVReq.GET &amp;&amp; status == NodeStatus.CANDIDATE)&#123;</span><br><span class="line">        <span class="keyword">return</span> ClientKVAck.fail();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸‹é¢å°±æ˜¯leaderå¤„ç†å†™è¯·æ±‚ï¼Œä½†ä»–åªä¼šå†™å…¥æœ¬åœ°ï¼ŒåŒæ­¥æ—¥å¿—åœ¨å¿ƒè·³æ—¶å®Œæˆã€‚</span></span><br><span class="line">    <span class="type">LogEntry</span> <span class="variable">logEntry</span> <span class="operator">=</span> LogEntry.builder()</span><br><span class="line">            .command(Command.builder().</span><br><span class="line">                    key(request.getKey()).</span><br><span class="line">                    value(request.getValue()).</span><br><span class="line">                    build())</span><br><span class="line">            .term(currentTerm)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æäº¤åˆ°æœ¬åœ°æ—¥å¿—</span></span><br><span class="line">    logModule.write(logEntry);</span><br><span class="line">    log.info(<span class="string">&quot;write logModule success, logEntry info : &#123;&#125;, log index : &#123;&#125;&quot;</span>, logEntry, logEntry.getIndex());</span><br><span class="line">    <span class="keyword">return</span> ClientKVAck.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="äº”ã€-åŸé¡¹ç›®çš„ä¸€äº›é—®é¢˜"><a href="#äº”ã€-åŸé¡¹ç›®çš„ä¸€äº›é—®é¢˜" class="headerlink" title="äº”ã€ åŸé¡¹ç›®çš„ä¸€äº›é—®é¢˜"></a>äº”ã€ åŸé¡¹ç›®çš„ä¸€äº›é—®é¢˜</h2><ol><li>åŸé¡¹ç›®åªæœ‰åœ¨æœ‰æ–°æ—¥å¿—æ¥çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ—¥å¿—åŒæ­¥ï¼Œæ²¡æœ‰æ–°æ—¥å¿—æ¥çš„æ—¶å€™ä¸ä¼šè¿›è¡Œæ—¥å¿—åŒæ­¥ï¼Œä½†æ˜¯ä¸€ä¸ªè½åçš„èŠ‚ç‚¹æ¢å¤ä¹‹åï¼Œåº”è¯¥è®©ä»–åŒæ­¥æ—¥å¿—ï¼Œè¿™æ ·å°±ä¸ä¼šåŒæ­¥åŠæ—¶ï¼Œäºæ˜¯æˆ‘æ”¹é€ æˆäº†æ¯æ¬¡å¿ƒè·³æ—¶è¿›è¡Œæ—¥å¿—åŒæ­¥ã€‚</li><li>åŸé¡¹ç›®åœ¨å¤šä¸ªå¼‚æ­¥çº¿ç¨‹çš„åŒæ­¥ï¼ˆæ¯”å¦‚æ‹‰ç¥¨è¯·æ±‚ï¼Œä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œå‘é€æ‹‰ç¥¨ï¼Œä½†å¿…é¡»éƒ½å®Œæˆä¹‹åæ‰å¼€å§‹ç»Ÿè®¡ï¼‰ä¸Šä½¿ç”¨äº† çº¿ç¨‹æ± +future+countDownLatch ä½¿ç”¨future.get()è·å¾—ç»“æœï¼Œç„¶åä½¿ç”¨countDownLatch.await()ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯future.get()è¿™ä¸ªæ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¯¼è‡´æ— æ³•è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚äºæ˜¯æˆ‘æ”¹é€ æˆäº†CompletableFuture+çº¿ç¨‹æ± çš„æ–¹å¼å®ç°ã€‚å…·ä½“è§å‰æ–‡ä¸­çš„ä»£ç ã€‚</li><li>åŸé¡¹ç›®æŠŠlastAppliedåˆå§‹åŒ–ä¸º0ï¼Œæˆ‘è®¤ä¸ºå¹¶ä¸åˆç†ï¼Œå› ä¸ºè¿™ä¸ªå°±é»˜è®¤0ä½ç½®çš„æ—¥å¿—å·²ç»åº”ç”¨äº†ã€‚æ‰€ä»¥åº”è¯¥æ”¹ä¸º-1ã€‚ï¼ˆæˆ‘çœ‹äº†ä¸€ä¸‹åŸé¡¹ç›®å¹¶æ²¡æœ‰è¯´æ˜0ä½ç½®çš„æ—¥å¿—æ˜¯åƒåœ¾æ—¥å¿—ï¼Œå¹¶ä¸”å†™å…¥æ—¥å¿—ä¹Ÿéƒ½æ˜¯ä»0å¼€å§‹ï¼Œæ‰€ä»¥0ä½ç½®æ˜¯æœ‰ç”¨çš„ï¼Œä¸åº”è¯¥è·³è¿‡ï¼‰ã€‚</li><li>åŸé¡¹ç›®æ²¡æœ‰å¯¹RPCè¯·æ±‚è¿›è¡Œè¶…æ—¶é™åˆ¶ã€‚è¿™æ ·åœ¨æŠ•ç¥¨ä¸­ææœ‰å¯èƒ½å‘ç”Ÿå¦‚ä¸‹æƒ…å†µï¼šä¸€ä¸ªèŠ‚ç‚¹å‘èµ·æ‹‰ç¥¨è¯·æ±‚ï¼Œä½†æœ‰ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½æŠ•äº†èµæˆç¥¨ã€‚è¿™ä¸ªå®•æœºèŠ‚ç‚¹ä¼šå¯¼è‡´RPCè¯·æ±‚ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œåœ¨æœ€åç»Ÿè®¡å¾—ç¥¨çš„æ—¶å€™ï¼Œä¼šåœ¨å¤šä¸ªå¼‚æ­¥ä»»åŠ¡åŒæ­¥è¿™é‡Œè¶…æ—¶ï¼ˆä¸€èˆ¬è®¾ä¸º3ç§’ï¼‰ã€‚ä½†å°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™ï¼Œå…¶ä»–èŠ‚ç‚¹ä¹Ÿææœ‰å¯èƒ½å‘èµ·æ–°ä¸€è½®çš„æ‹‰ç¥¨è¯·æ±‚ï¼Œè¿™æ ·æœ¬æ¥ç¬¬ä¸€æ¬¡å‘é€æ‹‰ç¥¨çš„èŠ‚ç‚¹ï¼Œæœ¬åº”è¯¥åœ¨ä»–é‚£ä¸€è½®å˜æˆleaderä½†æ˜¯åœ¨3ç§’ä¹‹åï¼Œè™½ç„¶æ‹¿åˆ°äº†å¤šæ•°ç¥¨æ•°ï¼Œä½†æ˜¯è‡ªå·±çŠ¶æ€æ˜¯followerï¼ˆè¿™é‡Œå‚è€ƒå‰æ–‡å†™çš„èŠ‚ç‚¹å¤„ç†æ‹‰ç¥¨è¯·æ±‚ï¼‰ï¼Œäºæ˜¯å¤±è´¥ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´å¤šè½®æ— æ•ˆæŠ•ç¥¨ï¼Œå¯¼è‡´æ•ˆç‡ä½ã€‚äºæ˜¯è®¾ç½®ä¸€ä¸ªRPCè¶…æ—¶æ—¶é—´ï¼ˆ500msï¼‰ä¿è¯èƒ½å¿«é€Ÿç»“ç®—ç¥¨æ•°ï¼Œè®©å…¶ä»–èŠ‚ç‚¹å‘èµ·æ–°ä¸€è½®æŠ•ç¥¨çš„æ¦‚ç‡å˜å°ã€‚ï¼ˆå…¶å®åŸé¡¹ç›®åœ¨æŠ•ç¥¨çš„æ—¶å€™è·Ÿæˆ‘çš„å®ç°æœ‰ä¸€å®šå‡ºå…¥ï¼Œä»–å¹¶æœªå¯¹æ–°ä¸€è½®æŠ•ç¥¨ä½œå‡ºç®¡ç†ï¼ˆæˆ‘åœ¨å½“æ–°ä¸€è½®æŠ•ç¥¨æ¥ä¸´æ—¶ï¼ŒæŠŠè‡ªå·±å¾—æŠ•ç¥¨äººç½®ä¸ºç©ºï¼Œå¹¶ä¸”æŠŠè‡ªå·±å˜æˆfollowerï¼‰ï¼Œåªæœ‰è‡ªå·±å˜æˆå€™é€‰äººï¼Œç„¶åè½é€‰ä¹‹åæ‰ä¼šæŠŠæŠ•ç¥¨äººæ¸…ç©ºï¼Œæˆ‘è§‰å¾—è¿™æ ·æ•ˆç‡ä¸é«˜ï¼‰</li><li>é’ˆå¯¹ç¬¬5ç‚¹çš„è¡¥å……è¯´æ˜ï¼ŒåŸé¡¹ç›®åªæœ‰è‡ªå·±å˜æˆå€™é€‰äººï¼Œç„¶åè½é€‰ä¹‹åæ‰ä¼šæŠŠæŠ•ç¥¨äººæ¸…ç©ºã€‚è¿™æ ·åšçš„è¯ï¼Œåœ¨ä¸€ä¸ªå‘¨æœŸå†…å¦‚æœæ²¡é€‰å‡ºæ¥é¢†å¯¼äººï¼Œé‚£å°±å¿…é¡»ç­‰åˆ°ä¸‹ä¸€ä¸ªå‘¨æœŸï¼ˆå› ä¸ºé‡ç½®æŠ•ç¥¨äººä¼šåœ¨ä¸€ä¸ªå‘¨æœŸåï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ–°çš„termï¼‰ã€‚è€Œæˆ‘çš„æ”¹è¿›ï¼Œè®©ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°æ›´å¤§çš„termä¹‹åä¼šè®©å‡ºè‡ªå·±çš„ä½ç½®ï¼Œå¹¶ä¸”é‡Šæ”¾æŠ•ç¥¨äººï¼Œè¿™æ ·åœ¨æ¯æ¬¡æ–°çš„termä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥è¿›è¡ŒæŠ•ç¥¨ã€‚è¿™æ ·åœ¨ä¸€ä¸ªé€‰ä¸¾å‘¨æœŸå†…å¤§æ¦‚ç‡å¯ä»¥æˆåŠŸé€‰ä¸¾ã€‚æˆ‘è¿™ç§æ–¹æ¡ˆçš„éšæœºæ—¶é—´è®¾ç½®èŒƒå›´æœ€å¥½ä¸º[electiontimeout, 2 * electiontimeout - 1],é¿å…å†²çªã€‚ ï¼ˆå…¶å®æˆ‘è¿™ä¸ªæ€è·¯è·Ÿ6.824 lab2æ€è·¯ä¸€æ ·ï¼‰</li><li>åŸé¡¹ç›®å¹¶æœªå®ç°Follower Readã€‚æˆ‘çš„å…·ä½“å®ç°è§å‰æ–‡</li></ol><hr><h2 id="äº”ã€-æ€»ç»“"><a href="#äº”ã€-æ€»ç»“" class="headerlink" title="äº”ã€ æ€»ç»“"></a>äº”ã€ æ€»ç»“</h2><p>ä»¥ä¸‹æ˜¯æˆ‘çš„ä¸€äº›å¿ƒå¾— å…±12æ¡</p><ol><li>æŠ•ç¥¨æ—¶ï¼Œå¦‚æœé‡åˆ°æ›´æ–°çš„termåˆ™æŠŠä¹‹å‰çš„æŠ•ç¥¨äººç½®ç©ºï¼Œé˜²æ­¢æ— æ³•æŠ•ç¥¨ï¼ˆæŠ•ç¥¨æ—¶ä¹Ÿéœ€è¦ä¸Šé”ï¼Œé¿å…é‡å¤æŠ•ç¥¨ï¼‰ï¼Œç„¶ååˆ¤æ–­è‡ªå·±æ²¡æœ‰æŠ•è¿‡ç¥¨ï¼Œå½“å‰å‘é€è¯·æ±‚çš„å€™é€‰äººæ˜¯å¦æœ‰èµ„æ ¼ï¼Œå³æŒæœ‰æ¯”è‡ªå·±æ›´æ–°çš„æ—¥å¿—ï¼Œå¦‚æœéƒ½æ»¡è¶³è¿™ä¸ªfolloweèŠ‚ç‚¹å°±å¯ä»¥æŠ•ç¥¨ç»™è¯¥èŠ‚ç‚¹ã€‚å¹¶æ›´æ–°ç›¸åº”çš„ä¿¡æ¯ï¼Œé‡Šæ”¾é”ã€‚</li><li>Followeræ”¶åˆ°æ—¥å¿—æ—¶ï¼Œåˆ¤æ–­æ—¥å¿—æ˜¯å¦åŒ¹é…ï¼Œä¸åŒ¹é…è¿”å›å¤±è´¥ï¼ŒåŒ¹é…åˆ™å†™å…¥æœ¬åœ°ã€‚å†™å…¥æœ¬åœ°ä¹‹åï¼Œæ ¹æ®leaderçš„commitIndexå¼‚æ­¥åº”ç”¨æ—¥å¿—ï¼Œæå‡æ•ˆç‡ã€‚ä½†éƒ½éœ€è¦ä¸Šé”ï¼ˆå†™å…¥ä¸æäº¤éƒ½éœ€è¦ï¼‰</li><li>followeræ”¶åˆ°å¿ƒè·³æ—¶ï¼Œåˆ¤æ–­leaderçš„termæ˜¯å¦å°äºè‡ªå·±ï¼Œå¦‚æœå°äºè¿”å›å¤±è´¥ï¼Œå¹¶ä¸”å‘Šè¯‰leaderè‡ªå·±çš„termï¼Œè®©ä»–é€€ä½ã€‚å¦‚æœå¤§äºç­‰äºè‡ªå·±ï¼Œåˆ™æŠŠè‡ªå·±çš„çŠ¶æ€å˜ä¸ºfollower(å› ä¸ºèŠ‚ç‚¹çš„çŠ¶æ€å¯èƒ½æ˜¯å€™é€‰äººï¼Œæˆ–è€…åˆ†åŒºä¹‹ååˆåŠ å…¥çš„è€leader)ã€‚ç„¶åé‡ç½®æŠ•ç¥¨å€’è®¡æ—¶ã€‚ç„¶åæ¯æ¬¡å¿ƒè·³è¿˜ä¼šå¸¦æœ‰leaderçš„commitIndexï¼ŒæŠŠè¿™ä¸ªè·Ÿè‡ªå·±æœ€åçš„æ—¥å¿—ç´¢å¼•å–æœ€å°å€¼ï¼Œç„¶åå¼‚æ­¥åº”ç”¨æ—¥å¿—åˆ°è¿™ä¸ªä½ç½®ï¼Œè·Ÿleaderä¿æŒåŒæ­¥ã€‚</li><li>åœ¨learderä¸­æŠŠåŒæ­¥æ—¥å¿—åˆ°followeæ“ä½œ è·Ÿ å¿ƒè·³æ”¾åœ¨ä¸€èµ·ï¼Œå³æ¯æ¬¡åˆ¤æ–­ä¸åŒçš„followeræ˜¯å¦éœ€è¦åŒæ­¥æ—¥å¿—ï¼Œå¦‚æœä¸éœ€è¦åˆ™å‘é€å¿ƒè·³ã€‚é€šè¿‡åˆ¤æ–­è‡ªå·±çš„lastIndex&gt;=æ¯ä¸ªfollowerçš„nextIndexï¼ˆå¯¹äºæ¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œéœ€è¦å‘é€ç»™ä»–çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼ï¼ˆåˆå§‹åŒ–ä¸ºé¢†å¯¼äººæœ€åç´¢å¼•å€¼åŠ ä¸€ï¼‰ï¼‰ã€‚å¦‚æœæ˜¯åˆ™å‘é€nextIndexå¯¹åº”çš„æ—¥å¿—ã€‚</li><li>åœ¨å‘é€æ—¥å¿—é˜¶æ®µï¼Œæ¯æ¬¡å‘é€ä¼šå¸¦ä¸ŠindexIndexçš„å‰ä¸€æ¡æ—¥å¿—çš„termå’Œindexç”¨äºæ—¥å¿—åŒ¹é…ã€‚å¦‚æœfolloweræ‹’æ”¶ï¼Œé‚£å°±æ˜¯æ—¥å¿—ä¸åŒ¹é…ï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯leaderçš„termå°äº†ï¼Œé‚£ä¹ˆleaderå°±åº”è¯¥é€€ä¸ºfollowerï¼‰ï¼Œé‚£ä¹ˆå°±æŠŠä»–çš„nextIndex å‡ä¸€ã€‚è¿™æ ·ä¸‹æ¬¡å¿ƒè·³æ—¶å°±ä¼šå‘é€å‰ä¸€ä¸ªæ—¥å¿—ç»™ä»–ã€‚ç›´åˆ°æˆåŠŸï¼Œæ›´æ–°ä»–å¯¹åº”çš„nextIndexä»¥åŠmatchIndexï¼ˆå¯¹äºæ¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå·²ç»å¤åˆ¶ç»™ä»–çš„æ—¥å¿—çš„æœ€é«˜ç´¢å¼•å€¼ï¼‰</li><li>åˆå¹¶å‘é€ï¼Œæ¯æ¬¡å‘é€æ—¥å¿—æ—¶ï¼Œä¼šæŠŠnextindexå¯¹åº”æ—¥å¿—ä¸€ç›´åˆ°è‡ªå·±çš„lastIndexæ—¥å¿—ä¸€èµ·å‘é€ï¼Œè¿™æ ·followerä¸€æ—¦åŒ¹é…å°±å¯ä»¥æ‰¹é‡å†™å…¥æ–°æ—¥å¿—ï¼Œå¿«é€ŸåŒæ­¥ã€‚</li><li>å½“ä¸€ä¸ªèŠ‚ç‚¹çš„æŠ•ç¥¨å€’è®¡æ—¶ç»“æŸåï¼Œè¿˜æ²¡æ”¶åˆ°leaderçš„å¿ƒè·³ã€‚è‡ªå·±åˆ™ä¼šæŠŠè‡ªå·±çš„term+1,æŠŠè‡ªå·±å˜æˆå€™é€‰äººï¼ŒæŠ•è‡ªå·±ä¸€ç¥¨ï¼Œç„¶åå‘æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å‘èµ·æ‹‰ç¥¨ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šæºå¸¦è‡ªå·±çš„term,æœ€åä¸€ä¸ªæ—¥å¿—çš„term,indexã€‚é€šè¿‡è¿™ä¸ªå…¶ä»–èŠ‚ç‚¹æ‰èƒ½åˆ¤æ–­ä½ æ˜¯å¦æœ‰èµ„æ ¼ã€‚</li><li>æŠŠå®ç°å‘èµ·æ‹‰ç¥¨æ“ä½œçš„ çº¿ç¨‹æ± +Future+CountDownLatch æ”¹æˆäº† CompletableFuture+çº¿ç¨‹æ± ã€‚å› ä¸ºFutureçš„getæ–¹æ³•ä¼šé˜»å¡è°ƒç”¨ï¼Œæ€§èƒ½ä¸å¦‚ç›´æ¥ä½¿ç”¨CompletableFutureçš„whenCompleteã€‚å¹¶ä¸”ä½¿ç”¨ä¸€ä¸ªList<CompletableFuture>å»ä¿å­˜è¿™äº›å¯¹è±¡ï¼Œä½¿ç”¨CompletableFuture.allOfæ–¹æ³•ä¿æŒå¤šä¸ªå¼‚æ­¥çº¿ç¨‹çš„åŒæ­¥ï¼Œä»è€Œä¸ä½¿ç”¨CountDownLatchè¿›è¡ŒåŒæ­¥ã€‚ä½¿ç”¨AtomicIntegerè®°å½•æŠ•ç¥¨æˆåŠŸæ•°é‡ï¼Œä¿è¯å®‰å…¨æ€§ã€‚</li><li>åœ¨ç¡®å®šLeaderçš„commitIndexæ—¶ï¼Œä¸å†ä½¿ç”¨æ¯æ¬¡åŒæ­¥çš„ç»“æœæ¥åˆ¤æ–­ï¼ˆå¦‚æœå¤§éƒ¨åˆ†æˆåŠŸå°±æäº¤ï¼‰ã€‚å› ä¸ºç°åœ¨æ˜¯åœ¨å¿ƒè·³æ—¶åŒæ­¥æ—¥å¿—ï¼Œç»™æ¯ä¸ªfolloweråŒæ­¥çš„ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªç´¢å¼•çš„æ—¥å¿—ã€‚è€Œæ˜¯åœ¨æ¯æ¬¡å¿ƒè·³ï¼ˆæ—¥å¿—ï¼‰å‘é€å®Œæˆä¹‹åï¼ˆè·Ÿ8ä¸€æ ·å¿…é¡»åœ¨å‘é€éƒ½å®Œæˆä¹‹åï¼‰ï¼Œä½¿ç”¨æ¯ä¸ªfollowerçš„matchIndex æ¥åˆ¤æ–­leadeçš„commitIndexã€‚è½¬åŒ–ä¸ºå·²çŸ¥æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§åŒ¹é…æ•°ï¼Œæ±‚è¶…è¿‡ä¸€åŠçš„åŒ¹é…ç´¢å¼•ï¼ˆå…¶å®å°±æ˜¯æ±‚ä¸­ä½æ•°å³å¯ï¼‰ã€‚å¾—åˆ°å¯¹åº”çš„commitIndexã€‚åˆ¤æ–­å½“å‰commitIndexçš„æ—¥å¿—æ˜¯å¦æ˜¯è‡ªå·±å½“å‰ä»»æœŸçš„ï¼Œå¦åˆ™ä¸èƒ½æäº¤ï¼ˆé˜²æ­¢å¹½çµå¤ç°é—®é¢˜ï¼Œå³é‡å¤æäº¤åŒä¸€ä¸ªä½ç½®çš„æ—¥å¿—ï¼‰ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æäº¤å½“å‰ä»»æœŸçš„æ—¥å¿—é¡ºå¸¦ä¸€å¹¶æäº¤ä¹‹å‰çš„ï¼Œä½†æ˜¯å¦‚æœå½“å‰ä»»æœŸä¸€ç›´æ²¡æ–°æ—¥å¿—éš¾é“è¿Ÿè¿Ÿä¸æäº¤å—ï¼Ÿ</li><li>æ’å…¥ç©ºæ—¥å¿—ï¼Œæ’å…¥ç©ºæ—¥å¿—å°±æ˜¯è§£å†³9ä¸­æåˆ°çš„å¹½çµå¤ç°é—®é¢˜ã€‚æ¯æ¬¡æ–°leaderä¸Šä»»å°±æ’å…¥ä¸€æ¡ç©ºæ—¥å¿—ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°é¡ºå¸¦æäº¤ä¹‹å‰ä»»æœŸæœªæäº¤çš„æ—¥å¿—ã€‚ä¹Ÿå¯ä»¥åŠæ—¶æäº¤ï¼Œä¸ä¾èµ–äºæ–°çš„æ—¥å¿—ã€‚æ–°ä¸Šä»»çš„leaderåˆå§‹åŒ–æ‰€æœ‰çš„ nextIndex å€¼ä¸ºè‡ªå·±çš„æœ€åä¸€æ¡æ—¥å¿—çš„ index + 1ï¼Œè¿™æ ·ä¸‹æ¬¡å¿ƒè·³å¦‚æœä¸åŒ¹é…å°±ä¼šè·Ÿç¬¬5æ­¥ä¸€æ ·ã€‚</li><li>Leaderå‘é€å¿ƒè·³ä¹Ÿæ˜¯ä½¿ç”¨çš„CompletableFutureä½†æ˜¯è¿™æ—¶å°±ä¸ç”¨åŒæ­¥äº†ï¼Œæ ¹æ®followerçš„è¿”å›å€¼ä¸­çš„termæ˜¯å¦å¤§äºè‡ªå·±çš„termæ¥åˆ¤æ–­è‡ªå·±æ˜¯å¦è¿˜èƒ½ç»§ç»­å½“ï¼Œå¦åˆ™å˜æˆfollowerã€‚</li><li>å®ç°çº¿æ€§ä¸€è‡´æ€§çš„follower readã€‚å¦‚æœæ˜¯leaderæ”¶åˆ°è¯»è¯·æ±‚ï¼Œå…ˆå¹¿æ’­è¯·æ±‚æ¥åˆ¤æ–­å½“å‰è‡ªå·±æ˜¯å¦è¿˜æ˜¯leader(å…·ä½“å®ç°è¿˜æ˜¯è·Ÿæ‹‰ç¥¨ç±»ä¼¼ï¼ŒCompletableFuture+çº¿ç¨‹æ± )ï¼Œå¦‚æœæ”¶åˆ°è¿‡åŠæ•°çš„æˆåŠŸå›å¤ï¼Œåˆ™ä¿è¯å°†æ—¥å¿—åº”ç”¨è‡³commitIndexçš„ä½ç½®ä¹‹åè¿”å›è¯»å–è¯·æ±‚ã€‚å¦‚æœå¤±è´¥åˆ™ä¸å“åº”æˆ–è€…è¿”å›å¤±è´¥ã€‚å¦‚æœæ˜¯followeræ”¶åˆ°äº†æ­¤æ¬¡è¯»è¯·æ±‚ï¼Œé‚£ä¹ˆå‘é€ä¸€ä¸ªè¯·æ±‚å½“å‰æœ€æ–°commitIndex(readIndex)çš„RPCç»™leader,leaderæ”¶åˆ°è¯·æ±‚ä¹Ÿä¼šå…ˆåˆ¤æ–­è‡ªå·±æ˜¯å¦è¿˜æ˜¯leader,ä¹‹åè¿”å›å½“å‰çš„commitIndexã€‚Followeræ‹¿åˆ°ä¹‹åå³ä¿è¯åº”ç”¨è‡³commitIndexä½ç½®ä¹‹åè¿”å›è¯»è¯·æ±‚ï¼Œå¦åˆ™è¿”å›å¤±è´¥ã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸å¹¶å‘æ¨¡å‹ä¼˜åŒ–&quot;&gt;&lt;a href=&quot;#Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸å¹¶å‘æ¨¡å‹ä¼˜åŒ–&quot; class=&quot;headerlink&quot; title=&quot;Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸å¹¶å‘æ¨¡å‹ä¼˜åŒ–&quot;&gt;&lt;/a&gt;Javaæ‰‹å†™Raftç¯‡ï¼šæ ¸å¿ƒæµç¨‹ä¸</summary>
      
    
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://nmcb666.vip/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆä¹ï¼‰ äºŒåˆ†</title>
    <link href="https://nmcb666.vip/posts/14894eda.html"/>
    <id>https://nmcb666.vip/posts/14894eda.html</id>
    <published>2026-01-28T16:23:15.000Z</published>
    <updated>2026-01-31T14:36:26.049Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç‹’ç‹’åƒé¦™è•‰"><a href="#ç‹’ç‹’åƒé¦™è•‰" class="headerlink" title="ç‹’ç‹’åƒé¦™è•‰"></a>ç‹’ç‹’åƒé¦™è•‰</h2><p>æ€è·¯ï¼šæœ€å°å€¼ä¸º1ï¼Œæœ€å¤§å€¼å°±æ˜¯æ•°ç»„æœ€å¤§å€¼ã€‚åœ¨è¿™ä¸ªèŒƒå›´ä¸Šä¸æ–­äºŒåˆ†ã€‚é‡åˆ°èƒ½åƒå®Œè®°å½•ç­”æ¡ˆï¼Œå¾€å·¦ä¾§äºŒåˆ†å¯»æ‰¾æ›´å°çš„ï¼Œåƒä¸å®Œå¾€ä¸è®¡ç­”æ¡ˆï¼Œå³ä¾§äºŒåˆ†å¯»æ‰¾æ›´å¤§çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minEatingSpeed</span><span class="params">(<span class="type">int</span>[] piles, <span class="type">int</span> h)</span> &#123;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i : piles) &#123;</span><br><span class="line">        r = Math.max(r,i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> r;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + ((r-l)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(fMinEatingSpeed(piles,mid) &lt;= h)&#123;</span><br><span class="line">            ans = mid;</span><br><span class="line">            r = mid-<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            l = mid+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">fMinEatingSpeed</span><span class="params">(<span class="type">int</span>[] piles,<span class="type">int</span> speed)</span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> pile : piles) &#123;</span><br><span class="line">        cnt += (pile + speed - <span class="number">1</span>) / speed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†å‰²æ•°ç»„æœ€å¤§å€¼"><a href="#åˆ†å‰²æ•°ç»„æœ€å¤§å€¼" class="headerlink" title="åˆ†å‰²æ•°ç»„æœ€å¤§å€¼"></a>åˆ†å‰²æ•°ç»„æœ€å¤§å€¼</h2><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ•°ç»„åˆ†æˆ k ä¸ªéç©ºçš„è¿ç»­å­æ•°ç»„ï¼Œä½¿å¾—è¿™ k ä¸ªå­æ•°ç»„å„è‡ªå’Œçš„æœ€å¤§å€¼ æœ€å°ã€‚</p><p>è¿”å›åˆ†å‰²åæœ€å°çš„å’Œçš„æœ€å¤§å€¼ã€‚</p><p>å­æ•°ç»„ æ˜¯æ•°ç»„ä¸­è¿ç»­çš„éƒ¨ä»½ã€‚</p><p>æ€è·¯ï¼š å¯¹ç­”æ¡ˆè¿›è¡ŒäºŒåˆ†ï¼Œç­”æ¡ˆèŒƒå›´ä¸º[0,sum(nums)]ã€‚få‡½æ•°ä¸ºå½“æœ€å°å€¼ä¸ºlimitçš„æ—¶å€™ï¼Œæˆ‘éœ€è¦çš„æœ€å°åˆ’åˆ†æ•°ã€‚å¦‚æœè¿™ä¸ªæœ€å°åˆ’åˆ†æ•°&lt;=k,åˆ™è®°å½•ç­”æ¡ˆï¼Œå¹¶ä¸”å»å·¦ä¾§äºŒåˆ†ï¼Œå¯»æ‰¾æ›´å°çš„ç­”æ¡ˆã€‚åä¹‹ï¼Œåˆ™å»å³ä¾§äºŒåˆ†ï¼Œä¸è®°å½•ç­”æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">splitArray</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">sum += num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// [0,sum]äºŒåˆ†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = sum, m, need; l &lt;= r;) &#123;</span><br><span class="line"><span class="comment">// ä¸­ç‚¹m</span></span><br><span class="line">m = l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line"><span class="comment">// å¿…é¡»è®©æ•°ç»„æ¯ä¸€éƒ¨åˆ†çš„ç´¯åŠ å’Œ &lt;= mï¼Œè¯·é—®åˆ’åˆ†æˆå‡ ä¸ªéƒ¨åˆ†æ‰å¤Ÿ!</span></span><br><span class="line">need = f(nums, m);</span><br><span class="line"><span class="keyword">if</span> (need &lt;= k) &#123;</span><br><span class="line"><span class="comment">// è¾¾æ ‡</span></span><br><span class="line">ans = m;</span><br><span class="line">r = m - <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">l = m + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">int</span>) ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»è®©æ•°ç»„arræ¯ä¸€éƒ¨åˆ†çš„ç´¯åŠ å’Œ &lt;= limitï¼Œè¯·é—®åˆ’åˆ†æˆå‡ ä¸ªéƒ¨åˆ†æ‰å¤Ÿ!</span></span><br><span class="line"><span class="comment">// è¿”å›éœ€è¦çš„éƒ¨åˆ†æ•°é‡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">long</span> limit)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">parts</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : arr) &#123;</span><br><span class="line"><span class="keyword">if</span> (num &gt; limit) &#123;</span><br><span class="line"><span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum + num &gt; limit) &#123;</span><br><span class="line">parts++;</span><br><span class="line">sum = num;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">sum += num;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> parts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰¾å‡ºç¬¬kå°çš„æ•°å¯¹è·ç¦»"><a href="#æ‰¾å‡ºç¬¬kå°çš„æ•°å¯¹è·ç¦»" class="headerlink" title="æ‰¾å‡ºç¬¬kå°çš„æ•°å¯¹è·ç¦»"></a>æ‰¾å‡ºç¬¬kå°çš„æ•°å¯¹è·ç¦»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">smallestDistancePair</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">Arrays.sort(nums);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// [0, æœ€å¤§-æœ€å°]ï¼Œä¸åœäºŒåˆ†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = nums[n - <span class="number">1</span>] - nums[<span class="number">0</span>], m, cnt; l &lt;= r;) &#123;</span><br><span class="line"><span class="comment">// mä¸­ç‚¹ï¼Œarrä¸­ä»»æ„ä¸¤æ•°çš„å·®å€¼ &lt;= m</span></span><br><span class="line">m = l + ((r - l) &gt;&gt; <span class="number">1</span>);</span><br><span class="line"><span class="comment">// è¿”å›æ•°å­—å¯¹çš„æ•°é‡</span></span><br><span class="line">cnt = f(nums, m);</span><br><span class="line"><span class="keyword">if</span> (cnt &gt;= k) &#123;</span><br><span class="line">ans = m;</span><br><span class="line">r = m - <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">l = m + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// arrä¸­ä»»æ„ä¸¤æ•°çš„å·®å€¼ &lt;= limit</span></span><br><span class="line"><span class="comment">// è¿™æ ·çš„æ•°å­—é…å¯¹ï¼Œæœ‰å‡ å¯¹ï¼Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// O(n)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>; l &lt; arr.length; l++) &#123;</span><br><span class="line"><span class="comment">// l......r r+1</span></span><br><span class="line"><span class="keyword">while</span> (r + <span class="number">1</span> &lt; arr.length &amp;&amp; arr[r + <span class="number">1</span>] - arr[l] &lt;= limit) &#123;</span><br><span class="line">r++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// arr[l...r]èŒƒå›´ä¸Šçš„æ•°å·®å€¼çš„ç»å¯¹å€¼éƒ½ä¸è¶…è¿‡limit</span></span><br><span class="line"><span class="comment">// arr[0...3]</span></span><br><span class="line"><span class="comment">// 0,1</span></span><br><span class="line"><span class="comment">// 0,2</span></span><br><span class="line"><span class="comment">// 0,3</span></span><br><span class="line">ans += r - l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒæ—¶è¿è¡Œnå°ç”µè„‘çš„æœ€é•¿æ—¶é—´"><a href="#åŒæ—¶è¿è¡Œnå°ç”µè„‘çš„æœ€é•¿æ—¶é—´" class="headerlink" title="åŒæ—¶è¿è¡Œnå°ç”µè„‘çš„æœ€é•¿æ—¶é—´"></a>åŒæ—¶è¿è¡Œnå°ç”µè„‘çš„æœ€é•¿æ—¶é—´</h2><p>leelcode2141</p><p>ä½ æœ‰ n å°ç”µè„‘ã€‚ç»™ä½ æ•´æ•° n å’Œä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹çš„æ•´æ•°æ•°ç»„ batteries ï¼Œå…¶ä¸­ç¬¬ i ä¸ªç”µæ± å¯ä»¥è®©ä¸€å°ç”µè„‘ è¿è¡Œ batteries[i] åˆ†é’Ÿã€‚ä½ æƒ³ä½¿ç”¨è¿™äº›ç”µæ± è®© å…¨éƒ¨ n å°ç”µè„‘ åŒæ—¶ è¿è¡Œã€‚</p><p>ä¸€å¼€å§‹ï¼Œä½ å¯ä»¥ç»™æ¯å°ç”µè„‘è¿æ¥ è‡³å¤šä¸€ä¸ªç”µæ±  ã€‚ç„¶ååœ¨ä»»æ„æ•´æ•°æ—¶åˆ»ï¼Œä½ éƒ½å¯ä»¥å°†ä¸€å°ç”µè„‘ä¸å®ƒçš„ç”µæ± æ–­å¼€è¿æ¥ï¼Œå¹¶è¿æ¥å¦ä¸€ä¸ªç”µæ± ï¼Œä½ å¯ä»¥è¿›è¡Œè¿™ä¸ªæ“ä½œ ä»»æ„æ¬¡ ã€‚æ–°è¿æ¥çš„ç”µæ± å¯ä»¥æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç”µæ± ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ«çš„ç”µè„‘ç”¨è¿‡çš„ç”µæ± ã€‚æ–­å¼€è¿æ¥å’Œè¿æ¥æ–°çš„ç”µæ± ä¸ä¼šèŠ±è´¹ä»»ä½•æ—¶é—´ã€‚</p><p>æ³¨æ„ï¼Œä½ ä¸èƒ½ç»™ç”µæ± å……ç”µã€‚</p><p>è¯·ä½ è¿”å›ä½ å¯ä»¥è®© n å°ç”µè„‘åŒæ—¶è¿è¡Œçš„ æœ€é•¿ åˆ†é’Ÿæ•°ã€‚</p><p>æ€è·¯ï¼šè¿˜æ˜¯äºŒåˆ†ç­”æ¡ˆã€‚ç­”æ¡ˆèŒƒå›´æ˜¯[0,sum(batteries)]ã€‚få‡½æ•°ä¸ºå½“è¿è¡Œæ—¶é—´ä¸ºmçš„æ—¶å€™ï¼Œæˆ‘èƒ½è¿è¡Œçš„æœ€å¤šç”µè„‘æ•°é‡ã€‚å¦‚æœè¿™ä¸ªæ•°é‡å¤§äºç­‰äºè§„å®šçš„æ•°é‡ï¼Œé‚£ä¹ˆæˆ‘è®°å½•mid,ç„¶åå»å³è¾¹äºŒåˆ†ï¼Œå¯»æ‰¾æ›´é•¿çš„æ—¶é—´ã€‚åä¹‹ï¼Œä¸è®¡å…¥ç­”æ¡ˆï¼Œå»å·¦ä¾§äºŒåˆ†ã€‚ è¿˜æœ‰ä¸€ä¸ªè´ªå¿ƒä¼˜åŒ–ï¼Œå¯ä»¥å‡å°‘äºŒåˆ†çš„æ¬¡æ•°ã€‚è¯¦è§ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">maxRunTime</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[] batteries)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> batteries.length;</span><br><span class="line">        <span class="keyword">if</span>(len&lt;n)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">r</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">            r+=batteries[i];</span><br><span class="line">            max= Math.max(max,batteries[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (r&gt; (<span class="type">long</span>) max * n) &#123;</span><br><span class="line">            <span class="comment">// æ‰€æœ‰ç”µæ± çš„æœ€å¤§ç”µé‡æ˜¯max</span></span><br><span class="line">            <span class="comment">// å¦‚æœæ­¤æ—¶sum &gt; (long) max * nï¼Œ</span></span><br><span class="line">            <span class="comment">// è¯´æ˜ : æœ€ç»ˆçš„ä¾›ç”µæ—¶é—´ä¸€å®šåœ¨ &gt;= maxï¼Œè€Œå¦‚æœæœ€ç»ˆçš„ä¾›ç”µæ—¶é—´ &gt;= max</span></span><br><span class="line">            <span class="comment">// è¯´æ˜ : å¯¹äºæœ€ç»ˆçš„ç­”æ¡ˆXæ¥è¯´ï¼Œæ‰€æœ‰ç”µæ± éƒ½æ˜¯è¯¾ä¸Šè®²çš„&quot;ç¢ç‰‡æ‹¼æ¥&quot;çš„æ¦‚å¿µ</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆå¯»æ‰¾ ? * n &lt;= sum çš„æƒ…å†µä¸­ï¼Œå°½é‡å¤§çš„ ? å³å¯</span></span><br><span class="line">            <span class="comment">// å³sum / n</span></span><br><span class="line">            <span class="keyword">return</span> r / n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        r = max;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">mid</span> <span class="operator">=</span> l+((r-l)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> f(batteries,mid);</span><br><span class="line">            <span class="keyword">if</span>(num &gt;= n )&#123;</span><br><span class="line">                ans = mid;</span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span>[] batteries,<span class="type">long</span> maxTime)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(maxTime == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">litterTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;batteries.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(batteries[i]&lt;maxTime)&#123;</span><br><span class="line">                litterTime+=batteries[i];</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                ans++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += (<span class="type">int</span>) (litterTime/maxTime);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="äºŒåˆ†æ€»ç»“"><a href="#äºŒåˆ†æ€»ç»“" class="headerlink" title="äºŒåˆ†æ€»ç»“"></a>äºŒåˆ†æ€»ç»“</h1><p>äºŒåˆ†ç­”æ¡ˆæ³•ï¼Œå…¶å®éƒ½å¯ä»¥çœ‹æˆç»™äº†ä¸‰ä¸ªå˜é‡ï¼Œæ•°ç»„ï¼Œé™åˆ¶ä»¥åŠç­”æ¡ˆã€‚æ­£å‘æ¨å¯¼éœ€è¦æˆ‘ä»¬æ ¹æ®æ•°ç»„ä»¥åŠé™åˆ¶å¾—åˆ°ç­”æ¡ˆã€‚ä½†ç°åœ¨æ ¹æ®äºŒåˆ†ç­”æ¡ˆæ³•ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠç­”æ¡ˆç¡®å®šä¸‹æ¥ï¼Œç„¶åç®—å‡ºä¸€ä¸ªè·Ÿé™åˆ¶ç›¸å…³çš„ä¸œè¥¿ï¼ŒæŠŠè¿™ä¸ªä¸œè¥¿è·ŸåŸé™åˆ¶ä½œæ¯”è¾ƒï¼ˆè¿™é‡Œå°±è§‚å¯Ÿå•è°ƒæ€§ï¼‰ï¼Œæ¥åˆ¤æ–­ä¸‹ä¸€æ­¥åº”è¯¥å»å“ªè¾¹æ‰¾ç­”æ¡ˆã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-28%20212134.png" alt="æ€»ç»“"/></div><span class="image-caption">æ€»ç»“</span></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç‹’ç‹’åƒé¦™è•‰&quot;&gt;&lt;a href=&quot;#ç‹’ç‹’åƒé¦™è•‰&quot; class=&quot;headerlink&quot; title=&quot;ç‹’ç‹’åƒé¦™è•‰&quot;&gt;&lt;/a&gt;ç‹’ç‹’åƒé¦™è•‰&lt;/h2&gt;&lt;p&gt;æ€è·¯ï¼šæœ€å°å€¼ä¸º1ï¼Œæœ€å¤§å€¼å°±æ˜¯æ•°ç»„æœ€å¤§å€¼ã€‚åœ¨è¿™ä¸ªèŒƒå›´ä¸Šä¸æ–­äºŒåˆ†ã€‚é‡åˆ°èƒ½åƒå®Œè®°å½•ç­”æ¡ˆï¼Œå¾€å·¦ä¾§äºŒåˆ†å¯»æ‰¾æ›´å°çš„ï¼Œåƒä¸å®Œå¾€ä¸è®¡</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆå…«ï¼‰åŒæŒ‡é’ˆ</title>
    <link href="https://nmcb666.vip/posts/6fd57b4.html"/>
    <id>https://nmcb666.vip/posts/6fd57b4.html</id>
    <published>2026-01-27T16:04:39.000Z</published>
    <updated>2026-01-31T14:36:26.049Z</updated>
    
    <content type="html"><![CDATA[<div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-27%20160658.png" alt="æ€»ç»“"/></div><span class="image-caption">æ€»ç»“</span></div><h2 id="å¯»æ‰¾é‡å¤æ•°-leetcode-hot100-æœ€åä¸€é¢˜"><a href="#å¯»æ‰¾é‡å¤æ•°-leetcode-hot100-æœ€åä¸€é¢˜" class="headerlink" title="å¯»æ‰¾é‡å¤æ•° leetcode hot100 æœ€åä¸€é¢˜"></a>å¯»æ‰¾é‡å¤æ•° leetcode hot100 æœ€åä¸€é¢˜</h2><p>æ€è·¯ï¼šå½“æˆé“¾è¡¨æ‰¾ç¯å¤„ç†ã€‚æ¯åˆ°ä¸€ä¸ªä½ç½®i é‚£ä¸‹ä¸€æ¬¡å°±åˆ°arr[i]å¯¹åº”çš„ä½ç½®ã€‚æ˜¾ç„¶å…¥ç¯èŠ‚ç‚¹å°±æ˜¯é‡å¤çš„æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findDuplicate</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">kuai</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">man</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        kuai = nums[nums[kuai]];</span><br><span class="line">        man = nums[man];</span><br><span class="line">        <span class="keyword">if</span>(kuai == man)&#123;</span><br><span class="line">            kuai = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(kuai != man)&#123;</span><br><span class="line">                kuai = nums[kuai];</span><br><span class="line">                man = nums[man];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> kuai;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥é›¨æ°´"><a href="#æ¥é›¨æ°´" class="headerlink" title="æ¥é›¨æ°´"></a>æ¥é›¨æ°´</h2><p>æ€è·¯ï¼šåˆå§‹ç‰ˆï¼Œç±»ä¼¼ä¸å‰ç¼€å’Œè·Ÿåç¼€å’Œï¼Œæˆ‘å¼€ä¸¤ä¸ªæ•°ç»„è®°å½•iå·¦è¾¹çš„æœ€å¤§å€¼å’Œå³è¾¹çš„æœ€å¤§å€¼ï¼Œç„¶åæ±‚å‡ºå½“å‰ä½ç½®èƒ½æ¥çš„é›¨æ°´ã€‚sum+=Math.max(0,Math.min(left[i],right[i])-nums[i])</p><p>ä¼˜åŒ–: åŒæŒ‡é’ˆæ€è·¯ï¼Œå·¦å³ä¸¤è¾¹å„ä¸€ä¸ªæŒ‡é’ˆã€‚å¹¶ä¸”ç»´æŠ¤ä¸¤ä¸ªå˜é‡è®°å½•ï¼Œå·¦æŒ‡é’ˆå·¦è¾¹çš„æœ€å¤§å€¼å’Œå³æŒ‡é’ˆå³è¾¹çš„æœ€å¤§å€¼ã€‚å¯¹äºå·¦æŒ‡é’ˆæ¥è¯´å·¦è¾¹çš„æœ€å¤§å€¼è‚¯å®šæ˜¯ç¡®å®šçš„ï¼Œå³æŒ‡é’ˆåŒç†ã€‚æ‰€ä»¥åªéœ€è¦åˆ¤æ–­ä¸¤è¾¹è°çš„æœ€å¤§å€¼æ›´å°ï¼Œé‚£ä¹ˆè¿™ä¸€è¾¹å°±å¯ä»¥ç»“ç®—äº†ï¼Œå¹¶ä¸”ç§»åŠ¨æŒ‡é’ˆï¼Œæ›´æ–°æœ€å¤§å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span><span class="number">1</span>,r=height.length-<span class="number">2</span>,lmax = height[<span class="number">0</span>],rmax = height[height.length-<span class="number">1</span>],sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(lmax&gt;=rmax)&#123;</span><br><span class="line">            <span class="comment">//ç»“ç®—å³è¾¹</span></span><br><span class="line">            sum+=Math.max(<span class="number">0</span>,rmax-height[r]);</span><br><span class="line">            rmax = Math.max(rmax,height[r--]);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ç»“ç®—å·¦è¾¹</span></span><br><span class="line">            sum+=Math.max(<span class="number">0</span>,lmax-height[l]);</span><br><span class="line">            lmax= Math.max(lmax,height[l++]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="èƒ–å¨ƒåèˆ¹"><a href="#èƒ–å¨ƒåèˆ¹" class="headerlink" title="èƒ–å¨ƒåèˆ¹"></a>èƒ–å¨ƒåèˆ¹</h2><p>ç»™å®šæ•°ç»„ people ã€‚people[i]è¡¨ç¤ºç¬¬ i ä¸ªäººçš„ä½“é‡ ï¼Œèˆ¹çš„æ•°é‡ä¸é™ï¼Œæ¯è‰˜èˆ¹å¯ä»¥æ‰¿è½½çš„æœ€å¤§é‡é‡ä¸º limitã€‚</p><p>æ¯è‰˜èˆ¹æœ€å¤šå¯åŒæ—¶è½½ä¸¤äººï¼Œä½†æ¡ä»¶æ˜¯è¿™äº›äººçš„é‡é‡ä¹‹å’Œæœ€å¤šä¸º limitã€‚</p><p>è¿”å› æ‰¿è½½æ‰€æœ‰äººæ‰€éœ€çš„æœ€å°èˆ¹æ•° ã€‚</p><p>æ€è·¯ï¼šæ’åºï¼Œç„¶ååŒæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æœ€è½»çš„ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æœ€é‡çš„ï¼Œå¦‚æœæœ€è½»çš„+æœ€é‡çš„&lt;=limitï¼Œé‚£ä¹ˆå¯ä»¥ä¸€èµ·è½½ï¼Œä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶ç§»åŠ¨ï¼Œans++ã€‚å¦åˆ™ï¼Œæœ€é‡çš„æŒ‡é’ˆç§»åŠ¨,ans++ã€‚å³èƒ–å­è‡ªå·±ä¸€ä¸ªèˆ¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numRescueBoats</span><span class="params">(<span class="type">int</span>[] people, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">    Arrays.sort(people);</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span>people.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span>n-<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(people[r]+people[l] &lt;= limit)&#123;</span><br><span class="line">            r--;</span><br><span class="line">            l++;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            r--;</span><br><span class="line">        &#125;</span><br><span class="line">        ans++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜ç§ï¼šå¦‚æœè¦æ±‚ä¸¤ä¸ªçš„ä½“é‡åŠ èµ·æ¥ç­‰äºå¶æ•°å‘¢ï¼Ÿ å¾ˆç®€å•ï¼Œåˆ†ä¸ºå¥‡å¶ä¸¤ä¸ªæ•°ç»„ï¼Œç„¶ååˆ†åˆ«å¤„ç†ï¼ŒæŠŠä¸¤ä¸ªç»“æœåŠ èµ·æ¥å³å¯ã€‚</p><h2 id="ä¾›æš–å™¨"><a href="#ä¾›æš–å™¨" class="headerlink" title="ä¾›æš–å™¨"></a>ä¾›æš–å™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findRadius</span><span class="params">(<span class="type">int</span>[] houses, <span class="type">int</span>[] heaters)</span> &#123;</span><br><span class="line">    Arrays.sort(houses);</span><br><span class="line">    Arrays.sort(heaters);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">heaterIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> house : houses) &#123;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ç¦»å½“å‰æˆ¿å±‹æœ€è¿‘çš„åŠ çƒ­å™¨</span></span><br><span class="line">        <span class="keyword">while</span> (heaterIndex &lt; heaters.length - <span class="number">1</span> &amp;&amp; </span><br><span class="line">               Math.abs(heaters[heaterIndex] - house) &gt;= </span><br><span class="line">               Math.abs(heaters[heaterIndex + <span class="number">1</span>] - house)) &#123;</span><br><span class="line">            heaterIndex++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        result = Math.max(result, Math.abs(heaters[heaterIndex] - house));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"><a href="#ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°" class="headerlink" title="ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"></a>ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°</h2><p>ç»™ä½ ä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­æ²¡æœ‰å‡ºç°çš„æœ€å°çš„æ­£æ•´æ•°ã€‚</p><p>è¯·ä½ å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) å¹¶ä¸”åªä½¿ç”¨å¸¸æ•°çº§åˆ«é¢å¤–ç©ºé—´çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>æ€è·¯ï¼šæˆ‘ç°åœ¨å°±æƒ³è®©æ¯ä¸ªä½ç½®éƒ½å¯¹åº”ï¼Œå³iä½ç½®ä¸Šæ”¾çš„å°±æ˜¯i+1ã€‚æ­¤æ—¶ï¼Œæˆ‘ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œlçš„å·¦è¾¹æ˜¯æ»¡è¶³æˆ‘è¿™ä¸ªæ¡ä»¶çš„ï¼Œrçš„å³è¾¹æ˜¯è‚¯å®šä¸æ»¡è¶³çš„åƒåœ¾ã€‚åˆå§‹åŒ–l=0,r=nã€‚</p><p>ç°åœ¨å¼€å§‹éå†ï¼šæ¯æ¬¡éƒ½è§‚å¯Ÿlä½ç½®ä¸Šçš„æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœæ»¡è¶³é‚£å°±l++ã€‚å¦‚æœä¸æ»¡è¶³åˆ¤æ–­å®ƒæ˜¯ä¸æ˜¯æˆ‘éœ€è¦çš„ï¼Œå³å®ƒåœ¨ä¸åœ¨å½“å‰låˆ°rèŒƒå›´å†…ï¼ˆå› ä¸ºå°äºlçš„å·²ç»å°±ä½äº†ï¼Œä¸éœ€è¦ä½ ï¼Œå¤§äºrçš„å·²ç»è¶…è¿‡äº†ï¼Œä¸éœ€è¦ä½ ï¼‰ã€‚å…³äºä¸ºä»€ä¹ˆå¤§äºrå°±ç®—è¶…è¿‡è¿™é‡Œè§£é‡Šä¸€ä¸‹ã€‚å› ä¸ºç†æƒ³çŠ¶æ€ä¸‹æˆ‘æ•°ç»„é•¿åº¦ä¸ºné‚£ä¹ˆæˆ‘å°±æœ‰1-nè¿™äº›æ•°ï¼Œä½†ä¸€æ—¦ä¸€ä¸ªæ•°ä¸æ»¡è¶³ï¼ˆrâ€”ï¼‰ï¼Œé‚£æˆ‘è‚¯å®šåˆ°ä¸äº†näº†,æœ€å¤§å°±æ˜¯rã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œç°åœ¨æˆ‘éœ€è¦ä½ ï¼Œä½†æ˜¯åœ¨num[num[l]-1] å·²ç»æœ‰ä¸€ä¸ªç›¸åŒçš„ä½ äº†ï¼Œè¯´æ˜ä½ é‡å¤äº†ã€‚æ‰€ä»¥ä¹Ÿä¼šè¢«å½“æˆåƒåœ¾ã€‚ä»¥ä¸Šä¸‰ç§æƒ…å†µä¼šè¢«å½“æˆåƒåœ¾ï¼Œè·Ÿâ€”rä½ç½®äº¤æ¢ã€‚å‰©ä¸‹æœ€åä¸€ç§æƒ…å†µï¼Œä½ æ˜¯æˆ‘éœ€è¦çš„è€Œä¸”ä½ è¿˜æ²¡åˆ°åº”è¯¥åˆ°çš„ä½ç½®ï¼Œäºæ˜¯æˆ‘æŠŠä½ äº¤æ¢åˆ°å¯¹åº”çš„ä½ç½®ã€‚ä¸‹æ¬¡å¾ªç¯ï¼Œç»§ç»­çœ‹iä½ç½®çš„æ•°ã€‚ ç›´åˆ°l&lt;rã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// æ—¶é—´å¤æ‚åº¦O(n)ï¼Œé¢å¤–ç©ºé—´å¤æ‚åº¦O(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">firstMissingPositive</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line"><span class="comment">// lçš„å·¦è¾¹ï¼Œéƒ½æ˜¯åšåˆ°iä½ç½®ä¸Šæ”¾ç€i+1çš„åŒºåŸŸ</span></span><br><span class="line"><span class="comment">// æ°¸è¿œç›¯ç€lä½ç½®çš„æ•°å­—çœ‹ï¼Œçœ‹èƒ½ä¸èƒ½æ‰©å……(l++)</span></span><br><span class="line"><span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// [r....]åƒåœ¾åŒº</span></span><br><span class="line"><span class="comment">// æœ€å¥½çš„çŠ¶å†µä¸‹ï¼Œè®¤ä¸º1~ræ˜¯å¯ä»¥æ”¶é›†å…¨çš„ï¼Œæ¯ä¸ªæ•°å­—æ”¶é›†1ä¸ªï¼Œä¸èƒ½æœ‰åƒåœ¾</span></span><br><span class="line"><span class="comment">// æœ‰åƒåœ¾å‘¢ï¼Ÿé¢„æœŸå°±ä¼šå˜å·®(r--)</span></span><br><span class="line"><span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> arr.length;</span><br><span class="line"><span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr[l] == l + <span class="number">1</span>) &#123;</span><br><span class="line">l++;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[l] &lt;= l || arr[l] &gt; r || arr[arr[l] - <span class="number">1</span>] == arr[l]) &#123;</span><br><span class="line">swap(arr, l, --r);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">swap(arr, l, arr[l] - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> l + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;img-wrap&quot;&gt;&lt;div class=&quot;img-bg&quot;&gt;&lt;img class=&quot;img&quot; src=&quot;https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆä¸ƒï¼‰ æ»‘åŠ¨çª—å£</title>
    <link href="https://nmcb666.vip/posts/aad8ff6.html"/>
    <id>https://nmcb666.vip/posts/aad8ff6.html</id>
    <published>2026-01-26T16:59:21.000Z</published>
    <updated>2026-01-31T14:36:26.049Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„"><a href="#ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„" class="headerlink" title="ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„"></a>ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„</h2><p>éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥æ»‘åŠ¨çª—å£å…·æœ‰å•è°ƒæ€§ï¼ŒåŠ å…¥æ–°æ•°è‚¯å®šä¼šå¯¼è‡´ç´¯åŠ å’Œå˜å¤§ï¼Œå‡å°‘æ•°å­—ä¼šå¯¼è‡´ç´¯åŠ å’Œå˜å°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minSubArrayLen</span><span class="params">(<span class="type">int</span> target, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>, sum = <span class="number">0</span>; r &lt; nums.length; r++) &#123;</span><br><span class="line">sum += nums[r];</span><br><span class="line"><span class="keyword">while</span> (sum - nums[l] &gt;= target) &#123;</span><br><span class="line"><span class="comment">// sum : nums[l....r]</span></span><br><span class="line"><span class="comment">// å¦‚æœlä½ç½®çš„æ•°ä»çª—å£å‡ºå»ï¼Œè¿˜èƒ½ç»§ç»­è¾¾æ ‡ï¼Œé‚£å°±å‡ºå»</span></span><br><span class="line">sum -= nums[l++];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum &gt;= target) &#123;</span><br><span class="line">ans = Math.min(ans, r - l + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans == Integer.MAX_VALUE ? <span class="number">0</span> : ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦"><a href="#æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦" class="headerlink" title="æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦"></a>æ— é‡å¤å­ä¸²çš„æœ€é•¿é•¿åº¦</h2><p>è®°å½•ä¸Šæ¬¡è¿™ä¸ªå­—ç¬¦å‡ºç°çš„ä½ç½®ï¼Œæ¯æ¬¡æ›´æ–°å·¦è¾¹ç•Œï¼Œå°±ç”¨å½“å‰å·¦è¾¹ç•Œè·Ÿï¼ˆä¸Šæ¬¡é‡å¤ä½ç½®+1ï¼‰çš„æœ€å¤§å€¼å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String str)</span> &#123;</span><br><span class="line"><span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length;</span><br><span class="line"><span class="comment">// char -&gt; int -&gt; 0 ~ 255</span></span><br><span class="line"><span class="comment">// æ¯ä¸€ç§å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line"><span class="type">int</span>[] last = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">256</span>];</span><br><span class="line"><span class="comment">// æ‰€æœ‰å­—ç¬¦éƒ½æ²¡æœ‰ä¸Šæ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line">Arrays.fill(last, -<span class="number">1</span>);</span><br><span class="line"><span class="comment">// ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>; r &lt; n; r++) &#123;</span><br><span class="line">l = Math.max(l, last[s[r]] + <span class="number">1</span>);</span><br><span class="line">ans = Math.max(ans, r - l + <span class="number">1</span>);</span><br><span class="line"><span class="comment">// æ›´æ–°å½“å‰å­—ç¬¦ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®</span></span><br><span class="line">last[s[r]] = r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœ€å°è¦†ç›–å­ä¸²"><a href="#æœ€å°è¦†ç›–å­ä¸²" class="headerlink" title="æœ€å°è¦†ç›–å­ä¸²"></a>æœ€å°è¦†ç›–å­ä¸²</h2><p>æè¿°ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ tï¼Œé•¿åº¦åˆ†åˆ«æ˜¯ m å’Œ nï¼Œè¿”å› s ä¸­çš„ æœ€çŸ­çª—å£ å­ä¸²ï¼Œä½¿å¾—è¯¥å­ä¸²åŒ…å« t ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬é‡å¤å­—ç¬¦ï¼‰ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„å­ä¸²ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² â€œâ€ã€‚</p><p>ç­‰åˆ°æ»¡è¶³è¦†ç›–æ¡ä»¶ä¹‹åï¼Œå†å¼€å§‹è€ƒè™‘ç§»åŠ¨å·¦è¾¹ç•Œã€‚ï¼Œåªæœ‰ç§»åŠ¨å·¦è¾¹ç•Œä¸ä¼šå¯¼è‡´è¦†ç›–æ¡ä»¶å¤±æ•ˆï¼Œæ‰èƒ½ç§»åŠ¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">minWindow</span><span class="params">(String str, String tar)</span> &#123;</span><br><span class="line"><span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line"><span class="type">char</span>[] t = tar.toCharArray();</span><br><span class="line"><span class="comment">// æ¯ç§å­—ç¬¦çš„æ¬ å€ºæƒ…å†µ</span></span><br><span class="line"><span class="comment">// cnts[i] = è´Ÿæ•°ï¼Œä»£è¡¨å­—ç¬¦iæœ‰è´Ÿå€º</span></span><br><span class="line"><span class="comment">// cnts[i] = æ­£æ•°ï¼Œä»£è¡¨å­—ç¬¦iæœ‰ç›ˆä½™</span></span><br><span class="line"><span class="type">int</span>[] cnts = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">256</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">char</span> cha : t) &#123;</span><br><span class="line">cnts[cha]--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ€å°è¦†ç›–å­ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"><span class="comment">// ä»å“ªä¸ªä½ç½®å¼€å¤´ï¼Œå‘ç°çš„æœ€å°è¦†ç›–å­ä¸²</span></span><br><span class="line"><span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// æ€»å€ºåŠ¡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">debt</span> <span class="operator">=</span> t.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = <span class="number">0</span>; r &lt; s.length; r++) &#123;</span><br><span class="line"><span class="comment">// çª—å£å³è¾¹ç•Œå‘å³ï¼Œç»™å‡ºå­—ç¬¦</span></span><br><span class="line"><span class="keyword">if</span> (cnts[s[r]]++ &lt; <span class="number">0</span>) &#123;</span><br><span class="line">debt--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (debt == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// çª—å£å·¦è¾¹ç•Œå‘å³ï¼Œæ‹¿å›å­—ç¬¦</span></span><br><span class="line"><span class="keyword">while</span> (cnts[s[l]] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">cnts[s[l++]]--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»¥rä½ç½®ç»“å°¾çš„è¾¾æ ‡çª—å£ï¼Œæ›´æ–°ç­”æ¡ˆ</span></span><br><span class="line"><span class="keyword">if</span> (r - l + <span class="number">1</span> &lt; len) &#123;</span><br><span class="line">len = r - l + <span class="number">1</span>;</span><br><span class="line">start = l;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> len == Integer.MAX_VALUE ? <span class="string">&quot;&quot;</span> : str.substring(start, start + len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²"><a href="#æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²" class="headerlink" title="æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²"></a>æ›¿æ¢å­ä¸²å¾—åˆ°å¹³è¡¡å­—ç¬¦ä¸²</h2><p>è§£é‡Šï¼šæœ‰ä¸€ä¸ªåªå«æœ‰ â€˜Qâ€™, â€˜Wâ€™, â€˜Eâ€™, â€˜Râ€™ å››ç§å­—ç¬¦ï¼Œä¸”é•¿åº¦ä¸º n çš„å­—ç¬¦ä¸²ã€‚</p><p>å‡å¦‚åœ¨è¯¥å­—ç¬¦ä¸²ä¸­ï¼Œè¿™å››ä¸ªå­—ç¬¦éƒ½æ°å¥½å‡ºç° n/4 æ¬¡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚</p><p>ç»™ä½ ä¸€ä¸ªè¿™æ ·çš„å­—ç¬¦ä¸² sï¼Œè¯·é€šè¿‡ã€Œæ›¿æ¢ä¸€ä¸ªå­ä¸²ã€çš„æ–¹å¼ï¼Œä½¿åŸå­—ç¬¦ä¸² s å˜æˆä¸€ä¸ªã€Œå¹³è¡¡å­—ç¬¦ä¸²ã€ã€‚</p><p>ä½ å¯ä»¥ç”¨å’Œã€Œå¾…æ›¿æ¢å­ä¸²ã€é•¿åº¦ç›¸åŒçš„ ä»»ä½• å…¶ä»–å­—ç¬¦ä¸²æ¥å®Œæˆæ›¿æ¢ã€‚</p><p>è¯·è¿”å›å¾…æ›¿æ¢å­ä¸²çš„æœ€å°å¯èƒ½é•¿åº¦ã€‚</p><p>å¦‚æœåŸå­—ç¬¦ä¸²è‡ªèº«å°±æ˜¯ä¸€ä¸ªå¹³è¡¡å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› 0ã€‚</p><p>æ€è·¯ï¼šè·Ÿæœ€å°è¦†ç›–å­ä¸²æ€è·¯ä¸€æ ·ã€‚åªéœ€è¦æ‰¾åˆ°å“ªäº›å­—ç¬¦è¶…è¿‡äº†å¤šå°‘ï¼Œæˆ‘ä»¬æ›¿æ¢ä»–å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">balancedString</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">4</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.length();i++)&#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">        cnt[pos]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">debat</span> <span class="operator">=</span> <span class="number">0</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(cnt[i] &lt;= n/<span class="number">4</span>)&#123;</span><br><span class="line">            cnt[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            cnt[i] = n/<span class="number">4</span> - cnt[i];</span><br><span class="line">            debat-=cnt[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(debat == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> r=<span class="number">0</span>,l=<span class="number">0</span>;r&lt;s.length();r++)&#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(r);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">if</span>(cnt[pos]++ &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            debat--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(debat == <span class="number">0</span>)&#123;</span><br><span class="line">            c = s.charAt(l);</span><br><span class="line">            pos = c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">            <span class="keyword">while</span>( cnt[pos] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                cnt[pos]--;</span><br><span class="line">                l++;</span><br><span class="line">                c = s.charAt(l);</span><br><span class="line">                pos = c == <span class="string">&#x27;W&#x27;</span> ? <span class="number">1</span> : (c == <span class="string">&#x27;E&#x27;</span> ? <span class="number">2</span> : (c== <span class="string">&#x27;R&#x27;</span> ? <span class="number">3</span> : <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.min(ans,r-l+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„"><a href="#Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„" class="headerlink" title="Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„"></a>Kä¸ªä¸åŒæ•´æ•°çš„å­æ•°ç»„</h2><p>æè¿°ï¼šç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ numså’Œä¸€ä¸ªæ•´æ•° kï¼Œè¿”å› nums ä¸­ ã€Œå¥½å­æ•°ç»„ã€ çš„æ•°ç›®ã€‚</p><p>å¦‚æœ nums çš„æŸä¸ªå­æ•°ç»„ä¸­ä¸åŒæ•´æ•°çš„ä¸ªæ•°æ°å¥½ä¸º kï¼Œåˆ™ç§° nums çš„è¿™ä¸ªè¿ç»­ã€ä¸ä¸€å®šä¸åŒçš„å­æ•°ç»„ä¸º ã€Œå¥½å­æ•°ç»„ ã€ã€‚</p><p>ä¾‹å¦‚ï¼Œ[1,2,3,1,2] ä¸­æœ‰ 3 ä¸ªä¸åŒçš„æ•´æ•°ï¼š1ï¼Œ2ï¼Œä»¥åŠ 3ã€‚<br>å­æ•°ç»„ æ˜¯æ•°ç»„çš„ è¿ç»­ éƒ¨åˆ†ã€‚</p><p>æ€è·¯ï¼šè½¬åŒ–ä¸ºæ±‚ä¸è¶…è¿‡kä¸ªä¸åŒæ•´æ•°é—®é¢˜ï¼Œç”¨k å‡å» k-1 å¯¹åº”çš„ç­”æ¡ˆ å°±æ˜¯åˆšå¥½ä¸ªæ•°ä¸ºkçš„ä¸ªæ•°ã€‚</p><p>å¯¹äºä¸è¶…è¿‡è¿™ä¸ªé—®é¢˜ç”¨æ»‘åŠ¨çª—å£è§£å†³ï¼Œåªè¦ç§ç±»ä¸è¶…è¿‡å°±æ‰©å¤§çª—å£ï¼Œå¦åˆ™ç¼©å°çª—å£ç›´åˆ°ç§ç±»ä¸è¶…è¿‡ã€‚ç„¶åç»Ÿè®¡ä»¥çª—å£å³è¾¹ç»“å°¾çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚å³r-l+1.æ¯æ¬¡ç´¯åŠ è¿™ä¸ªç»“æœå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subarraysWithKDistinct</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸è¶…è¿‡kä¸ªä¸åŒæ•´æ•°</span></span><br><span class="line">    <span class="keyword">return</span> find(nums,k) - find(nums,k-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX</span> <span class="operator">=</span> <span class="number">20001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[MAX];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">    Arrays.fill(cnt,<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">kinds</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>,r=<span class="number">0</span>;r&lt;nums.length;r++)&#123;</span><br><span class="line">        <span class="comment">// çª—å£å³è¾¹ç•Œå‘å³ï¼Œç»™å‡ºå­—ç¬¦,å¹¶åˆ¤æ–­æ˜¯ä¸æ˜¯æ–°çš„</span></span><br><span class="line">        <span class="keyword">if</span>(++cnt[nums[r]] == <span class="number">1</span>)&#123;</span><br><span class="line">            kinds++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (kinds &gt; k)&#123;</span><br><span class="line">            <span class="comment">// çª—å£å·¦è¾¹ç•Œå‘å³ï¼Œæ‹¿å›å­—ç¬¦ï¼Œå¦‚æœä¸€ä¸ªå­—ç¬¦æ²¡æœ‰äº†ï¼Œåˆ™ç§ç±»å‡ä¸€</span></span><br><span class="line">            <span class="keyword">if</span>( -- cnt[nums[l++]] == <span class="number">0</span>)&#123;</span><br><span class="line">                kinds--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä»¥rä½ç½®ç»“å°¾çš„è¾¾æ ‡çª—å£ï¼Œç´¯åŠ ä¸ªæ•°</span></span><br><span class="line">        sum+= r-l+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&quot;&gt;&lt;a href=&quot;#ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&quot; class=&quot;headerlink&quot; title=&quot;ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&quot;&gt;&lt;/a&gt;ç´¯åŠ å’Œå¤§äºç­‰äºkçš„æœ€å°é•¿åº¦å­æ•°ç»„&lt;/h2&gt;&lt;p&gt;éƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥æ»‘åŠ¨çª—å£å…·æœ‰å•</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>èšåˆä¸èšåˆæ ¹</title>
    <link href="https://nmcb666.vip/posts/6758315a.html"/>
    <id>https://nmcb666.vip/posts/6758315a.html</id>
    <published>2026-01-26T01:21:51.000Z</published>
    <updated>2026-01-31T14:36:26.046Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« ç”¨äºå­˜æ”¾æˆ‘åœ¨é˜…è¯»ã€Šæ‚Ÿé“é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹æ—¶ï¼Œå…³äºèšåˆä¸èšåˆæ ¹çš„ç¬”è®°ã€‚</p><p>1.åªèƒ½é€šè¿‡èšåˆæ ¹æ¥ä¿®æ”¹å†…éƒ¨å¯¹è±¡ï¼Œä¸èƒ½ç»•è¿‡èšåˆæ ¹ã€‚</p><p>2.å°±ç®—æƒ³å¼•ç”¨èšåˆæ ¹é‡Œé¢çš„å¯¹è±¡ï¼Œæ¯”å¦‚è®¢å•é‡Œé¢çš„è®¢å•é¡¹åˆ—è¡¨ã€‚é‚£ä¹ˆè®¢å•è¿™ä¸ªèšåˆæ ¹æä¾›çš„getæ–¹æ³•ä¹Ÿå¿…é¡»new ä¸€ä¸ªæ–°åˆ—è¡¨è¿”å›ï¼</p><p>3.åªæœ‰èšåˆæ ¹æœ‰repositoryã€‚ï¼ˆå®ä½“å¯ä»¥æœ‰factoryï¼‰</p><p>4.è®¾è®¡èšåˆæœ€å¥½å°è€Œå…¨ï¼Œæœ€å¥½èƒ½åšåˆ°ä¸€ä¸ªå®ä½“å°±æ˜¯èšåˆã€‚ä½†åšä¸åˆ°ä¹Ÿä¸å¼ºæ±‚ï¼Œèƒ½æ»¡è¶³è¦æ±‚å³å¯ï¼Œä½†åˆ‡è®°ä¸èƒ½è¿‡å¤§ï¼Œä¹Ÿä¸èƒ½å¤ªå°ã€‚</p><p>5.èšåˆæ ¹ä¸èƒ½åœ¨å†…éƒ¨ç›´æ¥å¼•ç”¨å…¶ä»–èšåˆæ ¹ï¼Œåªèƒ½æ ¹æ®å”¯ä¸€idå»æŸ¥è¯¢å¦ä¸€ä¸ªèšåˆæ ¹ï¼Œç”±æœåŠ¡è¿›è¡Œç»Ÿæ’ã€‚</p><p>6.ä¸€ä¸ªäº‹åŠ¡åªå¯¹ä¸€ä¸ªèšåˆæ ¹ä¿å­˜ç”Ÿæ•ˆã€‚</p><p>7.è·¨èšåˆé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå› ä¸ºè§„å®šäº†ç¬¬6æ¡ï¼Œæ‰€ä»¥åœ¨è·¨èšåˆä¸­ç»å¸¸ä¼šå¯¹ä¸åŒçš„è¡¨è¿›è¡Œæ“ä½œï¼‰ï¼Œå…·ä½“å¯ä»¥ç”±é¢†åŸŸäº‹ä»¶å®ç°ã€‚</p><p>8.å¦‚æœèšåˆæ ¹å†…éƒ¨æœ‰ä¸€ä¸ªå®ä½“åˆ—è¡¨ï¼ˆ1ï¼šNå…³ç³»ï¼‰é‚£ä¹ˆå¯ä»¥è€ƒè™‘æŠŠè¿™ä¸ªå®ä½“ä¹Ÿå˜æˆèšåˆæ ¹ï¼ŒåŸèšåˆæ ¹åªä¿ç•™ä»–çš„å”¯ä¸€idåˆ—è¡¨ã€‚å¦‚æœæ˜¯å¤šå¯¹å¤šå…³ç³»ï¼Œå¯ä»¥è€ƒè™‘å†æ–°å»ºä¸€ä¸ªè¡¨ç¤ºå®ƒä»¬ä¸¤ä¸ªå…³ç³»çš„èšåˆæ ¹ã€‚</p><p>9.ä¸ºä»€ä¹ˆè¦æ‹†åˆ†èšåˆæ ¹ï¼Ÿ å› ä¸ºä¸€ä¸ªèšåˆæ ¹ä¿ç•™çš„ä¿¡æ¯è¶Šå¤šï¼Œé‚£ä¹ˆåœ¨å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä¿å­˜èšåˆæ ¹æ—¶å†²çªçš„æ¦‚ç‡å°±è¶Šå¤§ã€‚æ¯”å¦‚æˆ‘çš„ç”¨æˆ·ä¿ç•™äº†èµ„æºåˆ—è¡¨ï¼Œè€Œä¸”æˆ‘æ˜¯ä¿ç•™äº†å®Œæ•´çš„èµ„æºä¿¡æ¯ï¼Œé‚£ä¹ˆå¯èƒ½èµ„æºçš„ä¿¡æ¯ä¿®æ”¹ï¼ˆåªæ˜¯ä¿®æ”¹äº†èµ„æºçš„æ›´æ–°æ—¥æœŸï¼‰ï¼Œä¹Ÿä¼šå¯¼è‡´æˆ‘çš„ç”¨æˆ·ä¿å­˜å¤±è´¥ï¼ˆä¹è§‚é”ï¼Œæ•°æ®ä¸ä¸€æ ·ï¼‰ã€‚ä½†å¦‚æœæŠŠèµ„æºå•ç‹¬å˜æˆèšåˆæ ¹ï¼Œç”¨æˆ·èšåˆåªä¿ç•™èµ„æºidé‚£ä¹ˆå°†ä¼šé¿å…è¿™ç§æƒ…å†µã€‚åŒæ—¶è€ƒè™‘èµ„æºè·Ÿç”¨æˆ·æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œæ‰€ä»¥æœ€å¥½æœ€æ–°å»ºä¸€ä¸ªè§’è‰²è·Ÿèµ„æºç»‘å®šçš„èšåˆæ ¹ï¼Œè§’è‰²èšåˆæ ¹é‡Œé¢ä¸ä¼šæœ‰ä»»ä½•èµ„æºç›¸å…³çš„ä¿¡æ¯ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™ç¯‡æ–‡ç« ç”¨äºå­˜æ”¾æˆ‘åœ¨é˜…è¯»ã€Šæ‚Ÿé“é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹æ—¶ï¼Œå…³äºèšåˆä¸èšåˆæ ¹çš„ç¬”è®°ã€‚&lt;/p&gt;
&lt;p&gt;1.åªèƒ½é€šè¿‡èšåˆæ ¹æ¥ä¿®æ”¹å†…éƒ¨å¯¹è±¡ï¼Œä¸èƒ½ç»•è¿‡èšåˆæ ¹ã€‚&lt;/p&gt;
&lt;p&gt;2.å°±ç®—æƒ³å¼•ç”¨èšåˆæ ¹é‡Œé¢çš„å¯¹è±¡ï¼Œæ¯”å¦‚è®¢å•é‡Œé¢çš„è®¢å•é¡¹åˆ—è¡¨ã€‚é‚£ä¹ˆè®¢å•è¿™ä¸ªèšåˆæ ¹æä¾›çš„getæ–¹æ³•ä¹Ÿå¿…é¡»new ä¸€ä¸ªæ–°åˆ—è¡¨è¿”å›</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆå…­ï¼‰å‰ç¼€å’Œ</title>
    <link href="https://nmcb666.vip/posts/3fdde4bd.html"/>
    <id>https://nmcb666.vip/posts/3fdde4bd.html</id>
    <published>2026-01-25T17:52:09.000Z</published>
    <updated>2026-01-31T14:36:26.049Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰"><a href="#ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰" class="headerlink" title="ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰"></a>ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰</h1><h2 id="å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦"><a href="#å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦" class="headerlink" title="å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦"></a>å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦</h2><p>æ€è·¯ï¼šå‰ç¼€å’Œ+å“ˆå¸Œè¡¨ã€‚å“ˆå¸Œè¡¨å­˜çš„æ˜¯keyæ˜¯å‰ç¼€å’Œï¼Œvalueæ˜¯å‡ºç°çš„ä½ç½®ã€‚ä½†è¿™ä¸ªä½ç½®å¿…é¡»æ˜¯æœ€æ—©å‡ºç°çš„ï¼Œè€Œä¸”å¿…é¡»é¢„å…ˆæ’å…¥ä¸€æ¡ 0 ,-1è¡¨ç¤º0ä¸€å¼€å§‹å°±æ˜¯ã€‚<br>ç„¶åï¼Œä¾æ¬¡éå†æ•°ç»„è®¡ç®—å‰ç¼€å’Œï¼Œç”¨å½“å‰çš„å‰ç¼€å’Œå‡å»kçš„å€¼å»å“ˆå¸Œè¡¨é‡Œé¢æŸ¥æ‰¾ï¼Œå½“å‰ä½ç½®å‡å»å¯¹åº”çš„ä½ç½®å°±æ˜¯ä»¥å½“å‰ä½ç½®ç»“å°¾çš„æœ€é•¿å­æ•°ç»„é•¿åº¦ã€‚éå†æ±‚æœ€å¤§å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">map.clear();</span><br><span class="line"><span class="comment">// é‡è¦ : 0è¿™ä¸ªå‰ç¼€å’Œï¼Œä¸€ä¸ªæ•°å­—ä¹Ÿæ²¡æœ‰çš„æ—¶å€™ï¼Œå°±å­˜åœ¨äº†</span></span><br><span class="line">map.put(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">sum += arr[i];</span><br><span class="line"><span class="keyword">if</span> (map.containsKey(sum - aim)) &#123;</span><br><span class="line">ans = Math.max(ans, i - map.get(sum - aim));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!map.containsKey(sum)) &#123;</span><br><span class="line">map.put(sum, i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„"><a href="#æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„" class="headerlink" title="æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„"></a>æ‰¾æ­£è´Ÿæ•°ç›¸ç­‰çš„æœ€é•¿å­æ•°ç»„</h2><p>æ€è·¯ï¼š æ„é€ å‰ç¼€å’Œï¼Œä½†æ˜¯å‰ç¼€å’Œè®°å½•æ­£è´Ÿæ•°æ•°é‡çš„å·®å€¼ã€‚æ­£æ•°ä¸º1ï¼Œè´Ÿæ•°ä¸º-1ï¼Œ0ä¸º0.ç„¶åæ¯åˆ°ä¸€ä¸ªä½ç½®é å“ˆå¸Œè¡¨æŸ¥è¯¢è·Ÿè‡ªå·±å‰ç¼€å’Œç›¸åŒçš„ä½ç½®ï¼Œç„¶åæ±‚é•¿åº¦ï¼Œå³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compute</span><span class="params">()</span>&#123;</span><br><span class="line">        map.put(<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            cnt+= arr[i] == <span class="number">0</span> ? <span class="number">0</span> : arr[i]&lt;<span class="number">0</span> ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(cnt))&#123;</span><br><span class="line">              ans = Math.max(ans,i-map.get(cnt));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!map.containsKey(cnt))&#123;</span><br><span class="line">                map.put(cnt,i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ-é“¾æ¥ï¼š-https-leetcode-cn-problems-longest-well-performing-interval"><a href="#è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ-é“¾æ¥ï¼š-https-leetcode-cn-problems-longest-well-performing-interval" class="headerlink" title="è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ é“¾æ¥ï¼š https://leetcode.cn/problems/longest-well-performing-interval/"></a>è¡¨ç°è‰¯å¥½çš„æœ€é•¿æ—¶é—´æ®µ é“¾æ¥ï¼š <a href="https://leetcode.cn/problems/longest-well-performing-interval/">https://leetcode.cn/problems/longest-well-performing-interval/</a></h2><p>æ€è·¯ï¼šè¿˜æ˜¯å‰ç¼€å’Œ+å“ˆå¸Œè¡¨ã€‚è¶…è¿‡æ—¶é•¿+1ï¼Œå°äºæ—¶é•¿-1ã€‚å¦‚æœé‡åˆ°å‰ç¼€å’Œä¸ºæ­£æ•°è¯´æ˜ä»ä¸€å¼€å§‹å°±æ˜¯æ»¡è¶³çš„ï¼Œè¿”å›i+1.å¦‚æœä¸ºè´Ÿæ•°æˆ–è€…0ï¼Œé‚£ä¹ˆå°±æ‰¾å‰ç¼€å’Œ-1çš„ä½ç½®ï¼ˆæ‹‰æ ¼æœ—æ—¥ä¸­å€¼å®šç†ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">longestWPI</span><span class="params">(<span class="type">int</span>[] hours)</span> &#123;</span><br><span class="line"><span class="comment">// æŸä¸ªå‰ç¼€å’Œï¼Œæœ€æ—©å‡ºç°çš„ä½ç½®</span></span><br><span class="line">HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 0è¿™ä¸ªå‰ç¼€å’Œï¼Œæœ€æ—©å‡ºç°åœ¨-1ï¼Œä¸€ä¸ªæ•°ä¹Ÿæ²¡æœ‰çš„æ—¶å€™</span></span><br><span class="line">map.put(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, sum = <span class="number">0</span>; i &lt; hours.length; i++) &#123;</span><br><span class="line">sum += hours[i] &gt; <span class="number">8</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (sum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">ans = i + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// sum &lt;= 0</span></span><br><span class="line"><span class="keyword">if</span> (map.containsKey(sum - <span class="number">1</span>)) &#123;</span><br><span class="line">ans = Math.max(ans, i - map.get(sum - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!map.containsKey(sum)) &#123;</span><br><span class="line">map.put(sum, i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤"><a href="#ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤" class="headerlink" title="ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤"></a>ç§»é™¤æœ€å°‘å­æ•°ç»„é•¿åº¦ä½¿æ•°ç»„å’Œå¯ä»¥è¢«pæ•´é™¤</h2><p>æ€è·¯ï¼šä»¥ä½™æ•°ä¸ºå‰ç¼€å’Œï¼Œæ±‚å‡ºæ•´ä¸ªæ•°ç»„å’Œçš„ä½™æ•°modã€‚ç„¶ååœ¨éå†è¿‡ç¨‹ä¸­é‡åˆ°å½“å‰ä½™æ•°curModï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°ä¹‹å‰æœ€åä¸€ä¸ªä½™æ•°ä¸º (curMod + p - mod)%p çš„ä½ç½®ï¼Œç„¶åæ±‚å‡ºé•¿åº¦ã€‚å°±æ˜¯éœ€è¦åœ¨å½“å‰ä½ç½®ç§»é™¤çš„å­æ•°ç»„çš„é•¿åº¦ã€‚éœ€è¦æœ€ååˆ¤æ–­é•¿åº¦æ˜¯ç­‰äºæ•°ç»„é•¿åº¦çš„æ—¶å€™ï¼Œè¿”å›-1.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minSubarray</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> p)</span> &#123;</span><br><span class="line"><span class="comment">// æ•´ä½“ä½™æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">mod = (mod + num) % p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (mod == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// key : å‰ç¼€å’Œ%pçš„ä½™æ•°</span></span><br><span class="line"><span class="comment">// value : æœ€æ™šå‡ºç°çš„ä½ç½®</span></span><br><span class="line">HashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, cur = <span class="number">0</span>, find; i &lt; nums.length; i++) &#123;</span><br><span class="line"><span class="comment">// 0...iè¿™éƒ¨åˆ†çš„ä½™æ•°</span></span><br><span class="line">cur = (cur + nums[i]) % p;</span><br><span class="line">find = cur &gt;= mod ? (cur - mod) : (cur + p - mod);</span><br><span class="line"><span class="comment">// find = (cur + p - mod) % p;</span></span><br><span class="line"><span class="keyword">if</span> (map.containsKey(find)) &#123;</span><br><span class="line">ans = Math.min(ans, i - map.get(find));</span><br><span class="line">&#125;</span><br><span class="line">map.put(cur, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans == nums.length ? -<span class="number">1</span> : ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸€ç»´å·®åˆ†"><a href="#ä¸€ç»´å·®åˆ†" class="headerlink" title="ä¸€ç»´å·®åˆ†"></a>ä¸€ç»´å·®åˆ†</h1><p>è§£é‡Šï¼šç°åœ¨è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ol><li>ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘è¦åœ¨ç»™å®šåŒºé—´åŠ ä¸Šä¸€ä¸ªåŒæ ·çš„æ•°ã€‚å¾ªç¯å¤šæ¬¡</li><li>åŠ å®Œä¹‹åè¿”å›ç»™æˆ‘æ¯ä¸ªä½ç½®ä¸Šçš„å€¼ã€‚</li></ol><p>ä¸€ç»´å·®åˆ†ï¼š</p><ol><li>åŒºé—´å¦‚æœä¸ºl,r è¦åŠ ä¸Ša,é‚£ä¹ˆæˆ‘åœ¨arr[l]+a,arr[r+1]-a.</li><li>ä¹‹åå¯¹è¿™ä¸ªæ•°ç»„æ±‚å‰ç¼€å’Œï¼Œå°±æ˜¯ç»“æœã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bookings</span></span><br><span class="line"><span class="comment">// [1,5,6]</span></span><br><span class="line"><span class="comment">// [2,9,3]</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] corpFlightBookings(<span class="type">int</span>[][] bookings, <span class="type">int</span> n) &#123;</span><br><span class="line"><span class="type">int</span>[] cnt = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">2</span>];</span><br><span class="line"><span class="comment">// è®¾ç½®å·®åˆ†æ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ“ä½œå¯¹åº”ä¸¤ä¸ªè®¾ç½®</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span>[] book : bookings) &#123;</span><br><span class="line">cnt[book[<span class="number">0</span>]] += book[<span class="number">2</span>];</span><br><span class="line">cnt[book[<span class="number">1</span>] + <span class="number">1</span>] -= book[<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åŠ å·¥å‰ç¼€å’Œ</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; cnt.length; i++) &#123;</span><br><span class="line">cnt[i] += cnt[i - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">ans[i] = cnt[i + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç­‰å·®å·®åˆ†"><a href="#ç­‰å·®å·®åˆ†" class="headerlink" title="ç­‰å·®å·®åˆ†"></a>ç­‰å·®å·®åˆ†</h1><p>è§£é‡Šï¼š è·Ÿä¸€ç»´å·®åˆ†ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘è¦ä»låˆ°r ä¾æ¬¡åŠ ä¸Šä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°ã€‚</p><p>ç»“è®ºï¼š å‡è®¾è¿™ä¸ªç­‰å·®æ•°åˆ— é¦–é¡¹ä¸º s , å…¬å·®ä¸º d, æœ«é¡¹ä¸º eã€‚é‚£å¯¹arr[l]+=s,arr[l+1]+=d-s,arr[r+1]-=d+e,arr[r+2]+=e; ç„¶åè¿›è¡Œä¸¤æ¬¡å‰ç¼€å’Œå³å¯ã€‚</p><h1 id="äºŒç»´å‰ç¼€å’Œ"><a href="#äºŒç»´å‰ç¼€å’Œ" class="headerlink" title="äºŒç»´å‰ç¼€å’Œ"></a>äºŒç»´å‰ç¼€å’Œ</h1><p>å…¬å¼ï¼š sum[i][j] = sum[i-1][j] + sum[i][j-1] - sum[i-1][j-1] + arr[i][j]<br>è®¡ç®—ä»ï¼ˆa,bï¼‰åˆ° ï¼ˆc,dï¼‰çš„å­çŸ©é˜µçš„å’Œ : sum[c][d] - sum[a-1][d] - sum[c][b-1] + sum[a-1][b-1]</p><h2 id="æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢"><a href="#æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢" class="headerlink" title="æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢"></a>æœ€å¤§ä»¥1ä¸ºè¾¹ç•Œçš„æ­£æ–¹å½¢</h2><p>æè¿°ï¼šç»™ä½ ä¸€ä¸ªç”±è‹¥å¹² 0 å’Œ 1 ç»„æˆçš„äºŒç»´ç½‘æ ¼ gridï¼Œè¯·ä½ æ‰¾å‡ºè¾¹ç•Œå…¨éƒ¨ç”± 1 ç»„æˆçš„æœ€å¤§ æ­£æ–¹å½¢ å­ç½‘æ ¼ï¼Œå¹¶è¿”å›è¯¥å­ç½‘æ ¼ä¸­çš„å…ƒç´ æ•°é‡ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› 0ã€‚</p><p>æ ¸å¿ƒæ€è·¯ï¼šæ„é€ å‡ºäºŒç»´å‰ç¼€å’Œï¼Œä¾æ¬¡æšä¸¾ä»¥ï¼ˆi,jï¼‰ä¸ºå·¦ä¸Šè§’çš„æ­£æ–¹å½¢æ˜¯å¦åˆæ³•ã€‚å‡è®¾ä»¥(c,d)ä¸ºå³ä¸‹è§’ã€‚è¿™ä¸ªæ­£æ–¹å½¢çš„å’Œå‡å»ä»¥(i+1,j+1),(c-1,d-1)ä¸ºå¯¹è§’çš„æ­£æ–¹å½¢å’Œçš„å€¼åº”è¯¥ç­‰äºä»–çš„ï¼ˆè¾¹é•¿-1ï¼‰ * 2ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">largest1BorderedSquare</span><span class="params">(<span class="type">int</span>[][] g)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> g.length;</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> g[<span class="number">0</span>].length;</span><br><span class="line">build(n, m, g);</span><br><span class="line"><span class="keyword">if</span> (sum(g, <span class="number">0</span>, <span class="number">0</span>, n - <span class="number">1</span>, m - <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰¾åˆ°çš„æœ€å¤§åˆæ³•æ­£æ–¹å½¢çš„è¾¹é•¿</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>; a &lt; n; a++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>; b &lt; m; b++) &#123;</span><br><span class="line"><span class="comment">// (a,b)æ‰€æœ‰å·¦ä¸Šè§’ç‚¹</span></span><br><span class="line"><span class="comment">//     (c,d)æ›´å¤§è¾¹é•¿çš„å³ä¸‹è§’ç‚¹ï¼Œkæ˜¯å½“å‰å°è¯•çš„è¾¹é•¿</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + ans, d = b + ans, k = ans + <span class="number">1</span>; c &lt; n &amp;&amp; d &lt; m; c++, d++, k++) &#123;</span><br><span class="line"><span class="keyword">if</span> (sum(g, a, b, c, d) - sum(g, a + <span class="number">1</span>, b + <span class="number">1</span>, c - <span class="number">1</span>, d - <span class="number">1</span>) == (k - <span class="number">1</span>) &lt;&lt; <span class="number">2</span>) &#123;</span><br><span class="line">ans = k;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans * ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// g : åŸå§‹äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">// æŠŠgå˜æˆåŸå§‹äºŒç»´æ•°ç»„çš„å‰ç¼€å’Œæ•°ç»„sumï¼Œå¤ç”¨è‡ªå·±</span></span><br><span class="line"><span class="comment">// ä¸èƒ½è¡¥0è¡Œï¼Œ0åˆ—ï¼Œéƒ½æ˜¯0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span>[][] g)</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">g[i][j] += get(g, i, j - <span class="number">1</span>) + get(g, i - <span class="number">1</span>, j) - get(g, i - <span class="number">1</span>, j - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span>[][] g, <span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a &gt; c ? <span class="number">0</span> : (g[c][d] - get(g, c, b - <span class="number">1</span>) - get(g, a - <span class="number">1</span>, d) + get(g, a - <span class="number">1</span>, b - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span>[][] g, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> (i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span>) ? <span class="number">0</span> : g[i][j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="äºŒç»´å·®åˆ†"><a href="#äºŒç»´å·®åˆ†" class="headerlink" title="äºŒç»´å·®åˆ†"></a>äºŒç»´å·®åˆ†</h1><p>è·Ÿä¸€ç»´å·®åˆ†å·®ä¸å¤šè¿™é‡Œç›´æ¥ç»™å…¬å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// äºŒç»´å·®åˆ†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">diff[a][b] += k;</span><br><span class="line">diff[c + <span class="number">1</span>][b] -= k;</span><br><span class="line">diff[a][d + <span class="number">1</span>] -= k;</span><br><span class="line">diff[c + <span class="number">1</span>][d + <span class="number">1</span>] += k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&quot;&gt;&lt;a href=&quot;#ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&quot;&gt;&lt;/a&gt;ä¸€ç»´å‰ç¼€å’Œï¼ˆå­æ•°ç»„ç›¸å…³é—®é¢˜ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å’Œç­‰äºkçš„æœ€é•¿å­æ•°ç»„é•¿åº¦&quot;&gt;&lt;a </summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Raftä¸Paxos</title>
    <link href="https://nmcb666.vip/posts/b1c1c3b5.html"/>
    <id>https://nmcb666.vip/posts/b1c1c3b5.html</id>
    <published>2026-01-25T14:05:03.000Z</published>
    <updated>2026-01-31T14:36:26.048Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ"><a href="#æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ" class="headerlink" title="[æ·±åº¦å¯¹æ¯”] åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos ä¸ Raftï¼Œä¸ºä½• Raft æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ"></a>[æ·±åº¦å¯¹æ¯”] åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos ä¸ Raftï¼Œä¸ºä½• Raft æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ</h1><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµ©ç€šå®‡å®™ä¸­ï¼Œ<strong>â€œå…±è¯†ï¼ˆConsensusï¼‰â€</strong> æ˜¯æœ€æ ¸å¿ƒçš„éš¾é¢˜ä¹‹ä¸€ã€‚å¦‚ä½•è®©ä¸€å †å¯èƒ½éšæ—¶å®•æœºã€ç½‘ç»œå»¶è¿Ÿçš„æœºå™¨å¯¹æŸä¸ªå€¼è¾¾æˆä¸€è‡´ï¼Ÿè¿™ä¸ªé—®é¢˜å›°æ‰°äº†è®¡ç®—æœºç§‘å­¦å®¶å‡ åå¹´ã€‚</p><p>åœ¨è¿™ä¸ªé¢†åŸŸï¼Œæœ‰ä¸¤ä½ç»å¯¹çš„ä¸»è§’ï¼šä¸€ä¸ªæ˜¯ç†è®ºç•Œçš„â€œç¥â€ <strong>Paxos</strong>ï¼Œå¦ä¸€ä¸ªæ˜¯å·¥ç¨‹ç•Œçš„â€œæ•‘ä¸–ä¸»â€ <strong>Raft</strong>ã€‚</p><p>å¾ˆå¤šå¼€å‘è€…éƒ½çŸ¥é“ï¼Œç°åœ¨ä¸»æµçš„åˆ†å¸ƒå¼ç»„ä»¶ï¼ˆå¦‚ Etcd, Consul, TiKV, Kafkaçš„æ–°ç‰ˆæœ¬ï¼‰å¤§å¤šé€‰æ‹©äº† Raftã€‚é‚£ä¹ˆï¼ŒPaxos åˆ°åº•è¾“åœ¨å“ªé‡Œï¼ŸRaft åˆä¸ºä½•å¦‚æ­¤å®¹æ˜“å®ç°ï¼Ÿæœ¬æ–‡å°†å¸¦ä½ æ·±å…¥å‰–æä¸¤è€…çš„åŒºåˆ«ä¸ä¼˜åŠ£ã€‚</p><hr><h2 id="ä¸€ã€-æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚"><a href="#ä¸€ã€-æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚" class="headerlink" title="ä¸€ã€ æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚"></a>ä¸€ã€ æ ¸å¿ƒè®¾è®¡å“²å­¦çš„å·®å¼‚</h2><p>è¦ç†è§£å®ƒä»¬çš„åŒºåˆ«ï¼Œé¦–å…ˆè¦çœ‹å®ƒä»¬è¯ç”Ÿçš„åˆè¡·ï¼š</p><ul><li><strong>Paxos (Leslie Lamport, 1990)</strong>ï¼šæ—¨åœ¨å‘ç°å…±è¯†é—®é¢˜çš„<strong>æ•°å­¦è§„å¾‹</strong>ã€‚å®ƒä»æ•°å­¦è§’åº¦è¯æ˜äº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¾¾æˆä¸€è‡´çš„å……è¦æ¡ä»¶ã€‚å®ƒè¿½æ±‚çš„æ˜¯ç†è®ºçš„å®Œå¤‡æ€§å’Œä¸€èˆ¬æ€§ã€‚</li><li><strong>Raft (Diego Ongaro &amp; John Ousterhout, 2013)</strong>ï¼šæ—¨åœ¨æä¾›ä¸€ä¸ª<strong>å¯ç†è§£ï¼ˆUnderstandableï¼‰</strong>ä¸”<strong>æ˜“äºå®ç°</strong>çš„ç®—æ³•ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡éå¸¸æ˜ç¡®ï¼š<strong>å°±æ˜¯ä¸ºäº†è§£å†³ Paxos å¤ªéš¾æ‡‚ã€å¤ªéš¾å®ç°çš„é—®é¢˜</strong>ã€‚</li></ul><p>å¦‚æœæŠŠ Paxos æ¯”ä½œé‡å­åŠ›å­¦ï¼ˆè§£é‡Šäº†ä¸–ç•Œçš„æœ¬è´¨ï¼Œä½†å¾ˆéš¾ç›´æ¥ç”¨æ¥é€ æ¡¥ï¼‰ï¼Œé‚£ä¹ˆ Raft å°±æ˜¯ç‰›é¡¿åŠ›å­¦ï¼ˆåœ¨ç‰¹å®šçº¦æŸä¸‹ï¼Œç»™äº†ä½ ä¸€å¥—é€ æ¡¥çš„æ ‡å‡†å…¬å¼ï¼‰ã€‚</p><hr><h2 id="äºŒã€-ä¸ºä»€ä¹ˆ-Raft-æ›´å®¹æ˜“å®ç°ï¼Ÿ"><a href="#äºŒã€-ä¸ºä»€ä¹ˆ-Raft-æ›´å®¹æ˜“å®ç°ï¼Ÿ" class="headerlink" title="äºŒã€ ä¸ºä»€ä¹ˆ Raft æ›´å®¹æ˜“å®ç°ï¼Ÿ"></a>äºŒã€ ä¸ºä»€ä¹ˆ Raft æ›´å®¹æ˜“å®ç°ï¼Ÿ</h2><p>è¿™æ˜¯ Raft èƒ½å¤Ÿåæ¥å±…ä¸Šçš„æœ€å¤§åŸå› ã€‚Raft å¹¶ä¸æ˜¯åœ¨ç†è®ºä¸Šè¶…è¶Šäº† Paxosï¼Œè€Œæ˜¯é€šè¿‡<strong>å¢åŠ çº¦æŸ</strong>å’Œ<strong>åˆ†è§£é—®é¢˜</strong>ï¼Œæå¤§åœ°é™ä½äº†å·¥ç¨‹è½åœ°çš„å¤æ‚åº¦ã€‚</p><h3 id="1-é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰"><a href="#1-é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰" class="headerlink" title="1. é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰"></a>1. é—®é¢˜çš„åˆ†è§£ï¼ˆDecompositionï¼‰</h3><p>Paxos å°†é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€ç¡®è®¤æäº¤ç­‰é€»è¾‘æ··æ‚åœ¨ä¸€èµ·ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚<br>Raft å¼ºåˆ¶å°†å…±è¯†é—®é¢˜æ‹†è§£ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„å­æ¨¡å—ï¼š</p><ul><li><strong>Leader Electionï¼ˆé€‰ä¸»ï¼‰</strong>ï¼šå…ˆé€‰å‡ºè€å¤§ï¼Œåˆ«çš„ä»€ä¹ˆéƒ½ä¸å¹²ã€‚</li><li><strong>Log Replicationï¼ˆæ—¥å¿—å¤åˆ¶ï¼‰</strong>ï¼šè€å¤§è´Ÿè´£åŒæ­¥æ•°æ®ï¼ŒFollower è´Ÿè´£æ¥æ”¶ã€‚</li><li><strong>Safetyï¼ˆå®‰å…¨æ€§ï¼‰</strong>ï¼šç¡®ä¿æ•°æ®ä¸€æ—¦æäº¤ï¼Œå°±æ°¸è¿œå­˜åœ¨ã€‚</li></ul><p>è¿™ç§è§£è€¦ä½¿å¾—å¼€å‘è€…å¯ä»¥ç‹¬ç«‹ç¼–å†™å’Œæµ‹è¯•æ¯ä¸ªæ¨¡å—ã€‚</p><h3 id="2-å¼º-Leader-æ¨¡å‹ï¼ˆStrong-Leaderï¼‰"><a href="#2-å¼º-Leader-æ¨¡å‹ï¼ˆStrong-Leaderï¼‰" class="headerlink" title="2. å¼º Leader æ¨¡å‹ï¼ˆStrong Leaderï¼‰"></a>2. å¼º Leader æ¨¡å‹ï¼ˆStrong Leaderï¼‰</h3><p>è¿™æ˜¯ Raft ç®€åŒ–çš„æ€æ‰‹é”ã€‚</p><ul><li><strong>Paxos</strong>ï¼šå…è®¸æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶å‘èµ·ææ¡ˆï¼ˆè™½ç„¶ Multi-Paxos ä¹Ÿä¼šä¼˜åŒ–ä¸ºå• Leaderï¼Œä½†åè®®æœ¬èº«å…è®¸å¹¶å‘ï¼‰ã€‚è¿™å¯¼è‡´éœ€è¦å¤„ç†æå…¶å¤æ‚çš„â€œå†²çªè§£å†³â€å’Œâ€œæ—¥å¿—ä¹±åºâ€é—®é¢˜ã€‚</li><li><strong>Raft</strong>ï¼šæ˜¯<strong>ç‹¬è£</strong>çš„ã€‚æ—¥å¿—æµå‘åªèƒ½æ˜¯ <code>Leader -&gt; Follower</code>ã€‚Follower ç»å¯¹ä¸ä¼šä¿®æ”¹ Leader çš„æ—¥å¿—ï¼ŒLeader ä¹Ÿæ°¸è¿œä¸ä¼šè¦†ç›–è‡ªå·±çš„æ—¥å¿—ã€‚è¿™ç§å•å‘æ•°æ®æµæ¶ˆé™¤äº†å¤§é‡è¾¹ç¼˜çŠ¶æ€ã€‚</li></ul><h3 id="3-å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog-Continuityï¼‰"><a href="#3-å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog-Continuityï¼‰" class="headerlink" title="3. å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog Continuityï¼‰"></a>3. å¼ºåˆ¶æ—¥å¿—è¿ç»­ï¼ˆLog Continuityï¼‰</h3><ul><li><strong>Paxos</strong>ï¼šå…è®¸æ—¥å¿—æœ‰â€œç©ºæ´â€ã€‚æ¯”å¦‚èŠ‚ç‚¹ A ç¡®è®¤äº†ç¬¬ 1ã€2ã€5 å·æ—¥å¿—ï¼Œç¼ºäº† 3 å’Œ 4ã€‚Paxos å…è®¸è¿™ç§æƒ…å†µå­˜åœ¨ï¼Œåç»­å†é€šè¿‡å¤æ‚çš„é€»è¾‘æŠŠç©ºæ´è¡¥é½ã€‚</li><li><strong>Raft</strong>ï¼š<strong>ä¸å…è®¸ç©ºæ´</strong>ã€‚Follower å¿…é¡»æŒ‰é¡ºåºæ¥æ”¶æ—¥å¿—ã€‚å¦‚æœ Follower ç¼ºäº†ç¬¬ 4 å·æ—¥å¿—ï¼ŒLeader ç»ä¸ä¼šå‘ç¬¬ 5 å·ç»™å®ƒï¼Œè€Œæ˜¯ä¼šå¼ºåˆ¶å›é€€ï¼ˆåˆ©ç”¨ <code>PrevLogIndex</code> æ£€æŸ¥ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€è‡´çš„ç‚¹ï¼Œç„¶åè¦†ç›–åŒæ­¥ã€‚è¿™è®©çŠ¶æ€æœºçš„å®ç°å˜å¾—æå…¶ç®€å•â€”â€”æŒ‰é¡ºåºæ‰§è¡Œå³å¯ã€‚</li></ul><h3 id="4-é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰"><a href="#4-é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰" class="headerlink" title="4. é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰"></a>4. é€‰ä¸»é™åˆ¶ï¼šæ‹¥æœ‰æœ€æ–°æ—¥å¿—è€…æ‰èƒ½å½“é€‰</h3><p>åœ¨ Paxos ä¸­ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½å¯èƒ½æˆä¸º Leaderï¼Œå“ªæ€•å®ƒçš„æ•°æ®å¾ˆæ—§ã€‚ä¸Šä½åï¼Œå®ƒéœ€è¦å…ˆå­¦ä¹ å†å²æ•°æ®ï¼Œè¡¥å…¨è‡ªå·±çš„çŸ¥è¯†ï¼Œç„¶åæ‰èƒ½å¼€å§‹å·¥ä½œã€‚<br>Raft è§„å®šï¼š<strong>åªæœ‰æ‹¥æœ‰æ‰€æœ‰å·²æäº¤æ—¥å¿—çš„èŠ‚ç‚¹ï¼Œæ‰æœ‰èµ„æ ¼å½“é€‰ Leaderã€‚</strong> è¿™æ„å‘³ç€æ–° Leader ä¸Šä»»çš„ç¬¬ä¸€åˆ»èµ·ï¼Œå®ƒå°±ä¸éœ€è¦å»é—®åˆ«äººâ€œæˆ‘æ˜¯ä¸æ˜¯ç¼ºæ•°æ®äº†â€ï¼Œç›´æ¥æ¥å—æ–°å†™å…¥å³å¯ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Raft ä¹‹æ‰€ä»¥å®¹æ˜“å®ç°ï¼Œæ˜¯å› ä¸ºå®ƒå‰¥å¤ºäº†èŠ‚ç‚¹çš„è‡ªç”±ï¼š</p><p>ä¸å‡†ä¹±åºæäº¤ï¼ˆæ¶ˆç­äº†å¤æ‚çš„å¹¶å‘åˆå¹¶é€»è¾‘ï¼‰ã€‚</p><p>ä¸å‡† Follower è´¨ç–‘ Leaderï¼ˆæ¶ˆç­äº†åŒå‘åŒæ­¥é€»è¾‘ï¼‰ã€‚</p><p>ä¸å‡†æ—§èŠ‚ç‚¹å½“ Leaderï¼ˆæ¶ˆç­äº† Leader ä¸Šä½åçš„è¡¥æ•°æ®é€»è¾‘ï¼‰ã€‚</p><hr><h2 id="ä¸‰ã€-Paxos-ä¸-Raft-çš„ä¼˜ç¼ºç‚¹æƒè¡¡"><a href="#ä¸‰ã€-Paxos-ä¸-Raft-çš„ä¼˜ç¼ºç‚¹æƒè¡¡" class="headerlink" title="ä¸‰ã€ Paxos ä¸ Raft çš„ä¼˜ç¼ºç‚¹æƒè¡¡"></a>ä¸‰ã€ Paxos ä¸ Raft çš„ä¼˜ç¼ºç‚¹æƒè¡¡</h2><p>æ—¢ç„¶ Raft è¿™ä¹ˆå¥½ï¼ŒPaxos æ˜¯ä¸æ˜¯ä¸€æ— æ˜¯å¤„ï¼Ÿå¹¶éå¦‚æ­¤ã€‚ä¸¤è€…åœ¨ä¸åŒçš„ç»´åº¦å„æœ‰åƒç§‹ã€‚</p><h3 id="1-Paxos-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Raftï¼‰"><a href="#1-Paxos-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Raftï¼‰" class="headerlink" title="1. Paxos çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Raftï¼‰"></a>1. Paxos çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Raftï¼‰</h3><ul><li><strong>ç†è®ºçš„æè‡´ä¸é€šç”¨æ€§</strong>ï¼šPaxos æ˜¯å…±è¯†ç®—æ³•çš„åŸºçŸ³ã€‚Google çš„ Chubbyã€Spanner åº•å±‚ä¾ç„¶æ˜¯ Paxos çš„å˜ç§ã€‚äº‹å®ä¸Šï¼ŒRaft å¯ä»¥è¢«çœ‹ä½œæ˜¯ Paxos çš„ä¸€ä¸ªç‰¹å®šçº¦æŸä¸‹çš„å­é›†ã€‚</li><li><strong>æ›´é«˜çš„å†™å…¥å¹¶å‘æ½œåŠ›</strong>ï¼šç”±äº Paxos å…è®¸æ—¥å¿—ä¹±åºç¡®è®¤ï¼ˆOut-of-Order Commitï¼‰ï¼Œåœ¨ä¸ä¾èµ–å¼ºé¡ºåºçš„åœºæ™¯ä¸‹ï¼ˆæˆ–è€…ä½¿ç”¨ EPaxos ç­‰å˜ç§ï¼‰ï¼Œå®ƒçš„ç†è®ºååé‡å¯ä»¥é«˜äº Raftã€‚Raft å¿…é¡»ä¸€ä¸ªæ¥ä¸€ä¸ªé¡ºåºæäº¤ï¼Œå­˜åœ¨é˜Ÿå¤´é˜»å¡ï¼ˆHead-of-Line Blockingï¼‰é£é™©ã€‚</li><li><strong>æ—  Leader çš„ç”Ÿå­˜èƒ½åŠ›</strong>ï¼šBasic Paxos ä¸éœ€è¦ Leaderï¼Œåœ¨ç½‘ç»œæå…¶ä¸ç¨³å®šã€æ— æ³•ç»´æŒç¨³å®š Leader çš„æç«¯ç¯å¢ƒä¸‹ï¼ŒBasic Paxos ä¾ç„¶èƒ½å·¥ä½œï¼Œè€Œ Raft ä¼šé™·å…¥åå¤é€‰ä¸»çš„æ­»å¾ªç¯ï¼ˆä¸å¯ç”¨ï¼‰ã€‚</li></ul><h3 id="2-Raft-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Paxosï¼‰"><a href="#2-Raft-çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯”-Paxosï¼‰" class="headerlink" title="2. Raft çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Paxosï¼‰"></a>2. Raft çš„ä¼˜ç‚¹ï¼ˆå¯¹æ¯” Paxosï¼‰</h3><ul><li><strong>å¯ç†è§£æ€§ï¼ˆUnderstandabilityï¼‰</strong>ï¼šè¿™æ˜¯ Raft çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚ä¸€ä¸ªæ™®é€šçš„å·¥ç¨‹å¸ˆé˜…è¯» Raft è®ºæ–‡ä¸¤éå¯èƒ½å°±èƒ½å†™å‡ºåŸå‹ï¼›è€Œé˜…è¯» Paxos è®ºæ–‡åéå¯èƒ½è¿˜æ˜¯ä¸€å¤´é›¾æ°´ã€‚</li><li><strong>å·¥ç¨‹ç»†èŠ‚å®Œå¤‡</strong>ï¼šPaxos è®ºæ–‡åªè®²äº†å¦‚ä½•è¾¾æˆå…±è¯†ï¼Œæ²¡è®²å¦‚ä½•å¢åˆ èŠ‚ç‚¹ã€å¦‚ä½•å‹ç¼©æ—¥å¿—ï¼ˆSnapshotï¼‰ã€‚Raft å¯¹è¿™äº›å·¥ç¨‹ç—›ç‚¹éƒ½ç»™å‡ºäº†æ ‡å‡†è§£å†³æ–¹æ¡ˆï¼ˆå¦‚ Joint Consensus æˆå‘˜å˜æ›´ç®—æ³•ï¼‰ã€‚</li><li><strong>è°ƒè¯•ä¸æ’é”™</strong>ï¼šç”±äº Raft çš„çŠ¶æ€è½¬æ¢è·¯å¾„éå¸¸æ¸…æ™°ï¼ˆä¸”æœ‰é™ï¼‰ï¼Œå½“ç³»ç»Ÿå‡ºç° Bug æ—¶ï¼Œæ›´å®¹æ˜“å¤ç°å’Œå®šä½ã€‚</li></ul><hr><h2 id="å››ã€-æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ"><a href="#å››ã€-æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ" class="headerlink" title="å››ã€ æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ"></a>å››ã€ æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ</h2><div class="table-container"><table><thead><tr><th style="text-align:left">ç‰¹æ€§</th><th style="text-align:left">Paxos (Multi-Paxos)</th><th style="text-align:left">Raft</th></tr></thead><tbody><tr><td style="text-align:left"><strong>è®¾è®¡ç›®æ ‡</strong></td><td style="text-align:left">ç†è®ºè¯æ˜</td><td style="text-align:left">å·¥ç¨‹å®ç°ã€å¯ç†è§£æ€§</td></tr><tr><td style="text-align:left"><strong>æ—¥å¿—ç»“æ„</strong></td><td style="text-align:left">å…è®¸ç©ºæ´ï¼Œå¹¶å‘ç¡®è®¤</td><td style="text-align:left">å¿…é¡»è¿ç»­ï¼Œé¡ºåºç¡®è®¤</td></tr><tr><td style="text-align:left"><strong>æ•°æ®æµå‘</strong></td><td style="text-align:left">å¤šç‚¹å¯èƒ½ï¼ˆå¤æ‚ï¼‰</td><td style="text-align:left">Leader å•å‘æµå‘ Follower</td></tr><tr><td style="text-align:left"><strong>å®ç°éš¾åº¦</strong></td><td style="text-align:left">æé«˜ï¼ˆå®¹æ˜“å†™å‡º Bugï¼‰</td><td style="text-align:left">ä¸­ç­‰ï¼ˆæœ‰æ ‡å‡†å‚è€ƒï¼‰</td></tr><tr><td style="text-align:left"><strong>å·¥ä¸šç•Œç°çŠ¶</strong></td><td style="text-align:left">Google Spanner, Zookeeper (ZAB ç±»ä¼¼)</td><td style="text-align:left">Etcd, Consul, TiKV, CockroachDB</td></tr></tbody></table></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ&quot;&gt;&lt;a href=&quot;#æ·±åº¦å¯¹æ¯”-åˆ†å¸ƒå¼å…±è¯†çš„åŒé›„ï¼šPaxos-ä¸-Raftï¼Œä¸ºä½•-Raft-æˆä¸ºäº†å·¥ç¨‹ç•Œçš„å® å„¿ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;[æ·±</summary>
      
    
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://nmcb666.vip/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆäº”ï¼‰ å‰ç¼€æ ‘</title>
    <link href="https://nmcb666.vip/posts/38c6bd07.html"/>
    <id>https://nmcb666.vip/posts/38c6bd07.html</id>
    <published>2026-01-24T16:36:58.000Z</published>
    <updated>2026-01-31T14:36:26.049Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰ç¼€æ ‘ç»“æ„"><a href="#å‰ç¼€æ ‘ç»“æ„" class="headerlink" title="å‰ç¼€æ ‘ç»“æ„"></a>å‰ç¼€æ ‘ç»“æ„</h2><p>Trieæ ‘ï¼Œå³å­—å…¸æ ‘ï¼Œåˆç§°å•è¯æŸ¥æ‰¾æ ‘æˆ–é”®æ ‘ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘çš„å˜ç§ã€‚å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡å’Œæ’åºå¤§é‡çš„å­—ç¬¦ä¸²ï¼ˆä½†ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼‰ï¼Œæ‰€ä»¥ç»å¸¸è¢«æœç´¢å¼•æ“ç³»ç»Ÿç”¨äºæ–‡æœ¬è¯é¢‘ç»Ÿè®¡ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥å‡å°‘æŸ¥è¯¢æ—¶é—´ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒã€‚</p><p>å‰ç¼€æ ‘çš„åŸºæœ¬æ“ä½œ</p><p>æ’å…¥å­—ç¬¦ä¸²ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡æ’å…¥å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦ã€‚å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°èŠ‚ç‚¹ã€‚æœ€åä¸€ä¸ªèŠ‚ç‚¹æ ‡è®°ä¸ºå­—ç¬¦ä¸²çš„ç»“æŸã€‚</p><p>åˆ é™¤å­—ç¬¦ä¸²ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å‡å°‘è·¯å¾„ä¸ŠèŠ‚ç‚¹çš„è®¡æ•°ã€‚å¦‚æœæŸèŠ‚ç‚¹çš„è®¡æ•°ä¸ºé›¶ï¼Œåˆ™åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p><p>æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°ï¼šæ²¿è·¯å¾„éå†å­—ç¬¦ä¸²ï¼Œè‹¥è·¯å¾„å®Œæ•´ä¸”ç»“æŸèŠ‚ç‚¹å­˜åœ¨ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²çš„è®¡æ•°ã€‚</p><p>æŸ¥è¯¢å‰ç¼€æ•°é‡ï¼šæ²¿è·¯å¾„éå†å‰ç¼€ï¼Œè‹¥è·¯å¾„å®Œæ•´ï¼Œåˆ™è¿”å›æœ€åèŠ‚ç‚¹çš„é€šè¿‡è®¡æ•°ã€‚</p><h3 id="èŠ‚ç‚¹çš„ç»“æ„"><a href="#èŠ‚ç‚¹çš„ç»“æ„" class="headerlink" title="èŠ‚ç‚¹çš„ç»“æ„"></a>èŠ‚ç‚¹çš„ç»“æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">class</span> <span class="title class_">TrieNode</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> pass;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> end;</span><br><span class="line"><span class="keyword">public</span> TrieNode[] nexts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">TrieNode</span><span class="params">()</span> &#123;</span><br><span class="line">pass = <span class="number">0</span>;</span><br><span class="line">end = <span class="number">0</span>;</span><br><span class="line">nexts = <span class="keyword">new</span> <span class="title class_">TrieNode</span>[<span class="number">26</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥å­—ç¬¦ä¸²"><a href="#æ’å…¥å­—ç¬¦ä¸²" class="headerlink" title="æ’å…¥å­—ç¬¦ä¸²"></a>æ’å…¥å­—ç¬¦ä¸²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">node.pass++;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123; <span class="comment">// ä»å·¦å¾€å³éå†å­—ç¬¦</span></span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>; <span class="comment">// ç”±å­—ç¬¦ï¼Œå¯¹åº”æˆèµ°å‘å“ªæ¡è·¯</span></span><br><span class="line"><span class="keyword">if</span> (node.nexts[path] == <span class="literal">null</span>) &#123;</span><br><span class="line">node.nexts[path] = <span class="keyword">new</span> <span class="title class_">TrieNode</span>();</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">node.pass++;</span><br><span class="line">&#125;</span><br><span class="line">node.end++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°"><a href="#æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°" class="headerlink" title="æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°"></a>æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°æ¬¡æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// æŸ¥è¯¢å‰ç¼€æ ‘é‡Œï¼Œwordå•è¯å‡ºç°äº†å‡ æ¬¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countWordsEqualTo</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (node.nexts[path] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> node.end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢å‰ç¼€æ•°é‡"><a href="#æŸ¥è¯¢å‰ç¼€æ•°é‡" class="headerlink" title="æŸ¥è¯¢å‰ç¼€æ•°é‡"></a>æŸ¥è¯¢å‰ç¼€æ•°é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">// æŸ¥è¯¢å‰ç¼€æ ‘é‡Œï¼Œæœ‰å¤šå°‘å•è¯ä»¥preåšå‰ç¼€</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countWordsStartingWith</span><span class="params">(String pre)</span> &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; pre.length(); i++) &#123;</span><br><span class="line">path = pre.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (node.nexts[path] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> node.pass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å­—ç¬¦ä¸²"><a href="#åˆ é™¤å­—ç¬¦ä¸²" class="headerlink" title="åˆ é™¤å­—ç¬¦ä¸²"></a>åˆ é™¤å­—ç¬¦ä¸²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// å¦‚æœä¹‹å‰wordæ’å…¥è¿‡å‰ç¼€æ ‘ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ æ‰ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">// å¦‚æœä¹‹å‰wordæ²¡æœ‰æ’å…¥è¿‡å‰ç¼€æ ‘ï¼Œé‚£ä¹ˆä»€ä¹ˆä¹Ÿä¸åš</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">erase</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (countWordsEqualTo(word) &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="type">TrieNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">node.pass--;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (--node.nexts[path].pass == <span class="number">0</span>) &#123;</span><br><span class="line">node.nexts[path] = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">node = node.nexts[path];</span><br><span class="line">&#125;</span><br><span class="line">node.end--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘"><a href="#ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘" class="headerlink" title="ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘"></a>ä½¿ç”¨é™æ€æ•°ç»„å®ç°å‰ç¼€æ ‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å¦‚æœå°†æ¥å¢åŠ äº†æ•°æ®é‡ï¼Œå°±æ”¹å¤§è¿™ä¸ªå€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">150001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][] tree = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN][<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] end = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] pass = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">pass[cur]++;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = ++cnt;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">pass[cur]++;</span><br><span class="line">&#125;</span><br><span class="line">end[cur]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> end[cur];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">prefixNumber</span><span class="params">(String pre)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; pre.length(); i++) &#123;</span><br><span class="line">path = pre.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> pass[cur];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String word)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (search(word) &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">// ä¸‹é¢è¿™ä¸€è¡Œä»£ç ï¼Œè®²è¯¾çš„æ—¶å€™æ²¡åŠ </span></span><br><span class="line"><span class="comment">// æœ¬é¢˜ä¸ä¼šç”¨åˆ°pass[1]çš„ä¿¡æ¯ï¼Œæ‰€ä»¥åŠ ä¸åŠ éƒ½å¯ä»¥ï¼Œä¸è¿‡æ­£ç¡®çš„å†™æ³•æ˜¯åŠ ä¸Š</span></span><br><span class="line">pass[cur]--;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (--pass[tree[cur][path]] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line">end[cur]--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">Arrays.fill(tree[i], <span class="number">0</span>);</span><br><span class="line">end[i] = <span class="number">0</span>;</span><br><span class="line">pass[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›¸å…³é¢˜ç›®"><a href="#ç›¸å…³é¢˜ç›®" class="headerlink" title="ç›¸å…³é¢˜ç›®"></a>ç›¸å…³é¢˜ç›®</h2><h3 id="æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼"><a href="#æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼" class="headerlink" title="æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼"></a>æŸ¥è¯¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å¼‚æˆ–æœ€å¤§å€¼</h3><p>æ€è·¯ï¼šæˆ‘ä»¬ä½¿ç”¨æ¯ä¸€ä¸ªæ•°ï¼Œæ ¹æ®ä»–çš„æ¯ä¸€ä½å»æ„å»ºä¸€ä¸ªå‰ç¼€æ ‘ã€‚ç„¶åä¾æ¬¡éå†æ¯ä¸€ä¸ªæ•°ï¼Œä»æœ€é«˜ä½å¼€å§‹éå†ï¼Œæˆ‘å¸Œæœ›æ‰¾åˆ°è·Ÿæˆ‘ä¸ä¸€æ ·çš„ä½ï¼Œäºæ˜¯æˆ‘åœ¨å‰ç¼€æ ‘é‡Œé¢æŸ¥æ‰¾ã€‚å¦‚æœå­˜åœ¨é‚£ä¹ˆæŠŠè¿™ä¸ªä½ç½®å˜æˆ1åŠ å…¥ç­”æ¡ˆï¼Œå¦‚æœä¸å­˜åœ¨é‚£ä¹ˆæŠŠè¿™ä¸ªä½ç½®å˜æˆ0åŠ å…¥ç­”æ¡ˆã€‚ç„¶åè·³åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ ‘å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å‰ç¼€æ ‘çš„åšæ³•</span></span><br><span class="line"><span class="comment">// å¥½æƒ³</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">findMaximumXOR1</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">build(nums);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">ans = Math.max(ans, maxXor(num));</span><br><span class="line">&#125;</span><br><span class="line">clear();</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡†å¤‡è¿™ä¹ˆå¤šé™æ€ç©ºé—´å°±å¤Ÿäº†ï¼Œå®éªŒå‡ºæ¥çš„</span></span><br><span class="line"><span class="comment">// å¦‚æœæµ‹è¯•æ•°æ®å‡çº§äº†è§„æ¨¡ï¼Œå°±æ”¹å¤§è¿™ä¸ªå€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">3000001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][] tree = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰ç¼€æ ‘ç›®å‰ä½¿ç”¨äº†å¤šå°‘ç©ºé—´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°å­—åªéœ€è¦ä»å“ªä¸€ä½å¼€å§‹è€ƒè™‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> high;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// æ‰¾ä¸ªæœ€å¤§å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">max = Math.max(num, max);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¡ç®—æ•°ç»„æœ€å¤§å€¼çš„äºŒè¿›åˆ¶çŠ¶æ€ï¼Œæœ‰å¤šå°‘ä¸ªå‰ç¼€çš„0</span></span><br><span class="line"><span class="comment">// å¯ä»¥å¿½ç•¥è¿™äº›å‰ç½®çš„0ï¼Œä»leftä½å¼€å§‹è€ƒè™‘</span></span><br><span class="line">high = <span class="number">31</span> - Integer.numberOfLeadingZeros(max);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">insert(num);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> high, path; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">path = (num &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = ++cnt;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxXor</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line"><span class="comment">// æœ€ç»ˆå¼‚æˆ–çš„ç»“æœ(å°½é‡å¤§)</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// å‰ç¼€æ ‘ç›®å‰æ¥åˆ°çš„èŠ‚ç‚¹ç¼–å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> high, status, want; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"><span class="comment">// status : numç¬¬iä½çš„çŠ¶æ€</span></span><br><span class="line">status = (num &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line"><span class="comment">// want : numç¬¬iä½å¸Œæœ›é‡åˆ°çš„çŠ¶æ€</span></span><br><span class="line">want = status ^ <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][want] == <span class="number">0</span>) &#123; <span class="comment">// è¯¢é—®å‰ç¼€æ ‘ï¼Œèƒ½ä¸èƒ½è¾¾æˆ</span></span><br><span class="line"><span class="comment">// ä¸èƒ½è¾¾æˆ</span></span><br><span class="line">want ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// wantå˜æˆçœŸçš„å¾€ä¸‹èµ°çš„è·¯</span></span><br><span class="line">ans |= (status ^ want) &lt;&lt; i;</span><br><span class="line">cur = tree[cur][want];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">tree[i][<span class="number">0</span>] = tree[i][<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„"><a href="#åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„" class="headerlink" title="åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„"></a>åœ¨äºŒç»´ç½‘æ ¼ä¸­ï¼Œæœç´¢å•è¯ç»„è¿”å›èƒ½æ‰¾åˆ°çš„å•è¯ç»„</h3><p>æ€è·¯ï¼šå›æº¯+å‰ç¼€æ ‘å‡æ</p><p>å…³é”®ç‚¹ï¼š1.æŠŠèµ°è¿‡çš„æ ¼å­ï¼Œæ ‡ä¸º0ï¼Œè¿™æ ·ä¸ä¼šé‡å¤èµ°ï¼Œä½†æ˜¯éœ€è¦æ¢å¤ç°åœº</p><p>2.åˆ©ç”¨å‰ç¼€æ ‘å‡æï¼Œé¦–å…ˆåˆ©ç”¨å•è¯ç»„æ„å»ºå‡ºå‰ç¼€æ ‘ã€‚æ¯æ¬¡é€’å½’çš„æ—¶å€™æ ¹æ®å‰ç¼€æ ‘æœ‰æ²¡æœ‰è·¯å¾„æ¥åˆ¤æ–­è¿™ä¸ªæ ¼å­é‡Œé¢çš„å•è¯èƒ½ä¸èƒ½è¦ã€‚é™¤äº†è·¯å¾„è¿˜è¦åˆ¤æ–­è¿™æ¡è·¯å¾„ä¸‹è¿˜æœ‰æ²¡æœ‰å‰©ä½™çš„æœªæ¢ç´¢å•è¯ï¼ˆåˆ©ç”¨passæ•°ç»„ï¼‰ã€‚</p><p>3.å·§ç”¨passè·Ÿendæ•°ç»„ã€‚pass[i] è¡¨ç¤ºå½“å‰èŠ‚ç‚¹å‰©ä½™è¿˜æœªæ”¶é›†çš„å•è¯ï¼Œend[i] è¡¨ç¤ºåœ¨å½“å‰èŠ‚ç‚¹å®Œç»“çš„å•è¯ï¼Œå¯ä»¥ç›´æ¥åŠ å…¥ansã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">findWords</span><span class="params">(<span class="type">char</span>[][] board, String[] words)</span> &#123;</span><br><span class="line">build(words);</span><br><span class="line">List&lt;String&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">dfs(board, i, j, <span class="number">1</span>, ans);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">clear();</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// board : äºŒç»´ç½‘æ ¼</span></span><br><span class="line"><span class="comment">// i,j : æ­¤æ—¶æ¥åˆ°çš„æ ¼å­ä½ç½®ï¼Œiè¡Œã€jåˆ—</span></span><br><span class="line"><span class="comment">// t : å‰ç¼€æ ‘çš„ç¼–å·</span></span><br><span class="line"><span class="comment">// List&lt;String&gt; ans : æ”¶é›†åˆ°äº†å“ªäº›å­—ç¬¦ä¸²ï¼Œéƒ½æ”¾å…¥ans</span></span><br><span class="line"><span class="comment">// è¿”å›å€¼ : æ”¶é›†åˆ°äº†å‡ ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] board, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> t, List&lt;String&gt; ans)</span> &#123;</span><br><span class="line"><span class="comment">// è¶Šç•Œ æˆ–è€… èµ°äº†å›å¤´è·¯ï¼Œç›´æ¥è¿”å›0</span></span><br><span class="line"><span class="keyword">if</span> (i &lt; <span class="number">0</span> || i == board.length || j &lt; <span class="number">0</span> || j == board[<span class="number">0</span>].length || board[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸è¶Šç•Œ ä¸” ä¸æ˜¯å›å¤´è·¯</span></span><br><span class="line"><span class="comment">// ç”¨tmpè®°å½•å½“å‰å­—ç¬¦</span></span><br><span class="line"><span class="type">char</span> <span class="variable">tmp</span> <span class="operator">=</span> board[i][j];</span><br><span class="line"><span class="comment">// è·¯çš„ç¼–å·</span></span><br><span class="line"><span class="comment">// a -&gt; 0</span></span><br><span class="line"><span class="comment">// b -&gt; 1</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// z -&gt; 25</span></span><br><span class="line"><span class="type">int</span> <span class="variable">road</span> <span class="operator">=</span> tmp - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">t = tree[t][road];</span><br><span class="line">       <span class="comment">// ä¸å­˜åœ¨è¯¥è·¯å¾„ï¼Œæˆ–è€…è¯¥è·¯å¾„ä¸‹çš„å•è¯å·²ç»è¢«ä½ æ‰¾å‡ºæ¥å®Œäº†  å…¶å®åº”è¯¥å†™æˆ t==0 || pass[t]==0 ä½†æ˜¯åˆå§‹åŒ–çš„æ—¶å€™passå°±æ˜¯ä»1å¼€å§‹ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ä¸ç”¨åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span> (pass[t] == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// iï¼Œjä½ç½®æœ‰å¿…è¦æ¥</span></span><br><span class="line"><span class="comment">// fix ï¼šä»å½“å‰iï¼Œjä½ç½®å‡ºå‘ï¼Œä¸€å…±æ”¶é›†åˆ°äº†å‡ ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">int</span> <span class="variable">fix</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (end[t] != <span class="literal">null</span>) &#123;</span><br><span class="line">fix++;</span><br><span class="line">ans.add(end[t]);</span><br><span class="line">end[t] = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŠŠiï¼Œjä½ç½®çš„å­—ç¬¦ï¼Œæ”¹æˆ0ï¼Œåç»­çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸å¯ä»¥å†æ¥åˆ°iï¼Œjä½ç½®çš„ï¼</span></span><br><span class="line">board[i][j] = <span class="number">0</span>;</span><br><span class="line">fix += dfs(board, i - <span class="number">1</span>, j, t, ans);</span><br><span class="line">fix += dfs(board, i + <span class="number">1</span>, j, t, ans);</span><br><span class="line">fix += dfs(board, i, j - <span class="number">1</span>, t, ans);</span><br><span class="line">fix += dfs(board, i, j + <span class="number">1</span>, t, ans);</span><br><span class="line">       <span class="comment">// å‡å»å·²ç»æ‰¾åˆ°çš„å•è¯æ•°é‡</span></span><br><span class="line">pass[t] -= fix;</span><br><span class="line">       <span class="comment">// æ¢å¤ç°åœº</span></span><br><span class="line">board[i][j] = tmp;</span><br><span class="line"><span class="keyword">return</span> fix;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">10001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[][] tree = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN][<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] pass = <span class="keyword">new</span> <span class="title class_">int</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String[] end = <span class="keyword">new</span> <span class="title class_">String</span>[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">build</span><span class="params">(String[] words)</span> &#123;</span><br><span class="line">cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">pass[cur]++;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, path; i &lt; word.length(); i++) &#123;</span><br><span class="line">path = word.charAt(i) - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (tree[cur][path] == <span class="number">0</span>) &#123;</span><br><span class="line">tree[cur][path] = ++cnt;</span><br><span class="line">&#125;</span><br><span class="line">cur = tree[cur][path];</span><br><span class="line">pass[cur]++;</span><br><span class="line">&#125;</span><br><span class="line">end[cur] = word;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= cnt; i++) &#123;</span><br><span class="line">Arrays.fill(tree[i], <span class="number">0</span>);</span><br><span class="line">pass[i] = <span class="number">0</span>;</span><br><span class="line">end[i] = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰ç¼€æ ‘ç»“æ„&quot;&gt;&lt;a href=&quot;#å‰ç¼€æ ‘ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;å‰ç¼€æ ‘ç»“æ„&quot;&gt;&lt;/a&gt;å‰ç¼€æ ‘ç»“æ„&lt;/h2&gt;&lt;p&gt;Trieæ ‘ï¼Œå³å­—å…¸æ ‘ï¼Œåˆç§°å•è¯æŸ¥æ‰¾æ ‘æˆ–é”®æ ‘ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘çš„å˜ç§ã€‚å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡å’Œæ’åºå¤§é‡çš„å­—ç¬¦ä¸²</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>CAPä¸­çš„ä¸€è‡´æ€§</title>
    <link href="https://nmcb666.vip/posts/5bb35c22.html"/>
    <id>https://nmcb666.vip/posts/5bb35c22.html</id>
    <published>2026-01-24T14:37:48.000Z</published>
    <updated>2026-01-31T14:36:26.048Z</updated>
    
    <content type="html"><![CDATA[<p>å…³äºCAPè¿™é‡Œå°±ä¸è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºCAPä¸­çš„ C å³ä¸€è‡´æ€§ï¼ˆçº¿æ€§ä¸€è‡´æ€§ï¼‰</p><h2 id="é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸ä¸”å®¹æ˜“æ··æ·†çš„é—®é¢˜ï¼Œå› ä¸ºâ€œä¸€è‡´æ€§â€ï¼ˆConsistencyï¼‰è¿™ä¸ªè¯åœ¨è®¡ç®—æœºç§‘å­¦çš„ä¸åŒé¢†åŸŸé‡Œï¼Œè™½ç„¶åå­—ä¸€æ ·ï¼Œä½†å«ä¹‰å´å¤§ç›¸å¾„åº­ã€‚</p><p>è¿™ä¸‰ä¸ªæ¦‚å¿µåˆ†åˆ«å¯¹åº”äº†ï¼š<strong>å•æœºæ•°æ®åº“ç†è®ºï¼ˆACIDï¼‰</strong>ã€<strong>åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºï¼ˆCAPï¼‰</strong> å’Œ <strong>å·¥ç¨‹å®è·µï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰</strong>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬å®ƒä»¬çš„åŒºåˆ«ï¼š</p><ul><li><strong>ACID çš„ä¸€è‡´æ€§</strong>ï¼šå…³ä¹<strong>æ•°æ®çš„â€œæ­£ç¡®æ€§â€</strong>ï¼ˆç¬¦åˆä¸šåŠ¡çº¦æŸï¼‰ã€‚</li><li><strong>CAP çš„ä¸€è‡´æ€§</strong>ï¼šå…³ä¹<strong>æ•°æ®çš„â€œæ–°æ—§â€</strong>ï¼ˆå¤šå‰¯æœ¬åŒæ­¥ï¼‰ã€‚</li><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§</strong>ï¼šå…³ä¹<strong>è·¨ç³»ç»Ÿçš„â€œåè°ƒâ€</strong>ï¼ˆè®©å¤šä¸ªç‹¬ç«‹ç³»ç»Ÿçš„æ•°æ®æœ€ç»ˆå¯¹é½ï¼‰ã€‚</li></ul><hr><h3 id="1-äº‹åŠ¡çš„ä¸€è‡´æ€§-ACID-ä¸­çš„-C"><a href="#1-äº‹åŠ¡çš„ä¸€è‡´æ€§-ACID-ä¸­çš„-C" class="headerlink" title="1. äº‹åŠ¡çš„ä¸€è‡´æ€§ (ACID ä¸­çš„ C)"></a>1. äº‹åŠ¡çš„ä¸€è‡´æ€§ (ACID ä¸­çš„ C)</h3><p>è¿™é‡Œçš„èƒŒæ™¯é€šå¸¸æŒ‡<strong>å•æœºæ•°æ®åº“</strong>ï¼ˆå¦‚ MySQLï¼‰çš„æœ¬åœ°äº‹åŠ¡ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šæŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“å¿…é¡»ä»ä¸€ä¸ª<strong>åˆæ³•çŠ¶æ€</strong>å˜æ¢åˆ°å¦ä¸€ä¸ª<strong>åˆæ³•çŠ¶æ€</strong>ã€‚</li><li><strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ï¼š<strong>ä¸šåŠ¡é€»è¾‘ä¸çº¦æŸ (Business Logic &amp; Constraints)</strong>ã€‚</li><li><strong>è¯¦ç»†è§£é‡Š</strong>ï¼š<br>â€œåˆæ³•çŠ¶æ€â€æ˜¯æŒ‡æ•°æ®å¿…é¡»ç¬¦åˆé¢„å®šä¹‰çš„è§„åˆ™ã€‚è¿™äº›è§„åˆ™åŒ…æ‹¬ï¼š<ul><li><strong>æ•°æ®åº“çº¦æŸ</strong>ï¼šä¸»é”®å”¯ä¸€ã€å¤–é”®çº¦æŸã€å­—æ®µç±»å‹ã€Checkçº¦æŸï¼ˆä¾‹å¦‚ä½™é¢ä¸èƒ½å°äº0ï¼‰ã€‚</li><li><strong>ä¸šåŠ¡é€»è¾‘</strong>ï¼šä¾‹å¦‚ A è½¬è´¦ç»™ B 100å…ƒï¼Œé‚£ä¹ˆ A å‡å» 100ï¼ŒB åŠ ä¸Š 100ï¼Œæ€»é‡‘é¢å¿…é¡»ä¸å˜ã€‚å¦‚æœä»£ç å†™é”™äº†ï¼ŒA å‡äº† 100ï¼ŒB å´åªåŠ äº† 50ï¼Œè™½ç„¶æ•°æ®åº“æ²¡å´©æºƒï¼ˆåŸå­æ€§æ»¡è¶³ï¼‰ï¼Œä½†<strong>ä¸€è‡´æ€§</strong>è¢«ç ´åäº†ï¼Œå› ä¸ºæ•°æ®ä¸å†ç¬¦åˆâ€œæ€»é¢å®ˆæ’â€çš„ä¸šåŠ¡è§„åˆ™ã€‚</li></ul></li><li><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<strong>å®ƒä¿è¯æ•°æ®ä¸è¿èƒŒç°å®ä¸–ç•Œçš„ä¸šåŠ¡è§„åˆ™ã€‚</strong></li></ul><hr><h3 id="2-åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§-CAP-ä¸­çš„-C"><a href="#2-åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§-CAP-ä¸­çš„-C" class="headerlink" title="2. åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§ (CAP ä¸­çš„ C)"></a>2. åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§ (CAP ä¸­çš„ C)</h3><p>è¿™é‡Œçš„èƒŒæ™¯æ˜¯æŒ‡<strong>å¤šå‰¯æœ¬çš„æ•°æ®å­˜å‚¨ç³»ç»Ÿ</strong>ï¼ˆå¦‚ Redis Cluster, Cassandra, ZooKeeper, HDFSï¼‰ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šåœ¨ CAP ç†è®ºä¸­ï¼ŒC ä»£è¡¨ <strong>Linearizability (çº¿æ€§ä¸€è‡´æ€§)</strong> æˆ– <strong>Strong Consistency (å¼ºä¸€è‡´æ€§)</strong>ã€‚æ„æ€æ˜¯ï¼š<strong>æ‰€æœ‰çš„èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°çš„æ•°æ®æ˜¯å®Œå…¨ç›¸åŒçš„</strong>ã€‚</li><li><strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ï¼š<strong>å¤šèŠ‚ç‚¹é—´çš„æ•°æ®åŒæ­¥ (Synchronization &amp; Timing)</strong>ã€‚</li><li><strong>è¯¦ç»†è§£é‡Š</strong>ï¼š<br>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†å®¹ç¾ï¼Œæ•°æ®é€šå¸¸ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆReplicaï¼‰ã€‚<ul><li>å½“ä½ å‘èŠ‚ç‚¹ A å†™å…¥ä¸€ä¸ªæ–°å€¼ <code>x = 1</code>ã€‚</li><li>ç´§æ¥ç€å‘èŠ‚ç‚¹ B è¯»å– <code>x</code>ã€‚</li><li><strong>ä¸€è‡´æ€§</strong>è¦æ±‚ï¼šä½ å¿…é¡»è¯»åˆ° <code>1</code>ã€‚å¦‚æœä½ è¯»åˆ°äº†æ—§å€¼ <code>0</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿå°±ä¸æ»¡è¶³ CAP ä¸­çš„ Cã€‚</li></ul></li><li><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<strong>å®ƒä¿è¯ä½ è¯»åˆ°çš„æ°¸è¿œæ˜¯æœ€æ–°å†™å…¥çš„æ•°æ®ï¼ˆå°±åƒåªæœ‰ä¸€ä¸ªå‰¯æœ¬ä¸€æ ·ï¼‰ã€‚</strong></li></ul><hr><h3 id="3-åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§"><a href="#3-åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§" class="headerlink" title="3. åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§"></a>3. åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§</h3><p>è¿™é‡Œçš„èƒŒæ™¯æ˜¯æŒ‡<strong>å¾®æœåŠ¡æ¶æ„</strong>æˆ–<strong>è·¨æ•°æ®åº“</strong>çš„æ“ä½œï¼ˆå¦‚ è®¢å•æœåŠ¡ + åº“å­˜æœåŠ¡ + æ”¯ä»˜æœåŠ¡ï¼‰ã€‚</p><ul><li><strong>å®šä¹‰</strong>ï¼šæŒ‡åœ¨è·¨è¶Šå¤šä¸ªç‹¬ç«‹æœåŠ¡æˆ–æ•°æ®åº“çš„æ“ä½œä¸­ï¼Œç¡®ä¿æ‰€æœ‰ç›¸å…³çš„æ•°æ®æœ€ç»ˆèƒ½å¤Ÿè¾¾æˆä¸€ç§<strong>é€»è¾‘ä¸Šçš„å¯¹é½</strong>ã€‚å®ƒå¯ä»¥ç†è§£ä¸ºäº‹åŠ¡çš„åŸå­æ€§ï¼Œ<strong>è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥</strong>ã€‚</li><li><strong>æ ¸å¿ƒå…³æ³¨ç‚¹</strong>ï¼š<strong>è·¨ç³»ç»Ÿçš„åŸå­æ€§ä¸æœ€ç»ˆçŠ¶æ€ (Global Outcome)</strong>ã€‚</li><li><strong>è¯¦ç»†è§£é‡Š</strong>ï¼š<br>ç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¾ˆéš¾åŒæ—¶æ»¡è¶³ CAPï¼ˆé€šå¸¸ä¸ºäº†å¯ç”¨æ€§ Aï¼Œå¿…é¡»ç‰ºç‰²å¼ºä¸€è‡´æ€§ Cï¼‰ï¼Œæ‰€ä»¥åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸è®¨è®ºä¸¤ç§ä¸€è‡´æ€§ï¼š<ol><li><strong>å¼ºä¸€è‡´æ€§ï¼ˆåˆšæ€§äº‹åŠ¡ï¼‰</strong>ï¼šå¦‚ XA åè®®ã€2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰ã€‚è¦æ±‚æ‰€æœ‰æœåŠ¡åŒæ—¶æäº¤ï¼Œç«‹åˆ»çœ‹åˆ°ç»“æœã€‚è¿™å¾ˆåƒ ACIDï¼Œä½†åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ€§èƒ½æå·®ã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæŸ”æ€§äº‹åŠ¡ï¼ŒBASEç†è®ºï¼‰</strong>ï¼šå¦‚ TCCã€Sagaã€æ¶ˆæ¯é˜Ÿåˆ—ã€‚å…è®¸ä¸­é—´æœ‰ä¸€æ®µæ—¶é—´æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼ˆä¾‹å¦‚è®¢å•å·²åˆ›å»ºï¼Œä½†åº“å­˜è¿˜æ²¡æ‰£å‡å®Œï¼‰ï¼Œä½†ä¿è¯ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šå˜å¯¹ã€‚</li></ol></li><li><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<strong>å®ƒä¿è¯å¤šä¸ªç‹¬ç«‹ç³»ç»Ÿçš„æ•°æ®ï¼Œè™½ç„¶å¯èƒ½æœ‰å»¶è¿Ÿï¼Œä½†æœ€ç»ˆä¼šâ€œè´¦ç›®â€å¯¹é½ï¼Œä¸ä¼šå‡ºç°â€œè®¢å•æˆåŠŸäº†ä½†æ²¡æ‰£åº“å­˜â€çš„çƒ‚è´¦ã€‚</strong></li></ul><hr><h3 id="ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨"><a href="#ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨" class="headerlink" title="ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨"></a>ä¸‰è€…å¯¹æ¯”æ€»ç»“è¡¨</h3><p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹è¡¨å¯¹æ¯”ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">ç»´åº¦</th><th style="text-align:left">ACID çš„ä¸€è‡´æ€§ (äº‹åŠ¡)</th><th style="text-align:left">CAP çš„ä¸€è‡´æ€§ (åˆ†å¸ƒå¼ç³»ç»Ÿ)</th><th style="text-align:left">åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§</th></tr></thead><tbody><tr><td style="text-align:left"><strong>ä¾§é‡ç‚¹</strong></td><td style="text-align:left"><strong>æ•°æ®çš„æ­£ç¡®æ€§</strong> (é€»è¾‘çº¦æŸ)</td><td style="text-align:left"><strong>æ•°æ®çš„å¯è§æ€§</strong> (æ—¶é—´åŒæ­¥)</td><td style="text-align:left"><strong>å…¨å±€æ“ä½œçš„ååŒ</strong> (å¤šæ–¹å¯¹é½)</td></tr><tr><td style="text-align:left"><strong>åœºæ™¯</strong></td><td style="text-align:left">å•æœºæ•°æ®åº“ (Oracle, MySQL)</td><td style="text-align:left">åˆ†å¸ƒå¼å­˜å‚¨ (Redis, ZK, NoSQL)</td><td style="text-align:left">å¾®æœåŠ¡ã€è·¨åº“ä¸šåŠ¡</td></tr><tr><td style="text-align:left"><strong>åä¾‹</strong></td><td style="text-align:left">è½¬è´¦åæ€»é‡‘é¢å˜å°‘äº† (è¿åå®ˆæ’)</td><td style="text-align:left">åˆšå†™å®Œä¸»åº“ï¼Œè¯»ä»åº“è¿˜æ˜¯æ—§æ•°æ®</td><td style="text-align:left">è®¢å•åº“æ˜¾ç¤ºâ€œå·²æ”¯ä»˜â€ï¼Œåº“å­˜åº“æ˜¾ç¤ºâ€œæœªæ‰£å‡â€</td></tr><tr><td style="text-align:left"><strong>ä¾èµ–å¯¹è±¡</strong></td><td style="text-align:left">ä¾èµ–æ•°æ®åº“å¼•æ“çš„çº¦æŸæ£€æŸ¥</td><td style="text-align:left">ä¾èµ–å…±è¯†ç®—æ³• (Raft, Paxos) æˆ–åŒæ­¥å¤åˆ¶</td><td style="text-align:left">ä¾èµ–åè°ƒå™¨ã€MQ æˆ– è¡¥å¿ä»£ç </td></tr><tr><td style="text-align:left"><strong>æ ¸å¿ƒé—®é¢˜</strong></td><td style="text-align:left">â€œè¿™ç¬”æ•°æ®åˆä¹é€»è¾‘å—ï¼Ÿâ€</td><td style="text-align:left">â€œæˆ‘ç°åœ¨è¯»åˆ°çš„æ˜¯æœ€æ–°çš„å—ï¼Ÿâ€</td><td style="text-align:left">â€œè¿™å‡ ä¸ªç³»ç»Ÿçš„æ•°æ®æœ€åèƒ½å¯¹ä¸Šå—ï¼Ÿâ€</td></tr></tbody></table></div><h3 id="ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­"><a href="#ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­" class="headerlink" title="ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­"></a>ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­</h3><p>å‡è®¾ä½ è¦å»ä¹°ä¸€æ¯å¥¶èŒ¶ï¼š</p><ol><li><p><strong>ACID ä¸€è‡´æ€§</strong>ï¼šä½ ä»˜äº† 20 å…ƒï¼Œåº—å‘˜å¿…é¡»ç»™ä½ ä¸€æ¯ 20 å…ƒçš„å¥¶èŒ¶ã€‚å¦‚æœåº—å‘˜åªç»™ä½ ä¸€æ¯ 10 å…ƒçš„æ°´ï¼Œæˆ–è€…æ²¡æ”¶é’±å°±ç»™ä½ å¥¶èŒ¶ï¼Œè¿™å°±è¿èƒŒäº†<strong>äº¤æ˜“è§„åˆ™</strong>ï¼ˆACID ç ´åï¼‰ã€‚</p></li><li><p><strong>CAP ä¸€è‡´æ€§</strong>ï¼šè¿™å®¶å¥¶èŒ¶åº—æœ‰ 3 ä¸ªåº—å‘˜ï¼ˆå‰¯æœ¬ï¼‰ã€‚åº—é•¿ï¼ˆä¸»èŠ‚ç‚¹ï¼‰åˆšåˆšæ›´æ–°äº†èœå•ï¼ŒæŠŠâ€œçç å¥¶èŒ¶â€æ¶¨ä»·åˆ° 25 å…ƒã€‚ä½ é—®åº—å‘˜ Aï¼Œä»–è¯´ 25 å…ƒï¼›ä½ ç«‹åˆ»é—®åº—å‘˜ Bï¼Œå¦‚æœåº—å‘˜ B è¿˜è¯´ 20 å…ƒï¼Œé‚£å°±æ˜¯<strong>åŒæ­¥</strong>æ²¡åšå¥½ï¼ˆCAP çš„ C ç ´åï¼‰ã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§</strong>ï¼šä½ åœ¨æ‰‹æœº App ä¸Šç‚¹å•ã€‚</p><ul><li>ä½ çš„æ”¯ä»˜å®æ‰£äº†é’±ï¼ˆæ”¯ä»˜æœåŠ¡ï¼‰ã€‚</li><li>å¥¶èŒ¶åº—çš„æ‰“å°æœºå‡ºäº†å°ç¥¨ï¼ˆè®¢å•æœåŠ¡ï¼‰ã€‚</li><li>å¦‚æœæ”¯ä»˜å®æ‰£äº†é’±ï¼Œä½†å¥¶èŒ¶åº—æ²¡æ”¶åˆ°å•å­ï¼›æˆ–è€…å¥¶èŒ¶åº—å‡ºäº†å•å­ï¼Œæ”¯ä»˜å®æ²¡æ‰£é’±ï¼Œè¿™å°±æ˜¯<strong>è·¨ç³»ç»Ÿ</strong>çš„ä¸ä¸€è‡´ã€‚åˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯è¦ä¿è¯ï¼šè¦ä¹ˆæ²¡æ‰£é’±ä¹Ÿæ²¡å•å­ï¼Œè¦ä¹ˆæ‰£äº†é’±ä¹Ÿæœ‰å•å­ï¼ˆå“ªæ€•ä¸­é—´æœ‰å‡ ç§’å»¶è¿Ÿï¼‰ã€‚</li></ul></li></ol><h2 id="çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§"><a href="#çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§" class="headerlink" title="çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§"></a>çº¿æ€§ä¸€è‡´æ€§è·Ÿé¡ºåºä¸€è‡´æ€§</h2><h3 id="é¡ºåºä¸€è‡´æ€§"><a href="#é¡ºåºä¸€è‡´æ€§" class="headerlink" title="é¡ºåºä¸€è‡´æ€§"></a>é¡ºåºä¸€è‡´æ€§</h3><p>å¦‚æœä¸€ä¸ªå¹¶å‘æ‰§è¡Œè¿‡ç¨‹æ‰€åŒ…å«çš„æ‰€æœ‰è¯»å†™æ“ä½œèƒ½å¤Ÿé‡æ’æˆä¸€ä¸ªå…¨å±€çº¿æ€§æœ‰åºçš„åºåˆ—ï¼Œå¹¶ä¸”è¿™ä¸ªåºåˆ—æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå¹¶å‘æ‰§è¡Œè¿‡ç¨‹å°±æ˜¯æ»¡è¶³é¡ºåºä¸€è‡´æ€§çš„ï¼š</p><p>â€¢    æ¡ä»¶ Iï¼šé‡æ’åçš„åºåˆ—ä¸­æ¯ä¸€ä¸ªè¯»æ“ä½œè¿”å›çš„å€¼ï¼Œå¿…é¡»ç­‰äºå‰é¢å¯¹åŒä¸€ä¸ªæ•°æ®å¯¹è±¡çš„æœ€è¿‘ä¸€æ¬¡å†™æ“ä½œæ‰€å†™å…¥çš„å€¼ã€‚</p><p>â€¢    æ¡ä»¶ IIï¼šåŸæ¥æ¯ä¸ªè¿›ç¨‹ä¸­å„ä¸ªæ“ä½œçš„æ‰§è¡Œå…ˆåé¡ºåºï¼Œåœ¨è¿™ä¸ªé‡æ’åçš„åºåˆ—ä¸­å¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><h3 id="çº¿æ€§ä¸€è‡´æ€§"><a href="#çº¿æ€§ä¸€è‡´æ€§" class="headerlink" title="çº¿æ€§ä¸€è‡´æ€§"></a>çº¿æ€§ä¸€è‡´æ€§</h3><p>çº¿æ€§ä¸€è‡´æ€§çš„å®šä¹‰ï¼Œä¸é¡ºåºä¸€è‡´æ€§éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯è¯•å›¾æŠŠæ‰€æœ‰è¯»å†™æ“ä½œé‡æ’æˆä¸€ä¸ªå…¨å±€çº¿æ€§æœ‰åºçš„åºåˆ—ï¼Œä½†é™¤äº†æ»¡è¶³å‰é¢çš„æ¡ä»¶ I å’Œæ¡ä»¶ II ä¹‹å¤–ï¼Œè¿˜è¦åŒæ—¶æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ï¼š</p><p>â€¢    æ¡ä»¶ IIIï¼šä¸åŒè¿›ç¨‹çš„æ“ä½œï¼Œå¦‚æœåœ¨æ—¶é—´ä¸Šä¸é‡å ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ‰§è¡Œå…ˆåé¡ºåºï¼Œåœ¨è¿™ä¸ªé‡æ’åçš„åºåˆ—ä¸­å¿…é¡»ä¿æŒä¸€è‡´ã€‚</p><h3 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h3><p>â€¢    å®ƒä»¬éƒ½è¯•å›¾è®©ç³»ç»Ÿâ€œè¡¨ç°å¾—åƒåªæœ‰ä¸€ä¸ªå‰¯æœ¬â€ä¸€æ ·ã€‚</p><p>â€¢    å®ƒä»¬éƒ½ä¿è¯äº†ç¨‹åºæ‰§è¡Œé¡ºåºä¸ä¼šè¢«æ‰“ä¹±ã€‚ä½“ç°åœ¨æ¡ä»¶ II å¯¹äºè¿›ç¨‹å†…å„ä¸ªæ“ä½œçš„æ’åºä¿æŒä¸Šã€‚</p><p>â€¢    çº¿æ€§ä¸€è‡´æ€§è€ƒè™‘äº†æ—¶é—´å…ˆåé¡ºåºï¼Œè€Œé¡ºåºä¸€è‡´æ€§æ²¡æœ‰ã€‚</p><p>â€¢    æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè‚¯å®šéƒ½æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼›åä¹‹ä¸ä¸€å®šã€‚</p><p>â€¢    çº¿æ€§ä¸€è‡´æ€§éšå«äº†æ—¶æ•ˆæ€§ä¿è¯ï¼ˆrecency guaranteeï¼‰ã€‚å®ƒä¿è¯æˆ‘ä»¬æ€»æ˜¯èƒ½è¯»åˆ°æ•°æ®æœ€æ–°çš„å€¼ã€‚</p><p>â€¢    åœ¨é¡ºåºä¸€è‡´æ€§ä¸­ï¼Œæˆ‘ä»¬æœ‰å¯èƒ½è¯»åˆ°æ—§ç‰ˆæœ¬çš„æ•°æ®ã€‚</p><p>å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ <a href="https://mp.weixin.qq.com/s/3odLhBtebF4cm58hl-87JA">https://mp.weixin.qq.com/s/3odLhBtebF4cm58hl-87JA</a></p><h2 id="æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ"></a>æœ€ç»ˆä¸€è‡´æ€§åˆæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å…¶å®æœ€ç»ˆä¸€è‡´æ€§å°±ä¸æ»¡è¶³CAPç†è®ºçš„C,è€Œæ˜¯å¯¹äºAPç³»ç»Ÿçš„æ‰©å……ã€‚</p><p><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰æ˜¯ CAP ç†è®ºä¸­é€‰æ‹©äº† APï¼ˆå¯ç”¨æ€§ + åˆ†åŒºå®¹é”™æ€§ï¼‰ç­–ç•¥åï¼Œä¸ºäº†å¼¥è¡¥ç¼ºå¤±çš„ Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰è€Œä¸å¾—ä¸é‡‡ç”¨çš„ä¸€ç§â€œå¦¥åâ€æ–¹æ¡ˆã€‚</strong></p><p>æˆ–è€…æ›´ç®€å•ç‚¹è¯´ï¼š<strong>æœ€ç»ˆä¸€è‡´æ€§æ˜¯ AP ç³»ç»Ÿçš„æ ¸å¿ƒç‰¹å¾ã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªå±‚é¢æ¥å‰–æè¿™æ®µå…³ç³»ï¼š</p><h3 id="1-CAP-çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€"><a href="#1-CAP-çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€" class="headerlink" title="1. CAP çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€"></a>1. CAP çš„å¿…ç„¶æ€§ä¸â€œäºŒé€‰ä¸€â€</h3><p>CAP ç†è®ºå‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ<strong>Pï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰æ˜¯ä¸å¯é¿å…çš„</strong>ï¼ˆç½‘çº¿æ€»ä¼šæ–­ï¼ŒèŠ‚ç‚¹æ€»ä¼šæŒ‚ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½åœ¨ Cï¼ˆå¼ºä¸€è‡´æ€§/çº¿æ€§ä¸€è‡´æ€§ï¼‰å’Œ Aï¼ˆå¯ç”¨æ€§ï¼‰ä¹‹é—´åšé€‰æ‹©ï¼š</p><ul><li><strong>é€‰æ‹© CPï¼ˆæ”¾å¼ƒ Aï¼‰</strong>ï¼šä¸ºäº†ä¿è¯æ•°æ®ç»å¯¹ä¸€è‡´ï¼Œå½“ç½‘ç»œå‡ºé—®é¢˜æ—¶ï¼Œæˆ‘å®æ„¿æŠ¥é”™æ‹’ç»æœåŠ¡ï¼Œä¹Ÿä¸è®©ä½ è¯»åˆ°æ—§æ•°æ®ã€‚<ul><li><em>ç»“æœ</em>ï¼šè¿™æ˜¯<strong>å¼ºä¸€è‡´æ€§</strong>ç³»ç»Ÿï¼ˆå¦‚ Zookeeper, HBaseï¼‰ã€‚</li></ul></li><li><strong>é€‰æ‹© APï¼ˆæ”¾å¼ƒ Cï¼‰</strong>ï¼šä¸ºäº†ä¿è¯æœåŠ¡æ°¸è¿œå¯ç”¨ï¼Œå“ªæ€•ç½‘ç»œå‡ºé—®é¢˜äº†ï¼Œæˆ‘ä¹Ÿè®©ä½ è¯»ï¼Œè™½ç„¶è¯»åˆ°çš„å¯èƒ½æ˜¯æ—§æ•°æ®ã€‚<ul><li><em>ç»“æœ</em>ï¼šè¿™å°±æ˜¯<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ï¼ˆå¦‚ DNS, Eureka, Cassandraï¼‰ã€‚</li></ul></li></ul><h3 id="2-æœ€ç»ˆä¸€è‡´æ€§åœ¨-CAP-å›¾è°±ä¸­çš„ä½ç½®"><a href="#2-æœ€ç»ˆä¸€è‡´æ€§åœ¨-CAP-å›¾è°±ä¸­çš„ä½ç½®" class="headerlink" title="2. æœ€ç»ˆä¸€è‡´æ€§åœ¨ CAP å›¾è°±ä¸­çš„ä½ç½®"></a>2. æœ€ç»ˆä¸€è‡´æ€§åœ¨ CAP å›¾è°±ä¸­çš„ä½ç½®</h3><p>å¦‚æœæŠŠ CAP ç”»æˆä¸€ä¸ªä¸‰è§’å½¢ï¼š</p><ul><li><strong>CAP ä¸­çš„ C (Consistency)</strong>ï¼šæŒ‡çš„æ˜¯<strong>çº¿æ€§ä¸€è‡´æ€§</strong>ï¼ˆå¼ºä¸€è‡´æ€§ï¼‰ã€‚å¦‚æœä½ è¿½æ±‚ CAP çš„ Cï¼Œä½ å°±å¿…é¡»ä¿è¯å†™å®Œç«‹åˆ»èƒ½è¯»åˆ°ã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šå®ƒæ˜¯<strong>å¼±ä¸€è‡´æ€§</strong>çš„ä¸€ç§ç‰¹ä¾‹ã€‚<strong>å®ƒä¸å±äº CAP çš„ C</strong>ã€‚ç›¸åï¼Œå®ƒæ˜¯å½“æˆ‘ä»¬<strong>æŠ›å¼ƒäº† CAP çš„ C</strong> ä¹‹åï¼Œé€€è€Œæ±‚å…¶æ¬¡è¿½æ±‚çš„ç›®æ ‡ã€‚</li></ul><blockquote><p><strong>å…³ç³»å…¬å¼</strong>ï¼š<br><strong>CAP (AP æ¨¡å¼)</strong> = <strong>Availability</strong> (é«˜å¯ç”¨) + <strong>Partition Tolerance</strong> (åˆ†åŒºå®¹é”™) + <strong>Eventual Consistency</strong> (æœ€ç»ˆä¸€è‡´æ€§)</p></blockquote><h3 id="3-ä¸ºä»€ä¹ˆ-AP-ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆ-AP-ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="3. ä¸ºä»€ä¹ˆ AP ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ"></a>3. ä¸ºä»€ä¹ˆ AP ç³»ç»Ÿå¿…ç„¶å¯¼è‡´æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ</h3><p>è®©æˆ‘ä»¬æ¨æ¼”ä¸€ä¸‹ï¼š</p><ol><li><strong>å‰æ (P)</strong>ï¼šç³»ç»Ÿæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ Node A å’Œ Node Bï¼Œå®ƒä»¬ä¹‹é—´çš„ç½‘ç»œæ–­äº†ã€‚</li><li><strong>æŠ‰æ‹© (A)</strong>ï¼šæˆ‘ä»¬é€‰æ‹©äº†é«˜å¯ç”¨ï¼ˆAvailabilityï¼‰ï¼Œæ‰€ä»¥å½“ç”¨æˆ·å‘ Node A å†™å…¥ <code>x=1</code> æ—¶ï¼ŒNode A å¿…é¡»æ¥å—å¹¶è¿”å›æˆåŠŸï¼Œä¸èƒ½æŠ¥é”™ã€‚</li><li><strong>åæœ</strong>ï¼šæ­¤æ—¶ï¼ŒNode A çš„æ•°æ®æ˜¯ <code>x=1</code>ï¼Œè€Œ Node B å› ä¸ºç½‘ç»œæ–­äº†ï¼Œæ•°æ®è¿˜æ˜¯ <code>x=0</code>ã€‚</li><li><strong>ç°çŠ¶</strong>ï¼šæ­¤æ—¶ç³»ç»Ÿå·²ç»<strong>ä¸ä¸€è‡´</strong>äº†ï¼ˆè¿åäº† CAP çš„ Cï¼‰ã€‚</li><li><strong>è¡¥æ•‘ (æœ€ç»ˆä¸€è‡´æ€§)</strong>ï¼šæˆ‘ä»¬ä¸èƒ½è®© Node B æ°¸è¿œæ˜¯ <code>0</code>ã€‚ç³»ç»Ÿæ‰¿è¯ºï¼šå½“ç½‘ç»œæ¢å¤åï¼ŒNode A ä¼šåå°æŠŠ <code>x=1</code> åŒæ­¥ç»™ Node Bã€‚ç»è¿‡ä¸€æ®µæ—¶é—´ï¼ˆä¸ç¡®å®šå¤šä¹…ï¼‰ï¼ŒNode B æœ€ç»ˆä¹Ÿä¼šå˜æˆ <code>1</code>ã€‚</li></ol><p><strong>ç»“è®º</strong>ï¼šå› ä¸ºé€‰æ‹©äº† Aï¼ˆå…è®¸åœ¨æ–­ç½‘æ—¶ç»§ç»­å†™ï¼‰ï¼Œå¿…ç„¶å¯¼è‡´æ•°æ®æš‚æ—¶ä¸ä¸€è‡´ã€‚è€Œâ€œæœ€ç»ˆä¸€è‡´æ€§â€å°±æ˜¯å¯¹è¿™ç§æš‚æ—¶ä¸ä¸€è‡´çš„<strong>å®¹å¿</strong>å’Œå¯¹æœªæ¥çš„<strong>æ‰¿è¯º</strong>ã€‚</p><h3 id="4-å»¶ä¼¸ï¼šBASE-ç†è®º"><a href="#4-å»¶ä¼¸ï¼šBASE-ç†è®º" class="headerlink" title="4. å»¶ä¼¸ï¼šBASE ç†è®º"></a>4. å»¶ä¼¸ï¼šBASE ç†è®º</h3><p>è®²åˆ°æœ€ç»ˆä¸€è‡´æ€§ä¸ CAP çš„å…³ç³»ï¼Œå°±ä¸å¾—ä¸æ <strong>BASE ç†è®º</strong>ã€‚å®ƒæ˜¯å¯¹ CAP ä¸­ AP ç­–ç•¥çš„å·¥ç¨‹åŒ–å»¶ä¼¸ã€‚ï¼š</p><ul><li><strong>BA (Basically Available)</strong>ï¼šåŸºæœ¬å¯ç”¨ï¼ˆå…è®¸å“åº”æ—¶é—´æ…¢ä¸€ç‚¹ï¼Œæˆ–è€…éƒ¨åˆ†é™çº§ï¼‰ã€‚</li><li><strong>S (Soft state)</strong>ï¼šè½¯çŠ¶æ€ï¼ˆå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå³å…è®¸æ•°æ®åŒæ­¥æœ‰å»¶è¿Ÿï¼‰ã€‚</li><li><strong>E (Eventual consistency)</strong>ï¼šæœ€ç»ˆä¸€è‡´æ€§ï¼ˆæ•°æ®æœ€ç»ˆä¼šå˜å¯¹ï¼‰ã€‚</li></ul><h3 id="5-æ€»ç»“è¡¨"><a href="#5-æ€»ç»“è¡¨" class="headerlink" title="5. æ€»ç»“è¡¨"></a>5. æ€»ç»“è¡¨</h3><div class="table-container"><table><thead><tr><th style="text-align:left">ç»´åº¦</th><th style="text-align:left">CAP çš„ C (å¼ºä¸€è‡´æ€§)</th><th style="text-align:left">æœ€ç»ˆä¸€è‡´æ€§ (å¼±ä¸€è‡´æ€§çš„ä¸€ç§)</th></tr></thead><tbody><tr><td style="text-align:left"><strong>CAP é€‰æ‹©</strong></td><td style="text-align:left"><strong>CP</strong> (æ”¾å¼ƒå¯ç”¨æ€§)</td><td style="text-align:left"><strong>AP</strong> (æ”¾å¼ƒå¼ºä¸€è‡´æ€§)</td></tr><tr><td style="text-align:left"><strong>æ ¸å¿ƒé€»è¾‘</strong></td><td style="text-align:left">å†™æ“ä½œå®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹<strong>ç«‹åˆ»</strong>å¯è§ã€‚</td><td style="text-align:left">å†™æ“ä½œå®Œæˆåï¼Œæ•°æ®<strong>å¼‚æ­¥</strong>å¤åˆ¶ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´æ‰å¯è§ã€‚</td></tr><tr><td style="text-align:left"><strong>ç”¨æˆ·ä½“éªŒ</strong></td><td style="text-align:left">â€œè¦ä¹ˆè¯»åˆ°æœ€æ–°çš„ï¼Œè¦ä¹ˆç³»ç»Ÿå‘Šè¯‰æˆ‘æŠ¥é”™/è¶…æ—¶ã€‚â€</td><td style="text-align:left">â€œæˆ‘å¯èƒ½è¯»åˆ°æ—§çš„ï¼Œä½†ç³»ç»Ÿä¿è¯éšæ—¶èƒ½ç”¨ã€‚â€</td></tr><tr><td style="text-align:left"><strong>å…¸å‹åœºæ™¯</strong></td><td style="text-align:left">é“¶è¡Œä½™é¢ã€åº“å­˜æ‰£å‡ã€åˆ†å¸ƒå¼é” (Etcd/ZK)</td><td style="text-align:left">ç¤¾äº¤ç½‘ç»œç‚¹èµã€DNSè§£æã€ç”µå•†å•†å“æµè§ˆé‡</td></tr><tr><td style="text-align:left"><strong>å…³ç³»</strong></td><td style="text-align:left"><strong>å®ƒæ˜¯ CAP å®šä¹‰çš„ä¸€è‡´æ€§æ ‡å‡†</strong></td><td style="text-align:left"><strong>å®ƒæ˜¯æ”¾å¼ƒ CAP çš„ C ä¹‹åçš„æ›¿ä»£æ–¹æ¡ˆ</strong></td></tr></tbody></table></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å…³äºCAPè¿™é‡Œå°±ä¸è¯¦ç»†è¯´æ˜ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºCAPä¸­çš„ C å³ä¸€è‡´æ€§ï¼ˆçº¿æ€§ä¸€è‡´æ€§ï¼‰&lt;/p&gt;
&lt;h2 id=&quot;é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿäº‹åŠ¡çš„ä¸€è‡´æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œè·Ÿåˆ†å¸ƒå¼äº‹åŠ¡é‡Œé¢æ‰€è°“çš„ä¸€è‡´æ€§åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot;&gt;&lt;a href=&quot;#é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä»€ä¹ˆæ˜¯CAPçš„ä¸€è‡´æ€§ï¼Œä»–è·Ÿ</summary>
      
    
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://nmcb666.vip/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•ï¼ˆå››ï¼‰é€’å½’</title>
    <link href="https://nmcb666.vip/posts/38e6282b.html"/>
    <id>https://nmcb666.vip/posts/38e6282b.html</id>
    <published>2026-01-20T15:24:25.000Z</published>
    <updated>2026-01-31T14:36:26.050Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é€’å½’ç›¸å…³çš„é¢˜ç›®"><a href="#é€’å½’ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="é€’å½’ç›¸å…³çš„é¢˜ç›®"></a>é€’å½’ç›¸å…³çš„é¢˜ç›®</h1><h2 id="æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—"><a href="#æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—" class="headerlink" title="æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—"></a>æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—</h2><p>é€’å½’çš„æ€è·¯ï¼šæ¯æ¬¡æŒ‰è¦è¿™ä¸ªä½ç½®çš„å­—ç¬¦å’Œä¸è¦è¿™ä¸ªä½ç½®çš„å­—ç¬¦ä¸¤ç§æƒ…å†µå»é€’å½’ï¼Œå½“i = s.length()æ—¶ï¼Œä¿å­˜å½“å‰çš„å­åºåˆ—ã€‚ç”¨hashSetå»é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String[] generatePermutation(String str) &#123;</span><br><span class="line"><span class="type">char</span>[] s = str.toCharArray();</span><br><span class="line">HashSet&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">f2(s, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">char</span>[s.length], <span class="number">0</span>, set);</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> set.size();</span><br><span class="line">String[] ans = <span class="keyword">new</span> <span class="title class_">String</span>[m];</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (String cur : set) &#123;</span><br><span class="line">ans[i++] = cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">// iæ˜¯å½“å‰è¦å¤„ç†çš„å­—ç¬¦çš„ç´¢å¼•,pathæ˜¯å½“å‰å·²ç»ä¿å­˜çš„è·¯å¾„ï¼Œsizeæ˜¯pathçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">(<span class="type">char</span>[] s, <span class="type">int</span> i, <span class="type">char</span>[] path, <span class="type">int</span> size, HashSet&lt;String&gt; set)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i == s.length) &#123;</span><br><span class="line">set.add(String.valueOf(path, <span class="number">0</span>, size));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">path[size] = s[i];</span><br><span class="line">f2(s, i + <span class="number">1</span>, path, size + <span class="number">1</span>, set);</span><br><span class="line">f2(s, i + <span class="number">1</span>, path, size, set);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„"><a href="#æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„" class="headerlink" title="æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„"></a>æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰€æœ‰å­æ•°ç»„ï¼Œé¡ºåºå¯ä»¥ä»»æ„</h2><p>æ€è·¯ï¼šå…ˆå°†æ•°ç»„æ’åºï¼Œç„¶åæ¯æ¬¡å¯¹åŒä¸€ä¸ªæ•°è®¨è®ºï¼Œè¦0ä¸ªï¼Œè¦1ä¸ªâ€¦ è¿˜éœ€è¦çŸ¥é“å¯¹äºè¿™ä¸ªæ•°æ¥è¯´ä¸‹ä¸€ä¸ªè·Ÿè‡ªå·±ä¸åŒçš„æ•°çš„ä½ç½®ï¼Œç„¶åè°ƒç”¨é€’å½’ä»ä¸‹ä¸ªä¸åŒçš„æ•°å¼€å§‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[] path = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">11</span>];</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    findSubsetsWithDup(<span class="number">0</span>,nums,<span class="number">0</span>,path,ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findSubsetsWithDup</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span>[] nums,<span class="type">int</span> size,<span class="type">int</span>[] path,List&lt;List&lt;Integer&gt;&gt; ans)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i==nums.length)&#123;</span><br><span class="line">        List&lt;Integer&gt; temp =<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;size;j++)&#123;</span><br><span class="line">            temp.add(path[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        ans.add(temp);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æ‰¾å‡ºä¸‹ä¸€ä¸ªè·Ÿè‡ªå·±ä¸åŒçš„æ•°çš„ä½ç½®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(j &lt; nums.length &amp;&amp; nums[j] == nums[i])&#123;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¦0ä¸ª</span></span><br><span class="line">        findSubsetsWithDup(j,nums,size,path,ans);</span><br><span class="line">        <span class="comment">// ä¾æ¬¡è¦å¤šä¸ª</span></span><br><span class="line">        <span class="keyword">for</span>(;i&lt;j;i++)&#123;</span><br><span class="line">            path[size++] = nums[i];</span><br><span class="line">            findSubsetsWithDup(j,nums,size,path,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„-nums-ï¼Œè¿”å›å…¶-æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—-ã€‚ä½ å¯ä»¥-æŒ‰ä»»æ„é¡ºåº-è¿”å›ç­”æ¡ˆã€‚"><a href="#ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„-nums-ï¼Œè¿”å›å…¶-æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—-ã€‚ä½ å¯ä»¥-æŒ‰ä»»æ„é¡ºåº-è¿”å›ç­”æ¡ˆã€‚" class="headerlink" title="ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚"></a>ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›å…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚</h2><p>æ€è·¯ï¼š æ¯æ¬¡æ‹¿ä¸€ä¸ªæ•°è·Ÿå½“å‰ä¸‹æ ‡çš„ç¬¬ä¸€ä¸ªæ•°äº¤æ¢ï¼Œç„¶åé€’å½’è°ƒç”¨å°†ä¸‹æ ‡+1ï¼Œé€’å½’å®Œæˆåå†äº¤æ¢å›æ¥ã€‚ç»ˆæ­¢æ¡ä»¶å°±ç®—ä¸‹æ ‡==nums.length</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; ans =<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    findPermute(nums,<span class="number">0</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findPermute</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> i,List&lt;List&lt;Integer&gt;&gt; ans)</span>&#123;</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span>(i == nums.length)&#123;</span><br><span class="line">        List&lt;Integer&gt; temp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;nums.length;j++)&#123;</span><br><span class="line">            temp.add(nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        ans.add(temp);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¾æ¬¡äº¤æ¢</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i;j&lt;nums.length;j++)&#123;</span><br><span class="line">            swap(nums,i,j);</span><br><span class="line">            findPermute(nums,i+<span class="number">1</span>,ans);</span><br><span class="line">            <span class="comment">// äº¤æ¢å›æ¥</span></span><br><span class="line">            swap(nums,i,j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹“å±•ï¼šå¦‚æœæœ‰é‡å¤æ•°å­—ï¼Œåˆ™éœ€è¦å»é‡</p><p>æ€è·¯ï¼š æ¯æ¬¡é€’å½’çš„æ—¶å€™ç»´æŠ¤ä¸€ä¸ªsetè¿™ä¸ªsetè®°å½•å“ªäº›æ•°æ¥åˆ°è¿‡æˆ‘è¿™ä¸ªä¸‹æ ‡ï¼Œå¦‚æœå‘ç°ä¸€ä¸ªæ•°å·²ç»æ¥åˆ°è¿‡ï¼Œåˆ™ä¸è¿›è¡Œäº¤æ¢ï¼Œä¹Ÿä¸é€’å½’è·³è¿‡å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, List&lt;List&lt;Integer&gt;&gt; ans)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (i == nums.length) &#123;</span><br><span class="line">List&lt;Integer&gt; cur = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">cur.add(num);</span><br><span class="line">&#125;</span><br><span class="line">ans.add(cur);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">HashSet&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; nums.length; j++) &#123;</span><br><span class="line"><span class="comment">// nums[j]æ²¡æœ‰æ¥åˆ°è¿‡iä½ç½®ï¼Œæ‰ä¼šå»å°è¯•</span></span><br><span class="line"><span class="keyword">if</span> (!set.contains(nums[j])) &#123;</span><br><span class="line">set.add(nums[j]);</span><br><span class="line">swap(nums, i, j);</span><br><span class="line">f(nums, i + <span class="number">1</span>, ans);</span><br><span class="line">swap(nums, i, j);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Nçš‡åé—®é¢˜"><a href="#Nçš‡åé—®é¢˜" class="headerlink" title="Nçš‡åé—®é¢˜"></a>Nçš‡åé—®é¢˜</h2><p>æ€è·¯ï¼šç»´æŠ¤ä¸€ä¸ªè·¯å¾„æ•°ç»„path[],pathçš„ç¬¬å‡ ä¸ªæ•°çš„å€¼è¡¨ç¤ºç¬¬å‡ è¡Œçš„çš‡åæ”¾åœ¨ç¬¬å‡ åˆ—ï¼Œæ¯æ¬¡å¾ªç¯æ¯ä¸€è¡Œçš„åˆ—å»åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œå¦‚æœåˆæ³•åˆ™é€’å½’è°ƒç”¨ä¸‹ä¸€è¡Œï¼Œå¹¶ä¸”size++.ç»ˆæ­¢æ¡ä»¶æ˜¯size == n å³æ‰¾åˆ°åˆæ³•çš„ä¸€ä¸ªè§£ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[] path = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    findSolveNQueens(<span class="number">0</span>,n,path,ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">findSolveNQueens</span><span class="params">(<span class="type">int</span> size,<span class="type">int</span> n,<span class="type">int</span>[] path,List&lt;List&lt;String&gt;&gt; ans)</span>&#123;</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span>(size == n)&#123;</span><br><span class="line">        List&lt;String&gt; temp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span>path[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">0</span> ;j&lt;pos;j++)&#123;</span><br><span class="line">                sb.append(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(<span class="string">&#x27;Q&#x27;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> pos+<span class="number">1</span>;j&lt;n;j++)&#123;</span><br><span class="line">                sb.append(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            temp.add(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        ans.add(temp);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¾æ¬¡å°è¯•</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="comment">// å°è¯•ç¬¬iåˆ—</span></span><br><span class="line">            <span class="keyword">if</span>(isvalid(i,path,size))&#123;</span><br><span class="line">                <span class="comment">// åˆæ³•</span></span><br><span class="line">                path[size] = i;</span><br><span class="line">                findSolveNQueens(size+<span class="number">1</span>,n,path,ans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isvalid</span> <span class="params">(<span class="type">int</span> i ,<span class="type">int</span>[] path,<span class="type">int</span> size)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k&lt; size; k++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i==path[k])&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( Math.abs(size-k) == Math.abs(i-path[k]))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‹“å±•ï¼š åˆ©ç”¨ä½è¿ç®—å»åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦åˆæ³•ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-21%20162737.png" alt="ç¤ºä¾‹å›¾ç‰‡"/></div><span class="image-caption">ç¤ºä¾‹å›¾ç‰‡</span></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">totalNQueens2</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (n &lt; <span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// n = 5</span></span><br><span class="line"><span class="comment">// 1 &lt;&lt; 5 = 0...100000 - 1</span></span><br><span class="line"><span class="comment">// limit  = 0...011111; </span></span><br><span class="line"><span class="comment">// n = 7</span></span><br><span class="line"><span class="comment">// limit  = 0...01111111; </span></span><br><span class="line"><span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> (<span class="number">1</span> &lt;&lt; n) - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> f2(limit, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// limit : å½“å‰æ˜¯å‡ çš‡åé—®é¢˜</span></span><br><span class="line"><span class="comment">// ä¹‹å‰çš‡åçš„åˆ—å½±å“ï¼šcol</span></span><br><span class="line"><span class="comment">// ä¹‹å‰çš‡åçš„å³ä¸Š -&gt; å·¦ä¸‹å¯¹è§’çº¿å½±å“ï¼šleft</span></span><br><span class="line"><span class="comment">// ä¹‹å‰çš‡åçš„å·¦ä¸Š -&gt; å³ä¸‹å¯¹è§’çº¿å½±å“ï¼šright</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">f2</span><span class="params">(<span class="type">int</span> limit, <span class="type">int</span> col, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (col == limit) &#123;</span><br><span class="line"><span class="comment">// æ‰€æœ‰çš‡åæ”¾å®Œäº†ï¼</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ€»é™åˆ¶</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ban</span> <span class="operator">=</span> col | left | right;</span><br><span class="line"><span class="comment">// ~ban : 1å¯æ”¾çš‡åï¼Œ0ä¸èƒ½æ”¾</span></span><br><span class="line"><span class="type">int</span> <span class="variable">candidate</span> <span class="operator">=</span> limit &amp; (~ban);</span><br><span class="line"><span class="comment">// æ”¾ç½®çš‡åçš„å°è¯•ï¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">place</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// ä¸€å…±æœ‰å¤šå°‘æœ‰æ•ˆçš„æ–¹æ³•</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (candidate != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// æå–å‡ºæœ€å³ä¾§çš„1</span></span><br><span class="line"><span class="comment">// 0 0 1 1 1 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line"><span class="comment">// place : </span></span><br><span class="line"><span class="comment">// 0 0 0 0 1 0</span></span><br><span class="line"><span class="comment">// candidate : </span></span><br><span class="line"><span class="comment">// 0 0 1 1 0 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line"><span class="comment">// place : </span></span><br><span class="line"><span class="comment">// 0 0 0 1 0 0</span></span><br><span class="line"><span class="comment">// candidate : </span></span><br><span class="line"><span class="comment">// 0 0 1 0 0 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line"><span class="comment">// place : </span></span><br><span class="line"><span class="comment">// 0 0 1 0 0 0</span></span><br><span class="line"><span class="comment">// candidate : </span></span><br><span class="line"><span class="comment">// 0 0 0 0 0 0</span></span><br><span class="line"><span class="comment">// 5 4 3 2 1 0</span></span><br><span class="line">place = candidate &amp; (-candidate);</span><br><span class="line">candidate ^= place;</span><br><span class="line">ans += f2(limit, col | place, (left | place) &gt;&gt; <span class="number">1</span>, (right | place) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é€’å½’ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é€’å½’ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é€’å½’ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;é€’å½’ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—&quot;&gt;&lt;a href=&quot;#æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¸é‡å¤çš„å­åºåˆ—&quot; cla</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆå››ï¼‰äºŒå‰æ ‘</title>
    <link href="https://nmcb666.vip/posts/44956a51.html"/>
    <id>https://nmcb666.vip/posts/44956a51.html</id>
    <published>2026-01-19T21:48:58.000Z</published>
    <updated>2026-01-31T14:36:26.049Z</updated>
    
    <content type="html"><![CDATA[<h1 id="äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®"><a href="#äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®"></a>äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®</h1><h2 id="å±‚åºéå†"><a href="#å±‚åºéå†" class="headerlink" title="å±‚åºéå†"></a>å±‚åºéå†</h2><p>æ€è·¯ï¼šåˆ©ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†ï¼Œç±»ä¼¼ä¸BFSã€‚</p><p>è¿™é‡Œä¸¾ä¸€ä¸ªé”¯é½¿å½¢å±‚åºéå†çš„ä¾‹å­ï¼ˆå³å…ˆä»å·¦å¾€å³ï¼Œå†ä»å³å¾€å·¦è¿›è¡Œä¸‹ä¸€å±‚éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">2001</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> TreeNode[] queue = <span class="keyword">new</span> <span class="title class_">TreeNode</span>[MAXN];</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> l, r;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">l = r = <span class="number">0</span>;</span><br><span class="line">queue[r++] = root;</span><br><span class="line"><span class="comment">// false ä»£è¡¨ä»å·¦å¾€å³</span></span><br><span class="line"><span class="comment">// true ä»£è¡¨ä»å³å¾€å·¦</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">reverse</span> <span class="operator">=</span> <span class="literal">false</span>; </span><br><span class="line"><span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r - l;</span><br><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"><span class="comment">// reverse == false, å·¦ -&gt; å³ï¼Œ l....r-1, æ”¶é›†sizeä¸ª</span></span><br><span class="line"><span class="comment">// reverse == true,  å³ -&gt; å·¦ï¼Œ r-1....l, æ”¶é›†sizeä¸ª</span></span><br><span class="line"><span class="comment">// å·¦ -&gt; å³, i = i + 1</span></span><br><span class="line"><span class="comment">// å³ -&gt; å·¦, i = i - 1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> reverse ? r - <span class="number">1</span> : l, j = reverse ? -<span class="number">1</span> : <span class="number">1</span>, k = <span class="number">0</span>; k &lt; size; i += j, k++) &#123;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue[i];</span><br><span class="line">list.add(cur.val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue[l++];</span><br><span class="line"><span class="keyword">if</span> (cur.left != <span class="literal">null</span>) &#123;</span><br><span class="line">queue[r++] = cur.left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (cur.right != <span class="literal">null</span>) &#123;</span><br><span class="line">queue[r++] = cur.right;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ans.add(list);</span><br><span class="line">reverse = !reverse;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘æœ€å¤§å®½åº¦"><a href="#äºŒå‰æ ‘æœ€å¤§å®½åº¦" class="headerlink" title="äºŒå‰æ ‘æœ€å¤§å®½åº¦"></a>äºŒå‰æ ‘æœ€å¤§å®½åº¦</h2><p>æ€è·¯ï¼šåˆ©ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†ï¼Œå¹¶åŒæ­¥è®°å½•å½“å‰å±‚èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œå°†ç´¢å¼•ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€åè®¡ç®—æ¯ä¸€å±‚å¼€å§‹ä¸ç»“æŸçš„ç´¢å¼•çš„å·®å€¼ï¼Œå¹¶è¿”å›æœ€å¤§å€¼ã€‚æƒ³è±¡ä¸ºå®Œå…¨äºŒå‰æ ‘ï¼Œå¯¹äºèŠ‚ç‚¹iï¼Œå…¶å·¦å­èŠ‚ç‚¹ä¸º2iï¼Œå³å­èŠ‚ç‚¹ä¸º2i+1ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">widthOfBinaryTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    TreeNode[] queue = <span class="keyword">new</span> <span class="title class_">TreeNode</span>[<span class="number">3001</span>];</span><br><span class="line">    Long[] idQueue = <span class="keyword">new</span> <span class="title class_">Long</span>[<span class="number">3001</span>];</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[r] = root;</span><br><span class="line">    idQueue[r++] = <span class="number">1L</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">        <span class="comment">//æ¯æ¬¡éå†å®Œæˆåï¼Œl åˆ° r-1ï¼Œå°±æ˜¯å½“å‰å±‚æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r-l;</span><br><span class="line">        ans = Math.max(ans,(<span class="type">int</span>)(idQueue[r-<span class="number">1</span>]-idQueue[l]+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue[l];</span><br><span class="line">            <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> idQueue[l++];</span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                queue[r] = node.left;</span><br><span class="line">                idQueue[r++] = id*<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                queue[r] =node.right;</span><br><span class="line">                idQueue[r++] = id*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦"><a href="#æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦" class="headerlink" title="æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦"></a>æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦</h2><p>æ€è·¯ï¼šåˆ©ç”¨é€’å½’è¿›è¡Œæ±‚è§£ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ±‚å·¦å³å­æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œå¹¶è¿”å›è¾ƒå¤§çš„å€¼ã€‚ï¼ˆæœ€å°æ·±åº¦åŒç†ï¼Œä½†è¦å¤„ç†æ ¹èŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µï¼Œå› ä¸ºä¸ºç©ºå­é—®é¢˜è¿”å›0é«˜åº¦ï¼Œä½†é¢˜ç›®è¯´çš„æœ€å°æ·±åº¦å¿…é¡»åˆ°å¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šå¹²æ‰°æœ€å°æ·±åº¦çš„è®¡ç®—ï¼Œæ‰€ä»¥å¿…é¡»å­èŠ‚ç‚¹ä¸ä¸ºç©ºæ‰èƒ½è¿›è¡Œé€’å½’ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> root == <span class="literal">null</span> ? <span class="number">0</span> : Math.max(maxDepth(root.left),maxDepth(root.right))+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right ==<span class="literal">null</span> &amp;&amp; root.left ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">lMin</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="type">int</span> <span class="variable">rMin</span> <span class="operator">=</span>Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        lMin = minDepth(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">        rMin = minDepth(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Math.min(lMin,rMin)+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘"><a href="#æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘" class="headerlink" title="æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘"></a>æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘</h2><p>æ€è·¯ï¼š</p><p>ç¡®å®šæ ¹èŠ‚ç‚¹ï¼š<br>å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸€å®šæ˜¯æ•´ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p><p>åˆ’åˆ†å·¦å³å­æ ‘ï¼š<br>æ ¹æ®æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®ï¼Œå¯ä»¥å°†ä¸­åºéå†åºåˆ—åˆ’åˆ†ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—ã€‚<br>å·¦å­æ ‘çš„ä¸­åºéå†åºåˆ—ä½äºæ ¹èŠ‚ç‚¹çš„å·¦è¾¹ï¼Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—ä½äºæ ¹èŠ‚ç‚¹çš„å³è¾¹ã€‚</p><p>é€’å½’æ„å»ºï¼š<br>æ ¹æ®å·¦å­æ ‘å’Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—é•¿åº¦ï¼Œå¯ä»¥åœ¨å‰åºéå†åºåˆ—ä¸­åˆ’åˆ†å‡ºå¯¹åº”çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„å‰åºéå†åºåˆ—ã€‚<br>é€’å½’åœ°å¯¹å·¦å³å­æ ‘è¿›è¡Œä¸Šè¿°æ“ä½œï¼Œç›´åˆ°éå†åºåˆ—ä¸ºç©ºï¼Œè¿”å› nullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(preorder.length == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> preorder.length;</span><br><span class="line">    HashMap&lt;Integer,Integer&gt; map =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i= <span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        map.put(inorder[i],i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> build(preorder,<span class="number">0</span>,len-<span class="number">1</span>,inorder,<span class="number">0</span>,len-<span class="number">1</span>,map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] pre ,<span class="type">int</span> l1,<span class="type">int</span> r1,<span class="type">int</span>[] in,<span class="type">int</span> l2,<span class="type">int</span> r2,HashMap&lt;Integer,Integer&gt; map)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l1&gt;r1 || l2 &gt; r2)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l1 == r1)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(pre[l1]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(pre[l1]);</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span>map.get(pre[l1]);</span><br><span class="line">    <span class="comment">// åˆ’åˆ†å·¦å³å­æ ‘ é€’å½’æ±‚è§£</span></span><br><span class="line">    head.left = build(pre,l1+<span class="number">1</span>,k-l2+l1,in,l2,k-<span class="number">1</span>,map);</span><br><span class="line">    head.right = build(pre,k-l2+l1+<span class="number">1</span>,r1,in,k+<span class="number">1</span>,r2,map);</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h2><p>æ€è·¯ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">null</span> || root == p || root == q) &#123;</span><br><span class="line"><span class="comment">// é‡åˆ°ç©ºï¼Œæˆ–è€…pï¼Œæˆ–è€…qï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">l</span> <span class="operator">=</span> lowestCommonAncestor(root.left, p, q);</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">r</span> <span class="operator">=</span> lowestCommonAncestor(root.right, p, q);</span><br><span class="line"><span class="keyword">if</span> (l != <span class="literal">null</span> &amp;&amp; r != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// å·¦æ ‘ä¹Ÿæœåˆ°ï¼Œå³æ ‘ä¹Ÿæœåˆ°ï¼Œè¿”å›root</span></span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (l == <span class="literal">null</span> &amp;&amp; r == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// éƒ½æ²¡æœåˆ°è¿”å›ç©º</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// lå’Œrä¸€ä¸ªä¸ºç©ºï¼Œä¸€ä¸ªä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">// è¿”å›ä¸ç©ºçš„é‚£ä¸ª</span></span><br><span class="line"><span class="keyword">return</span> l != <span class="literal">null</span> ? l : r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#éªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="éªŒè¯äºŒå‰æœç´¢æ ‘"></a>éªŒè¯äºŒå‰æœç´¢æ ‘</h2><p>æ€è·¯ï¼šæ¯ä¸ªç‚¹å¿…é¡»å¤§äºå·¦æ ‘çš„æœ€å¤§å€¼ï¼Œå°äºå³æ ‘æœ€å°å€¼ã€‚é€’å½’éªŒè¯å³å¯ã€‚ä½†æ³¨æ„æŠŠæœ€å¤§å€¼è®¾ä¸ºLong.MIN_VALUEï¼Œæœ€å°å€¼è®¾ä¸ºLong.MAX_VALUEï¼ˆä¸ºäº†ä¸å¯¹ç»“æœé€ æˆå¹²æ‰°ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">max</span> <span class="operator">=</span> Long.MIN_VALUE;</span><br><span class="line"><span class="type">long</span> <span class="variable">min</span> <span class="operator">=</span> Long.MAX_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        max = Long.MIN_VALUE;</span><br><span class="line">        min = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">lok</span> <span class="operator">=</span> isValidBST(root.left);</span><br><span class="line">    <span class="type">long</span> <span class="variable">lmax</span> <span class="operator">=</span> max;</span><br><span class="line">    <span class="type">long</span> <span class="variable">lmin</span> <span class="operator">=</span> min;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">rok</span> <span class="operator">=</span> isValidBST(root.right);</span><br><span class="line">    <span class="type">long</span> <span class="variable">rmax</span> <span class="operator">=</span> max;</span><br><span class="line">    <span class="type">long</span> <span class="variable">rmin</span> <span class="operator">=</span> min;</span><br><span class="line">    max = Math.max(Math.max(lmax,rmax),root.val);</span><br><span class="line">    min = Math.min(Math.min(lmin,rmin),root.val);</span><br><span class="line">    <span class="keyword">return</span> lok &amp;&amp; rok &amp;&amp; root.val &gt; lmax &amp;&amp; root.val&lt; rmin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;å±‚åºéå†&quot;&gt;&lt;a href=&quot;#å±‚åºéå†&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>DDDé¢†åŸŸäº‹ä»¶çš„æœ€ä½³å®è·µ</title>
    <link href="https://nmcb666.vip/posts/8f3b837f.html"/>
    <id>https://nmcb666.vip/posts/8f3b837f.html</id>
    <published>2026-01-16T23:59:31.000Z</published>
    <updated>2026-01-31T14:36:26.045Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ"><a href="#DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ" class="headerlink" title="DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ"></a>DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ</h1><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„æˆ˜æœ¯è½åœ°è¿‡ç¨‹ä¸­ï¼Œ<strong>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰</strong> æ˜¯è¿æ¥å„ä¸ªå­åŸŸã€èšåˆä»¥åŠé™ç•Œä¸Šä¸‹æ–‡çš„â€œèƒ¶æ°´â€ã€‚å®ƒä¸ä»…è§£è€¦äº†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ›´æ˜¯å®ç°â€œæœ€ç»ˆä¸€è‡´æ€§â€æ¶æ„çš„å…³é”®æ‰‹æ®µã€‚</p><p>æœ¬æ–‡åŸºäºå®é™…å¼€å‘ç»éªŒï¼Œæ€»ç»“é¢†åŸŸäº‹ä»¶çš„å»ºæ¨¡ã€ç”Ÿæˆã€å‘å¸ƒåŠå¯é æ€§æŠ•é€’çš„æœ€ä½³å®è·µï¼Œå¹¶æ¢è®¨ä¸åŒæ–¹æ¡ˆèƒŒåçš„æƒè¡¡ã€‚</p><hr><h2 id="ä¸€ã€-ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ"><a href="#ä¸€ã€-ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ" class="headerlink" title="ä¸€ã€ ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ"></a>ä¸€ã€ ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ</h2><p>ç®€å•æ¥è¯´ï¼Œé¢†åŸŸäº‹ä»¶æ˜¯<strong>èšåˆå†…å·²å‘ç”Ÿçš„ä¸šåŠ¡äº‹å®</strong>ã€‚</p><ul><li><strong>ä¸šåŠ¡äº‹å®</strong>ï¼šæ„å‘³ç€å®ƒæ˜¯è¿‡å»å¼ã€‚æ¯”å¦‚â€œç”¨æˆ·å·²æ³¨å†Œâ€ã€â€œè®¢å•å·²æ”¯ä»˜â€ã€‚</li><li><strong>å‘½åè§„èŒƒ</strong>ï¼šæ¨èä½¿ç”¨ <code>åŠ¨è¯è¿‡å»å¼</code>ï¼ˆå¦‚ <code>OrderPaid</code>, <code>AccountActivated</code>ï¼‰ã€‚</li><li><strong>ä»·å€¼</strong>ï¼š<ol><li><strong>è§£è€¦</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸éœ€è¦çŸ¥é“è°åœ¨å…³æ³¨å®ƒã€‚</li><li><strong>å‰¯ä½œç”¨å¤„ç†</strong>ï¼šè§¦å‘é€šçŸ¥ã€å¤§æ•°æ®åˆ†æã€æŠ¥è¡¨ç”Ÿæˆç­‰éæ ¸å¿ƒé€»è¾‘ã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šè·¨èšåˆã€è·¨æœåŠ¡çš„çŠ¶æ€åŒæ­¥ã€‚</li></ol></li></ul><hr><h2 id="äºŒã€-å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯-vs-ç˜¦æ¶ˆæ¯"><a href="#äºŒã€-å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯-vs-ç˜¦æ¶ˆæ¯" class="headerlink" title="äºŒã€ å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯ vs ç˜¦æ¶ˆæ¯"></a>äºŒã€ å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯ vs ç˜¦æ¶ˆæ¯</h2><p>é¢†åŸŸäº‹ä»¶é€šå¸¸è¢«å»ºæ¨¡ä¸º<strong>ä¸å¯å˜çš„å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰</strong>ã€‚ä½†åœ¨è®¾è®¡æ¶ˆæ¯ä½“ï¼ˆPayloadï¼‰æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªç»å…¸æŠ‰æ‹©ï¼š</p><h3 id="1-ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰"><a href="#1-ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰" class="headerlink" title="1. ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰"></a>1. ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰</h3><p>æ¶ˆæ¯ä½“ä»…åŒ…å«æœ€åŸºç¡€çš„å…ƒæ•°æ®ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MobileChanged&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;entityId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eventId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uuid-001&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eventTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1654156165&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆæ¯æå°ï¼Œä¼ è¾“å¿«ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆè´¹è€…ï¼ˆSubscriberï¼‰å¿…é¡»æ‹¿ç€ <code>entityId</code> åæŸ¥èšåˆæ ¹ä¿¡æ¯ï¼Œå¯¼è‡´<strong>è¯»æ”¾å¤§</strong>ã€‚</li></ul><h3 id="2-èƒ–æ¶ˆæ¯ï¼ˆEvent-Enrichment-äº‹ä»¶å¢å¼ºï¼‰"><a href="#2-èƒ–æ¶ˆæ¯ï¼ˆEvent-Enrichment-äº‹ä»¶å¢å¼ºï¼‰" class="headerlink" title="2. èƒ–æ¶ˆæ¯ï¼ˆEvent Enrichment / äº‹ä»¶å¢å¼ºï¼‰"></a>2. èƒ–æ¶ˆæ¯ï¼ˆEvent Enrichment / äº‹ä»¶å¢å¼ºï¼‰</h3><p>æ¶ˆæ¯ä½“åŒ…å«æ¶ˆè´¹è€…æ‰€éœ€çš„ä¸šåŠ¡æ•°æ®ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MobileChanged&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">&quot;beforeMobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13800000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;afterMobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18100000000&quot;</span> <span class="comment">// å¢å¼ºå­—æ®µ</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆè´¹è€…å®Œå…¨è‡ªæ²»ï¼Œæ— éœ€åæŸ¥ï¼Œé™ä½æºç«¯ç³»ç»Ÿå‹åŠ›ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆæ¯ä½“è¾ƒå¤§ï¼›å¯èƒ½åŒ…å«æ¶ˆè´¹è€…ä¸åº”å…³å¿ƒçš„æ•æ„Ÿæ•°æ®ï¼›å­˜åœ¨æ•°æ®æ—¶æ•ˆæ€§é—®é¢˜ï¼ˆå¦‚æœæ¶ˆè´¹è€…å¤„ç†æ…¢ï¼Œæ¶ˆæ¯é‡Œçš„æ•°æ®å¯èƒ½æ˜¯æ—§çš„ï¼‰ã€‚</li></ul><blockquote><p><strong>ğŸ’¡ æ€è€ƒä¸å»ºè®®</strong>ï¼š<br>åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œä¸ºäº†å‡å°‘è·¨æœåŠ¡è°ƒç”¨å¸¦æ¥çš„è€¦åˆä¸å»¶è¿Ÿï¼Œ<strong>æ¨èé€‚åº¦çš„â€œäº‹ä»¶å¢å¼ºâ€</strong>ã€‚å³ï¼šåŒ…å«æ¶ˆè´¹è€…å¤„ç†ä¸šåŠ¡æ‰€å¿…é¡»çš„æ ¸å¿ƒå­—æ®µï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ªèšåˆæ ¹éƒ½å¡è¿›å»ã€‚</p></blockquote><hr><h2 id="ä¸‰ã€-ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ"><a href="#ä¸‰ã€-ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ" class="headerlink" title="ä¸‰ã€ ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ"></a>ä¸‰ã€ ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ</h2><p>åœ¨ä»£ç å±‚é¢ï¼Œä½•å¤„åˆ›å»ºã€ä½•å¤„å‘å¸ƒäº‹ä»¶ï¼Œç›´æ¥å½±å“ä»£ç çš„æ•´æ´åº¦ï¼ˆClean Codeï¼‰ã€‚æˆ‘ä»¬å¯¹æ¯”å››ç§å¸¸è§æ–¹æ¡ˆï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">æ–¹æ¡ˆ</th><th style="text-align:left">æè¿°</th><th style="text-align:left">è¯„ä»·</th><th style="text-align:left">å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>1. Serviceå±‚åˆ›å»º</strong></td><td style="text-align:left">ä¸šåŠ¡æ‰§è¡Œå®Œåï¼Œæ‰‹åŠ¨ <code>new Event()</code> å¹¶å‘å¸ƒ</td><td style="text-align:left"><strong>ç®€å•ç²—æš´</strong>ã€‚é€‚åˆè´«è¡€æ¨¡å‹ï¼Œä½†å®¹æ˜“å¯¼è‡´Serviceå±‚é€»è¾‘è†¨èƒ€ï¼Œå®¹æ˜“é—æ¼ã€‚</td><td style="text-align:left">â­ï¸â­ï¸</td></tr><tr><td style="text-align:left"><strong>2. èšåˆæ ¹ä¾èµ–Infra</strong></td><td style="text-align:left">èšåˆæ ¹æ³¨å…¥ <code>Publisher</code>ï¼Œå†…éƒ¨ç›´æ¥å‘å¸ƒ</td><td style="text-align:left"><strong>åæ¨¡å¼</strong>ã€‚èšåˆæ ¹ä¸åº”ä¾èµ–åŸºç¡€è®¾æ–½ï¼Œç ´åäº†POJOçš„çº¯å‡€æ€§ï¼Œä¸”å¯¼è‡´å•ä¸€èŒè´£é—®é¢˜ã€‚</td><td style="text-align:left">ğŸš«</td></tr><tr><td style="text-align:left"><strong>3. èšåˆæ ¹è¿”å›äº‹ä»¶</strong></td><td style="text-align:left">æ–¹æ³•ç­¾åæ”¹ä¸º <code>List&lt;Event&gt; doSomething()</code></td><td style="text-align:left"><strong>ä¾µå…¥æ€§å¼º</strong>ã€‚å¼ºè¡Œæ”¹å˜äº†ä¸šåŠ¡æ–¹æ³•ç­¾åï¼Œè°ƒç”¨æ–¹å¤„ç†ç¹çã€‚</td><td style="text-align:left">â­ï¸</td></tr><tr><td style="text-align:left"><strong>4. èšåˆæ ¹æš‚å­˜ + æŠ½å–</strong></td><td style="text-align:left">èšåˆæ ¹å†…éƒ¨ <code>List</code> æš‚å­˜ï¼ŒRepoä¿å­˜æ—¶æŠ½å–</td><td style="text-align:left"><strong>æœ€ä½³å®è·µ</strong>ã€‚ä¿è¯äº†èšåˆæ ¹çš„çº¯å‡€ï¼ŒåŒæ—¶åˆ©ç”¨åŸºç¡€è®¾æ–½å±‚è‡ªåŠ¨åŒ–å¤„ç†å‘å¸ƒï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚</td><td style="text-align:left">â­ï¸â­ï¸â­ï¸â­ï¸</td></tr></tbody></table></div><h3 id="æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹"><a href="#æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹" class="headerlink" title="æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹"></a>æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹</h3><p><strong>æŠ½è±¡èšåˆæ ¹åŸºç±»ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractAggregateRoot</span> &#123;</span><br><span class="line">    <span class="comment">// æš‚å­˜äº‹ä»¶ï¼Œä¸æŒä¹…åŒ–åˆ°ä¸šåŠ¡è¡¨</span></span><br><span class="line">    <span class="meta">@Transient</span> </span><br><span class="line">    <span class="keyword">private</span> List&lt;DomainEvent&gt; domainEvents = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">registerEvent</span><span class="params">(DomainEvent event)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.domainEvents.add(event);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›ç»™åŸºç¡€è®¾æ–½å±‚è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;DomainEvent&gt; <span class="title function_">pollEvents</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;DomainEvent&gt; events = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.domainEvents);</span><br><span class="line">        <span class="built_in">this</span>.domainEvents.clear();</span><br><span class="line">        <span class="keyword">return</span> events;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>ä¸šåŠ¡èšåˆæ ¹ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">AbstractAggregateRoot</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeMobile</span><span class="params">(String newMobile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mobile = newMobile;</span><br><span class="line">        <span class="comment">// ä»…ä»…æ˜¯æ³¨å†Œï¼Œä¸æ¶‰åŠIOæ“ä½œ</span></span><br><span class="line">        registerEvent(<span class="keyword">new</span> <span class="title class_">MobileChangedEvent</span>(<span class="built_in">this</span>.id, newMobile));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="å››ã€-å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦"><a href="#å››ã€-å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦" class="headerlink" title="å››ã€ å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦"></a>å››ã€ å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦</h2><p>æœ€æ ¸å¿ƒçš„å·¥ç¨‹éš¾é¢˜åœ¨äºï¼š<strong>Databaseä¿å­˜</strong> ä¸ <strong>MQæ¶ˆæ¯å‘é€</strong> æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œã€‚<br>å¦‚æœ DB æäº¤äº†ï¼Œä½† MQ æŒ‚äº†ï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥<strong>æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆTransactional Outbox Patternï¼‰</strong>ã€‚</p><h3 id="1-æ ¸å¿ƒæœºåˆ¶"><a href="#1-æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="1. æ ¸å¿ƒæœºåˆ¶"></a>1. æ ¸å¿ƒæœºåˆ¶</h3><p>åˆ©ç”¨å…³ç³»å‹æ•°æ®åº“çš„æœ¬åœ°äº‹åŠ¡ï¼ˆACIDï¼‰ï¼Œå°†â€œä¸šåŠ¡æ•°æ®ä¿å­˜â€å’Œâ€œäº‹ä»¶æ•°æ®ä¿å­˜â€æ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤ã€‚</p><ul><li><strong>Step 1</strong>: å¼€å¯äº‹åŠ¡ã€‚</li><li><strong>Step 2</strong>: Update ä¸šåŠ¡è¡¨ã€‚</li><li><strong>Step 3</strong>: Insert into <code>t_event</code> (çŠ¶æ€ï¼šPENDING)ã€‚</li><li><strong>Step 4</strong>: æäº¤äº‹åŠ¡ã€‚</li></ul><p>æ­¤æ—¶ï¼Œä¸šåŠ¡æ“ä½œå’Œäº‹ä»¶è®°å½•è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><h3 id="2-å‘é€ä¸è¡¥å¿ç­–ç•¥"><a href="#2-å‘é€ä¸è¡¥å¿ç­–ç•¥" class="headerlink" title="2. å‘é€ä¸è¡¥å¿ç­–ç•¥"></a>2. å‘é€ä¸è¡¥å¿ç­–ç•¥</h3><p>ä¿å­˜åˆ° <code>t_event</code> åï¼Œå¦‚ä½•å‘åˆ° MQï¼Ÿ</p><ul><li><strong>æ–¹æ¡ˆ Aï¼šåº”ç”¨ç›´æ¥å‘ + è½®è¯¢è¡¥å¿ï¼ˆé€‚åˆä¸­å°è§„æ¨¡ï¼‰</strong><ul><li>åº”ç”¨åœ¨äº‹åŠ¡æäº¤åï¼Œç›´æ¥å¼‚æ­¥å‘é€ MQã€‚å‘é€æˆåŠŸåˆ™æ›´æ–° <code>t_event</code> ä¸º <code>PUBLISHED</code>ã€‚</li><li>åå°å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼ˆWorkerï¼‰ï¼Œæ‰«æ <code>t_event</code> ä¸­è¶…è¿‡ 1 åˆ†é’Ÿä»ä¸º <code>PENDING</code> çš„è®°å½•ï¼Œè¿›è¡Œé‡è¯•ã€‚</li><li><em>ç¼ºç‚¹</em>ï¼šå¢åŠ äº†æ•°æ®åº“æŸ¥è¯¢å‹åŠ›ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EventJdbcRepository eventJdbcRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBusiness</span> <span class="params">(Command cmd)</span> &#123;</span><br><span class="line">        <span class="type">AggregateRoot</span> <span class="variable">root</span> <span class="operator">=</span> repository.load(bizId);</span><br><span class="line">        entity.doBusiness(cmd.getValue());</span><br><span class="line">        repository.save(root);</span><br><span class="line">        <span class="comment">// å‘å¸ƒé¢†åŸŸäº‹ä»¶</span></span><br><span class="line">        List&lt;DomainEvent&gt; domainEvents = entity.getDomainEvents();</span><br><span class="line">        publisher.publish(domainEvents);</span><br><span class="line">        <span class="comment">// é€šè¿‡äº‹ä»¶çš„EntityIdæ›´æ–°EventStoreä¸­äº‹ä»¶çš„çŠ¶æ€ä¸ºå·²å‘å¸ƒ</span></span><br><span class="line">        List&lt;String&gt; eventIds = domainEvents.stream()</span><br><span class="line">        .map(e-&gt;e.getEventId())</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">     eventJdbcRepository.publishSuccess(eventIds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">// TODO 1.æ‰«ææ•°æ®åº“è¶…æ—¶æœªå‘å¸ƒæˆåŠŸçš„é¢†åŸŸäº‹ä»¶</span></span><br><span class="line">    <span class="comment">// TODO 2.å‘å¸ƒé¢†åŸŸäº‹ä»¶åˆ°æ¶ˆæ¯ä¸­é—´ä»¶</span></span><br><span class="line">    <span class="comment">// TODO 3.ä¿®æ”¹æ•°æ®åº“é¢†åŸŸäº‹ä»¶å‘å¸ƒçŠ¶æ€ä¸ºå·²å‘å¸ƒ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>æ–¹æ¡ˆ Bï¼šäº‹åŠ¡æ—¥å¿—æ‹–å°¾ / CDCï¼ˆé€‚åˆå¤§è§„æ¨¡ï¼‰</strong><ul><li>åº”ç”¨åªç®¡å†™åº“ï¼Œä¸å‘æ¶ˆæ¯ã€‚</li><li>åˆ©ç”¨ <strong>Canal / Debezium</strong> ç›‘å¬æ•°æ®åº“çš„ Binlogã€‚</li><li>CDC ç»„ä»¶è§£æ Binlog ä¸­çš„ <code>t_event</code> æ’å…¥è®°å½•ï¼Œè‡ªåŠ¨æŠ•é€’åˆ° MQã€‚</li><li><em>ä¼˜ç‚¹</em>ï¼šåº”ç”¨å±‚å®Œå…¨è§£è€¦ï¼Œæ€§èƒ½æé«˜ã€‚</li></ul></li></ul><hr><h2 id="äº”ã€-è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ"><a href="#äº”ã€-è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ" class="headerlink" title="äº”ã€ è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ"></a>äº”ã€ è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ</h2><p>åœ¨ DDD çš„åˆ†å±‚æ¶æ„ä¸­ï¼Œäº‹ä»¶è®¢é˜…è€…ï¼ˆSubscriber/Listenerï¼‰åº”è¯¥æ”¾åœ¨å“ªé‡Œï¼Ÿ</p><p><strong>ç»“è®ºï¼šç”¨æˆ·æ¥å£å±‚ï¼ˆUser Interface / Adapters Layerï¼‰ã€‚</strong></p><ul><li><strong>ç†ç”±</strong>ï¼šè®¢é˜… MQ æ¶ˆæ¯æœ¬è´¨ä¸Šå’Œ Controller æ¥æ”¶ HTTP è¯·æ±‚æ˜¯ä¸€æ ·çš„ã€‚å®ƒä»¬éƒ½æ˜¯å¤–éƒ¨ä¸–ç•Œçš„è¾“å…¥ï¼ˆInputï¼‰ã€‚</li><li><strong>æµç¨‹</strong>ï¼š<ol><li>Subscriber æ¥æ”¶ JSON æ¶ˆæ¯ã€‚</li><li>ååºåˆ—åŒ–ä¸º DTOã€‚</li><li><strong>è°ƒç”¨ Application Service</strong> æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡å‘½ä»¤ã€‚</li></ol></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é¢†åŸŸäº‹ä»¶è®¢é˜…è€…</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DomainEventSubscriber</span> &#123;</span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        <span class="keyword">private</span> ApplicationService applicationService;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@KafkaListener(topics = &quot;domain_event_topic&quot;,groupId = &quot;local_consumer_group_id&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span> <span class="params">(String event)</span> &#123;</span><br><span class="line">            <span class="comment">// è§£æå¾—åˆ°é¢†åŸŸäº‹ä»¶</span></span><br><span class="line">            <span class="type">DomainEvent</span> <span class="variable">domainEvent</span> <span class="operator">=</span> JSON.parse(event,DomainEvent.class);</span><br><span class="line">            <span class="comment">// æ‹¼è£…Command</span></span><br><span class="line">            <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> <span class="built_in">this</span>.toCommand(domainEvent);</span><br><span class="line">            <span class="comment">// åº”ç”¨å±‚æ‰§è¡Œé¢†åŸŸæ¨¡å‹çŠ¶æ€å˜æ›´</span></span><br><span class="line">            applicationService.handleCommand(command);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰"><a href="#å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰" class="headerlink" title="å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰"></a>å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰</h3><p>ç”±äºç½‘ç»œæŠ–åŠ¨æˆ–é‡è¯•æœºåˆ¶ï¼Œæ¶ˆè´¹è€…å¿…ç„¶ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯ã€‚<strong>å¿…é¡»</strong>åˆ©ç”¨ <code>event_id</code> å»ºç«‹å”¯ä¸€ç´¢å¼•æˆ–å»é‡è¡¨ï¼Œç¡®ä¿åŒä¸€ä¸šåŠ¡é€»è¾‘ä¸æ‰§è¡Œä¸¤æ¬¡ã€‚</p><hr><h2 id="å…­ã€-æ€»ç»“"><a href="#å…­ã€-æ€»ç»“" class="headerlink" title="å…­ã€ æ€»ç»“"></a>å…­ã€ æ€»ç»“</h2><p>é¢†åŸŸäº‹ä»¶çš„è®¾è®¡ä¸ä»…ä»…æ˜¯æŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯ä¸€ç§å°†<strong>ä¸šåŠ¡æµç¨‹æ˜¾æ€§åŒ–</strong>çš„æ‰‹æ®µã€‚</p><ol><li><strong>è®¾è®¡ä¸Š</strong>ï¼šä¼˜å…ˆé€‰æ‹© <strong>â€œèšåˆæ ¹æš‚å­˜ + åŸºç¡€è®¾æ–½æŠ½å–â€</strong> çš„ç”Ÿæˆæ¨¡å¼ï¼Œä¿æŒé¢†åŸŸçº¯å‡€ã€‚</li><li><strong>æ•°æ®ä¸Š</strong>ï¼šæƒè¡¡æ¶ˆæ¯å¤§å°ï¼Œæ¨èä½¿ç”¨ <strong>å¢å¼ºå‹äº‹ä»¶</strong> å‡å°‘ä¸‹æ¸¸ä¾èµ–ã€‚</li><li><strong>æ¶æ„ä¸Š</strong>ï¼šå¿…é¡»æ­£è§†åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ï¼Œ<strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong> æ˜¯å®ç°å¯é æŠ•é€’çš„åŸºçŸ³ã€‚</li></ol><p>DDD çš„è·¯é€”è™½è¿œï¼Œä½†åªè¦å¤„ç†å¥½é¢†åŸŸäº‹ä»¶ï¼Œç³»ç»Ÿçš„è§£è€¦ä¸æ¼”è¿›å°±ä¼šå˜å¾—ä»å®¹è®¸å¤šã€‚</p><p>æœ€åæœ‰å…³äºé¢†åŸŸäº‹ä»¶è·Ÿäº‹ä»¶å›æº¯ä»¥åŠCQRSçš„ç»“åˆå¯ä»¥çœ‹ä¸“é—¨çš„æ–‡ç« ã€‚ CQRSä¸DDD: <a href="https://juejin.cn/post/7510057969265115146">https://juejin.cn/post/7510057969265115146</a> , é¢†åŸŸäº‹ä»¶ä¸äº‹ä»¶å›æº¯ï¼š<a href="https://juejin.cn/post/7510120678847184906">https://juejin.cn/post/7510120678847184906</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ&quot;&gt;&lt;a href=&quot;#DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆä¸‰) é“¾è¡¨</title>
    <link href="https://nmcb666.vip/posts/73873447.html"/>
    <id>https://nmcb666.vip/posts/73873447.html</id>
    <published>2026-01-16T16:06:09.000Z</published>
    <updated>2026-01-31T14:36:26.049Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é“¾è¡¨ç›¸å…³çš„é¢˜ç›®"><a href="#é“¾è¡¨ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="é“¾è¡¨ç›¸å…³çš„é¢˜ç›®"></a>é“¾è¡¨ç›¸å…³çš„é¢˜ç›®</h1><p>è¿™é‡Œç”¨æ¥è®°å½•é“¾è¡¨ç›¸å…³çš„é¢˜ç›®ä»¥åŠæ€è·¯</p><h2 id="ç›¸äº¤é“¾è¡¨"><a href="#ç›¸äº¤é“¾è¡¨" class="headerlink" title="ç›¸äº¤é“¾è¡¨"></a>ç›¸äº¤é“¾è¡¨</h2><p>è¾“å…¥ä¸¤ä¸ªé“¾è¡¨ï¼Œæ‰¾å‡ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ, ç¬¬ä¸€è½®è®©ä¸¤ä¸ªåˆ°è¾¾æœ«å°¾çš„èŠ‚ç‚¹æŒ‡å‘å¦ä¸€ä¸ªé“¾è¡¨çš„å¤´éƒ¨, æœ€åå¦‚æœç›¸é‡åˆ™ä¸ºäº¤ç‚¹(åœ¨ç¬¬ä¸€è½®ç§»åŠ¨ä¸­æ°å¥½æŠ¹é™¤äº†é•¿åº¦å·®)</span></span><br><span class="line"><span class="comment">        ä¸¤ä¸ªæŒ‡é’ˆç­‰äºç§»åŠ¨äº†ç›¸åŒçš„è·ç¦», æœ‰äº¤ç‚¹å°±è¿”å›, æ— äº¤ç‚¹å°±æ˜¯å„èµ°äº†ä¸¤æ¡æŒ‡é’ˆçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">        **/</span></span><br><span class="line">        <span class="keyword">if</span>(headA == <span class="literal">null</span> || headB == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pA</span> <span class="operator">=</span> headA, pB = headB;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œç¬¬ä¸€è½®ä½“ç°åœ¨pAå’ŒpBç¬¬ä¸€æ¬¡åˆ°è¾¾å°¾éƒ¨ä¼šç§»å‘å¦ä¸€é“¾è¡¨çš„è¡¨å¤´, è€Œç¬¬äºŒè½®ä½“ç°åœ¨å¦‚æœpAæˆ–pBç›¸äº¤å°±è¿”å›äº¤ç‚¹, ä¸ç›¸äº¤æœ€åå°±æ˜¯null==null</span></span><br><span class="line">        <span class="keyword">while</span>(pA != pB) &#123;</span><br><span class="line">            pA = pA == <span class="literal">null</span> ? headB : pA.next;</span><br><span class="line">            pB = pB == <span class="literal">null</span> ? headA : pB.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"><a href="#Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨" class="headerlink" title="Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"></a>Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</h2><p>æ€è·¯ï¼šæ¯kä¸ªç¿»è½¬ä¸€æ¬¡ï¼Œå¯ä»¥å•ç‹¬è¿›è¡Œåè½¬ï¼Œä½†æ³¨æ„ä¸Šä¸€ç»„çš„å°¾èŠ‚ç‚¹å’Œä¸‹ä¸€ç»„çš„å¤´èŠ‚ç‚¹è¦è¿æ¥èµ·æ¥ï¼Œæ‰€ä»¥éœ€è¦è®°å½•ä¸Šä¸€ç»„å°¾èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">start</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">end</span> <span class="operator">=</span> teamEnd(start, k);</span><br><span class="line"><span class="keyword">if</span> (end == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç»„å¾ˆç‰¹æ®Šå› ä¸ºç‰µæ‰¯åˆ°æ¢å¤´çš„é—®é¢˜</span></span><br><span class="line">head = end;</span><br><span class="line">reverse(start, end);</span><br><span class="line"><span class="comment">// ç¿»è½¬ä¹‹åstartå˜æˆäº†ä¸Šä¸€ç»„çš„ç»“å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">ListNode</span> <span class="variable">lastTeamEnd</span> <span class="operator">=</span> start;</span><br><span class="line"><span class="keyword">while</span> (lastTeamEnd.next != <span class="literal">null</span>) &#123;</span><br><span class="line">start = lastTeamEnd.next;</span><br><span class="line">end = teamEnd(start, k);</span><br><span class="line"><span class="keyword">if</span> (end == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line">reverse(start, end);</span><br><span class="line">lastTeamEnd.next = end; <span class="comment">// ä¸Šä¸€ç»„ç»“å°¾èŠ‚ç‚¹è¦è¿æ¥ä¸‹ä¸€ç»„å¤´èŠ‚ç‚¹</span></span><br><span class="line">lastTeamEnd = start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„çš„å¼€å§‹èŠ‚ç‚¹æ˜¯sï¼Œå¾€ä¸‹æ•°kä¸ªæ‰¾åˆ°å½“å‰ç»„çš„ç»“æŸèŠ‚ç‚¹è¿”å›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">teamEnd</span><span class="params">(ListNode s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (--k != <span class="number">0</span> &amp;&amp; s != <span class="literal">null</span>) &#123;</span><br><span class="line">s = s.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// s -&gt; a -&gt; b -&gt; c -&gt; e -&gt; ä¸‹ä¸€ç»„çš„å¼€å§‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// ä¸Šé¢çš„é“¾è¡¨é€šè¿‡å¦‚ä¸‹çš„reverseæ–¹æ³•è°ƒæ•´æˆ : e -&gt; c -&gt; b -&gt; a -&gt; s -&gt; ä¸‹ä¸€ç»„çš„å¼€å§‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(ListNode s, ListNode e)</span> &#123;</span><br><span class="line">e = e.next;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>, cur = s, next = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">while</span> (cur != e) &#123;</span><br><span class="line">next = cur.next;</span><br><span class="line">cur.next = pre;</span><br><span class="line">pre = cur;</span><br><span class="line">cur = next;</span><br><span class="line">&#125;</span><br><span class="line">s.next = e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éšæœºé“¾è¡¨çš„å¤åˆ¶"><a href="#éšæœºé“¾è¡¨çš„å¤åˆ¶" class="headerlink" title="éšæœºé“¾è¡¨çš„å¤åˆ¶"></a>éšæœºé“¾è¡¨çš„å¤åˆ¶</h2><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ random ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚</p><p>æ€è·¯ï¼šå°†æ¯ä¸ªèŠ‚ç‚¹å¤åˆ¶ä¸€ä»½ï¼Œå¹¶æŠŠå¤åˆ¶çš„èŠ‚ç‚¹æ”¾åœ¨åŸèŠ‚ç‚¹åé¢ï¼Œæ¯”å¦‚1-&gt;2-&gt;3-&gt;4-&gt;5ï¼Œå¤åˆ¶ä¹‹åå˜æˆ1-&gt;1â€™-&gt;2-&gt;2â€™-&gt;3-&gt;3â€™-&gt;4-&gt;4â€™-&gt;5-&gt;5â€™ï¼Œç„¶åéå†é“¾è¡¨ï¼Œå°†å¤åˆ¶çš„èŠ‚ç‚¹çš„randomæŒ‡é’ˆæŒ‡å‘åŸèŠ‚ç‚¹çš„randomæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ€åå°†é“¾è¡¨æ‹†åˆ†ï¼Œè¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">copyRandomList</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">pre</span> <span class="operator">=</span>head;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†é“¾è¡¨å¤åˆ¶ä¸²è”</span></span><br><span class="line">    <span class="keyword">while</span>(pre != <span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next;</span><br><span class="line">        pre.next = <span class="keyword">new</span> <span class="title class_">Node</span>(pre.val);</span><br><span class="line">        pre.next.next = next;</span><br><span class="line">        pre = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†randomè¿›è¡Œå¤åˆ¶</span></span><br><span class="line">    pre = head;</span><br><span class="line">    <span class="keyword">while</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next.next;</span><br><span class="line">        pre.next.random = pre.random == <span class="literal">null</span> ? <span class="literal">null</span> : pre.random.next;</span><br><span class="line">        pre = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ†ç¦»ä¸¤ä¸ªé“¾è¡¨</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">newHead</span> <span class="operator">=</span> head.next;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">newPre</span> <span class="operator">=</span> newHead;</span><br><span class="line">    pre =head;</span><br><span class="line">    <span class="keyword">while</span>(pre != <span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next.next;</span><br><span class="line">        newPre.next = next == <span class="literal">null</span> ? <span class="literal">null</span> : next.next ;</span><br><span class="line">        pre.next = next;</span><br><span class="line">        pre =next;</span><br><span class="line">        newPre = newPre.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­å›æ–‡é“¾è¡¨"><a href="#åˆ¤æ–­å›æ–‡é“¾è¡¨" class="headerlink" title="åˆ¤æ–­å›æ–‡é“¾è¡¨"></a>åˆ¤æ–­å›æ–‡é“¾è¡¨</h2><p>æ€è·¯ï¼šåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œæ‰¾åˆ°ä¸­ç‚¹ï¼Œç„¶åç¿»è½¬ååŠéƒ¨åˆ†é“¾è¡¨ï¼Œæ¯”è¾ƒå‰åä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ç›¸ç­‰ã€‚æœ€åæ¢å¤é“¾è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(head.next==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//åˆ©ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­ç‚¹</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">man</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">kuai</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span> (kuai.next != <span class="literal">null</span> &amp;&amp; kuai.next.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        man = man.next;</span><br><span class="line">        kuai = kuai.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">reverseHead</span> <span class="operator">=</span> reverseList(man);</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">isPal</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">reversePre</span> <span class="operator">=</span>reverseHead;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span>(reversePre!=<span class="literal">null</span> &amp;&amp; pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(pre.val!=reversePre.val)&#123;</span><br><span class="line">            isPal = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        reversePre = reversePre.next;</span><br><span class="line">        pre = pre.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é“¾è¡¨è¿˜åŸ</span></span><br><span class="line">    reverseList(reverseHead);</span><br><span class="line">    <span class="keyword">return</span> isPal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span>&#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>,next=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">        next =head.next;</span><br><span class="line">        head.next = pre;</span><br><span class="line">        pre =head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯-å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹"><a href="#é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯-å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹" class="headerlink" title="é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹"></a>é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹</h2><p>æ€è·¯ï¼šåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå¿«æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œå¦‚æœå¿«æ…¢æŒ‡é’ˆç›¸é‡ï¼Œåˆ™è¯´æ˜é“¾è¡¨æœ‰ç¯ï¼Œå¦åˆ™æ²¡æœ‰ç¯ã€‚ç›¸é‡çš„æ—¶å€™ï¼Œå¿«æŒ‡é’ˆå›åˆ°å¤´èŠ‚ç‚¹ï¼Œæ…¢æŒ‡é’ˆç»§ç»­ç§»åŠ¨ï¼Œä½†æ˜¯æ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆæ¯æ¬¡éƒ½ç§»åŠ¨ä¸€æ­¥ï¼Œå†æ¬¡ç›¸é‡çš„æ—¶å€™å°±æ˜¯ç¯çš„å…¥å£èŠ‚ç‚¹ã€‚ a+(nb+c) = 2(a+c)  a = nb - c  æ‰€ä»¥æ…¢æŒ‡é’ˆå†èµ°aæ­¥ï¼Œå°±èƒ½åˆ°è¾¾å…¥å£èŠ‚ç‚¹ã€‚æ­¤æ—¶å¿«æŒ‡é’ˆä¹Ÿèµ°aæ­¥ï¼Œæ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆç›¸é‡çš„èŠ‚ç‚¹å°±æ˜¯å…¥å£èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span>head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="literal">null</span> &amp;&amp; fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        <span class="keyword">if</span>(fast==slow)&#123;</span><br><span class="line">            fast = head;</span><br><span class="line">            <span class="keyword">while</span>(fast!=slow)&#123;</span><br><span class="line">                fast = fast.next;</span><br><span class="line">                slow = slow.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> slow;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ’åºé“¾è¡¨"><a href="#æ’åºé“¾è¡¨" class="headerlink" title="æ’åºé“¾è¡¨"></a>æ’åºé“¾è¡¨</h2><p>è¦æ±‚ï¼šæ—¶é—´å¤æ‚åº¦nlog(n),ç©ºé—´å¤æ‚åº¦O(1)ï¼Œä¸”ç¨³å®š<br>æ€è·¯ï¼šåˆ©ç”¨éé€’å½’ç‰ˆæœ¬çš„å½’å¹¶æ’åºï¼Œå¹¶ä¸”mergeæ˜¯åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ã€‚<br>ä»£ç å¾ˆå¤æ‚ï¼Œçœ‹çœ‹å°±å¥½<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// æ—¶é—´å¤æ‚åº¦O(n*logn)ï¼Œé¢å¤–ç©ºé—´å¤æ‚åº¦O(1)ï¼Œæœ‰ç¨³å®šæ€§</span></span><br><span class="line"><span class="comment">// æ³¨æ„ä¸ºäº†é¢å¤–ç©ºé—´å¤æ‚åº¦O(1)ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨é€’å½’</span></span><br><span class="line"><span class="comment">// å› ä¸ºmergeSorté€’å½’éœ€è¦O(log n)çš„é¢å¤–ç©ºé—´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">sortList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">n++;</span><br><span class="line">cur = cur.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// l1...r1 æ¯ç»„çš„å·¦éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// l2...r2 æ¯ç»„çš„å³éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// next ä¸‹ä¸€ç»„çš„å¼€å¤´</span></span><br><span class="line"><span class="comment">// lastTeamEnd ä¸Šä¸€ç»„çš„ç»“å°¾</span></span><br><span class="line">ListNode l1, r1, l2, r2, next, lastTeamEnd;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">step</span> <span class="operator">=</span> <span class="number">1</span>; step &lt; n; step &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç»„å¾ˆç‰¹æ®Šï¼Œå› ä¸ºè¦å†³å®šæ•´ä¸ªé“¾è¡¨çš„å¤´ï¼Œæ‰€ä»¥å•ç‹¬å¤„ç†</span></span><br><span class="line">l1 = head;</span><br><span class="line">r1 = findEnd(l1, step);</span><br><span class="line">l2 = r1.next;</span><br><span class="line">r2 = findEnd(l2, step);</span><br><span class="line">next = r2.next;</span><br><span class="line">r1.next = <span class="literal">null</span>;</span><br><span class="line">r2.next = <span class="literal">null</span>;</span><br><span class="line">merge(l1, r1, l2, r2);</span><br><span class="line">head = start;</span><br><span class="line">lastTeamEnd = end;</span><br><span class="line"><span class="keyword">while</span> (next != <span class="literal">null</span>) &#123;</span><br><span class="line">l1 = next;</span><br><span class="line">r1 = findEnd(l1, step);</span><br><span class="line">l2 = r1.next;</span><br><span class="line"><span class="keyword">if</span> (l2 == <span class="literal">null</span>) &#123;</span><br><span class="line">lastTeamEnd.next = l1;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">r2 = findEnd(l2, step);</span><br><span class="line">next = r2.next;</span><br><span class="line">r1.next = <span class="literal">null</span>;</span><br><span class="line">r2.next = <span class="literal">null</span>;</span><br><span class="line">merge(l1, r1, l2, r2);</span><br><span class="line">lastTeamEnd.next = start;</span><br><span class="line">lastTeamEnd = end;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ…æ‹¬såœ¨å†…ï¼Œå¾€ä¸‹æ•°kä¸ªèŠ‚ç‚¹è¿”å›</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸å¤Ÿï¼Œè¿”å›æœ€åä¸€ä¸ªæ•°åˆ°çš„éç©ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">findEnd</span><span class="params">(ListNode s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (s.next != <span class="literal">null</span> &amp;&amp; --k != <span class="number">0</span>) &#123;</span><br><span class="line">s = s.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode start;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode end;</span><br><span class="line"></span><br><span class="line"><span class="comment">// l1...r1 -&gt; null : æœ‰åºçš„å·¦éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// l2...r2 -&gt; null : æœ‰åºçš„å³éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// æ•´ä½“mergeåœ¨ä¸€èµ·ï¼Œä¿è¯æœ‰åº</span></span><br><span class="line"><span class="comment">// å¹¶ä¸”æŠŠå…¨å±€å˜é‡startè®¾ç½®ä¸ºæ•´ä½“çš„å¤´ï¼Œå…¨å±€å˜é‡endè®¾ç½®ä¸ºæ•´ä½“çš„å°¾</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(ListNode l1, ListNode r1, ListNode l2, ListNode r2)</span> &#123;</span><br><span class="line">ListNode pre;</span><br><span class="line"><span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">start = l1;</span><br><span class="line">pre = l1;</span><br><span class="line">l1 = l1.next;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">start = l2;</span><br><span class="line">pre = l2;</span><br><span class="line">l2 = l2.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (l1 != <span class="literal">null</span> &amp;&amp; l2 != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">pre.next = l1;</span><br><span class="line">pre = l1;</span><br><span class="line">l1 = l1.next;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre.next = l2;</span><br><span class="line">pre = l2;</span><br><span class="line">l2 = l2.next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">pre.next = l1;</span><br><span class="line">end = r1;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre.next = l2;</span><br><span class="line">end = r2;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å®ç°LRUç¼“å­˜"><a href="#å®ç°LRUç¼“å­˜" class="headerlink" title="å®ç°LRUç¼“å­˜"></a>å®ç°LRUç¼“å­˜</h2><p>æ€è·¯ï¼šåˆ©ç”¨åŒå‘é“¾è¡¨å’ŒHashMapï¼ŒåŒå‘é“¾è¡¨è´Ÿè´£ç»´æŠ¤æœ€ä¹…æœªä½¿ç”¨çš„é¡ºåºï¼ˆæœ€ä¹…æœªä½¿ç”¨æ”¾åˆ°å¤´èŠ‚ç‚¹ï¼Œåªè¦ä½¿ç”¨å°±æ”¾åˆ°å°¾èŠ‚ç‚¹ï¼‰ï¼ˆå®ç°ä¸‰ä¸ªåŠŸèƒ½ 1.åŠ å…¥èŠ‚ç‚¹(ç›´æ¥æ”¾å…¥å°¾éƒ¨)ï¼Œ2.å°†å·²ç»æœ‰çš„èŠ‚ç‚¹æ”¾å…¥å°¾éƒ¨ï¼Œ3.åˆ é™¤å¤´èŠ‚ç‚¹ï¼‰ï¼ŒHashMapå®ç°å¿«é€ŸæŸ¥æ‰¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Listnode</span>&#123;</span><br><span class="line">            <span class="type">int</span> val;</span><br><span class="line">            <span class="type">int</span> key;</span><br><span class="line">            Listnode last;</span><br><span class="line">            Listnode next;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">Listnode</span><span class="params">(<span class="type">int</span> val,<span class="type">int</span> key)</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.val =val;</span><br><span class="line">                <span class="built_in">this</span>.key =key;</span><br><span class="line">                last =<span class="literal">null</span>;</span><br><span class="line">                next =<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">doubleList</span>&#123;</span><br><span class="line">            Listnode head;</span><br><span class="line">            Listnode tail;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">doubleList</span><span class="params">()</span>&#123;</span><br><span class="line">                head =<span class="literal">null</span>;</span><br><span class="line">                tail =<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNode</span><span class="params">(Listnode node)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(head == <span class="literal">null</span>)&#123;</span><br><span class="line">                    head = node;</span><br><span class="line">                    tail = node;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    tail.next = node;</span><br><span class="line">                    node.last = tail;</span><br><span class="line">                    tail = node;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveNode2Tail</span><span class="params">(Listnode node)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (tail == node) &#123;  <span class="comment">/// å¦‚æœæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ä¸éœ€è¦ç§»åŠ¨</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node == head)&#123;</span><br><span class="line">                    head = node.next;</span><br><span class="line">                    head.last =<span class="literal">null</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    node.last.next = node.next;</span><br><span class="line">                    node.next.last = node.last;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                tail.next = node;</span><br><span class="line">                node.last = tail;</span><br><span class="line">                node.next = <span class="literal">null</span>;</span><br><span class="line">                tail =node;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> Listnode <span class="title function_">delHead</span><span class="params">()</span>&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">h</span> <span class="operator">=</span>head;</span><br><span class="line">                <span class="keyword">if</span>(head == tail)&#123;</span><br><span class="line">                    head = <span class="literal">null</span>;</span><br><span class="line">                    tail =<span class="literal">null</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Listnode</span> <span class="variable">next</span> <span class="operator">=</span>head.next;</span><br><span class="line">                    head.next = <span class="literal">null</span>;</span><br><span class="line">                    head = next;</span><br><span class="line">                    head.last = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> h;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> HashMap&lt;Integer,Listnode&gt; myMap;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span>  <span class="type">int</span> <span class="variable">MaxCap</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span> doubleList myList;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cap = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">this</span>.MaxCap = capacity;</span><br><span class="line">            myMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer,Listnode&gt;();</span><br><span class="line">            myList = <span class="keyword">new</span> <span class="title class_">doubleList</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(myMap.containsKey(key))&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> myMap.get(key);</span><br><span class="line">                myList.moveNode2Tail(node);</span><br><span class="line">                <span class="keyword">return</span> node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(myMap.containsKey(key))&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> myMap.get(key);</span><br><span class="line">                node.val = value;</span><br><span class="line">                myList.moveNode2Tail(node);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(cap == MaxCap)&#123;</span><br><span class="line">                    myMap.remove(myList.delHead().key);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    cap++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Listnode</span>(value,key);</span><br><span class="line">                myMap.put(key,node);</span><br><span class="line">                myList.addNode(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;p&gt;è¿™é‡Œç”¨æ¥è®°å½•é“¾è¡¨ç›¸å…³çš„é¢˜ç›®ä»¥åŠæ€è·¯&lt;/p&gt;
&lt;h2 id=&quot;ç›¸äº¤é“¾è¡¨&quot;&gt;&lt;a href=&quot;#ç›¸äº¤é“¾è¡¨</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³çš„æ€»ç»“</title>
    <link href="https://nmcb666.vip/posts/fee9ca7b.html"/>
    <id>https://nmcb666.vip/posts/fee9ca7b.html</id>
    <published>2026-01-15T14:13:30.000Z</published>
    <updated>2026-01-31T14:36:26.048Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><h3 id="TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ"><a href="#TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ" class="headerlink" title="TC å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ"></a>TC å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ</h3><p>ä»¥Seateæ¡†æ¶ä¸ºä¾‹ï¼Œåœ¨TMå‘TCå‘é€å…¨å±€äº‹åŠ¡å¼€å§‹æ—¶ï¼ŒTCä¼šç”Ÿæˆå¯¹åº”çš„å…¨å±€äº‹åŠ¡IDï¼ˆXIDï¼‰ï¼Œå¹¶å‘é€ç»™TMã€‚TM å°† XID æ”¾å…¥å½“å‰çº¿ç¨‹çš„ ThreadLocal ä¸­ï¼Œåç»­çš„ RM (èµ„æºç®¡ç†å™¨) åˆ†æ”¯äº‹åŠ¡é€šè¿‡è§£æè¯¥ XID æ¥æ³¨å†Œåˆ†æ”¯ã€‚å¦‚æœæ¶‰åŠRPCè°ƒç”¨ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ä¼šåœ¨è¯·æ±‚å¤´éƒ¨ä¼ é€’è¿™ä¸ªXIDï¼Œè®©RMçŸ¥é“è¿™ä¸ªXID,RMå‘TCå‘é€åˆ†æ”¯äº‹åŠ¡å¼€å§‹æ—¶,å°±ä¼šæºå¸¦è¿™ä¸ªXID,ä»è€Œå‘Šè¯‰TCè¿™ä¸ªRMå±äºå“ªä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</p><p>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹çš„XIDæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥æ— æ³•ç¡®å®šå“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚è¿™æ—¶å…¨å±€äº‹åŠ¡ä¼šå¤±æ•ˆã€‚è§£å†³æ–¹æ¡ˆå¯ä»¥æ˜¯åœ¨å¼€å¯æ–°çº¿ç¨‹æ—¶ï¼Œå°†XIDä¼ é€’ç»™æ–°çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹çš„XIDä¼šç»§æ‰¿çˆ¶çº¿ç¨‹çš„XIDã€‚è¿™æ ·å­çº¿ç¨‹çš„XIDå°±ä¼šå’Œçˆ¶çº¿ç¨‹çš„XIDä¸€è‡´ï¼Œä»è€Œå¯ä»¥ç¡®å®šå“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-15%20142842.png" alt="æµç¨‹å›¾ç‰‡"/></div><span class="image-caption">æµç¨‹å›¾ç‰‡</span></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#åˆ†å¸ƒå¼äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;/a&gt;åˆ†å¸ƒå¼äº‹åŠ¡&lt;/h2&gt;&lt;h3 id=&quot;TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ&quot;&gt;&lt;a href=&quot;#TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡</summary>
      
    
    
    
    
    <category term="å…«è‚¡" scheme="https://nmcb666.vip/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
  <entry>
    <title>DDDä¸MVCçš„ç»Ÿä¸€</title>
    <link href="https://nmcb666.vip/posts/f4b47790.html"/>
    <id>https://nmcb666.vip/posts/f4b47790.html</id>
    <published>2026-01-11T18:50:35.000Z</published>
    <updated>2026-01-31T14:36:26.045Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ"><a href="#MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ" class="headerlink" title="MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ"></a>MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ</h1><p>åœ¨åç«¯å¼€å‘å­¦ä¹ å’Œå®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šè¢«å„ç§æ¶æ„æ¨¡å¼å’Œè®¾è®¡æ€æƒ³å›´ç»•â€”â€”MVCã€Service+DAOåˆ†å±‚ã€DDDå››å±‚æ¶æ„ï¼ˆDDDå¹¶éä¸å››å±‚æ¶æ„ç»‘å®š DDDæ˜¯æ€æƒ³ï¼Œå››å±‚æ¶æ„æ˜¯ä»£ç è½åœ°çš„ä¸€ä¸ªæ¶æ„ï¼‰â€¦â€¦è¿™äº›æ¦‚å¿µä¹‹é—´åˆ°åº•æ˜¯æ›¿ä»£å…³ç³»è¿˜æ˜¯äº’è¡¥å…³ç³»ï¼Ÿä¸ºä»€ä¹ˆç®€å•ä¸šåŠ¡ç”¨Service+DAOå°±å¤Ÿï¼Œå¤æ‚ä¸šåŠ¡å´è¦å¼•å…¥DDDï¼Ÿç»“åˆè¿‘æœŸçš„å­¦ä¹ æ€è€ƒï¼Œæˆ‘æƒ³æ¢³ç†æ¸…æ¥šè¿™äº›æ¶æ„ä¹‹é—´çš„æ ¸å¿ƒå…³è”ï¼Œå¸®è‡ªå·±ï¼ˆä¹Ÿå¸Œæœ›å¸®åˆ°åŒæ ·å›°æƒ‘çš„åŒå­¦ï¼‰å»ºç«‹æ¸…æ™°çš„è®¤çŸ¥ã€‚</p><h2 id="ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜"><a href="#ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜" class="headerlink" title="ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜"></a>ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜</h2><p>æœ€æ—©æ¥è§¦åç«¯å¼€å‘æ—¶ï¼ŒMVCæ˜¯ç»•ä¸å¼€çš„å…¥é—¨æ¶æ„ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼šå°†è½¯ä»¶åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒå±‚çº§ï¼Œå®ç°â€œå±•ç¤ºä¸é€»è¾‘â€çš„åˆæ­¥è§£è€¦ã€‚</p><ul><li><p><strong>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰</strong>ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ã€åè°ƒåç»­å¤„ç†ã€è¿”å›å“åº”ï¼Œç›¸å½“äºç³»ç»Ÿçš„â€œå…¥å£/å‡ºå£â€ï¼Œä¸æ‰¿è½½æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼›</p></li><li><p><strong>Modelï¼ˆæ¨¡å‹ï¼‰</strong>ï¼šå°è£…æ•°æ®å’Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ˜¯ç³»ç»Ÿçš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£æ•°æ®çš„å¢åˆ æ”¹æŸ¥å’Œä¸šåŠ¡è§„åˆ™æ ¡éªŒï¼›</p></li><li><p><strong>Viewï¼ˆè§†å›¾ï¼‰</strong>ï¼šå±•ç¤ºæ•°æ®ï¼Œä¸ç”¨æˆ·ç›´æ¥äº¤äº’ï¼ˆå‰åç«¯åˆ†ç¦»åœºæ™¯ä¸‹ï¼Œå‰ç«¯é¡µé¢å³Viewå±‚ï¼Œåç«¯ä¸å†å…³æ³¨ï¼‰ã€‚</p></li></ul><p>MVCçš„ä»·å€¼åœ¨äºç»™å‡ºäº†â€œä»£ç è¯¥æ”¾å“ªâ€çš„æ˜ç¡®ç­”æ¡ˆï¼Œè§£å†³äº†æ—©æœŸå¼€å‘ä¸­â€œä¸šåŠ¡é€»è¾‘ä¸é¡µé¢å±•ç¤ºæ··åœ¨ä¸€èµ·â€çš„æ··ä¹±é—®é¢˜ã€‚ä½†å®ƒçš„å±€é™æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼šModelå±‚æ˜¯ä¸€ä¸ªâ€œå¤§é»‘ç›’â€ï¼Œæ²¡æœ‰æ˜ç¡®çš„å†…éƒ¨åˆ’åˆ†æ ‡å‡†â€”â€”å½“ä¸šåŠ¡ç®€å•æ—¶ï¼Œä¸€ä¸ªService+Mapperå°±èƒ½æ’‘èµ·Modelå±‚ï¼›ä½†å½“ä¸šåŠ¡å¤æ‚ï¼ˆæ¯”å¦‚ç”µå•†è®¢å•å±¥çº¦ã€é‡‘èé£æ§ï¼‰æ—¶ï¼Œç›´æ¥æŠŠæ‰€æœ‰é€»è¾‘å †åœ¨Serviceé‡Œï¼Œå¾ˆå¿«å°±ä¼šå¯¼è‡´ä»£ç è‡ƒè‚¿ã€é€»è¾‘æ··ä¹±ã€éš¾ä»¥ç»´æŠ¤ã€‚</p><h2 id="äºŒã€æ¼”è¿›ï¼šService-DAOåˆ†å±‚â€”â€”MVC-Modelå±‚çš„ç®€æ˜“æ‹†åˆ†"><a href="#äºŒã€æ¼”è¿›ï¼šService-DAOåˆ†å±‚â€”â€”MVC-Modelå±‚çš„ç®€æ˜“æ‹†åˆ†" class="headerlink" title="äºŒã€æ¼”è¿›ï¼šService+DAOåˆ†å±‚â€”â€”MVC Modelå±‚çš„ç®€æ˜“æ‹†åˆ†"></a>äºŒã€æ¼”è¿›ï¼šService+DAOåˆ†å±‚â€”â€”MVC Modelå±‚çš„ç®€æ˜“æ‹†åˆ†</h2><p>ä¸ºäº†å¼¥è¡¥MVC Modelå±‚çš„æ¨¡ç³Šæ€§ï¼Œåœ¨Springç”Ÿæ€å®è·µä¸­ï¼Œæˆ‘ä»¬è‡ªç„¶æ¼”åŒ–å‡ºäº†â€œController+Service+DAOï¼ˆMapperï¼‰â€çš„ä¸‰å±‚è½åœ°æ–¹æ¡ˆã€‚è¿™æœ¬è´¨ä¸Šæ˜¯å¯¹MVCçš„Modelå±‚åšäº†ç¬¬ä¸€æ¬¡â€œç²—ç²’åº¦æ‹†åˆ†â€ï¼Œè®©èŒè´£æ›´æ¸…æ™°ï¼š</p><ul><li><p><strong>Controllerå±‚</strong>ï¼šå®Œå…¨å¯¹åº”MVCçš„Controllerå±‚ï¼Œè´Ÿè´£è¯·æ±‚æ¥æ”¶ã€å‚æ•°ç®€å•æ ¡éªŒã€è°ƒç”¨Serviceå±‚ï¼›</p></li><li><p><strong>Serviceå±‚</strong>ï¼šå¯¹åº”MVC Modelå±‚çš„â€œä¸šåŠ¡é€»è¾‘æ ¸å¿ƒâ€ï¼Œå®ç°è®¢å•æ”¯ä»˜ã€åº“å­˜æ‰£å‡ç­‰æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ï¼›</p></li><li><p><strong>DAOï¼ˆMapperï¼‰å±‚</strong>ï¼šå¯¹åº”MVC Modelå±‚çš„â€œæ•°æ®è®¿é—®éƒ¨åˆ†â€ï¼Œä»…è´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ï¼Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚</p></li></ul><p>è¿™ç§æ‹†åˆ†æ–¹æ¡ˆç®€å•ç›´è§‚ã€å¼€å‘æ•ˆç‡é«˜ï¼Œéå¸¸é€‚åˆç®€å•CRUDåœºæ™¯ï¼ˆæ¯”å¦‚å°å‹ç®¡ç†åå°ã€ä¸ªäººå·¥å…·ï¼‰ã€‚ä½†å®ƒçš„é—®é¢˜åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹ä¼šæš´éœ²æ— é—ï¼šServiceå±‚å¾ˆå®¹æ˜“å˜æˆâ€œä¸‡èƒ½å±‚â€â€”â€”æ—¢è¦å¤„ç†è·¨å®ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼ˆæ¯”å¦‚æ”¯ä»˜éœ€è¦åè°ƒè®¢å•ã€åº“å­˜ã€æ”¯ä»˜ä¸‰ä¸ªæ¨¡å—ï¼‰ï¼Œåˆè¦å…¼é¡¾äº‹åŠ¡æ§åˆ¶ã€æ•°æ®ç»„è£…ç­‰è¾…åŠ©é€»è¾‘ï¼Œæœ€ç»ˆå¯¼è‡´Serviceå±‚ä»£ç è‡ƒè‚¿ã€é€»è¾‘ç¼ ç»•ï¼Œåç»­è¿­ä»£å’Œç»´æŠ¤æˆæœ¬æé«˜ã€‚</p><h2 id="ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC-Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§"><a href="#ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC-Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§" class="headerlink" title="ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§"></a>ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§</h2><p>å½“ä¸šåŠ¡å¤æ‚åº¦ä¸Šå‡åˆ°ä¸€å®šç¨‹åº¦ï¼ŒDDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰å°±æˆäº†æ›´ä¼˜çš„é€‰æ‹©ã€‚å¾ˆå¤šäººä¼šè¯¯ä»¥ä¸ºDDDæ˜¯â€œæ›¿ä»£MVCâ€çš„æ¶æ„ï¼Œå…¶å®ä¸ç„¶â€”â€”DDDæœ¬è´¨ä¸Šæ˜¯ä¸€å¥—â€œä¸šåŠ¡å»ºæ¨¡æ–¹æ³•è®ºâ€ï¼Œå®ƒåœ¨MVCçš„å¤§æ¡†æ¶ä¸‹ï¼Œå¯¹Modelå±‚åšäº†æ›´ç²¾ç»†çš„æ‹†åˆ†ï¼Œè®©å¤æ‚ä¸šåŠ¡é€»è¾‘æ›´æ¸…æ™°ã€æ›´è´´åˆä¸šåŠ¡æœ¬èº«ã€‚</p><p>DDDæå‡ºçš„å››å±‚æ¶æ„ï¼ˆç”¨æˆ·å±‚/æ¥å£å±‚ã€åº”ç”¨å±‚ã€é¢†åŸŸå±‚ã€åŸºç¡€è®¾æ–½å±‚ï¼‰ï¼Œä¸MVCã€Service+DAOåˆ†å±‚çš„å¯¹åº”å…³ç³»éå¸¸æ¸…æ™°ï¼Œæ ¸å¿ƒç»“è®ºå…ˆæŠ›å‡ºæ¥ï¼š<strong>DDDçš„ç”¨æˆ·å±‚å¯¹åº”MVCçš„Controllerå±‚ï¼Œåä¸‰å±‚å…±åŒæ„æˆMVCçš„Modelå±‚ï¼›DDDä¸MVCå®Œå…¨å…¼å®¹ï¼Œåªæ˜¯å¯¹Modelå±‚çš„æ‹†åˆ†æ›´å½»åº•</strong>ã€‚</p><h3 id="1-DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»"><a href="#1-DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»" class="headerlink" title="1. DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»"></a>1. DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»</h3><div class="table-container"><table><thead><tr><th>DDDå››å±‚æ¶æ„</th><th>æ ¸å¿ƒèŒè´£</th><th>å¯¹åº”MVCåˆ†å±‚</th><th>å¯¹åº”Service+DAOåˆ†å±‚</th><th>Springå®è·µè½åœ°</th></tr></thead><tbody><tr><td>ç”¨æˆ·å±‚ï¼ˆæ¥å£å±‚ï¼‰</td><td>æ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼ˆHTTP/RPC/æ¶ˆæ¯ï¼‰ã€è¿”å›å“åº”ã€å‚æ•°éä¸šåŠ¡æ ¡éªŒã€æƒé™æ‹¦æˆª</td><td>Controllerå±‚</td><td>Controllerå±‚</td><td>@RestControllerã€ControllerAdviceã€RPCæ¥å£</td></tr><tr><td>åº”ç”¨å±‚</td><td>åè°ƒé¢†åŸŸå±‚æ‰§è¡Œã€å¤„ç†äº‹åŠ¡ã€ç»„è£…è¿”å›æ•°æ®ï¼Œæ— æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</td><td>Modelå±‚</td><td>Serviceå±‚çš„â€œåè°ƒéƒ¨åˆ†â€</td><td>XXXApplicationServiceï¼ˆåº”ç”¨æœåŠ¡ï¼‰</td></tr><tr><td>é¢†åŸŸå±‚</td><td>å°è£…æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€èšåˆæ ¹/å®ä½“/å€¼å¯¹è±¡ã€è·¨å®ä½“ä¸šåŠ¡é€»è¾‘ï¼Œç³»ç»Ÿæ ¸å¿ƒ</td><td>Modelå±‚ï¼ˆæ ¸å¿ƒï¼‰</td><td>Serviceå±‚çš„â€œæ ¸å¿ƒä¸šåŠ¡éƒ¨åˆ†â€</td><td>èšåˆæ ¹ï¼ˆEntityï¼‰ã€XXXDomainServiceï¼ˆé¢†åŸŸæœåŠ¡ï¼‰</td></tr><tr><td>åŸºç¡€è®¾æ–½å±‚</td><td>å°è£…æŠ€æœ¯ç»†èŠ‚ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€ç¬¬ä¸‰æ–¹æ¥å£ï¼‰ï¼Œä¸ºä¸Šå±‚æä¾›æŠ€æœ¯æ”¯æ’‘</td><td>Modelå±‚</td><td>DAOï¼ˆMapperï¼‰å±‚</td><td>Repositoryã€Mapperã€RedisTemplateã€Feignå®¢æˆ·ç«¯</td></tr></tbody></table></div><h3 id="2-å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡-é¢†åŸŸæœåŠ¡â€"><a href="#2-å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡-é¢†åŸŸæœåŠ¡â€" class="headerlink" title="2. å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡+é¢†åŸŸæœåŠ¡â€"></a>2. å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡+é¢†åŸŸæœåŠ¡â€</h3><p>DDDå¯¹Service+DAOåˆ†å±‚çš„æ ¸å¿ƒä¼˜åŒ–ï¼Œå°±æ˜¯æŠŠä¼ ç»Ÿâ€œåšServiceâ€æ‹†æˆäº†â€œè–„åº”ç”¨æœåŠ¡â€å’Œâ€œåšé¢†åŸŸæœåŠ¡â€ï¼Œè®©ä¸šåŠ¡é€»è¾‘çš„å½’å±æ›´æ˜ç¡®ï¼š</p><ul><li><p><strong>é¢†åŸŸæœåŠ¡</strong>ï¼šåªè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚â€œè®¢å•æ”¯ä»˜â€éœ€è¦æ ¡éªŒè®¢å•çŠ¶æ€ã€æ‰£å‡åº“å­˜ã€æ›´æ–°æ”¯ä»˜çŠ¶æ€ç­‰è·¨å®ä½“é€»è¾‘ï¼Œéƒ½æ”¾åœ¨é¢†åŸŸæœåŠ¡ï¼›</p></li><li><p><strong>åº”ç”¨æœåŠ¡</strong>ï¼šä¸ç¢°æ ¸å¿ƒä¸šåŠ¡ï¼Œåªåšâ€œåè°ƒå·¥ä½œâ€â€”â€”æ¯”å¦‚å¼€å¯äº‹åŠ¡ã€è°ƒç”¨é¢†åŸŸæœåŠ¡ã€æŠŠé¢†åŸŸå±‚çš„ç»“æœç»„è£…æˆå‰ç«¯éœ€è¦çš„æ ¼å¼ã€‚</p></li></ul><p>åŒæ—¶ï¼ŒDDDè¿˜å¼ºè°ƒâ€œä¸šåŠ¡é©±åŠ¨å»ºæ¨¡â€ï¼šå…ˆæ¢³ç†ä¸šåŠ¡é¢†åŸŸçš„è§„åˆ™ï¼ˆæ¯”å¦‚â€œæœªæ”¯ä»˜è®¢å•24å°æ—¶è‡ªåŠ¨å–æ¶ˆâ€ï¼‰ï¼Œå†æŠŠè¿™äº›è§„åˆ™å°è£…åˆ°å®ä½“ç±»ä¸­ï¼ˆæ¯”å¦‚Orderå®ä½“çš„canPay()ã€markAsPaid()æ–¹æ³•ï¼‰ï¼Œè€Œä¸æ˜¯åƒä¼ ç»ŸService+DAOé‚£æ ·ï¼ŒæŠŠæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½å†™åœ¨Serviceçš„if-elseé‡Œã€‚è¿™ç§æ–¹å¼è®©ä»£ç æ›´è´´åˆä¸šåŠ¡ï¼Œåç»­è¿­ä»£æ—¶ä¹Ÿæ›´å®¹æ˜“ç†è§£å’Œä¿®æ”¹ã€‚</p><h2 id="å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ"><a href="#å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ" class="headerlink" title="å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ"></a>å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ</h2><p>æ¢³ç†å®Œä»MVCåˆ°Service+DAOï¼Œå†åˆ°DDDçš„æ¼”è¿›è„‰ç»œï¼Œä¼šå‘ç°ä¸€ä¸ªæ ¸å¿ƒè§„å¾‹ï¼š<strong>æ‰€æœ‰æ¶æ„åˆ†å±‚çš„æœ€ç»ˆç›®æ ‡éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯é’ˆå¯¹ä¸åŒä¸šåŠ¡å¤æ‚åº¦ï¼Œé€‰æ‹©äº†ä¸åŒçš„æ‹†åˆ†ç²’åº¦</strong>ã€‚</p><ul><li><p>MVCï¼šè§£å†³â€œå±•ç¤ºä¸é€»è¾‘â€çš„è§£è€¦ï¼Œç»™å‡ºæœ€åŸºç¡€çš„åˆ†å±‚æ¡†æ¶ï¼›</p></li><li><p>Service+DAOï¼šè§£å†³MVC Modelå±‚çš„å†…éƒ¨è§£è€¦ï¼Œè®©æ•°æ®è®¿é—®å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œé€‚é…ç®€å•ä¸šåŠ¡ï¼›</p></li><li><p>DDDï¼šè§£å†³å¤æ‚ä¸šåŠ¡ä¸‹Modelå±‚çš„æ·±åº¦è§£è€¦ï¼Œè®©æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€åè°ƒé€»è¾‘ã€æŠ€æœ¯ç»†èŠ‚å½»åº•åˆ†ç¦»ï¼Œé€‚é…å¤æ‚ä¸šåŠ¡ã€‚</p></li></ul><p>å¾ˆå¤šäººä¼šè¯¯ä»¥ä¸ºâ€œDDDæ¯”MVCé«˜çº§â€â€œç”¨äº†DDDå°±ä¸èƒ½ç”¨MVCâ€ï¼Œè¿™å…¶å®æ˜¯è¯¯åŒºã€‚DDDå’ŒMVCä¸æ˜¯å¯¹ç«‹å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»â€”â€”MVCæä¾›äº†æ•´ä½“çš„æ¶æ„éª¨æ¶ï¼ŒDDDåˆ™æ˜¯å¯¹è¿™ä¸ªéª¨æ¶ä¸­â€œModelå±‚â€çš„ç²¾ç»†åŒ–è®¾è®¡æŒ‡å—ã€‚</p><h2 id="äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„"><a href="#äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„" class="headerlink" title="äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„"></a>äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„</h2><p>æ¶æ„æ²¡æœ‰â€œæœ€ä¼˜è§£â€ï¼Œåªæœ‰â€œæœ€åˆé€‚â€ã€‚ç»“åˆè‡ªå·±çš„å®è·µç»éªŒï¼Œç»™å‡ºå‡ ç‚¹é€‰æ‹©å»ºè®®ï¼š</p><ol><li><p><strong>ç®€å•CRUDåœºæ™¯ï¼ˆå°å‹ç®¡ç†åå°ã€ä¸ªäººå·¥å…·ï¼‰</strong>ï¼šç›´æ¥ç”¨â€œController+Service+DAOâ€ï¼Œå¼€å‘æ•ˆç‡é«˜ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œæ²¡å¿…è¦è¿‡åº¦è®¾è®¡ï¼›</p></li><li><p><strong>ä¸­ç­‰å¤æ‚åº¦åœºæ™¯ï¼ˆå¸¸è§„ä¸šåŠ¡ç³»ç»Ÿï¼‰</strong>ï¼šå¯ä»¥å€Ÿé‰´DDDçš„æ€æƒ³ï¼Œåœ¨Serviceå±‚å†…éƒ¨åšç®€å•æ‹†åˆ†ï¼ˆæ¯”å¦‚æŠŠæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æŠ½æˆå•ç‹¬çš„æ–¹æ³•æˆ–ç±»ï¼‰ï¼Œé¿å…Serviceå±‚è‡ƒè‚¿ï¼›</p></li><li><p><strong>é«˜å¤æ‚åº¦åœºæ™¯ï¼ˆç”µå•†ã€é‡‘èã€ä¾›åº”é“¾ï¼‰</strong>ï¼šæ¨èä½¿ç”¨DDDå››å±‚æ¶æ„ï¼Œé€šè¿‡é¢†åŸŸå»ºæ¨¡è®©å¤æ‚ä¸šåŠ¡é€»è¾‘æ›´æ¸…æ™°ï¼Œä¸ºé•¿æœŸè¿­ä»£æ‰“ä¸‹åŸºç¡€ï¼›</p></li><li><p><strong>æ¸è¿›å¼æ”¹é€ </strong>ï¼šä¸ç”¨ä¸€å¼€å§‹å°±å…¨ç›˜é‡æ„ä¸ºDDDï¼Œå¯ä»¥ä»â€œæ‹†åˆ†Serviceå±‚â€å¼€å§‹ï¼Œå…ˆæŠŠæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æŠ½æˆé¢†åŸŸæœåŠ¡ï¼Œå†é€æ­¥å®Œå–„åº”ç”¨å±‚å’ŒåŸºç¡€è®¾æ–½å±‚ï¼Œé™ä½æ”¹é€ é£é™©ã€‚</p></li></ol><h2 id="å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ</h2><p>DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æœ¬èº«ä¸å¼ºåˆ¶è§„å®š â€œå››å±‚æ¶æ„â€ã€‚DDD çš„æ ¸å¿ƒåœ¨äºæˆ˜ç•¥è®¾è®¡ï¼ˆé™ç•Œä¸Šä¸‹æ–‡ã€é¢†åŸŸæ¨¡å‹ï¼‰å’Œæˆ˜æœ¯è®¾è®¡ï¼ˆå®ä½“ã€å€¼å¯¹è±¡ã€èšåˆæ ¹ã€é¢†åŸŸæœåŠ¡ã€ä»“å‚¨ç­‰ï¼‰ï¼Œè€Œ â€œå››å±‚æ¶æ„â€ ç¡®å®æ˜¯ä¸ºäº†è®©è¿™äº›æˆ˜æœ¯è®¾è®¡æ¨¡å¼åœ¨ä»£ç å±‚é¢æ›´å¥½è½åœ°è€Œæ€»ç»“å‡ºçš„ä¸€å¥—ç»å…¸å·¥ç¨‹å®è·µã€‚</p><p>åœ¨å®é™…è½åœ° DDD æ—¶ï¼Œä»£ç æ¶æ„çš„é€‰æ‹©ç¡®å®éå¸¸é‡è¦ã€‚è™½ç„¶ DDD æ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸å¼ºæ±‚ç‰¹å®šç›®å½•ç»“æ„ï¼Œä½†ä¸šç•Œå·²ç»æ²‰æ·€å‡ºä¸¤å¥—æœ€ä¸»æµçš„æ¶æ„æ¨¡å¼ï¼š</p><ol><li><strong>ç»å…¸çš„å››å±‚æ¶æ„ï¼ˆLayered Architectureï¼‰</strong> â€”â€” æœ€å®¹æ˜“ç†è§£ï¼Œé€‚åˆèµ·æ­¥ã€‚</li><li><strong>æ•´æ´/å…­è¾¹å½¢æ¶æ„ï¼ˆClean / Hexagonal Architectureï¼‰</strong> â€”â€” ä¾èµ–å€’ç½®æ›´å½»åº•ï¼Œç°ä»£å¾®æœåŠ¡ä¸»æµã€‚</li></ol><p>æ­¤å¤–ï¼Œå›½å†… Java åœˆï¼ˆç‰¹åˆ«æ˜¯é˜¿é‡Œç³»ï¼‰è¿˜å¸¸ç”¨ <strong>COLA æ¶æ„</strong>ã€‚</p><p>ä¸‹é¢è¯¦ç»†æ‹†è§£è¿™å‡ ç§æ¶æ„çš„ä»£ç ç›®å½•ç»“æ„å’Œæ ¸å¿ƒè¦ç‚¹ã€‚</p><hr><h3 id="æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„-Standard-4-Layer"><a href="#æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„-Standard-4-Layer" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„ (Standard 4-Layer)"></a>æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„ (Standard 4-Layer)</h3><p>è¿™æ˜¯æœ€ç¬¦åˆä¸Šæ–‡æ‰€æå‡ºè§‚ç‚¹çš„ç†è§£çš„ç»“æ„ï¼Œç»“æ„æ¸…æ™°ï¼Œé€‚åˆä»ä¸‰å±‚æ¶æ„è½¬å‹è¿‡æ¥çš„å›¢é˜Ÿã€‚</p><h4 id="æ ¸å¿ƒåŸåˆ™"><a href="#æ ¸å¿ƒåŸåˆ™" class="headerlink" title="æ ¸å¿ƒåŸåˆ™"></a>æ ¸å¿ƒåŸåˆ™</h4><p><strong>ä¾èµ–å€’ç½®ï¼ˆDIPï¼‰</strong>ï¼šè™½ç„¶ç‰©ç†ä¸Šæ˜¯å››å±‚ï¼Œä½†åœ¨é€»è¾‘ä¸Šï¼Œ<strong>é¢†åŸŸå±‚ï¼ˆDomainï¼‰å¿…é¡»æ˜¯ç‹¬ç«‹çš„</strong>ã€‚</p><ul><li><strong>é”™è¯¯çš„åšæ³•</strong>ï¼šDomain å±‚ <code>import</code> Infrastructure å±‚çš„ä»£ç ã€‚</li><li><strong>æ­£ç¡®çš„åšæ³•</strong>ï¼šDomain å±‚å®šä¹‰æ¥å£ï¼ˆRepository Interfaceï¼‰ï¼ŒInfrastructure å±‚å»å®ç°å®ƒã€‚</li></ul><h4 id="ç›®å½•ç»“æ„ç¤ºä¾‹"><a href="#ç›®å½•ç»“æ„ç¤ºä¾‹" class="headerlink" title="ç›®å½•ç»“æ„ç¤ºä¾‹"></a>ç›®å½•ç»“æ„ç¤ºä¾‹</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">com.company.project</span><br><span class="line">â”œâ”€â”€ interfaces (ç”¨æˆ·æ¥å£å±‚ / Web)</span><br><span class="line">â”‚   â”œâ”€â”€ controller       // å¤„ç† HTTP è¯·æ±‚</span><br><span class="line">â”‚   â””â”€â”€ dto              // æ•°æ®ä¼ è¾“å¯¹è±¡ (Request/Response)</span><br><span class="line">â”œâ”€â”€ application (åº”ç”¨å±‚)</span><br><span class="line">â”‚   â”œâ”€â”€ service          // åº”ç”¨æœåŠ¡ (æµç¨‹ç¼–æ’)</span><br><span class="line">â”‚   â””â”€â”€ assembler        // DTO ä¸ Entity çš„è½¬æ¢å™¨</span><br><span class="line">â”œâ”€â”€ domain (é¢†åŸŸå±‚ - æ ¸å¿ƒ)</span><br><span class="line">â”‚   â”œâ”€â”€ model            // èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ aggregate    // èšåˆ</span><br><span class="line">â”‚   â”‚   â””â”€â”€ entity       // å®ä½“</span><br><span class="line">â”‚   â”œâ”€â”€ service          // é¢†åŸŸæœåŠ¡ (è·¨å®ä½“é€»è¾‘)</span><br><span class="line">â”‚   â””â”€â”€ repository       // ä»“å‚¨æ¥å£ (æ³¨æ„ï¼šè¿™é‡Œåªæ”¾æ¥å£ï¼)</span><br><span class="line">â””â”€â”€ infrastructure (åŸºç¡€è®¾æ–½å±‚)</span><br><span class="line">    â”œâ”€â”€ repository       // ä»“å‚¨å®ç° (Implï¼Œè¿™é‡Œä¾èµ– JPA/MyBatis)</span><br><span class="line">    â”œâ”€â”€ entity           // PO (Persistent Objectï¼Œå¯¹åº”æ•°æ®åº“è¡¨)</span><br><span class="line">    â””â”€â”€ util             // é€šç”¨å·¥å…·</span><br></pre></td></tr></table></figure><hr><h3 id="æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„-å…­è¾¹å½¢æ¶æ„-Clean-Hexagonal"><a href="#æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„-å…­è¾¹å½¢æ¶æ„-Clean-Hexagonal" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„ / å…­è¾¹å½¢æ¶æ„ (Clean / Hexagonal)"></a>æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„ / å…­è¾¹å½¢æ¶æ„ (Clean / Hexagonal)</h3><p>è¿™æ˜¯ç›®å‰ DDD ç¤¾åŒº<strong>æœ€æ¨è</strong>çš„æ¶æ„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾®æœåŠ¡åœºæ™¯ä¸‹ã€‚å®ƒä¸å†å¼ºè°ƒâ€œä¸Šä¸‹å±‚â€ï¼Œè€Œæ˜¯å¼ºè°ƒâ€œ<strong>å†…å¤–</strong>â€ã€‚</p><ul><li><strong>å†…æ ¸ï¼ˆInnerï¼‰</strong>ï¼šDomain + Applicationã€‚è¿™æ˜¯é›·æ‰“ä¸åŠ¨çš„ä¸šåŠ¡æ ¸å¿ƒã€‚</li><li><strong>å¤–å£³ï¼ˆOuterï¼‰</strong>ï¼šWebã€Databaseã€Redisã€MQã€‚è¿™äº›éƒ½æ˜¯â€œæ’ä»¶â€ã€‚</li></ul><h4 id="æ ¸å¿ƒåŸåˆ™-1"><a href="#æ ¸å¿ƒåŸåˆ™-1" class="headerlink" title="æ ¸å¿ƒåŸåˆ™"></a>æ ¸å¿ƒåŸåˆ™</h4><p><strong>ä¾èµ–åªèƒ½ç”±å¤–å‘å†…</strong>ã€‚å¤–å£³ï¼ˆWebã€DBï¼‰ä¾èµ–å†…æ ¸ï¼ˆDomainï¼‰ï¼Œå†…æ ¸è°ä¹Ÿä¸ä¾èµ–ã€‚</p><h4 id="ç›®å½•ç»“æ„ç¤ºä¾‹-1"><a href="#ç›®å½•ç»“æ„ç¤ºä¾‹-1" class="headerlink" title="ç›®å½•ç»“æ„ç¤ºä¾‹"></a>ç›®å½•ç»“æ„ç¤ºä¾‹</h4><p>è¿™ç§æ¶æ„é€šå¸¸ä¼šæŠŠæ–‡ä»¶å¤¹åˆ†ä¸º <code>adapter</code>ï¼ˆé€‚é…å™¨/å¤–å£³ï¼‰å’Œ <code>core</code>ï¼ˆå†…æ ¸ï¼‰ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">com.company.project</span><br><span class="line">â”œâ”€â”€ adapter (é€‚é…å™¨å±‚ - å¯¹åº”â€œå…­è¾¹å½¢â€çš„ç«¯å£)</span><br><span class="line">â”‚   â”œâ”€â”€ inbound (è¾“å…¥ç«¯ / é©±åŠ¨ç«¯)</span><br><span class="line">â”‚   â”‚   â””â”€â”€ web          // RestController</span><br><span class="line">â”‚   â””â”€â”€ outbound (è¾“å‡ºç«¯ / è¢«é©±åŠ¨ç«¯)</span><br><span class="line">â”‚       â”œâ”€â”€ persistence  // æ•°æ®åº“å®ç° (Repository Impl)</span><br><span class="line">â”‚       â””â”€â”€ thirdparty   // ç¬¬ä¸‰æ–¹è°ƒç”¨ (å¦‚è°ƒç”¨æ”¯ä»˜æ¥å£)</span><br><span class="line">â”œâ”€â”€ application (åº”ç”¨å±‚ - ä¸šåŠ¡æµç¨‹)</span><br><span class="line">â”‚   â”œâ”€â”€ service          // åº”ç”¨æœåŠ¡</span><br><span class="line">â”‚   â””â”€â”€ port             // ç«¯å£å®šä¹‰ (å¦‚æœæ˜¯ä¸¥æ ¼å…­è¾¹å½¢ï¼Œæ¥å£å®šä¹‰åœ¨è¿™é‡Œ)</span><br><span class="line">â””â”€â”€ domain (é¢†åŸŸå±‚ - ä¸šåŠ¡æ ¸å¿ƒ)</span><br><span class="line">    â”œâ”€â”€ model            // å®ä½“ã€èšåˆæ ¹</span><br><span class="line">    â”œâ”€â”€ service          // é¢†åŸŸæœåŠ¡</span><br><span class="line">    â””â”€â”€ repository       // ä»“å‚¨æ¥å£ (å®šä¹‰æ•°æ®è¯¥æ€ä¹ˆå­˜ï¼Œä½†ä¸å…³å¿ƒå­˜å“ªé‡Œ)</span><br></pre></td></tr></table></figure><p><strong>åŒºåˆ«ç‚¹</strong>ï¼š<br>ä½ ä¼šå‘ç° <code>Controller</code> å’Œ <code>RepositoryImpl</code> å˜æˆäº†å…„å¼Ÿå…³ç³»ï¼Œéƒ½å±äº <code>Adapter</code>ï¼ˆå¤–å›´è®¾æ–½ï¼‰ï¼Œè€Œ <code>Domain</code> è¢«å±‚å±‚ä¿æŠ¤åœ¨æœ€é‡Œé¢ã€‚</p><hr><h3 id="æ–¹æ¡ˆä¸‰ï¼šCOLA-æ¶æ„-Clean-Object-Oriented-and-Layered-Architecture"><a href="#æ–¹æ¡ˆä¸‰ï¼šCOLA-æ¶æ„-Clean-Object-Oriented-and-Layered-Architecture" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šCOLA æ¶æ„ (Clean Object-Oriented and Layered Architecture)"></a>æ–¹æ¡ˆä¸‰ï¼šCOLA æ¶æ„ (Clean Object-Oriented and Layered Architecture)</h3><p>å¦‚æœä½ æ˜¯ Java å¼€å‘è€…ï¼Œç‰¹åˆ«æ˜¯åœ¨å›½å†…å¤§å‚ç¯å¢ƒï¼Œé˜¿é‡Œå¼€æºçš„ <strong>COLA æ¶æ„</strong> æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ DDD è½åœ°æ¨¡æ¿ã€‚å®ƒç»“åˆäº†å››å±‚æ¶æ„å’Œæ•´æ´æ¶æ„çš„ä¼˜ç‚¹ã€‚</p><p>å®ƒçš„ç‰¹ç‚¹æ˜¯æŠŠ<strong>å¯¹å¤–æš´éœ²çš„æ¥å£ï¼ˆAPIï¼‰</strong>å•ç‹¬æŠ½ç¦»æˆä¸€ä¸ªæ¨¡å—ï¼Œæ–¹ä¾¿å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ã€‚</p><h4 id="Maven-æ¨¡å—ç»“æ„"><a href="#Maven-æ¨¡å—ç»“æ„" class="headerlink" title="Maven æ¨¡å—ç»“æ„"></a>Maven æ¨¡å—ç»“æ„</h4><p>COLA é€šå¸¸æ˜¯å¤š Module çš„ Maven é¡¹ç›®ï¼š</p><ol><li><strong><code>start</code> (å¯åŠ¨å±‚)</strong><ul><li>Spring Boot å¯åŠ¨ç±»ï¼Œå„ç§é…ç½®ã€‚</li></ul></li><li><strong><code>adapter</code> (é€‚é…å±‚)</strong><ul><li>Controller (Web), Consumer (MQ)ã€‚</li></ul></li><li><strong><code>client</code> (API å±‚ / SDK)</strong><ul><li><strong>é‡ç‚¹</strong>ï¼šè¿™é‡Œæ”¾ DTO å’Œ API æ¥å£å®šä¹‰ã€‚å¤–éƒ¨ç³»ç»Ÿåªéœ€è¦ä¾èµ–è¿™ä¸ª jar åŒ…ã€‚</li></ul></li><li><strong><code>app</code> (åº”ç”¨å±‚)</strong><ul><li>Application Service, Command Handlerã€‚</li></ul></li><li><strong><code>domain</code> (é¢†åŸŸå±‚)</strong><ul><li>Entity, ValueObject, DomainService, Repository Interfaceã€‚</li><li><strong>æœ€çº¯å‡€çš„ä¸€å±‚ï¼Œä¸ä¾èµ– Springï¼Œåªä¾èµ– JDKã€‚</strong></li></ul></li><li><strong><code>infrastructure</code> (åŸºç¡€è®¾æ–½å±‚)</strong><ul><li>MyBatis Mapper, Repository Impl, Redis Utilã€‚</li></ul></li></ol><hr><h3 id="æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ"><a href="#æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ" class="headerlink" title="æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ"></a>æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ</h3><ol><li><p><strong>å¦‚æœä½ æ˜¯åˆå­¦è€…ï¼Œæˆ–è€…é¡¹ç›®è§„æ¨¡ä¸å¤§</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆä¸€ï¼ˆç»å…¸çš„å››å±‚æ¶æ„ï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šæœ€ç¬¦åˆç›´è§‰ï¼Œæ–‡ä»¶å¤¹åˆ†å±‚æ¸…æ™°ï¼Œä» MVC è¿ç§»è¿‡æ¥è®¤çŸ¥è´Ÿæ‹…æœ€å°ã€‚</li><li><em>æ³¨æ„ç‚¹ï¼šä¸€å®šè¦åšæŒâ€œé¢†åŸŸå±‚å®šä¹‰æ¥å£ï¼ŒåŸºç¡€å±‚å®ç°æ¥å£â€ï¼Œä¸è¦è®©é¢†åŸŸå±‚ä¾èµ– MyBatisã€‚</em></li></ul></li><li><p><strong>å¦‚æœä½ åœ¨åšå¾®æœåŠ¡ï¼Œæˆ–è€…ä¸šåŠ¡é€»è¾‘æåº¦å¤æ‚</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆäºŒï¼ˆæ•´æ´/å…­è¾¹å½¢æ¶æ„ï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šèƒ½å¤Ÿå®Œç¾éš”ç¦»æŠ€æœ¯å®ç°çš„å˜åŠ¨ï¼ˆæ¯”å¦‚ä» MySQL æ¢åˆ° MongoDBï¼Œæ ¸å¿ƒä¸šåŠ¡ä»£ç ä¸€è¡Œéƒ½ä¸ç”¨æ”¹ï¼‰ã€‚</li></ul></li><li><p><strong>å¦‚æœä½ çš„å›¢é˜Ÿç”¨ Java ä¸”ç”±äºè§„èŒƒè¦æ±‚</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆä¸‰ï¼ˆCOLAï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šå›½å†…èµ„æ–™å¤šï¼Œè§„èŒƒçº¦æŸæ€§å¼ºï¼Œé€‚åˆå›¢é˜Ÿåä½œã€‚</li></ul></li></ol><h3 id="å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰"><a href="#å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰" class="headerlink" title="å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰"></a>å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰</h3><p>ä¸ç®¡ä½ é€‰å“ªä¸ªæ–‡ä»¶ç»“æ„ï¼ŒDDD è½åœ°çš„<strong>ç”Ÿæ­»çº¿</strong>åªæœ‰ä¸€æ¡ï¼š</p><blockquote><p><strong>Domain å±‚ï¼ˆé¢†åŸŸå±‚ï¼‰å¿…é¡»æ˜¯â€œçº¯å‡€â€çš„ã€‚</strong></p></blockquote><ul><li>å®ƒå¯ä»¥å¼•ç”¨ <code>java.util.List</code>ã€‚</li><li>å®ƒ<strong>ç»å¯¹ä¸èƒ½</strong>å¼•ç”¨ <code>javax.sql.DataSource</code>ã€<code>org.springframework.xxx</code>ã€<code>com.github.pagehelper</code>ã€‚</li><li>å®ƒåªè°ˆä¸šåŠ¡ï¼ˆè´¦å·ã€é‡‘é¢ã€å†»ç»“ï¼‰ï¼Œä¸è°ˆæŠ€æœ¯ï¼ˆè¡¨ã€JSONã€HTTPï¼‰ã€‚</li></ul><p>åªè¦å®ˆä½äº†è¿™æ¡çº¿ï¼Œä½ çš„æ¶æ„å°±æ˜¯åˆæ ¼çš„ DDD æ¶æ„ã€‚</p><h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>ä»MVCåˆ°Service+DAOï¼Œå†åˆ°DDDï¼Œä¸æ˜¯æ¶æ„çš„â€œæ›¿ä»£â€ï¼Œè€Œæ˜¯æ¶æ„çš„â€œæ¼”è¿›â€ã€‚å®ƒä»¬çš„æ ¸å¿ƒéƒ½æ˜¯é€šè¿‡åˆ†å±‚å®ç°è§£è€¦ï¼Œåªæ˜¯é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡å¤æ‚åº¦ï¼Œé€‰æ‹©äº†ä¸åŒçš„æ‹†åˆ†ç²’åº¦ã€‚</p><p>å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œä¸ç”¨ç›²ç›®è¿½æ±‚â€œé«˜å¤§ä¸Šâ€çš„æ¶æ„ï¼Œè€Œåº”è¯¥ç†è§£æ¯ç§æ¶æ„çš„æ ¸å¿ƒä»·å€¼å’Œé€‚ç”¨åœºæ™¯ï¼šç®€å•ä¸šåŠ¡ç”¨ç®€å•æ¶æ„ï¼Œå¤æ‚ä¸šåŠ¡ç”¨ç²¾ç»†æ¶æ„ã€‚åŒæ—¶ï¼Œè¦æŠ“ä½æ¶æ„è®¾è®¡çš„æœ¬è´¨â€”â€”è®©ä»£ç ç»“æ„æ¸…æ™°ã€èŒè´£æ˜ç¡®ï¼Œä¾¿äºç»´æŠ¤å’Œè¿­ä»£ã€‚è¿™æ‰æ˜¯æˆ‘ä»¬å­¦ä¹ å„ç§æ¶æ„æ€æƒ³çš„æœ€ç»ˆç›®çš„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot;&gt;&lt;a href=&quot;#MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot;&gt;&lt;/a&gt;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&lt;/</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œé—®é¢˜æ€»ç»“</title>
    <link href="https://nmcb666.vip/posts/a3a5550f.html"/>
    <id>https://nmcb666.vip/posts/a3a5550f.html</id>
    <published>2026-01-08T15:32:51.000Z</published>
    <updated>2026-01-31T14:36:26.048Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘"><a href="#å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘" class="headerlink" title="å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘"></a>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘</h2><h3 id="é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢"><a href="#é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢" class="headerlink" title="é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€  é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢ é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢"></a>é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€  é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢ é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸ä¸”å…³é”®çš„ç½‘ç»œé—®é¢˜ã€‚</p><p>ç®€å•ç›´æ¥çš„å›ç­”æ˜¯ï¼š<strong>ä½ ä¼šå¾—åˆ°ä½ æ‰€åœ¨å±€åŸŸç½‘çš„â€œç½‘å…³â€ï¼ˆGatewayï¼‰çš„ MAC åœ°å€ã€‚</strong></p><h4 id="è¯¦ç»†åŸç†è§£æ"><a href="#è¯¦ç»†åŸç†è§£æ" class="headerlink" title="è¯¦ç»†åŸç†è§£æ"></a>è¯¦ç»†åŸç†è§£æ</h4><p>å½“ä½ çš„ç”µè„‘ï¼ˆä¸»æœº Aï¼‰æƒ³è¦å‘é€æ•°æ®åŒ…ç»™ä¸€ä¸ª IP åœ°å€ï¼ˆä¸»æœº Bï¼‰æ—¶ï¼Œå®ƒä¼šç»å†ä»¥ä¸‹é€»è¾‘åˆ¤æ–­æµç¨‹ï¼š</p><ol><li><p><strong>åˆ¤æ–­ç›®æ ‡ IP æ˜¯å¦åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ï¼ˆå­ç½‘ï¼‰å†…ï¼š</strong></p><ul><li>ç”µè„‘ä¼šæŸ¥çœ‹è‡ªå·±çš„å­ç½‘æ©ç ï¼ˆSubnet Maskï¼‰ã€‚</li><li>å¦‚æœ <code>ç›®æ ‡IP</code> å’Œ <code>æœ¬æœºIP</code> åœ¨åŒä¸€ä¸ªç½‘æ®µå†…ï¼Œç”µè„‘è®¤ä¸ºå®ƒå¯ä»¥ç›´æ¥é€šä¿¡ã€‚</li><li><strong>å¦‚æœä¸åœ¨åŒä¸€ä¸ªç½‘æ®µå†…</strong>ï¼Œç”µè„‘è®¤ä¸ºâ€œæˆ‘å¤Ÿä¸ç€å®ƒâ€ï¼Œå¿…é¡»æ‰¾ä¸€ä¸ªâ€œä¸­ä»‹â€æ¥å¸®å¿™è½¬å‘ã€‚</li></ul></li><li><p><strong>å¯»æ‰¾â€œä¸­ä»‹â€ï¼ˆç½‘å…³ï¼‰ï¼š</strong></p><ul><li>è¿™ä¸ªâ€œä¸­ä»‹â€å°±æ˜¯ä½ é…ç½®çš„<strong>é»˜è®¤ç½‘å…³ï¼ˆDefault Gatewayï¼‰</strong>ã€‚é€šå¸¸è¿™æ˜¯ä½ è·¯ç”±å™¨ï¼ˆRouterï¼‰çš„å†…ç½‘ IP åœ°å€ï¼ˆä¾‹å¦‚ <code>192.168.1.1</code> æˆ– <code>192.168.0.1</code>ï¼‰ã€‚</li><li>ç”µè„‘ä¼šæŠŠæ•°æ®åŒ…å‘ç»™ç½‘å…³ï¼Œç”±ç½‘å…³è´Ÿè´£æŠŠæ•°æ®åŒ…æŠ•é€’åˆ°å¤–ç½‘ã€‚</li></ul></li><li><p><strong>ARP è§£æçš„å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼š</strong></p><ul><li>æ—¢ç„¶æ•°æ®åŒ…è¦å‘ç»™ç½‘å…³ï¼Œé‚£ä¹ˆåœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆäºŒå±‚ï¼‰ï¼Œç›®æ ‡ MAC åœ°å€å°±å¿…é¡»æ˜¯ç½‘å…³çš„ MAC åœ°å€ã€‚</li><li>å› æ­¤ï¼Œä½ çš„ç”µè„‘ä¼šå‘èµ·ä¸€ä¸ª <strong>ARP è¯·æ±‚</strong>ï¼Œä½†æ˜¯è¯·æ±‚çš„ç›®æ ‡ IP ä¸å†æ˜¯â€œç›®çš„ IPâ€ï¼Œè€Œæ˜¯ <strong>â€œç½‘å…³çš„ IPâ€</strong>ã€‚</li></ul></li><li><p><strong>è·å– MAC åœ°å€ï¼š</strong></p><ul><li>ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰æ”¶åˆ° ARP è¯·æ±‚åï¼Œå›å¤å®ƒçš„ MAC åœ°å€ã€‚</li><li>ä½ çš„ç”µè„‘å°†æ•°æ®åŒ…å°è£…ï¼Œ<strong>ç›®æ ‡ IP ä»ç„¶æ˜¯è¿œæ–¹çš„ IPï¼Œä½†ç›®æ ‡ MAC åœ°å€å˜æˆäº†ç½‘å…³çš„ MAC åœ°å€</strong>ã€‚</li></ul></li></ol><h4 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h4><p>å‡è®¾ä½ çš„ç½‘ç»œç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li><strong>ä½ çš„ç”µè„‘ IPï¼š</strong> <code>192.168.1.100</code></li><li><strong>ä½ çš„ç½‘å…³ IPï¼š</strong> <code>192.168.1.1</code> ï¼ˆMAC: <code>AA:AA:AA:AA:AA:AA</code>ï¼‰</li><li><strong>ä½ æƒ³è®¿é—®çš„ç™¾åº¦æœåŠ¡å™¨ IPï¼š</strong> <code>110.242.68.4</code> ï¼ˆè¿™æ˜¾ç„¶ä¸åœ¨ä½ çš„å±€åŸŸç½‘ï¼‰</li></ul><p><strong>å‘ç”Ÿçš„è¿‡ç¨‹ï¼š</strong></p><ol><li>ä½ è¦ ping <code>110.242.68.4</code>ã€‚</li><li>ä½ çš„ç”µè„‘è®¡ç®—ä¸€ä¸‹ï¼Œå‘ç° <code>110.242.68.4</code> ä¸åœ¨ <code>192.168.1.x</code> è¿™ä¸ªåœˆå­é‡Œã€‚</li><li>ä½ çš„ç”µè„‘å†³å®šï¼šâ€œæˆ‘è¦æŠŠè¿™ä¸ªåŒ…äº¤ç»™ç½‘å…³ <code>192.168.1.1</code> å¤„ç†ã€‚â€</li><li>ä½ çš„ç”µè„‘å‘å‡º ARP è¯·æ±‚ï¼šâ€œè°æ˜¯ <code>192.168.1.1</code>ï¼Ÿè¯·å‘Šè¯‰æˆ‘ä½ çš„ MAC åœ°å€ã€‚â€</li><li>è·¯ç”±å™¨å›å¤ï¼šâ€œæˆ‘æ˜¯ <code>192.168.1.1</code>ï¼Œæˆ‘çš„ MAC æ˜¯ <code>AA:AA:AA:AA:AA:AA</code>ã€‚â€</li><li>ä½ çš„ç”µè„‘å‘é€æ•°æ®åŒ…ï¼š<ul><li><strong>æº IPï¼š</strong> <code>192.168.1.100</code></li><li><strong>ç›®çš„ IPï¼š</strong> <code>110.242.68.4</code> ï¼ˆIP å¤´ä¸å˜ï¼‰</li><li><strong>æº MACï¼š</strong> <code>ä½ çš„ç”µè„‘ MAC</code></li><li><strong>ç›®çš„ MACï¼š</strong> <code>AA:AA:AA:AA:AA:AA</code> ï¼ˆå˜æˆäº†ç½‘å…³çš„ MACï¼‰</li></ul></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li><strong>åŒç½‘æ®µé€šä¿¡ï¼š</strong> ARP è§£æ <strong>ç›®æ ‡ IP</strong> çš„ MACã€‚</li><li><strong>è·¨ç½‘æ®µé€šä¿¡ï¼š</strong> ARP è§£æ <strong>ç½‘å…³ IP</strong> çš„ MACã€‚</li></ul><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“ä½ è®¿é—®äº’è”ç½‘ä¸Šä»»ä½•ç½‘ç«™æ—¶ï¼Œä½ ç”µè„‘çš„ ARP ç¼“å­˜è¡¨ä¸­ï¼Œä¸»è¦å˜åŠ¨çš„å…¶å®æ˜¯ç½‘å…³çš„è®°å½•ï¼Œè€Œä¸æ˜¯äº’è”ç½‘ä¸Šæ— æ•°æœåŠ¡å™¨çš„ MAC åœ°å€ï¼ˆä½ ä¹Ÿæ— æ³•ç›´æ¥è·å–äº’è”ç½‘æœåŠ¡å™¨çš„ MAC åœ°å€ï¼Œå› ä¸ºè·¯ç”±å™¨ä¼šéš”ç¦»å¹¿æ’­åŸŸï¼‰ã€‚</p><h3 id="å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ"><a href="#å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ" class="headerlink" title="å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ"></a>å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ</h3><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œâ€œå°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPâ€æ˜¯æœ€æ ¸å¿ƒçš„åŸºç¡€é—®é¢˜ä¹‹ä¸€ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠé“¾è·¯å±‚ã€ç½‘ç»œå±‚çš„ååŒå·¥ä½œï¼Œä»¥åŠäº¤æ¢æœºã€è·¯ç”±å™¨ç­‰è®¾å¤‡çš„æ ¸å¿ƒæœºåˆ¶ã€‚æœ¬æ–‡å°†ç»“åˆæ­¤å‰çš„è®¨è®ºï¼Œä»¥æŠ€æœ¯æ€è€ƒçš„è§†è§’ï¼Œå®Œæ•´æ¢³ç†ä»ç½‘ç»œåŒ…å°è£…å®Œæˆåˆ°æœ€ç»ˆé€è¾¾ç›®æ ‡IPçš„å…¨æµç¨‹ï¼Œæ‹†è§£å…¶ä¸­çš„å…³é”®é€»è¾‘ä¸è®¾å¤‡åˆ†å·¥ã€‚</p><h4 id="ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ "><a href="#ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ " class="headerlink" title="ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ "></a>ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ </h4><p>å½“æˆ‘ä»¬åœ¨ä¸»æœºä¸Šå®Œæˆç½‘ç»œåŒ…å°è£…åï¼ˆé€šå¸¸æ˜¯TCP/UDPå¤´éƒ¨+IPå¤´éƒ¨+æ•°æ®çš„å°è£…ï¼‰ï¼Œè¿™ä¸ªåŒ…è¦åœ¨ç‰©ç†ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¿…é¡»å…·å¤‡â€œä¸¤å±‚èº«ä»½æ ‡è¯†â€ï¼Œå¯¹åº”ç½‘ç»œåˆ†å±‚æ¨¡å‹çš„ä¸åŒèŒè´£ï¼š</p><ul><li><p><strong>ç½‘ç»œå±‚èº«ä»½</strong>ï¼šå³æºIPåœ°å€ï¼ˆå‘é€æ–¹ä¸»æœºIPï¼‰å’Œç›®æ ‡IPåœ°å€ï¼ˆæœ€ç»ˆæ¥æ”¶æ–¹IPï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯â€œè·¨ç½‘æ®µå¯¼èˆªâ€ï¼Œç¡®å®šæ•°æ®åŒ…çš„æœ€ç»ˆç›®çš„åœ°ï¼Œå…¨ç¨‹ä¸å˜ã€‚</p></li><li><p><strong>é“¾è·¯å±‚èº«ä»½</strong>ï¼šå³æºMACåœ°å€ï¼ˆå½“å‰å‘é€è®¾å¤‡ç½‘å¡MACï¼‰å’Œç›®æ ‡MACåœ°å€ï¼ˆå½“å‰é“¾è·¯ä¸‹ä¸€è·³è®¾å¤‡MACï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯â€œå±€åŸŸç½‘å†…å®šä½â€ï¼Œæ¯ç»è¿‡ä¸€è·³é“¾è·¯éƒ½ä¼šæ›´æ–°ï¼Œä»…åœ¨å½“å‰é“¾è·¯æœ‰æ•ˆã€‚</p></li></ul><p>æ ¸å¿ƒç»“è®ºï¼šIPåœ°å€è´Ÿè´£â€œæ‰¾æœ€ç»ˆç›®çš„åœ°åœ¨å“ªâ€ï¼ŒMACåœ°å€è´Ÿè´£â€œæ‰¾å½“å‰é“¾è·¯ä¸Šä¸‹ä¸€è·³æ˜¯è°â€ï¼Œä¸¤è€…ååŒå®Œæˆå…¨è·¯å¾„ä¼ è¾“ã€‚</p><h4 id="äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ"><a href="#äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ" class="headerlink" title="äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ"></a>äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ</h4><p>å°è£…å®Œæˆåï¼Œä¸»æœºçš„TCP/IPåè®®æ ˆé¦–å…ˆä¼šè¿›è¡Œä¸€ä¸ªæ ¸å¿ƒåˆ¤æ–­â€”â€”ç›®æ ‡IPæ˜¯å¦ä¸æœ¬æœºåœ¨åŒä¸€å±€åŸŸç½‘ï¼ˆé€šè¿‡å­ç½‘æ©ç è®¡ç®—ç½‘æ®µï¼‰ã€‚è¿™ä¸ªåˆ¤æ–­ç›´æ¥å†³å®šäº†åç»­çš„å‘é€é€»è¾‘ï¼šæ˜¯ç›´æ¥å‘é€ç»™ç›®æ ‡ä¸»æœºï¼Œè¿˜æ˜¯å…ˆå‘é€ç»™ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰ã€‚</p><h4 id="ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº"><a href="#ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº" class="headerlink" title="ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº"></a>ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº</h4><p>å½“ç›®æ ‡IPåœ¨åŒä¸€ç½‘æ®µæ—¶ï¼Œä¸»æœºéœ€è¦ç›´æ¥ä¸ç›®æ ‡ä¸»æœºé€šä¿¡ï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯â€œå¦‚ä½•è·å–ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€â€ï¼Œè¿™å°±éœ€è¦ARPåè®®çš„å‚ä¸ã€‚</p><h5 id="3-1-æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨"><a href="#3-1-æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨" class="headerlink" title="3.1 æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨"></a>3.1 æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨</h5><p>ä¸»æœºæœ¬åœ°ä¼šç»´æŠ¤ä¸€ä¸ªARPç¼“å­˜è¡¨ï¼Œå­˜å‚¨â€œIPåœ°å€-MACåœ°å€â€çš„æ˜ å°„å…³ç³»ã€‚åè®®æ ˆä¼šå…ˆæŸ¥è¯¢è¯¥è¡¨ï¼š</p><ul><li><p>è‹¥å­˜åœ¨ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€ï¼šç›´æ¥è¿›å…¥é“¾è·¯å±‚å°è£…ï¼Œå°†ç›®æ ‡MACå¡«å…¥ä»¥å¤ªç½‘å¸§å¤´ï¼ŒæºMACå¡«å…¥æœ¬æœºç½‘å¡MACï¼Œç„¶åå°†å¸§å‘é€è‡³äº¤æ¢æœºã€‚</p></li><li><p>è‹¥ä¸å­˜åœ¨ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€ï¼šè§¦å‘ARPå¹¿æ’­æµç¨‹ã€‚</p></li></ul><h5 id="3-2-æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC"><a href="#3-2-æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC" class="headerlink" title="3.2 æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC"></a>3.2 æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC</h5><p>ä¸»æœºå‘é€ARPè¯·æ±‚åŒ…ï¼ˆé“¾è·¯å±‚ç›®æ ‡MACä¸ºå¹¿æ’­åœ°å€FF:FF:FF:FF:FF:FFï¼‰ï¼Œè¯¥å¹¿æ’­åŒ…ä¼šè¢«äº¤æ¢æœºæ³›æ´ªè‡³å±€åŸŸç½‘å†…æ‰€æœ‰è®¾å¤‡ï¼š</p><ul><li><p>éç›®æ ‡è®¾å¤‡æ”¶åˆ°åï¼Œå‘ç°ç›®æ ‡IPä¸æ˜¯è‡ªå·±ï¼Œç›´æ¥ä¸¢å¼ƒï¼›</p></li><li><p>ç›®æ ‡è®¾å¤‡æ”¶åˆ°åï¼Œè¯†åˆ«å‡ºç›®æ ‡IPæ˜¯è‡ªå·±ï¼Œå›å¤ARPå“åº”åŒ…ï¼ŒåŒ…å«è‡ªèº«MACåœ°å€ï¼›</p></li><li><p>ä¸»æœºæ”¶åˆ°ARPå“åº”åï¼Œå°†â€œç›®æ ‡IP-ç›®æ ‡MACâ€æ˜ å°„å­˜å…¥ARPç¼“å­˜è¡¨ï¼Œåç»­é€šä¿¡å¯ç›´æ¥ä½¿ç”¨ã€‚</p></li></ul><h5 id="3-3-æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘"><a href="#3-3-æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘" class="headerlink" title="3.3 æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘"></a>3.3 æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘</h5><p>ä¸»æœºå°†å°è£…å¥½çš„ä»¥å¤ªç½‘å¸§å‘é€è‡³äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šé€šè¿‡è‡ªèº«çš„MACåœ°å€è¡¨ï¼ˆè®°å½•â€œMACåœ°å€-ç«¯å£â€æ˜ å°„ï¼‰è¿›è¡Œè½¬å‘ï¼š</p><ul><li><p>è‹¥MACåœ°å€è¡¨å­˜åœ¨ç›®æ ‡MACå¯¹åº”çš„ç«¯å£ï¼šç›´æ¥å°†å¸§ä»è¯¥ç«¯å£è½¬å‘ï¼ˆå•æ’­ï¼‰ï¼Œä»…ç›®æ ‡è®¾å¤‡èƒ½æ¥æ”¶ï¼›</p></li><li><p>è‹¥MACåœ°å€è¡¨ä¸å­˜åœ¨ç›®æ ‡MACå¯¹åº”çš„ç«¯å£ï¼šäº¤æ¢æœºæ‰§è¡Œâ€œæ³›æ´ªâ€ï¼Œå°†å¸§ä»é™¤æ¥æ”¶ç«¯å£å¤–çš„æ‰€æœ‰ç«¯å£è½¬å‘ï¼Œç›´åˆ°ç›®æ ‡è®¾å¤‡æ¥æ”¶åï¼Œäº¤æ¢æœºé€šè¿‡æºMACå­¦ä¹ ï¼Œå°†ç›®æ ‡MACä¸å¯¹åº”ç«¯å£çš„æ˜ å°„å­˜å…¥MACåœ°å€è¡¨ï¼Œåç»­é€šä¿¡ç›´æ¥å•æ’­ã€‚</p></li></ul><p>æ ¸å¿ƒè¦ç‚¹ï¼šäº¤æ¢æœºä»…è¯†åˆ«MACåœ°å€ï¼Œä¸å…³å¿ƒIPåœ°å€ï¼›ARPå¹¿æ’­ä»…åœ¨å½“å‰å±€åŸŸç½‘å†…ä¼ æ’­ï¼Œä¸ä¼šè·¨ç½‘æ®µã€‚</p><h4 id="å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP"><a href="#å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP" class="headerlink" title="å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP"></a>å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP</h4><p>å½“ç›®æ ‡IPä¸åœ¨åŒä¸€ç½‘æ®µæ—¶ï¼Œä¸»æœºæ— æ³•ç›´æ¥ä¸ç›®æ ‡ä¸»æœºé€šä¿¡ï¼Œå¿…é¡»é€šè¿‡ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰è½¬å‘â€”â€”ç½‘å…³æ˜¯è¿æ¥æœ¬åœ°å±€åŸŸç½‘ä¸å¤–éƒ¨ç½‘ç»œçš„â€œæ¡¥æ¢â€ï¼ŒåŒæ—¶å±äºä¸¤ä¸ªç½‘ç»œï¼ˆæœ¬åœ°å±€åŸŸç½‘å’Œå¤–ç½‘ï¼‰ï¼Œæ‹¥æœ‰ä¸¤ä¸ªIPå’Œä¸¤ä¸ªMACï¼ˆå±€åŸŸç½‘ä¾§IP/MACã€å¤–ç½‘ä¾§IP/MACï¼‰ã€‚</p><h5 id="4-1-æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€"><a href="#4-1-æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€" class="headerlink" title="4.1 æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€"></a>4.1 æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€</h5><ul><li><p>ç½‘å…³IPçš„è·å–ï¼šä¸»æœºé€šè¿‡DHCPè‡ªåŠ¨è·å–ï¼ˆå¸¸è§ï¼‰æˆ–æ‰‹åŠ¨é…ç½®ï¼Œå­˜å‚¨åœ¨æœ¬åœ°ç½‘ç»œè®¾ç½®ä¸­ï¼›</p></li><li><p>ç½‘å…³MACçš„è·å–ï¼šä¸åŒä¸€å±€åŸŸç½‘è·å–ç›®æ ‡MACé€»è¾‘ä¸€è‡´ï¼Œé€šè¿‡æŸ¥è¯¢ARPç¼“å­˜è¡¨æˆ–å‘é€ARPå¹¿æ’­è·å–ç½‘å…³IPå¯¹åº”çš„MACåœ°å€ã€‚</p></li></ul><h5 id="4-2-æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³"><a href="#4-2-æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³" class="headerlink" title="4.2 æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³"></a>4.2 æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³</h5><p>ä¸»æœºå°†ä»¥å¤ªç½‘å¸§çš„ç›®æ ‡MACå¡«å…¥ç½‘å…³çš„å±€åŸŸç½‘ä¾§MACï¼ŒæºMACå¡«å…¥æœ¬æœºMACï¼Œå‘é€è‡³äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºè½¬å‘è‡³ç½‘å…³ã€‚</p><h5 id="4-3-æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰"><a href="#4-3-æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰" class="headerlink" title="4.3 æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰"></a>4.3 æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰</h5><p>ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰æ”¶åˆ°å¸§åï¼Œä¼šæ‰§è¡Œâ€œå‰¥å¸§-è·¯ç”±-é‡æ–°å°è£…â€çš„æ ¸å¿ƒæµç¨‹ï¼š</p><ol><li><p>å‰¥å¸§ï¼šè·¯ç”±å™¨å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œä¼šå‰¥ç¦»é“¾è·¯å±‚ä»¥å¤ªç½‘å¸§å¤´ï¼ˆMACåœ°å€ä¿¡æ¯å¤±æ•ˆï¼‰ï¼ŒæŸ¥çœ‹IPå¤´éƒ¨çš„ç›®æ ‡IPï¼›</p></li><li><p>è·¯ç”±å†³ç­–ï¼šæŸ¥è¯¢è‡ªèº«è·¯ç”±è¡¨ï¼Œç¡®å®šç›®æ ‡IPå¯¹åº”çš„â€œä¸‹ä¸€è·³ç½‘å…³â€ï¼ˆå¯èƒ½æ˜¯è¿è¥å•†è·¯ç”±å™¨ã€éª¨å¹²ç½‘è·¯ç”±å™¨ç­‰ï¼‰ï¼›</p></li><li><p>é‡æ–°å°è£…ï¼šé€šè¿‡ARPè·å–ä¸‹ä¸€è·³ç½‘å…³çš„MACåœ°å€ï¼Œå°†æ–°çš„ä»¥å¤ªç½‘å¸§å¤´å°è£…ï¼ˆæºMACä¸ºç½‘å…³çš„å¤–ç½‘ä¾§MACï¼Œç›®æ ‡MACä¸ºä¸‹ä¸€è·³ç½‘å…³çš„MACï¼‰ï¼Œå‘é€è‡³ä¸‹ä¸€è·³ï¼›</p></li><li><p>é‡å¤è½¬å‘ï¼šæ•°æ®åŒ…åœ¨äº’è”ç½‘ä¸­ç»è¿‡å¤šä¸ªè·¯ç”±å™¨æ¥åŠ›è½¬å‘ï¼Œæ¯ä¸€è·³éƒ½é‡å¤â€œå‰¥å¸§-è·¯ç”±-é‡æ–°å°è£…â€ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡IPæ‰€åœ¨çš„å±€åŸŸç½‘ç½‘å…³ã€‚</p></li></ol><h5 id="4-4-æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­-ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰"><a href="#4-4-æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­-ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰" class="headerlink" title="4.4 æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­/ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰"></a>4.4 æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­/ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰</h5><p>å®¶åº­/ä¼ä¸šå†…ç½‘ä½¿ç”¨ç§æœ‰IPï¼ˆå¦‚192.168.x.xï¼‰ï¼Œæ— æ³•ç›´æ¥åœ¨äº’è”ç½‘ä¸­è·¯ç”±ã€‚å› æ­¤ï¼Œç½‘å…³åœ¨è½¬å‘æ—¶ä¼šè§¦å‘NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰ï¼š</p><ul><li><p>å‡ºå£è½¬æ¢ï¼šå°†æ•°æ®åŒ…çš„æºIPä»ç§æœ‰IPæ”¹ä¸ºç½‘å…³çš„å…¬ç½‘IPï¼ŒåŒæ—¶è®°å½•â€œç§æœ‰IP:ç«¯å£-å…¬ç½‘IP:ç«¯å£â€çš„æ˜ å°„å…³ç³»ï¼ˆNATè¡¨ï¼‰ï¼›</p></li><li><p>å…¥å£è½¬æ¢ï¼šå½“ç›®æ ‡IPçš„å“åº”åŒ…è¿”å›è‡³ç½‘å…³æ—¶ï¼Œç½‘å…³é€šè¿‡NATè¡¨åå‘æŸ¥è¯¢ï¼Œå°†ç›®æ ‡IPæ”¹ä¸ºå¯¹åº”çš„å†…ç½‘ç§æœ‰IPï¼Œç›®æ ‡MACæ”¹ä¸ºè¯¥ä¸»æœºçš„MACï¼Œè½¬å‘è‡³ç›®æ ‡ä¸»æœºã€‚</p></li></ul><p>æ ¸å¿ƒè¦ç‚¹ï¼šNATä»…å‘ç”Ÿåœ¨æœ¬åœ°ç½‘å…³çš„å‡ºå£å¤„ï¼Œæ˜¯ç§æœ‰IPè®¿é—®äº’è”ç½‘çš„å¿…è¦æ¡ä»¶ï¼›æºIPåœ¨NATè½¬æ¢åï¼Œåœ¨äº’è”ç½‘ä¼ è¾“è¿‡ç¨‹ä¸­ä¿æŒä¸å˜ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡å±€åŸŸç½‘ã€‚</p><h5 id="4-5-æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³"><a href="#4-5-æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³" class="headerlink" title="4.5 æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³"></a>4.5 æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³</h5><p>å½“æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡IPæ‰€åœ¨çš„å±€åŸŸç½‘ç½‘å…³åï¼Œç½‘å…³ä¼šå†æ¬¡æ‰§è¡Œâ€œå‰¥å¸§-è·¯ç”±â€ï¼Œå‘ç°ç›®æ ‡IPåœ¨å½“å‰å±€åŸŸç½‘å†…ï¼Œé€šè¿‡ARPè·å–ç›®æ ‡ä¸»æœºçš„MACåœ°å€ï¼Œé‡æ–°å°è£…å¸§åå‘é€è‡³ç›®æ ‡ä¸»æœºï¼Œå®Œæˆå…¨é“¾è·¯ä¼ è¾“ã€‚</p><h4 id="äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“"><a href="#äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“" class="headerlink" title="äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“"></a>äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“</h4><div class="table-container"><table><thead><tr><th>è®¾å¤‡</th><th>å·¥ä½œå±‚çº§</th><th>æ ¸å¿ƒèŒè´£</th><th>å…³é”®ç‰¹æ€§</th></tr></thead><tbody><tr><td>ä¸»æœº</td><td>ç½‘ç»œå±‚+é“¾è·¯å±‚</td><td>å°è£…ç½‘ç»œåŒ…ã€ARPæŸ¥è¯¢/å¹¿æ’­ã€åˆ¤æ–­ç›®æ ‡IPç½‘æ®µ</td><td>ç»´æŠ¤ARPç¼“å­˜è¡¨ï¼Œä¸ç›´æ¥è·¨ç½‘æ®µè½¬å‘</td></tr><tr><td>äº¤æ¢æœº</td><td>é“¾è·¯å±‚</td><td>æ ¹æ®MACåœ°å€è¡¨è½¬å‘å¸§ã€æ³›æ´ªæœªçŸ¥MACå¸§ã€å­¦ä¹ æºMAC</td><td>ä¸è¯†åˆ«IPåœ°å€ï¼Œä¸éš”ç¦»å¹¿æ’­åŸŸï¼ˆäºŒå±‚äº¤æ¢æœºï¼‰</td></tr><tr><td>è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰</td><td>ç½‘ç»œå±‚+é“¾è·¯å±‚</td><td>è·¯ç”±å†³ç­–ã€è·¨ç½‘æ®µè½¬å‘ã€NATè½¬æ¢ã€éš”ç¦»å¹¿æ’­åŸŸ</td><td>ä¸¢å¼ƒå¹¿æ’­åŒ…ï¼ŒåŒæ—¶å±äºå¤šä¸ªç½‘ç»œï¼Œç»´æŠ¤è·¯ç”±è¡¨</td></tr></tbody></table></div><h4 id="å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰"><a href="#å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰" class="headerlink" title="å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰"></a>å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å°è£…å®Œæˆç½‘ç»œåŒ…</span><br><span class="line">â”œâ”€ å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ</span><br><span class="line">â”‚  â”œâ”€ æ˜¯ï¼š</span><br><span class="line">â”‚  â”‚  â”œâ”€ æŸ¥è¯¢ARPç¼“å­˜è¡¨ â†’ æœ‰ç›®æ ‡MACï¼Ÿ</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ æ˜¯ï¼šå°è£…å¸§ï¼ˆç›®æ ‡MAC=ç›®æ ‡ä¸»æœºMACï¼‰â†’ äº¤æ¢æœºè½¬å‘ â†’ ç›®æ ‡ä¸»æœº</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ å¦ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC â†’ å­˜å…¥ç¼“å­˜ â†’ å°è£…è½¬å‘</span><br><span class="line">â”‚  â””â”€ å¦ï¼š</span><br><span class="line">â”‚     â”œâ”€ è·å–ç½‘å…³IPï¼ˆDHCP/æ‰‹åŠ¨é…ç½®ï¼‰</span><br><span class="line">â”‚     â”œâ”€ è·å–ç½‘å…³MACï¼ˆARPæŸ¥è¯¢/å¹¿æ’­ï¼‰</span><br><span class="line">â”‚     â”œâ”€ å°è£…å¸§ï¼ˆç›®æ ‡MAC=ç½‘å…³MACï¼‰â†’ äº¤æ¢æœºè½¬å‘ â†’ ç½‘å…³</span><br><span class="line">â”‚     â”œâ”€ ç½‘å…³NATï¼šæºIPä»ç§æœ‰IPæ”¹ä¸ºå…¬ç½‘IP</span><br><span class="line">â”‚     â”œâ”€ ç½‘å…³è·¯ç”±å†³ç­– â†’ è½¬å‘è‡³ä¸‹ä¸€è·³ï¼ˆäº’è”ç½‘å¤šè·¯ç”±å™¨æ¥åŠ›ï¼‰</span><br><span class="line">â”‚     â”œâ”€ åˆ°è¾¾ç›®æ ‡å±€åŸŸç½‘ç½‘å…³ â†’ å‰¥å¸§è·¯ç”± â†’ è·å–ç›®æ ‡ä¸»æœºMAC</span><br><span class="line">â”‚     â””â”€ è½¬å‘è‡³ç›®æ ‡ä¸»æœº</span><br><span class="line">â””â”€ æ ¸å¿ƒä¸å˜é‡ï¼šç›®æ ‡IPå…¨ç¨‹ä¸å˜ï¼›æ ¸å¿ƒå˜é‡ï¼šMACåœ°å€æ¯è·³æ›´æ–°</span><br></pre></td></tr></table></figure><h4 id="ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰"><a href="#ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰" class="headerlink" title="ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰"></a>ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰</h4><ul><li><p>Qï¼šå¦‚æœæŒ‡å®šçš„MACåœ°å€ä¸åœ¨å±€åŸŸç½‘å†…æ€ä¹ˆåŠï¼Ÿ<br>Aï¼šä¸»æœºå‘é€å‰ä¼šé€šè¿‡ARPéªŒè¯ï¼Œè‹¥ARPå¹¿æ’­æ— å“åº”ï¼Œä¼šåˆ¤å®šâ€œç›®æ ‡ä¸å¯è¾¾â€ï¼Œç›´æ¥æŠ¥é”™ï¼Œæ•°æ®åŒ…ä¸ä¼šå‘é€ã€‚</p></li><li><p>Qï¼šäº¤æ¢æœºæœ‰ARPå—ï¼ŸçŸ¥é“IPå¯¹åº”MACå—ï¼Ÿ<br>Aï¼šäºŒå±‚äº¤æ¢æœºæ— ARPï¼Œä¸è¯†åˆ«IPï¼Œä»…é€šè¿‡MACåœ°å€è½¬å‘ï¼›ä¸‰å±‚äº¤æ¢æœºé›†æˆè·¯ç”±åŠŸèƒ½ï¼Œæ‰ä¼šæœ‰ARPè¡¨ã€‚</p></li><li><p>Qï¼šARPæ˜¯å¹¿æ’­ï¼Œå¦‚ä½•éš”ç¦»å¹¿æ’­åŸŸï¼Ÿ<br>Aï¼šè·¯ç”±å™¨ä¼šä¸¢å¼ƒå¹¿æ’­åŒ…ï¼Œä¸è·¨ç½‘æ®µè½¬å‘ï¼Œå› æ­¤å¹¿æ’­åŸŸè¢«è·¯ç”±å™¨éš”ç¦»ï¼Œä»…åœ¨å½“å‰å±€åŸŸç½‘å†…ä¼ æ’­ã€‚</p></li></ul><h4 id="å…«ã€æ€»ç»“"><a href="#å…«ã€æ€»ç»“" class="headerlink" title="å…«ã€æ€»ç»“"></a>å…«ã€æ€»ç»“</h4><p>ç½‘ç»œåŒ…ä»å°è£…å®Œæˆåˆ°é€è¾¾ç›®æ ‡IPçš„è¿‡ç¨‹ï¼Œæœ¬è´¨æ˜¯â€œIPåœ°å€å¯¼èˆª+MACåœ°å€å®šä½â€çš„ååŒè¿‡ç¨‹ï¼Œæ¶‰åŠARPå¯»å€ã€äº¤æ¢æœºæ³›æ´ª/è½¬å‘ã€è·¯ç”±å™¨è·¯ç”±/NATç­‰æ ¸å¿ƒæœºåˆ¶ã€‚ç†è§£è¿™ä¸€è¿‡ç¨‹çš„å…³é”®ï¼Œæ˜¯åˆ†æ¸…ç½‘ç»œå±‚ä¸é“¾è·¯å±‚çš„èŒè´£è¾¹ç•Œï¼Œä»¥åŠå„è®¾å¤‡çš„åˆ†å·¥é€»è¾‘â€”â€”IPè´Ÿè´£â€œæ‰¾ç»ˆç‚¹â€ï¼ŒMACè´Ÿè´£â€œæ‰¾ä¸‹ä¸€è·³â€ï¼Œäº¤æ¢æœºç®¡â€œå±€åŸŸç½‘å†…æ¬è¿â€ï¼Œè·¯ç”±å™¨ç®¡â€œè·¨ç½‘æ®µå¯¼èˆª+éš”ç¦»å¹¿æ’­â€ï¼Œæœ€ç»ˆå®ç°æ•°æ®åŒ…çš„ç²¾å‡†ä¼ è¾“ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot;&gt;&lt;a href=&quot;#å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot; class=&quot;headerlink&quot; title=&quot;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot;&gt;&lt;/a&gt;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&lt;/h2&gt;&lt;h3 id=&quot;é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-</summary>
      
    
    
    
    
    <category term="å…«è‚¡" scheme="https://nmcb666.vip/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
</feed>
