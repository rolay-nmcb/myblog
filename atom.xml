<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>çº³æ–¯å¡å¯`Blog</title>
  <icon>https://www.gravatar.com/avatar/feb67af737a34cba9363ed2d415c9ae9</icon>
  <subtitle>ğŸ˜¶â€ğŸŒ«ï¸</subtitle>
  <link href="https://nmcb666.vip/atom.xml" rel="self"/>
  
  <link href="https://nmcb666.vip/"/>
  <updated>2026-01-19T13:51:09.833Z</updated>
  <id>https://nmcb666.vip/</id>
  
  <author>
    <name>çº³æ–¯å¡å¯</name>
    <email>2843035026@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆå››ï¼‰äºŒå‰æ ‘</title>
    <link href="https://nmcb666.vip/posts/44956a51.html"/>
    <id>https://nmcb666.vip/posts/44956a51.html</id>
    <published>2026-01-19T21:48:58.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®"><a href="#äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®"></a>äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®</h1><h2 id="å±‚åºéå†"><a href="#å±‚åºéå†" class="headerlink" title="å±‚åºéå†"></a>å±‚åºéå†</h2><p>æ€è·¯ï¼šåˆ©ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†ï¼Œç±»ä¼¼ä¸BFSã€‚</p><p>è¿™é‡Œä¸¾ä¸€ä¸ªé”¯é½¿å½¢å±‚åºéå†çš„ä¾‹å­ï¼ˆå³å…ˆä»å·¦å¾€å³ï¼Œå†ä»å³å¾€å·¦è¿›è¡Œä¸‹ä¸€å±‚éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXN</span> <span class="operator">=</span> <span class="number">2001</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> TreeNode[] queue = <span class="keyword">new</span> <span class="title class_">TreeNode</span>[MAXN];</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> l, r;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">l = r = <span class="number">0</span>;</span><br><span class="line">queue[r++] = root;</span><br><span class="line"><span class="comment">// false ä»£è¡¨ä»å·¦å¾€å³</span></span><br><span class="line"><span class="comment">// true ä»£è¡¨ä»å³å¾€å·¦</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">reverse</span> <span class="operator">=</span> <span class="literal">false</span>; </span><br><span class="line"><span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r - l;</span><br><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"><span class="comment">// reverse == false, å·¦ -&gt; å³ï¼Œ l....r-1, æ”¶é›†sizeä¸ª</span></span><br><span class="line"><span class="comment">// reverse == true,  å³ -&gt; å·¦ï¼Œ r-1....l, æ”¶é›†sizeä¸ª</span></span><br><span class="line"><span class="comment">// å·¦ -&gt; å³, i = i + 1</span></span><br><span class="line"><span class="comment">// å³ -&gt; å·¦, i = i - 1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> reverse ? r - <span class="number">1</span> : l, j = reverse ? -<span class="number">1</span> : <span class="number">1</span>, k = <span class="number">0</span>; k &lt; size; i += j, k++) &#123;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue[i];</span><br><span class="line">list.add(cur.val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> queue[l++];</span><br><span class="line"><span class="keyword">if</span> (cur.left != <span class="literal">null</span>) &#123;</span><br><span class="line">queue[r++] = cur.left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (cur.right != <span class="literal">null</span>) &#123;</span><br><span class="line">queue[r++] = cur.right;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ans.add(list);</span><br><span class="line">reverse = !reverse;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘æœ€å¤§å®½åº¦"><a href="#äºŒå‰æ ‘æœ€å¤§å®½åº¦" class="headerlink" title="äºŒå‰æ ‘æœ€å¤§å®½åº¦"></a>äºŒå‰æ ‘æœ€å¤§å®½åº¦</h2><p>æ€è·¯ï¼šåˆ©ç”¨é˜Ÿåˆ—è¿›è¡Œå±‚åºéå†ï¼Œå¹¶åŒæ­¥è®°å½•å½“å‰å±‚èŠ‚ç‚¹çš„ç´¢å¼•ï¼Œå°†ç´¢å¼•ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€åè®¡ç®—æ¯ä¸€å±‚å¼€å§‹ä¸ç»“æŸçš„ç´¢å¼•çš„å·®å€¼ï¼Œå¹¶è¿”å›æœ€å¤§å€¼ã€‚æƒ³è±¡ä¸ºå®Œå…¨äºŒå‰æ ‘ï¼Œå¯¹äºèŠ‚ç‚¹iï¼Œå…¶å·¦å­èŠ‚ç‚¹ä¸º2iï¼Œå³å­èŠ‚ç‚¹ä¸º2i+1ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">widthOfBinaryTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    TreeNode[] queue = <span class="keyword">new</span> <span class="title class_">TreeNode</span>[<span class="number">3001</span>];</span><br><span class="line">    Long[] idQueue = <span class="keyword">new</span> <span class="title class_">Long</span>[<span class="number">3001</span>];</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[r] = root;</span><br><span class="line">    idQueue[r++] = <span class="number">1L</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">        <span class="comment">//æ¯æ¬¡éå†å®Œæˆåï¼Œl åˆ° r-1ï¼Œå°±æ˜¯å½“å‰å±‚æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r-l;</span><br><span class="line">        ans = Math.max(ans,(<span class="type">int</span>)(idQueue[r-<span class="number">1</span>]-idQueue[l]+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue[l];</span><br><span class="line">            <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> idQueue[l++];</span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                queue[r] = node.left;</span><br><span class="line">                idQueue[r++] = id*<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                queue[r] =node.right;</span><br><span class="line">                idQueue[r++] = id*<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦"><a href="#æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦" class="headerlink" title="æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦"></a>æœ€å¤§æ·±åº¦è·Ÿæœ€å°æ·±åº¦</h2><p>æ€è·¯ï¼šåˆ©ç”¨é€’å½’è¿›è¡Œæ±‚è§£ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæ±‚å·¦å³å­æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œå¹¶è¿”å›è¾ƒå¤§çš„å€¼ã€‚ï¼ˆæœ€å°æ·±åº¦åŒç†ï¼Œä½†è¦å¤„ç†æ ¹èŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µï¼Œå› ä¸ºä¸ºç©ºå­é—®é¢˜è¿”å›0é«˜åº¦ï¼Œä½†é¢˜ç›®è¯´çš„æœ€å°æ·±åº¦å¿…é¡»åˆ°å¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¼šå¹²æ‰°æœ€å°æ·±åº¦çš„è®¡ç®—ï¼Œæ‰€ä»¥å¿…é¡»å­èŠ‚ç‚¹ä¸ä¸ºç©ºæ‰èƒ½è¿›è¡Œé€’å½’ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> root == <span class="literal">null</span> ? <span class="number">0</span> : Math.max(maxDepth(root.left),maxDepth(root.right))+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right ==<span class="literal">null</span> &amp;&amp; root.left ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">lMin</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="type">int</span> <span class="variable">rMin</span> <span class="operator">=</span>Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        lMin = minDepth(root.left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">        rMin = minDepth(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Math.min(lMin,rMin)+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘"><a href="#æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘" class="headerlink" title="æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘"></a>æ ¹æ®ä¸­åºéå†å’Œå‰åºéå†æ„å»ºäºŒå‰æ ‘</h2><p>æ€è·¯ï¼š</p><p>ç¡®å®šæ ¹èŠ‚ç‚¹ï¼š<br>å‰åºéå†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸€å®šæ˜¯æ•´ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p><p>åˆ’åˆ†å·¦å³å­æ ‘ï¼š<br>æ ¹æ®æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®ï¼Œå¯ä»¥å°†ä¸­åºéå†åºåˆ—åˆ’åˆ†ä¸ºå·¦å­æ ‘å’Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—ã€‚<br>å·¦å­æ ‘çš„ä¸­åºéå†åºåˆ—ä½äºæ ¹èŠ‚ç‚¹çš„å·¦è¾¹ï¼Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—ä½äºæ ¹èŠ‚ç‚¹çš„å³è¾¹ã€‚</p><p>é€’å½’æ„å»ºï¼š<br>æ ¹æ®å·¦å­æ ‘å’Œå³å­æ ‘çš„ä¸­åºéå†åºåˆ—é•¿åº¦ï¼Œå¯ä»¥åœ¨å‰åºéå†åºåˆ—ä¸­åˆ’åˆ†å‡ºå¯¹åº”çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„å‰åºéå†åºåˆ—ã€‚<br>é€’å½’åœ°å¯¹å·¦å³å­æ ‘è¿›è¡Œä¸Šè¿°æ“ä½œï¼Œç›´åˆ°éå†åºåˆ—ä¸ºç©ºï¼Œè¿”å› nullã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">buildTree</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span>[] inorder)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(preorder.length == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> preorder.length;</span><br><span class="line">    HashMap&lt;Integer,Integer&gt; map =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i= <span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        map.put(inorder[i],i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> build(preorder,<span class="number">0</span>,len-<span class="number">1</span>,inorder,<span class="number">0</span>,len-<span class="number">1</span>,map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">build</span><span class="params">(<span class="type">int</span>[] pre ,<span class="type">int</span> l1,<span class="type">int</span> r1,<span class="type">int</span>[] in,<span class="type">int</span> l2,<span class="type">int</span> r2,HashMap&lt;Integer,Integer&gt; map)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l1&gt;r1 || l2 &gt; r2)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l1 == r1)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(pre[l1]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(pre[l1]);</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span>map.get(pre[l1]);</span><br><span class="line">    <span class="comment">// åˆ’åˆ†å·¦å³å­æ ‘ é€’å½’æ±‚è§£</span></span><br><span class="line">    head.left = build(pre,l1+<span class="number">1</span>,k-l2+l1,in,l2,k-<span class="number">1</span>,map);</span><br><span class="line">    head.right = build(pre,k-l2+l1+<span class="number">1</span>,r1,in,k+<span class="number">1</span>,r2,map);</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h2><p>æ€è·¯ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">null</span> || root == p || root == q) &#123;</span><br><span class="line"><span class="comment">// é‡åˆ°ç©ºï¼Œæˆ–è€…pï¼Œæˆ–è€…qï¼Œç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">l</span> <span class="operator">=</span> lowestCommonAncestor(root.left, p, q);</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">r</span> <span class="operator">=</span> lowestCommonAncestor(root.right, p, q);</span><br><span class="line"><span class="keyword">if</span> (l != <span class="literal">null</span> &amp;&amp; r != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// å·¦æ ‘ä¹Ÿæœåˆ°ï¼Œå³æ ‘ä¹Ÿæœåˆ°ï¼Œè¿”å›root</span></span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (l == <span class="literal">null</span> &amp;&amp; r == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// éƒ½æ²¡æœåˆ°è¿”å›ç©º</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// lå’Œrä¸€ä¸ªä¸ºç©ºï¼Œä¸€ä¸ªä¸ä¸ºç©º</span></span><br><span class="line"><span class="comment">// è¿”å›ä¸ç©ºçš„é‚£ä¸ª</span></span><br><span class="line"><span class="keyword">return</span> l != <span class="literal">null</span> ? l : r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#éªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="éªŒè¯äºŒå‰æœç´¢æ ‘"></a>éªŒè¯äºŒå‰æœç´¢æ ‘</h2><p>æ€è·¯ï¼šæ¯ä¸ªç‚¹å¿…é¡»å¤§äºå·¦æ ‘çš„æœ€å¤§å€¼ï¼Œå°äºå³æ ‘æœ€å°å€¼ã€‚é€’å½’éªŒè¯å³å¯ã€‚ä½†æ³¨æ„æŠŠæœ€å¤§å€¼è®¾ä¸ºLong.MIN_VALUEï¼Œæœ€å°å€¼è®¾ä¸ºLong.MAX_VALUEï¼ˆä¸ºäº†ä¸å¯¹ç»“æœé€ æˆå¹²æ‰°ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">max</span> <span class="operator">=</span> Long.MIN_VALUE;</span><br><span class="line"><span class="type">long</span> <span class="variable">min</span> <span class="operator">=</span> Long.MAX_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        max = Long.MIN_VALUE;</span><br><span class="line">        min = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">lok</span> <span class="operator">=</span> isValidBST(root.left);</span><br><span class="line">    <span class="type">long</span> <span class="variable">lmax</span> <span class="operator">=</span> max;</span><br><span class="line">    <span class="type">long</span> <span class="variable">lmin</span> <span class="operator">=</span> min;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">rok</span> <span class="operator">=</span> isValidBST(root.right);</span><br><span class="line">    <span class="type">long</span> <span class="variable">rmax</span> <span class="operator">=</span> max;</span><br><span class="line">    <span class="type">long</span> <span class="variable">rmin</span> <span class="operator">=</span> min;</span><br><span class="line">    max = Math.max(Math.max(lmax,rmax),root.val);</span><br><span class="line">    min = Math.min(Math.min(lmin,rmin),root.val);</span><br><span class="line">    <span class="keyword">return</span> lok &amp;&amp; rok &amp;&amp; root.val &gt; lmax &amp;&amp; root.val&lt; rmin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;äºŒå‰æ ‘ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;å±‚åºéå†&quot;&gt;&lt;a href=&quot;#å±‚åºéå†&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>DDDé¢†åŸŸäº‹ä»¶çš„æœ€ä½³å®è·µ</title>
    <link href="https://nmcb666.vip/posts/8f3b837f.html"/>
    <id>https://nmcb666.vip/posts/8f3b837f.html</id>
    <published>2026-01-16T23:59:31.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ"><a href="#DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ" class="headerlink" title="DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ"></a>DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ</h1><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„æˆ˜æœ¯è½åœ°è¿‡ç¨‹ä¸­ï¼Œ<strong>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰</strong> æ˜¯è¿æ¥å„ä¸ªå­åŸŸã€èšåˆä»¥åŠé™ç•Œä¸Šä¸‹æ–‡çš„â€œèƒ¶æ°´â€ã€‚å®ƒä¸ä»…è§£è€¦äº†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ›´æ˜¯å®ç°â€œæœ€ç»ˆä¸€è‡´æ€§â€æ¶æ„çš„å…³é”®æ‰‹æ®µã€‚</p><p>æœ¬æ–‡åŸºäºå®é™…å¼€å‘ç»éªŒï¼Œæ€»ç»“é¢†åŸŸäº‹ä»¶çš„å»ºæ¨¡ã€ç”Ÿæˆã€å‘å¸ƒåŠå¯é æ€§æŠ•é€’çš„æœ€ä½³å®è·µï¼Œå¹¶æ¢è®¨ä¸åŒæ–¹æ¡ˆèƒŒåçš„æƒè¡¡ã€‚</p><hr><h2 id="ä¸€ã€-ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ"><a href="#ä¸€ã€-ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ" class="headerlink" title="ä¸€ã€ ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ"></a>ä¸€ã€ ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶ï¼Ÿ</h2><p>ç®€å•æ¥è¯´ï¼Œé¢†åŸŸäº‹ä»¶æ˜¯<strong>èšåˆå†…å·²å‘ç”Ÿçš„ä¸šåŠ¡äº‹å®</strong>ã€‚</p><ul><li><strong>ä¸šåŠ¡äº‹å®</strong>ï¼šæ„å‘³ç€å®ƒæ˜¯è¿‡å»å¼ã€‚æ¯”å¦‚â€œç”¨æˆ·å·²æ³¨å†Œâ€ã€â€œè®¢å•å·²æ”¯ä»˜â€ã€‚</li><li><strong>å‘½åè§„èŒƒ</strong>ï¼šæ¨èä½¿ç”¨ <code>åŠ¨è¯è¿‡å»å¼</code>ï¼ˆå¦‚ <code>OrderPaid</code>, <code>AccountActivated</code>ï¼‰ã€‚</li><li><strong>ä»·å€¼</strong>ï¼š<ol><li><strong>è§£è€¦</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸éœ€è¦çŸ¥é“è°åœ¨å…³æ³¨å®ƒã€‚</li><li><strong>å‰¯ä½œç”¨å¤„ç†</strong>ï¼šè§¦å‘é€šçŸ¥ã€å¤§æ•°æ®åˆ†æã€æŠ¥è¡¨ç”Ÿæˆç­‰éæ ¸å¿ƒé€»è¾‘ã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šè·¨èšåˆã€è·¨æœåŠ¡çš„çŠ¶æ€åŒæ­¥ã€‚</li></ol></li></ul><hr><h2 id="äºŒã€-å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯-vs-ç˜¦æ¶ˆæ¯"><a href="#äºŒã€-å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯-vs-ç˜¦æ¶ˆæ¯" class="headerlink" title="äºŒã€ å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯ vs ç˜¦æ¶ˆæ¯"></a>äºŒã€ å»ºæ¨¡ï¼šèƒ–æ¶ˆæ¯ vs ç˜¦æ¶ˆæ¯</h2><p>é¢†åŸŸäº‹ä»¶é€šå¸¸è¢«å»ºæ¨¡ä¸º<strong>ä¸å¯å˜çš„å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰</strong>ã€‚ä½†åœ¨è®¾è®¡æ¶ˆæ¯ä½“ï¼ˆPayloadï¼‰æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªç»å…¸æŠ‰æ‹©ï¼š</p><h3 id="1-ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰"><a href="#1-ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰" class="headerlink" title="1. ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰"></a>1. ç˜¦æ¶ˆæ¯ï¼ˆId-Onlyï¼‰</h3><p>æ¶ˆæ¯ä½“ä»…åŒ…å«æœ€åŸºç¡€çš„å…ƒæ•°æ®ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MobileChanged&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;entityId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eventId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uuid-001&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eventTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1654156165&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆæ¯æå°ï¼Œä¼ è¾“å¿«ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆè´¹è€…ï¼ˆSubscriberï¼‰å¿…é¡»æ‹¿ç€ <code>entityId</code> åæŸ¥èšåˆæ ¹ä¿¡æ¯ï¼Œå¯¼è‡´<strong>è¯»æ”¾å¤§</strong>ã€‚</li></ul><h3 id="2-èƒ–æ¶ˆæ¯ï¼ˆEvent-Enrichment-äº‹ä»¶å¢å¼ºï¼‰"><a href="#2-èƒ–æ¶ˆæ¯ï¼ˆEvent-Enrichment-äº‹ä»¶å¢å¼ºï¼‰" class="headerlink" title="2. èƒ–æ¶ˆæ¯ï¼ˆEvent Enrichment / äº‹ä»¶å¢å¼ºï¼‰"></a>2. èƒ–æ¶ˆæ¯ï¼ˆEvent Enrichment / äº‹ä»¶å¢å¼ºï¼‰</h3><p>æ¶ˆæ¯ä½“åŒ…å«æ¶ˆè´¹è€…æ‰€éœ€çš„ä¸šåŠ¡æ•°æ®ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;eventType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MobileChanged&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">&quot;beforeMobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13800000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;afterMobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18100000000&quot;</span> <span class="comment">// å¢å¼ºå­—æ®µ</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šæ¶ˆè´¹è€…å®Œå…¨è‡ªæ²»ï¼Œæ— éœ€åæŸ¥ï¼Œé™ä½æºç«¯ç³»ç»Ÿå‹åŠ›ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆæ¯ä½“è¾ƒå¤§ï¼›å¯èƒ½åŒ…å«æ¶ˆè´¹è€…ä¸åº”å…³å¿ƒçš„æ•æ„Ÿæ•°æ®ï¼›å­˜åœ¨æ•°æ®æ—¶æ•ˆæ€§é—®é¢˜ï¼ˆå¦‚æœæ¶ˆè´¹è€…å¤„ç†æ…¢ï¼Œæ¶ˆæ¯é‡Œçš„æ•°æ®å¯èƒ½æ˜¯æ—§çš„ï¼‰ã€‚</li></ul><blockquote><p><strong>ğŸ’¡ æ€è€ƒä¸å»ºè®®</strong>ï¼š<br>åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œä¸ºäº†å‡å°‘è·¨æœåŠ¡è°ƒç”¨å¸¦æ¥çš„è€¦åˆä¸å»¶è¿Ÿï¼Œ<strong>æ¨èé€‚åº¦çš„â€œäº‹ä»¶å¢å¼ºâ€</strong>ã€‚å³ï¼šåŒ…å«æ¶ˆè´¹è€…å¤„ç†ä¸šåŠ¡æ‰€å¿…é¡»çš„æ ¸å¿ƒå­—æ®µï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ªèšåˆæ ¹éƒ½å¡è¿›å»ã€‚</p></blockquote><hr><h2 id="ä¸‰ã€-ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ"><a href="#ä¸‰ã€-ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ" class="headerlink" title="ä¸‰ã€ ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ"></a>ä¸‰ã€ ç”Ÿæˆï¼šå¦‚ä½•ä¼˜é›…åœ°åˆ›å»ºäº‹ä»¶ï¼Ÿ</h2><p>åœ¨ä»£ç å±‚é¢ï¼Œä½•å¤„åˆ›å»ºã€ä½•å¤„å‘å¸ƒäº‹ä»¶ï¼Œç›´æ¥å½±å“ä»£ç çš„æ•´æ´åº¦ï¼ˆClean Codeï¼‰ã€‚æˆ‘ä»¬å¯¹æ¯”å››ç§å¸¸è§æ–¹æ¡ˆï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">æ–¹æ¡ˆ</th><th style="text-align:left">æè¿°</th><th style="text-align:left">è¯„ä»·</th><th style="text-align:left">å»ºè®®</th></tr></thead><tbody><tr><td style="text-align:left"><strong>1. Serviceå±‚åˆ›å»º</strong></td><td style="text-align:left">ä¸šåŠ¡æ‰§è¡Œå®Œåï¼Œæ‰‹åŠ¨ <code>new Event()</code> å¹¶å‘å¸ƒ</td><td style="text-align:left"><strong>ç®€å•ç²—æš´</strong>ã€‚é€‚åˆè´«è¡€æ¨¡å‹ï¼Œä½†å®¹æ˜“å¯¼è‡´Serviceå±‚é€»è¾‘è†¨èƒ€ï¼Œå®¹æ˜“é—æ¼ã€‚</td><td style="text-align:left">â­ï¸â­ï¸</td></tr><tr><td style="text-align:left"><strong>2. èšåˆæ ¹ä¾èµ–Infra</strong></td><td style="text-align:left">èšåˆæ ¹æ³¨å…¥ <code>Publisher</code>ï¼Œå†…éƒ¨ç›´æ¥å‘å¸ƒ</td><td style="text-align:left"><strong>åæ¨¡å¼</strong>ã€‚èšåˆæ ¹ä¸åº”ä¾èµ–åŸºç¡€è®¾æ–½ï¼Œç ´åäº†POJOçš„çº¯å‡€æ€§ï¼Œä¸”å¯¼è‡´å•ä¸€èŒè´£é—®é¢˜ã€‚</td><td style="text-align:left">ğŸš«</td></tr><tr><td style="text-align:left"><strong>3. èšåˆæ ¹è¿”å›äº‹ä»¶</strong></td><td style="text-align:left">æ–¹æ³•ç­¾åæ”¹ä¸º <code>List&lt;Event&gt; doSomething()</code></td><td style="text-align:left"><strong>ä¾µå…¥æ€§å¼º</strong>ã€‚å¼ºè¡Œæ”¹å˜äº†ä¸šåŠ¡æ–¹æ³•ç­¾åï¼Œè°ƒç”¨æ–¹å¤„ç†ç¹çã€‚</td><td style="text-align:left">â­ï¸</td></tr><tr><td style="text-align:left"><strong>4. èšåˆæ ¹æš‚å­˜ + æŠ½å–</strong></td><td style="text-align:left">èšåˆæ ¹å†…éƒ¨ <code>List</code> æš‚å­˜ï¼ŒRepoä¿å­˜æ—¶æŠ½å–</td><td style="text-align:left"><strong>æœ€ä½³å®è·µ</strong>ã€‚ä¿è¯äº†èšåˆæ ¹çš„çº¯å‡€ï¼ŒåŒæ—¶åˆ©ç”¨åŸºç¡€è®¾æ–½å±‚è‡ªåŠ¨åŒ–å¤„ç†å‘å¸ƒï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚</td><td style="text-align:left">â­ï¸â­ï¸â­ï¸â­ï¸</td></tr></tbody></table></div><h3 id="æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹"><a href="#æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹" class="headerlink" title="æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹"></a>æ¨èæ–¹æ¡ˆä»£ç ç¤ºä¾‹</h3><p><strong>æŠ½è±¡èšåˆæ ¹åŸºç±»ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractAggregateRoot</span> &#123;</span><br><span class="line">    <span class="comment">// æš‚å­˜äº‹ä»¶ï¼Œä¸æŒä¹…åŒ–åˆ°ä¸šåŠ¡è¡¨</span></span><br><span class="line">    <span class="meta">@Transient</span> </span><br><span class="line">    <span class="keyword">private</span> List&lt;DomainEvent&gt; domainEvents = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">registerEvent</span><span class="params">(DomainEvent event)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.domainEvents.add(event);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›ç»™åŸºç¡€è®¾æ–½å±‚è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;DomainEvent&gt; <span class="title function_">pollEvents</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;DomainEvent&gt; events = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.domainEvents);</span><br><span class="line">        <span class="built_in">this</span>.domainEvents.clear();</span><br><span class="line">        <span class="keyword">return</span> events;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>ä¸šåŠ¡èšåˆæ ¹ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">extends</span> <span class="title class_">AbstractAggregateRoot</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeMobile</span><span class="params">(String newMobile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mobile = newMobile;</span><br><span class="line">        <span class="comment">// ä»…ä»…æ˜¯æ³¨å†Œï¼Œä¸æ¶‰åŠIOæ“ä½œ</span></span><br><span class="line">        registerEvent(<span class="keyword">new</span> <span class="title class_">MobileChangedEvent</span>(<span class="built_in">this</span>.id, newMobile));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="å››ã€-å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦"><a href="#å››ã€-å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦" class="headerlink" title="å››ã€ å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦"></a>å››ã€ å¯é æŠ•é€’ï¼šåˆ†å¸ƒå¼äº‹åŠ¡çš„å™©æ¢¦</h2><p>æœ€æ ¸å¿ƒçš„å·¥ç¨‹éš¾é¢˜åœ¨äºï¼š<strong>Databaseä¿å­˜</strong> ä¸ <strong>MQæ¶ˆæ¯å‘é€</strong> æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œã€‚<br>å¦‚æœ DB æäº¤äº†ï¼Œä½† MQ æŒ‚äº†ï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥<strong>æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆTransactional Outbox Patternï¼‰</strong>ã€‚</p><h3 id="1-æ ¸å¿ƒæœºåˆ¶"><a href="#1-æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="1. æ ¸å¿ƒæœºåˆ¶"></a>1. æ ¸å¿ƒæœºåˆ¶</h3><p>åˆ©ç”¨å…³ç³»å‹æ•°æ®åº“çš„æœ¬åœ°äº‹åŠ¡ï¼ˆACIDï¼‰ï¼Œå°†â€œä¸šåŠ¡æ•°æ®ä¿å­˜â€å’Œâ€œäº‹ä»¶æ•°æ®ä¿å­˜â€æ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æäº¤ã€‚</p><ul><li><strong>Step 1</strong>: å¼€å¯äº‹åŠ¡ã€‚</li><li><strong>Step 2</strong>: Update ä¸šåŠ¡è¡¨ã€‚</li><li><strong>Step 3</strong>: Insert into <code>t_event</code> (çŠ¶æ€ï¼šPENDING)ã€‚</li><li><strong>Step 4</strong>: æäº¤äº‹åŠ¡ã€‚</li></ul><p>æ­¤æ—¶ï¼Œä¸šåŠ¡æ“ä½œå’Œäº‹ä»¶è®°å½•è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><h3 id="2-å‘é€ä¸è¡¥å¿ç­–ç•¥"><a href="#2-å‘é€ä¸è¡¥å¿ç­–ç•¥" class="headerlink" title="2. å‘é€ä¸è¡¥å¿ç­–ç•¥"></a>2. å‘é€ä¸è¡¥å¿ç­–ç•¥</h3><p>ä¿å­˜åˆ° <code>t_event</code> åï¼Œå¦‚ä½•å‘åˆ° MQï¼Ÿ</p><ul><li><strong>æ–¹æ¡ˆ Aï¼šåº”ç”¨ç›´æ¥å‘ + è½®è¯¢è¡¥å¿ï¼ˆé€‚åˆä¸­å°è§„æ¨¡ï¼‰</strong><ul><li>åº”ç”¨åœ¨äº‹åŠ¡æäº¤åï¼Œç›´æ¥å¼‚æ­¥å‘é€ MQã€‚å‘é€æˆåŠŸåˆ™æ›´æ–° <code>t_event</code> ä¸º <code>PUBLISHED</code>ã€‚</li><li>åå°å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼ˆWorkerï¼‰ï¼Œæ‰«æ <code>t_event</code> ä¸­è¶…è¿‡ 1 åˆ†é’Ÿä»ä¸º <code>PENDING</code> çš„è®°å½•ï¼Œè¿›è¡Œé‡è¯•ã€‚</li><li><em>ç¼ºç‚¹</em>ï¼šå¢åŠ äº†æ•°æ®åº“æŸ¥è¯¢å‹åŠ›ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EventJdbcRepository eventJdbcRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBusiness</span> <span class="params">(Command cmd)</span> &#123;</span><br><span class="line">        <span class="type">AggregateRoot</span> <span class="variable">root</span> <span class="operator">=</span> repository.load(bizId);</span><br><span class="line">        entity.doBusiness(cmd.getValue());</span><br><span class="line">        repository.save(root);</span><br><span class="line">        <span class="comment">// å‘å¸ƒé¢†åŸŸäº‹ä»¶</span></span><br><span class="line">        List&lt;DomainEvent&gt; domainEvents = entity.getDomainEvents();</span><br><span class="line">        publisher.publish(domainEvents);</span><br><span class="line">        <span class="comment">// é€šè¿‡äº‹ä»¶çš„EntityIdæ›´æ–°EventStoreä¸­äº‹ä»¶çš„çŠ¶æ€ä¸ºå·²å‘å¸ƒ</span></span><br><span class="line">        List&lt;String&gt; eventIds = domainEvents.stream()</span><br><span class="line">        .map(e-&gt;e.getEventId())</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">     eventJdbcRepository.publishSuccess(eventIds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">// TODO 1.æ‰«ææ•°æ®åº“è¶…æ—¶æœªå‘å¸ƒæˆåŠŸçš„é¢†åŸŸäº‹ä»¶</span></span><br><span class="line">    <span class="comment">// TODO 2.å‘å¸ƒé¢†åŸŸäº‹ä»¶åˆ°æ¶ˆæ¯ä¸­é—´ä»¶</span></span><br><span class="line">    <span class="comment">// TODO 3.ä¿®æ”¹æ•°æ®åº“é¢†åŸŸäº‹ä»¶å‘å¸ƒçŠ¶æ€ä¸ºå·²å‘å¸ƒ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>æ–¹æ¡ˆ Bï¼šäº‹åŠ¡æ—¥å¿—æ‹–å°¾ / CDCï¼ˆé€‚åˆå¤§è§„æ¨¡ï¼‰</strong><ul><li>åº”ç”¨åªç®¡å†™åº“ï¼Œä¸å‘æ¶ˆæ¯ã€‚</li><li>åˆ©ç”¨ <strong>Canal / Debezium</strong> ç›‘å¬æ•°æ®åº“çš„ Binlogã€‚</li><li>CDC ç»„ä»¶è§£æ Binlog ä¸­çš„ <code>t_event</code> æ’å…¥è®°å½•ï¼Œè‡ªåŠ¨æŠ•é€’åˆ° MQã€‚</li><li><em>ä¼˜ç‚¹</em>ï¼šåº”ç”¨å±‚å®Œå…¨è§£è€¦ï¼Œæ€§èƒ½æé«˜ã€‚</li></ul></li></ul><hr><h2 id="äº”ã€-è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ"><a href="#äº”ã€-è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ" class="headerlink" title="äº”ã€ è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ"></a>äº”ã€ è®¢é˜…ï¼šå½’å±äºå“ªä¸€å±‚ï¼Ÿ</h2><p>åœ¨ DDD çš„åˆ†å±‚æ¶æ„ä¸­ï¼Œäº‹ä»¶è®¢é˜…è€…ï¼ˆSubscriber/Listenerï¼‰åº”è¯¥æ”¾åœ¨å“ªé‡Œï¼Ÿ</p><p><strong>ç»“è®ºï¼šç”¨æˆ·æ¥å£å±‚ï¼ˆUser Interface / Adapters Layerï¼‰ã€‚</strong></p><ul><li><strong>ç†ç”±</strong>ï¼šè®¢é˜… MQ æ¶ˆæ¯æœ¬è´¨ä¸Šå’Œ Controller æ¥æ”¶ HTTP è¯·æ±‚æ˜¯ä¸€æ ·çš„ã€‚å®ƒä»¬éƒ½æ˜¯å¤–éƒ¨ä¸–ç•Œçš„è¾“å…¥ï¼ˆInputï¼‰ã€‚</li><li><strong>æµç¨‹</strong>ï¼š<ol><li>Subscriber æ¥æ”¶ JSON æ¶ˆæ¯ã€‚</li><li>ååºåˆ—åŒ–ä¸º DTOã€‚</li><li><strong>è°ƒç”¨ Application Service</strong> æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡å‘½ä»¤ã€‚</li></ol></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * é¢†åŸŸäº‹ä»¶è®¢é˜…è€…</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DomainEventSubscriber</span> &#123;</span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        <span class="keyword">private</span> ApplicationService applicationService;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@KafkaListener(topics = &quot;domain_event_topic&quot;,groupId = &quot;local_consumer_group_id&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span> <span class="params">(String event)</span> &#123;</span><br><span class="line">            <span class="comment">// è§£æå¾—åˆ°é¢†åŸŸäº‹ä»¶</span></span><br><span class="line">            <span class="type">DomainEvent</span> <span class="variable">domainEvent</span> <span class="operator">=</span> JSON.parse(event,DomainEvent.class);</span><br><span class="line">            <span class="comment">// æ‹¼è£…Command</span></span><br><span class="line">            <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> <span class="built_in">this</span>.toCommand(domainEvent);</span><br><span class="line">            <span class="comment">// åº”ç”¨å±‚æ‰§è¡Œé¢†åŸŸæ¨¡å‹çŠ¶æ€å˜æ›´</span></span><br><span class="line">            applicationService.handleCommand(command);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰"><a href="#å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰" class="headerlink" title="å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰"></a>å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰</h3><p>ç”±äºç½‘ç»œæŠ–åŠ¨æˆ–é‡è¯•æœºåˆ¶ï¼Œæ¶ˆè´¹è€…å¿…ç„¶ä¼šæ”¶åˆ°é‡å¤æ¶ˆæ¯ã€‚<strong>å¿…é¡»</strong>åˆ©ç”¨ <code>event_id</code> å»ºç«‹å”¯ä¸€ç´¢å¼•æˆ–å»é‡è¡¨ï¼Œç¡®ä¿åŒä¸€ä¸šåŠ¡é€»è¾‘ä¸æ‰§è¡Œä¸¤æ¬¡ã€‚</p><hr><h2 id="å…­ã€-æ€»ç»“"><a href="#å…­ã€-æ€»ç»“" class="headerlink" title="å…­ã€ æ€»ç»“"></a>å…­ã€ æ€»ç»“</h2><p>é¢†åŸŸäº‹ä»¶çš„è®¾è®¡ä¸ä»…ä»…æ˜¯æŠ€æœ¯å®ç°ï¼Œæ›´æ˜¯ä¸€ç§å°†<strong>ä¸šåŠ¡æµç¨‹æ˜¾æ€§åŒ–</strong>çš„æ‰‹æ®µã€‚</p><ol><li><strong>è®¾è®¡ä¸Š</strong>ï¼šä¼˜å…ˆé€‰æ‹© <strong>â€œèšåˆæ ¹æš‚å­˜ + åŸºç¡€è®¾æ–½æŠ½å–â€</strong> çš„ç”Ÿæˆæ¨¡å¼ï¼Œä¿æŒé¢†åŸŸçº¯å‡€ã€‚</li><li><strong>æ•°æ®ä¸Š</strong>ï¼šæƒè¡¡æ¶ˆæ¯å¤§å°ï¼Œæ¨èä½¿ç”¨ <strong>å¢å¼ºå‹äº‹ä»¶</strong> å‡å°‘ä¸‹æ¸¸ä¾èµ–ã€‚</li><li><strong>æ¶æ„ä¸Š</strong>ï¼šå¿…é¡»æ­£è§†åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜ï¼Œ<strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong> æ˜¯å®ç°å¯é æŠ•é€’çš„åŸºçŸ³ã€‚</li></ol><p>DDD çš„è·¯é€”è™½è¿œï¼Œä½†åªè¦å¤„ç†å¥½é¢†åŸŸäº‹ä»¶ï¼Œç³»ç»Ÿçš„è§£è€¦ä¸æ¼”è¿›å°±ä¼šå˜å¾—ä»å®¹è®¸å¤šã€‚</p><p>æœ€åæœ‰å…³äºé¢†åŸŸäº‹ä»¶è·Ÿäº‹ä»¶å›æº¯ä»¥åŠCQRSçš„ç»“åˆå¯ä»¥çœ‹ä¸“é—¨çš„æ–‡ç« ã€‚ CQRSä¸DDD: <a href="https://juejin.cn/post/7510057969265115146">https://juejin.cn/post/7510057969265115146</a> , é¢†åŸŸäº‹ä»¶ä¸äº‹ä»¶å›æº¯ï¼š<a href="https://juejin.cn/post/7510120678847184906">https://juejin.cn/post/7510120678847184906</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ&quot;&gt;&lt;a href=&quot;#DDD-å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹ä»¶ï¼ˆDomain-Eventsï¼‰çš„è®¾è®¡æŠ‰æ‹©ä¸å·¥ç¨‹è½åœ°æ€è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;DDD å®æˆ˜ï¼šå…³äºé¢†åŸŸäº‹</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆä¸‰) é“¾è¡¨</title>
    <link href="https://nmcb666.vip/posts/73873447.html"/>
    <id>https://nmcb666.vip/posts/73873447.html</id>
    <published>2026-01-16T16:06:09.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é“¾è¡¨ç›¸å…³çš„é¢˜ç›®"><a href="#é“¾è¡¨ç›¸å…³çš„é¢˜ç›®" class="headerlink" title="é“¾è¡¨ç›¸å…³çš„é¢˜ç›®"></a>é“¾è¡¨ç›¸å…³çš„é¢˜ç›®</h1><p>è¿™é‡Œç”¨æ¥è®°å½•é“¾è¡¨ç›¸å…³çš„é¢˜ç›®ä»¥åŠæ€è·¯</p><h2 id="ç›¸äº¤é“¾è¡¨"><a href="#ç›¸äº¤é“¾è¡¨" class="headerlink" title="ç›¸äº¤é“¾è¡¨"></a>ç›¸äº¤é“¾è¡¨</h2><p>è¾“å…¥ä¸¤ä¸ªé“¾è¡¨ï¼Œæ‰¾å‡ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        å®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ, ç¬¬ä¸€è½®è®©ä¸¤ä¸ªåˆ°è¾¾æœ«å°¾çš„èŠ‚ç‚¹æŒ‡å‘å¦ä¸€ä¸ªé“¾è¡¨çš„å¤´éƒ¨, æœ€åå¦‚æœç›¸é‡åˆ™ä¸ºäº¤ç‚¹(åœ¨ç¬¬ä¸€è½®ç§»åŠ¨ä¸­æ°å¥½æŠ¹é™¤äº†é•¿åº¦å·®)</span></span><br><span class="line"><span class="comment">        ä¸¤ä¸ªæŒ‡é’ˆç­‰äºç§»åŠ¨äº†ç›¸åŒçš„è·ç¦», æœ‰äº¤ç‚¹å°±è¿”å›, æ— äº¤ç‚¹å°±æ˜¯å„èµ°äº†ä¸¤æ¡æŒ‡é’ˆçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">        **/</span></span><br><span class="line">        <span class="keyword">if</span>(headA == <span class="literal">null</span> || headB == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pA</span> <span class="operator">=</span> headA, pB = headB;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œç¬¬ä¸€è½®ä½“ç°åœ¨pAå’ŒpBç¬¬ä¸€æ¬¡åˆ°è¾¾å°¾éƒ¨ä¼šç§»å‘å¦ä¸€é“¾è¡¨çš„è¡¨å¤´, è€Œç¬¬äºŒè½®ä½“ç°åœ¨å¦‚æœpAæˆ–pBç›¸äº¤å°±è¿”å›äº¤ç‚¹, ä¸ç›¸äº¤æœ€åå°±æ˜¯null==null</span></span><br><span class="line">        <span class="keyword">while</span>(pA != pB) &#123;</span><br><span class="line">            pA = pA == <span class="literal">null</span> ? headB : pA.next;</span><br><span class="line">            pB = pB == <span class="literal">null</span> ? headA : pB.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"><a href="#Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨" class="headerlink" title="Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"></a>Kä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</h2><p>æ€è·¯ï¼šæ¯kä¸ªç¿»è½¬ä¸€æ¬¡ï¼Œå¯ä»¥å•ç‹¬è¿›è¡Œåè½¬ï¼Œä½†æ³¨æ„ä¸Šä¸€ç»„çš„å°¾èŠ‚ç‚¹å’Œä¸‹ä¸€ç»„çš„å¤´èŠ‚ç‚¹è¦è¿æ¥èµ·æ¥ï¼Œæ‰€ä»¥éœ€è¦è®°å½•ä¸Šä¸€ç»„å°¾èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">start</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">end</span> <span class="operator">=</span> teamEnd(start, k);</span><br><span class="line"><span class="keyword">if</span> (end == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç»„å¾ˆç‰¹æ®Šå› ä¸ºç‰µæ‰¯åˆ°æ¢å¤´çš„é—®é¢˜</span></span><br><span class="line">head = end;</span><br><span class="line">reverse(start, end);</span><br><span class="line"><span class="comment">// ç¿»è½¬ä¹‹åstartå˜æˆäº†ä¸Šä¸€ç»„çš„ç»“å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">ListNode</span> <span class="variable">lastTeamEnd</span> <span class="operator">=</span> start;</span><br><span class="line"><span class="keyword">while</span> (lastTeamEnd.next != <span class="literal">null</span>) &#123;</span><br><span class="line">start = lastTeamEnd.next;</span><br><span class="line">end = teamEnd(start, k);</span><br><span class="line"><span class="keyword">if</span> (end == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line">reverse(start, end);</span><br><span class="line">lastTeamEnd.next = end; <span class="comment">// ä¸Šä¸€ç»„ç»“å°¾èŠ‚ç‚¹è¦è¿æ¥ä¸‹ä¸€ç»„å¤´èŠ‚ç‚¹</span></span><br><span class="line">lastTeamEnd = start;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰ç»„çš„å¼€å§‹èŠ‚ç‚¹æ˜¯sï¼Œå¾€ä¸‹æ•°kä¸ªæ‰¾åˆ°å½“å‰ç»„çš„ç»“æŸèŠ‚ç‚¹è¿”å›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">teamEnd</span><span class="params">(ListNode s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (--k != <span class="number">0</span> &amp;&amp; s != <span class="literal">null</span>) &#123;</span><br><span class="line">s = s.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// s -&gt; a -&gt; b -&gt; c -&gt; e -&gt; ä¸‹ä¸€ç»„çš„å¼€å§‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// ä¸Šé¢çš„é“¾è¡¨é€šè¿‡å¦‚ä¸‹çš„reverseæ–¹æ³•è°ƒæ•´æˆ : e -&gt; c -&gt; b -&gt; a -&gt; s -&gt; ä¸‹ä¸€ç»„çš„å¼€å§‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(ListNode s, ListNode e)</span> &#123;</span><br><span class="line">e = e.next;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>, cur = s, next = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">while</span> (cur != e) &#123;</span><br><span class="line">next = cur.next;</span><br><span class="line">cur.next = pre;</span><br><span class="line">pre = cur;</span><br><span class="line">cur = next;</span><br><span class="line">&#125;</span><br><span class="line">s.next = e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éšæœºé“¾è¡¨çš„å¤åˆ¶"><a href="#éšæœºé“¾è¡¨çš„å¤åˆ¶" class="headerlink" title="éšæœºé“¾è¡¨çš„å¤åˆ¶"></a>éšæœºé“¾è¡¨çš„å¤åˆ¶</h2><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ random ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚</p><p>æ€è·¯ï¼šå°†æ¯ä¸ªèŠ‚ç‚¹å¤åˆ¶ä¸€ä»½ï¼Œå¹¶æŠŠå¤åˆ¶çš„èŠ‚ç‚¹æ”¾åœ¨åŸèŠ‚ç‚¹åé¢ï¼Œæ¯”å¦‚1-&gt;2-&gt;3-&gt;4-&gt;5ï¼Œå¤åˆ¶ä¹‹åå˜æˆ1-&gt;1â€™-&gt;2-&gt;2â€™-&gt;3-&gt;3â€™-&gt;4-&gt;4â€™-&gt;5-&gt;5â€™ï¼Œç„¶åéå†é“¾è¡¨ï¼Œå°†å¤åˆ¶çš„èŠ‚ç‚¹çš„randomæŒ‡é’ˆæŒ‡å‘åŸèŠ‚ç‚¹çš„randomæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ€åå°†é“¾è¡¨æ‹†åˆ†ï¼Œè¿”å›æ–°é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">copyRandomList</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">pre</span> <span class="operator">=</span>head;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†é“¾è¡¨å¤åˆ¶ä¸²è”</span></span><br><span class="line">    <span class="keyword">while</span>(pre != <span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next;</span><br><span class="line">        pre.next = <span class="keyword">new</span> <span class="title class_">Node</span>(pre.val);</span><br><span class="line">        pre.next.next = next;</span><br><span class="line">        pre = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†randomè¿›è¡Œå¤åˆ¶</span></span><br><span class="line">    pre = head;</span><br><span class="line">    <span class="keyword">while</span>(pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next.next;</span><br><span class="line">        pre.next.random = pre.random == <span class="literal">null</span> ? <span class="literal">null</span> : pre.random.next;</span><br><span class="line">        pre = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ†ç¦»ä¸¤ä¸ªé“¾è¡¨</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">newHead</span> <span class="operator">=</span> head.next;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">newPre</span> <span class="operator">=</span> newHead;</span><br><span class="line">    pre =head;</span><br><span class="line">    <span class="keyword">while</span>(pre != <span class="literal">null</span>)&#123;</span><br><span class="line">        next = pre.next.next;</span><br><span class="line">        newPre.next = next == <span class="literal">null</span> ? <span class="literal">null</span> : next.next ;</span><br><span class="line">        pre.next = next;</span><br><span class="line">        pre =next;</span><br><span class="line">        newPre = newPre.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­å›æ–‡é“¾è¡¨"><a href="#åˆ¤æ–­å›æ–‡é“¾è¡¨" class="headerlink" title="åˆ¤æ–­å›æ–‡é“¾è¡¨"></a>åˆ¤æ–­å›æ–‡é“¾è¡¨</h2><p>æ€è·¯ï¼šåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œæ‰¾åˆ°ä¸­ç‚¹ï¼Œç„¶åç¿»è½¬ååŠéƒ¨åˆ†é“¾è¡¨ï¼Œæ¯”è¾ƒå‰åä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ç›¸ç­‰ã€‚æœ€åæ¢å¤é“¾è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(head.next==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//åˆ©ç”¨å¿«æ…¢æŒ‡é’ˆæ‰¾åˆ°ä¸­ç‚¹</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">man</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">kuai</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span> (kuai.next != <span class="literal">null</span> &amp;&amp; kuai.next.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        man = man.next;</span><br><span class="line">        kuai = kuai.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">reverseHead</span> <span class="operator">=</span> reverseList(man);</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">isPal</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">reversePre</span> <span class="operator">=</span>reverseHead;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span>(reversePre!=<span class="literal">null</span> &amp;&amp; pre!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(pre.val!=reversePre.val)&#123;</span><br><span class="line">            isPal = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        reversePre = reversePre.next;</span><br><span class="line">        pre = pre.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é“¾è¡¨è¿˜åŸ</span></span><br><span class="line">    reverseList(reverseHead);</span><br><span class="line">    <span class="keyword">return</span> isPal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span>&#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>,next=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span>(head!=<span class="literal">null</span>)&#123;</span><br><span class="line">        next =head.next;</span><br><span class="line">        head.next = pre;</span><br><span class="line">        pre =head;</span><br><span class="line">        head = next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯-å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹"><a href="#é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯-å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹" class="headerlink" title="é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹"></a>é“¾è¡¨æ˜¯å¦å­˜åœ¨ç¯ å¹¶æ±‚ç¯çš„å…¥å£èŠ‚ç‚¹</h2><p>æ€è·¯ï¼šåˆ©ç”¨å¿«æ…¢æŒ‡é’ˆï¼Œå¿«æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸¤æ­¥ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡ç§»åŠ¨ä¸€æ­¥ï¼Œå¦‚æœå¿«æ…¢æŒ‡é’ˆç›¸é‡ï¼Œåˆ™è¯´æ˜é“¾è¡¨æœ‰ç¯ï¼Œå¦åˆ™æ²¡æœ‰ç¯ã€‚ç›¸é‡çš„æ—¶å€™ï¼Œå¿«æŒ‡é’ˆå›åˆ°å¤´èŠ‚ç‚¹ï¼Œæ…¢æŒ‡é’ˆç»§ç»­ç§»åŠ¨ï¼Œä½†æ˜¯æ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆæ¯æ¬¡éƒ½ç§»åŠ¨ä¸€æ­¥ï¼Œå†æ¬¡ç›¸é‡çš„æ—¶å€™å°±æ˜¯ç¯çš„å…¥å£èŠ‚ç‚¹ã€‚ a+(nb+c) = 2(a+c)  a = nb - c  æ‰€ä»¥æ…¢æŒ‡é’ˆå†èµ°aæ­¥ï¼Œå°±èƒ½åˆ°è¾¾å…¥å£èŠ‚ç‚¹ã€‚æ­¤æ—¶å¿«æŒ‡é’ˆä¹Ÿèµ°aæ­¥ï¼Œæ…¢æŒ‡é’ˆå’Œå¿«æŒ‡é’ˆç›¸é‡çš„èŠ‚ç‚¹å°±æ˜¯å…¥å£èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">detectCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(head ==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span>head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span>(fast!=<span class="literal">null</span> &amp;&amp; fast.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        slow = slow.next;</span><br><span class="line">        <span class="keyword">if</span>(fast==slow)&#123;</span><br><span class="line">            fast = head;</span><br><span class="line">            <span class="keyword">while</span>(fast!=slow)&#123;</span><br><span class="line">                fast = fast.next;</span><br><span class="line">                slow = slow.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> slow;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ’åºé“¾è¡¨"><a href="#æ’åºé“¾è¡¨" class="headerlink" title="æ’åºé“¾è¡¨"></a>æ’åºé“¾è¡¨</h2><p>è¦æ±‚ï¼šæ—¶é—´å¤æ‚åº¦nlog(n),ç©ºé—´å¤æ‚åº¦O(1)ï¼Œä¸”ç¨³å®š<br>æ€è·¯ï¼šåˆ©ç”¨éé€’å½’ç‰ˆæœ¬çš„å½’å¹¶æ’åºï¼Œå¹¶ä¸”mergeæ˜¯åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨ã€‚<br>ä»£ç å¾ˆå¤æ‚ï¼Œçœ‹çœ‹å°±å¥½<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// æ—¶é—´å¤æ‚åº¦O(n*logn)ï¼Œé¢å¤–ç©ºé—´å¤æ‚åº¦O(1)ï¼Œæœ‰ç¨³å®šæ€§</span></span><br><span class="line"><span class="comment">// æ³¨æ„ä¸ºäº†é¢å¤–ç©ºé—´å¤æ‚åº¦O(1)ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨é€’å½’</span></span><br><span class="line"><span class="comment">// å› ä¸ºmergeSorté€’å½’éœ€è¦O(log n)çš„é¢å¤–ç©ºé—´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">sortList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">n++;</span><br><span class="line">cur = cur.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// l1...r1 æ¯ç»„çš„å·¦éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// l2...r2 æ¯ç»„çš„å³éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// next ä¸‹ä¸€ç»„çš„å¼€å¤´</span></span><br><span class="line"><span class="comment">// lastTeamEnd ä¸Šä¸€ç»„çš„ç»“å°¾</span></span><br><span class="line">ListNode l1, r1, l2, r2, next, lastTeamEnd;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">step</span> <span class="operator">=</span> <span class="number">1</span>; step &lt; n; step &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç»„å¾ˆç‰¹æ®Šï¼Œå› ä¸ºè¦å†³å®šæ•´ä¸ªé“¾è¡¨çš„å¤´ï¼Œæ‰€ä»¥å•ç‹¬å¤„ç†</span></span><br><span class="line">l1 = head;</span><br><span class="line">r1 = findEnd(l1, step);</span><br><span class="line">l2 = r1.next;</span><br><span class="line">r2 = findEnd(l2, step);</span><br><span class="line">next = r2.next;</span><br><span class="line">r1.next = <span class="literal">null</span>;</span><br><span class="line">r2.next = <span class="literal">null</span>;</span><br><span class="line">merge(l1, r1, l2, r2);</span><br><span class="line">head = start;</span><br><span class="line">lastTeamEnd = end;</span><br><span class="line"><span class="keyword">while</span> (next != <span class="literal">null</span>) &#123;</span><br><span class="line">l1 = next;</span><br><span class="line">r1 = findEnd(l1, step);</span><br><span class="line">l2 = r1.next;</span><br><span class="line"><span class="keyword">if</span> (l2 == <span class="literal">null</span>) &#123;</span><br><span class="line">lastTeamEnd.next = l1;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">r2 = findEnd(l2, step);</span><br><span class="line">next = r2.next;</span><br><span class="line">r1.next = <span class="literal">null</span>;</span><br><span class="line">r2.next = <span class="literal">null</span>;</span><br><span class="line">merge(l1, r1, l2, r2);</span><br><span class="line">lastTeamEnd.next = start;</span><br><span class="line">lastTeamEnd = end;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒ…æ‹¬såœ¨å†…ï¼Œå¾€ä¸‹æ•°kä¸ªèŠ‚ç‚¹è¿”å›</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸å¤Ÿï¼Œè¿”å›æœ€åä¸€ä¸ªæ•°åˆ°çš„éç©ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode <span class="title function_">findEnd</span><span class="params">(ListNode s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (s.next != <span class="literal">null</span> &amp;&amp; --k != <span class="number">0</span>) &#123;</span><br><span class="line">s = s.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode start;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ListNode end;</span><br><span class="line"></span><br><span class="line"><span class="comment">// l1...r1 -&gt; null : æœ‰åºçš„å·¦éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// l2...r2 -&gt; null : æœ‰åºçš„å³éƒ¨åˆ†</span></span><br><span class="line"><span class="comment">// æ•´ä½“mergeåœ¨ä¸€èµ·ï¼Œä¿è¯æœ‰åº</span></span><br><span class="line"><span class="comment">// å¹¶ä¸”æŠŠå…¨å±€å˜é‡startè®¾ç½®ä¸ºæ•´ä½“çš„å¤´ï¼Œå…¨å±€å˜é‡endè®¾ç½®ä¸ºæ•´ä½“çš„å°¾</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(ListNode l1, ListNode r1, ListNode l2, ListNode r2)</span> &#123;</span><br><span class="line">ListNode pre;</span><br><span class="line"><span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">start = l1;</span><br><span class="line">pre = l1;</span><br><span class="line">l1 = l1.next;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">start = l2;</span><br><span class="line">pre = l2;</span><br><span class="line">l2 = l2.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (l1 != <span class="literal">null</span> &amp;&amp; l2 != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (l1.val &lt;= l2.val) &#123;</span><br><span class="line">pre.next = l1;</span><br><span class="line">pre = l1;</span><br><span class="line">l1 = l1.next;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre.next = l2;</span><br><span class="line">pre = l2;</span><br><span class="line">l2 = l2.next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (l1 != <span class="literal">null</span>) &#123;</span><br><span class="line">pre.next = l1;</span><br><span class="line">end = r1;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre.next = l2;</span><br><span class="line">end = r2;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å®ç°LRUç¼“å­˜"><a href="#å®ç°LRUç¼“å­˜" class="headerlink" title="å®ç°LRUç¼“å­˜"></a>å®ç°LRUç¼“å­˜</h2><p>æ€è·¯ï¼šåˆ©ç”¨åŒå‘é“¾è¡¨å’ŒHashMapï¼ŒåŒå‘é“¾è¡¨è´Ÿè´£ç»´æŠ¤æœ€ä¹…æœªä½¿ç”¨çš„é¡ºåºï¼ˆæœ€ä¹…æœªä½¿ç”¨æ”¾åˆ°å¤´èŠ‚ç‚¹ï¼Œåªè¦ä½¿ç”¨å°±æ”¾åˆ°å°¾èŠ‚ç‚¹ï¼‰ï¼ˆå®ç°ä¸‰ä¸ªåŠŸèƒ½ 1.åŠ å…¥èŠ‚ç‚¹(ç›´æ¥æ”¾å…¥å°¾éƒ¨)ï¼Œ2.å°†å·²ç»æœ‰çš„èŠ‚ç‚¹æ”¾å…¥å°¾éƒ¨ï¼Œ3.åˆ é™¤å¤´èŠ‚ç‚¹ï¼‰ï¼ŒHashMapå®ç°å¿«é€ŸæŸ¥æ‰¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Listnode</span>&#123;</span><br><span class="line">            <span class="type">int</span> val;</span><br><span class="line">            <span class="type">int</span> key;</span><br><span class="line">            Listnode last;</span><br><span class="line">            Listnode next;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">Listnode</span><span class="params">(<span class="type">int</span> val,<span class="type">int</span> key)</span>&#123;</span><br><span class="line">                <span class="built_in">this</span>.val =val;</span><br><span class="line">                <span class="built_in">this</span>.key =key;</span><br><span class="line">                last =<span class="literal">null</span>;</span><br><span class="line">                next =<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">doubleList</span>&#123;</span><br><span class="line">            Listnode head;</span><br><span class="line">            Listnode tail;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">doubleList</span><span class="params">()</span>&#123;</span><br><span class="line">                head =<span class="literal">null</span>;</span><br><span class="line">                tail =<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNode</span><span class="params">(Listnode node)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(head == <span class="literal">null</span>)&#123;</span><br><span class="line">                    head = node;</span><br><span class="line">                    tail = node;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    tail.next = node;</span><br><span class="line">                    node.last = tail;</span><br><span class="line">                    tail = node;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveNode2Tail</span><span class="params">(Listnode node)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (tail == node) &#123;  <span class="comment">/// å¦‚æœæ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ä¸éœ€è¦ç§»åŠ¨</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node == head)&#123;</span><br><span class="line">                    head = node.next;</span><br><span class="line">                    head.last =<span class="literal">null</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    node.last.next = node.next;</span><br><span class="line">                    node.next.last = node.last;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                tail.next = node;</span><br><span class="line">                node.last = tail;</span><br><span class="line">                node.next = <span class="literal">null</span>;</span><br><span class="line">                tail =node;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> Listnode <span class="title function_">delHead</span><span class="params">()</span>&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">h</span> <span class="operator">=</span>head;</span><br><span class="line">                <span class="keyword">if</span>(head == tail)&#123;</span><br><span class="line">                    head = <span class="literal">null</span>;</span><br><span class="line">                    tail =<span class="literal">null</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">Listnode</span> <span class="variable">next</span> <span class="operator">=</span>head.next;</span><br><span class="line">                    head.next = <span class="literal">null</span>;</span><br><span class="line">                    head = next;</span><br><span class="line">                    head.last = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> h;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> HashMap&lt;Integer,Listnode&gt; myMap;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> <span class="variable">cap</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span>  <span class="type">int</span> <span class="variable">MaxCap</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span> doubleList myList;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.cap = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">this</span>.MaxCap = capacity;</span><br><span class="line">            myMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer,Listnode&gt;();</span><br><span class="line">            myList = <span class="keyword">new</span> <span class="title class_">doubleList</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(myMap.containsKey(key))&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> myMap.get(key);</span><br><span class="line">                myList.moveNode2Tail(node);</span><br><span class="line">                <span class="keyword">return</span> node.val;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(myMap.containsKey(key))&#123;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> myMap.get(key);</span><br><span class="line">                node.val = value;</span><br><span class="line">                myList.moveNode2Tail(node);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(cap == MaxCap)&#123;</span><br><span class="line">                    myMap.remove(myList.delHead().key);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    cap++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Listnode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Listnode</span>(value,key);</span><br><span class="line">                myMap.put(key,node);</span><br><span class="line">                myList.addNode(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&quot;&gt;&lt;/a&gt;é“¾è¡¨ç›¸å…³çš„é¢˜ç›®&lt;/h1&gt;&lt;p&gt;è¿™é‡Œç”¨æ¥è®°å½•é“¾è¡¨ç›¸å…³çš„é¢˜ç›®ä»¥åŠæ€è·¯&lt;/p&gt;
&lt;h2 id=&quot;ç›¸äº¤é“¾è¡¨&quot;&gt;&lt;a href=&quot;#ç›¸äº¤é“¾è¡¨</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ç›¸å…³çš„æ€»ç»“</title>
    <link href="https://nmcb666.vip/posts/fee9ca7b.html"/>
    <id>https://nmcb666.vip/posts/fee9ca7b.html</id>
    <published>2026-01-15T14:13:30.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h2><h3 id="TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ"><a href="#TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ" class="headerlink" title="TC å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ"></a>TC å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ</h3><p>ä»¥Seateæ¡†æ¶ä¸ºä¾‹ï¼Œåœ¨TMå‘TCå‘é€å…¨å±€äº‹åŠ¡å¼€å§‹æ—¶ï¼ŒTCä¼šç”Ÿæˆå¯¹åº”çš„å…¨å±€äº‹åŠ¡IDï¼ˆXIDï¼‰ï¼Œå¹¶å‘é€ç»™TMã€‚TM å°† XID æ”¾å…¥å½“å‰çº¿ç¨‹çš„ ThreadLocal ä¸­ï¼Œåç»­çš„ RM (èµ„æºç®¡ç†å™¨) åˆ†æ”¯äº‹åŠ¡é€šè¿‡è§£æè¯¥ XID æ¥æ³¨å†Œåˆ†æ”¯ã€‚å¦‚æœæ¶‰åŠRPCè°ƒç”¨ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ä¼šåœ¨è¯·æ±‚å¤´éƒ¨ä¼ é€’è¿™ä¸ªXIDï¼Œè®©RMçŸ¥é“è¿™ä¸ªXID,RMå‘TCå‘é€åˆ†æ”¯äº‹åŠ¡å¼€å§‹æ—¶,å°±ä¼šæºå¸¦è¿™ä¸ªXID,ä»è€Œå‘Šè¯‰TCè¿™ä¸ªRMå±äºå“ªä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</p><p>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œç”±äºæ¯ä¸ªçº¿ç¨‹çš„XIDæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ‰€ä»¥æ— æ³•ç¡®å®šå“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚è¿™æ—¶å…¨å±€äº‹åŠ¡ä¼šå¤±æ•ˆã€‚è§£å†³æ–¹æ¡ˆå¯ä»¥æ˜¯åœ¨å¼€å¯æ–°çº¿ç¨‹æ—¶ï¼Œå°†XIDä¼ é€’ç»™æ–°çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹çš„XIDä¼šç»§æ‰¿çˆ¶çº¿ç¨‹çš„XIDã€‚è¿™æ ·å­çº¿ç¨‹çš„XIDå°±ä¼šå’Œçˆ¶çº¿ç¨‹çš„XIDä¸€è‡´ï¼Œä»è€Œå¯ä»¥ç¡®å®šå“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-15%20142842.png" alt="æµç¨‹å›¾ç‰‡"/></div><span class="image-caption">æµç¨‹å›¾ç‰‡</span></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#åˆ†å¸ƒå¼äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;åˆ†å¸ƒå¼äº‹åŠ¡&quot;&gt;&lt;/a&gt;åˆ†å¸ƒå¼äº‹åŠ¡&lt;/h2&gt;&lt;h3 id=&quot;TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Ÿ&quot;&gt;&lt;a href=&quot;#TC-å¦‚ä½•çŸ¥é“å“ªäº›RMå±äºåŒä¸€ä¸ªå…¨å±€äº‹åŠ¡</summary>
      
    
    
    
    
    <category term="å…«è‚¡" scheme="https://nmcb666.vip/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
  <entry>
    <title>DDDä¸MVCçš„ç»Ÿä¸€</title>
    <link href="https://nmcb666.vip/posts/f4b47790.html"/>
    <id>https://nmcb666.vip/posts/f4b47790.html</id>
    <published>2026-01-11T18:50:35.000Z</published>
    <updated>2026-01-19T13:51:09.831Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ"><a href="#MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ" class="headerlink" title="MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ"></a>MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ</h1><p>åœ¨åç«¯å¼€å‘å­¦ä¹ å’Œå®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šè¢«å„ç§æ¶æ„æ¨¡å¼å’Œè®¾è®¡æ€æƒ³å›´ç»•â€”â€”MVCã€Service+DAOåˆ†å±‚ã€DDDå››å±‚æ¶æ„ï¼ˆDDDå¹¶éä¸å››å±‚æ¶æ„ç»‘å®š DDDæ˜¯æ€æƒ³ï¼Œå››å±‚æ¶æ„æ˜¯ä»£ç è½åœ°çš„ä¸€ä¸ªæ¶æ„ï¼‰â€¦â€¦è¿™äº›æ¦‚å¿µä¹‹é—´åˆ°åº•æ˜¯æ›¿ä»£å…³ç³»è¿˜æ˜¯äº’è¡¥å…³ç³»ï¼Ÿä¸ºä»€ä¹ˆç®€å•ä¸šåŠ¡ç”¨Service+DAOå°±å¤Ÿï¼Œå¤æ‚ä¸šåŠ¡å´è¦å¼•å…¥DDDï¼Ÿç»“åˆè¿‘æœŸçš„å­¦ä¹ æ€è€ƒï¼Œæˆ‘æƒ³æ¢³ç†æ¸…æ¥šè¿™äº›æ¶æ„ä¹‹é—´çš„æ ¸å¿ƒå…³è”ï¼Œå¸®è‡ªå·±ï¼ˆä¹Ÿå¸Œæœ›å¸®åˆ°åŒæ ·å›°æƒ‘çš„åŒå­¦ï¼‰å»ºç«‹æ¸…æ™°çš„è®¤çŸ¥ã€‚</p><h2 id="ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜"><a href="#ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜" class="headerlink" title="ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜"></a>ä¸€ã€èµ·ç‚¹ï¼šMVCçš„æ ¸å¿ƒä»·å€¼â€”â€”è§£å†³â€œä»£ç æ”¾å“ªâ€çš„åŸºç¡€é—®é¢˜</h2><p>æœ€æ—©æ¥è§¦åç«¯å¼€å‘æ—¶ï¼ŒMVCæ˜¯ç»•ä¸å¼€çš„å…¥é—¨æ¶æ„ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼šå°†è½¯ä»¶åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒå±‚çº§ï¼Œå®ç°â€œå±•ç¤ºä¸é€»è¾‘â€çš„åˆæ­¥è§£è€¦ã€‚</p><ul><li><p><strong>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰</strong>ï¼šæ¥æ”¶ç”¨æˆ·è¯·æ±‚ã€åè°ƒåç»­å¤„ç†ã€è¿”å›å“åº”ï¼Œç›¸å½“äºç³»ç»Ÿçš„â€œå…¥å£/å‡ºå£â€ï¼Œä¸æ‰¿è½½æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼›</p></li><li><p><strong>Modelï¼ˆæ¨¡å‹ï¼‰</strong>ï¼šå°è£…æ•°æ®å’Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ˜¯ç³»ç»Ÿçš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£æ•°æ®çš„å¢åˆ æ”¹æŸ¥å’Œä¸šåŠ¡è§„åˆ™æ ¡éªŒï¼›</p></li><li><p><strong>Viewï¼ˆè§†å›¾ï¼‰</strong>ï¼šå±•ç¤ºæ•°æ®ï¼Œä¸ç”¨æˆ·ç›´æ¥äº¤äº’ï¼ˆå‰åç«¯åˆ†ç¦»åœºæ™¯ä¸‹ï¼Œå‰ç«¯é¡µé¢å³Viewå±‚ï¼Œåç«¯ä¸å†å…³æ³¨ï¼‰ã€‚</p></li></ul><p>MVCçš„ä»·å€¼åœ¨äºç»™å‡ºäº†â€œä»£ç è¯¥æ”¾å“ªâ€çš„æ˜ç¡®ç­”æ¡ˆï¼Œè§£å†³äº†æ—©æœŸå¼€å‘ä¸­â€œä¸šåŠ¡é€»è¾‘ä¸é¡µé¢å±•ç¤ºæ··åœ¨ä¸€èµ·â€çš„æ··ä¹±é—®é¢˜ã€‚ä½†å®ƒçš„å±€é™æ€§ä¹Ÿå¾ˆæ˜æ˜¾ï¼šModelå±‚æ˜¯ä¸€ä¸ªâ€œå¤§é»‘ç›’â€ï¼Œæ²¡æœ‰æ˜ç¡®çš„å†…éƒ¨åˆ’åˆ†æ ‡å‡†â€”â€”å½“ä¸šåŠ¡ç®€å•æ—¶ï¼Œä¸€ä¸ªService+Mapperå°±èƒ½æ’‘èµ·Modelå±‚ï¼›ä½†å½“ä¸šåŠ¡å¤æ‚ï¼ˆæ¯”å¦‚ç”µå•†è®¢å•å±¥çº¦ã€é‡‘èé£æ§ï¼‰æ—¶ï¼Œç›´æ¥æŠŠæ‰€æœ‰é€»è¾‘å †åœ¨Serviceé‡Œï¼Œå¾ˆå¿«å°±ä¼šå¯¼è‡´ä»£ç è‡ƒè‚¿ã€é€»è¾‘æ··ä¹±ã€éš¾ä»¥ç»´æŠ¤ã€‚</p><h2 id="äºŒã€æ¼”è¿›ï¼šService-DAOåˆ†å±‚â€”â€”MVC-Modelå±‚çš„ç®€æ˜“æ‹†åˆ†"><a href="#äºŒã€æ¼”è¿›ï¼šService-DAOåˆ†å±‚â€”â€”MVC-Modelå±‚çš„ç®€æ˜“æ‹†åˆ†" class="headerlink" title="äºŒã€æ¼”è¿›ï¼šService+DAOåˆ†å±‚â€”â€”MVC Modelå±‚çš„ç®€æ˜“æ‹†åˆ†"></a>äºŒã€æ¼”è¿›ï¼šService+DAOåˆ†å±‚â€”â€”MVC Modelå±‚çš„ç®€æ˜“æ‹†åˆ†</h2><p>ä¸ºäº†å¼¥è¡¥MVC Modelå±‚çš„æ¨¡ç³Šæ€§ï¼Œåœ¨Springç”Ÿæ€å®è·µä¸­ï¼Œæˆ‘ä»¬è‡ªç„¶æ¼”åŒ–å‡ºäº†â€œController+Service+DAOï¼ˆMapperï¼‰â€çš„ä¸‰å±‚è½åœ°æ–¹æ¡ˆã€‚è¿™æœ¬è´¨ä¸Šæ˜¯å¯¹MVCçš„Modelå±‚åšäº†ç¬¬ä¸€æ¬¡â€œç²—ç²’åº¦æ‹†åˆ†â€ï¼Œè®©èŒè´£æ›´æ¸…æ™°ï¼š</p><ul><li><p><strong>Controllerå±‚</strong>ï¼šå®Œå…¨å¯¹åº”MVCçš„Controllerå±‚ï¼Œè´Ÿè´£è¯·æ±‚æ¥æ”¶ã€å‚æ•°ç®€å•æ ¡éªŒã€è°ƒç”¨Serviceå±‚ï¼›</p></li><li><p><strong>Serviceå±‚</strong>ï¼šå¯¹åº”MVC Modelå±‚çš„â€œä¸šåŠ¡é€»è¾‘æ ¸å¿ƒâ€ï¼Œå®ç°è®¢å•æ”¯ä»˜ã€åº“å­˜æ‰£å‡ç­‰æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ï¼›</p></li><li><p><strong>DAOï¼ˆMapperï¼‰å±‚</strong>ï¼šå¯¹åº”MVC Modelå±‚çš„â€œæ•°æ®è®¿é—®éƒ¨åˆ†â€ï¼Œä»…è´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ï¼Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚</p></li></ul><p>è¿™ç§æ‹†åˆ†æ–¹æ¡ˆç®€å•ç›´è§‚ã€å¼€å‘æ•ˆç‡é«˜ï¼Œéå¸¸é€‚åˆç®€å•CRUDåœºæ™¯ï¼ˆæ¯”å¦‚å°å‹ç®¡ç†åå°ã€ä¸ªäººå·¥å…·ï¼‰ã€‚ä½†å®ƒçš„é—®é¢˜åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹ä¼šæš´éœ²æ— é—ï¼šServiceå±‚å¾ˆå®¹æ˜“å˜æˆâ€œä¸‡èƒ½å±‚â€â€”â€”æ—¢è¦å¤„ç†è·¨å®ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼ˆæ¯”å¦‚æ”¯ä»˜éœ€è¦åè°ƒè®¢å•ã€åº“å­˜ã€æ”¯ä»˜ä¸‰ä¸ªæ¨¡å—ï¼‰ï¼Œåˆè¦å…¼é¡¾äº‹åŠ¡æ§åˆ¶ã€æ•°æ®ç»„è£…ç­‰è¾…åŠ©é€»è¾‘ï¼Œæœ€ç»ˆå¯¼è‡´Serviceå±‚ä»£ç è‡ƒè‚¿ã€é€»è¾‘ç¼ ç»•ï¼Œåç»­è¿­ä»£å’Œç»´æŠ¤æˆæœ¬æé«˜ã€‚</p><h2 id="ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC-Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§"><a href="#ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC-Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§" class="headerlink" title="ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§"></a>ä¸‰ã€è¿›é˜¶ï¼šDDDå››å±‚æ¶æ„â€”â€”MVC Modelå±‚çš„ç²¾ç»†åŒ–å‡çº§</h2><p>å½“ä¸šåŠ¡å¤æ‚åº¦ä¸Šå‡åˆ°ä¸€å®šç¨‹åº¦ï¼ŒDDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰å°±æˆäº†æ›´ä¼˜çš„é€‰æ‹©ã€‚å¾ˆå¤šäººä¼šè¯¯ä»¥ä¸ºDDDæ˜¯â€œæ›¿ä»£MVCâ€çš„æ¶æ„ï¼Œå…¶å®ä¸ç„¶â€”â€”DDDæœ¬è´¨ä¸Šæ˜¯ä¸€å¥—â€œä¸šåŠ¡å»ºæ¨¡æ–¹æ³•è®ºâ€ï¼Œå®ƒåœ¨MVCçš„å¤§æ¡†æ¶ä¸‹ï¼Œå¯¹Modelå±‚åšäº†æ›´ç²¾ç»†çš„æ‹†åˆ†ï¼Œè®©å¤æ‚ä¸šåŠ¡é€»è¾‘æ›´æ¸…æ™°ã€æ›´è´´åˆä¸šåŠ¡æœ¬èº«ã€‚</p><p>DDDæå‡ºçš„å››å±‚æ¶æ„ï¼ˆç”¨æˆ·å±‚/æ¥å£å±‚ã€åº”ç”¨å±‚ã€é¢†åŸŸå±‚ã€åŸºç¡€è®¾æ–½å±‚ï¼‰ï¼Œä¸MVCã€Service+DAOåˆ†å±‚çš„å¯¹åº”å…³ç³»éå¸¸æ¸…æ™°ï¼Œæ ¸å¿ƒç»“è®ºå…ˆæŠ›å‡ºæ¥ï¼š<strong>DDDçš„ç”¨æˆ·å±‚å¯¹åº”MVCçš„Controllerå±‚ï¼Œåä¸‰å±‚å…±åŒæ„æˆMVCçš„Modelå±‚ï¼›DDDä¸MVCå®Œå…¨å…¼å®¹ï¼Œåªæ˜¯å¯¹Modelå±‚çš„æ‹†åˆ†æ›´å½»åº•</strong>ã€‚</p><h3 id="1-DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»"><a href="#1-DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»" class="headerlink" title="1. DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»"></a>1. DDDå››å±‚æ¶æ„çš„æ ¸å¿ƒèŒè´£ä¸å¯¹åº”å…³ç³»</h3><div class="table-container"><table><thead><tr><th>DDDå››å±‚æ¶æ„</th><th>æ ¸å¿ƒèŒè´£</th><th>å¯¹åº”MVCåˆ†å±‚</th><th>å¯¹åº”Service+DAOåˆ†å±‚</th><th>Springå®è·µè½åœ°</th></tr></thead><tbody><tr><td>ç”¨æˆ·å±‚ï¼ˆæ¥å£å±‚ï¼‰</td><td>æ¥æ”¶å¤–éƒ¨è¯·æ±‚ï¼ˆHTTP/RPC/æ¶ˆæ¯ï¼‰ã€è¿”å›å“åº”ã€å‚æ•°éä¸šåŠ¡æ ¡éªŒã€æƒé™æ‹¦æˆª</td><td>Controllerå±‚</td><td>Controllerå±‚</td><td>@RestControllerã€ControllerAdviceã€RPCæ¥å£</td></tr><tr><td>åº”ç”¨å±‚</td><td>åè°ƒé¢†åŸŸå±‚æ‰§è¡Œã€å¤„ç†äº‹åŠ¡ã€ç»„è£…è¿”å›æ•°æ®ï¼Œæ— æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</td><td>Modelå±‚</td><td>Serviceå±‚çš„â€œåè°ƒéƒ¨åˆ†â€</td><td>XXXApplicationServiceï¼ˆåº”ç”¨æœåŠ¡ï¼‰</td></tr><tr><td>é¢†åŸŸå±‚</td><td>å°è£…æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€èšåˆæ ¹/å®ä½“/å€¼å¯¹è±¡ã€è·¨å®ä½“ä¸šåŠ¡é€»è¾‘ï¼Œç³»ç»Ÿæ ¸å¿ƒ</td><td>Modelå±‚ï¼ˆæ ¸å¿ƒï¼‰</td><td>Serviceå±‚çš„â€œæ ¸å¿ƒä¸šåŠ¡éƒ¨åˆ†â€</td><td>èšåˆæ ¹ï¼ˆEntityï¼‰ã€XXXDomainServiceï¼ˆé¢†åŸŸæœåŠ¡ï¼‰</td></tr><tr><td>åŸºç¡€è®¾æ–½å±‚</td><td>å°è£…æŠ€æœ¯ç»†èŠ‚ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€ç¬¬ä¸‰æ–¹æ¥å£ï¼‰ï¼Œä¸ºä¸Šå±‚æä¾›æŠ€æœ¯æ”¯æ’‘</td><td>Modelå±‚</td><td>DAOï¼ˆMapperï¼‰å±‚</td><td>Repositoryã€Mapperã€RedisTemplateã€Feignå®¢æˆ·ç«¯</td></tr></tbody></table></div><h3 id="2-å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡-é¢†åŸŸæœåŠ¡â€"><a href="#2-å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡-é¢†åŸŸæœåŠ¡â€" class="headerlink" title="2. å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡+é¢†åŸŸæœåŠ¡â€"></a>2. å…³é”®æ¼”è¿›ï¼šä»Serviceå±‚åˆ°â€œåº”ç”¨æœåŠ¡+é¢†åŸŸæœåŠ¡â€</h3><p>DDDå¯¹Service+DAOåˆ†å±‚çš„æ ¸å¿ƒä¼˜åŒ–ï¼Œå°±æ˜¯æŠŠä¼ ç»Ÿâ€œåšServiceâ€æ‹†æˆäº†â€œè–„åº”ç”¨æœåŠ¡â€å’Œâ€œåšé¢†åŸŸæœåŠ¡â€ï¼Œè®©ä¸šåŠ¡é€»è¾‘çš„å½’å±æ›´æ˜ç¡®ï¼š</p><ul><li><p><strong>é¢†åŸŸæœåŠ¡</strong>ï¼šåªè´Ÿè´£æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚â€œè®¢å•æ”¯ä»˜â€éœ€è¦æ ¡éªŒè®¢å•çŠ¶æ€ã€æ‰£å‡åº“å­˜ã€æ›´æ–°æ”¯ä»˜çŠ¶æ€ç­‰è·¨å®ä½“é€»è¾‘ï¼Œéƒ½æ”¾åœ¨é¢†åŸŸæœåŠ¡ï¼›</p></li><li><p><strong>åº”ç”¨æœåŠ¡</strong>ï¼šä¸ç¢°æ ¸å¿ƒä¸šåŠ¡ï¼Œåªåšâ€œåè°ƒå·¥ä½œâ€â€”â€”æ¯”å¦‚å¼€å¯äº‹åŠ¡ã€è°ƒç”¨é¢†åŸŸæœåŠ¡ã€æŠŠé¢†åŸŸå±‚çš„ç»“æœç»„è£…æˆå‰ç«¯éœ€è¦çš„æ ¼å¼ã€‚</p></li></ul><p>åŒæ—¶ï¼ŒDDDè¿˜å¼ºè°ƒâ€œä¸šåŠ¡é©±åŠ¨å»ºæ¨¡â€ï¼šå…ˆæ¢³ç†ä¸šåŠ¡é¢†åŸŸçš„è§„åˆ™ï¼ˆæ¯”å¦‚â€œæœªæ”¯ä»˜è®¢å•24å°æ—¶è‡ªåŠ¨å–æ¶ˆâ€ï¼‰ï¼Œå†æŠŠè¿™äº›è§„åˆ™å°è£…åˆ°å®ä½“ç±»ä¸­ï¼ˆæ¯”å¦‚Orderå®ä½“çš„canPay()ã€markAsPaid()æ–¹æ³•ï¼‰ï¼Œè€Œä¸æ˜¯åƒä¼ ç»ŸService+DAOé‚£æ ·ï¼ŒæŠŠæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½å†™åœ¨Serviceçš„if-elseé‡Œã€‚è¿™ç§æ–¹å¼è®©ä»£ç æ›´è´´åˆä¸šåŠ¡ï¼Œåç»­è¿­ä»£æ—¶ä¹Ÿæ›´å®¹æ˜“ç†è§£å’Œä¿®æ”¹ã€‚</p><h2 id="å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ"><a href="#å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ" class="headerlink" title="å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ"></a>å››ã€æ ¸å¿ƒè®¤çŸ¥ï¼šæ‰€æœ‰æ¶æ„çš„æœ¬è´¨éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯ç²’åº¦ä¸åŒ</h2><p>æ¢³ç†å®Œä»MVCåˆ°Service+DAOï¼Œå†åˆ°DDDçš„æ¼”è¿›è„‰ç»œï¼Œä¼šå‘ç°ä¸€ä¸ªæ ¸å¿ƒè§„å¾‹ï¼š<strong>æ‰€æœ‰æ¶æ„åˆ†å±‚çš„æœ€ç»ˆç›®æ ‡éƒ½æ˜¯â€œè§£è€¦â€ï¼Œåªæ˜¯é’ˆå¯¹ä¸åŒä¸šåŠ¡å¤æ‚åº¦ï¼Œé€‰æ‹©äº†ä¸åŒçš„æ‹†åˆ†ç²’åº¦</strong>ã€‚</p><ul><li><p>MVCï¼šè§£å†³â€œå±•ç¤ºä¸é€»è¾‘â€çš„è§£è€¦ï¼Œç»™å‡ºæœ€åŸºç¡€çš„åˆ†å±‚æ¡†æ¶ï¼›</p></li><li><p>Service+DAOï¼šè§£å†³MVC Modelå±‚çš„å†…éƒ¨è§£è€¦ï¼Œè®©æ•°æ®è®¿é—®å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œé€‚é…ç®€å•ä¸šåŠ¡ï¼›</p></li><li><p>DDDï¼šè§£å†³å¤æ‚ä¸šåŠ¡ä¸‹Modelå±‚çš„æ·±åº¦è§£è€¦ï¼Œè®©æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€åè°ƒé€»è¾‘ã€æŠ€æœ¯ç»†èŠ‚å½»åº•åˆ†ç¦»ï¼Œé€‚é…å¤æ‚ä¸šåŠ¡ã€‚</p></li></ul><p>å¾ˆå¤šäººä¼šè¯¯ä»¥ä¸ºâ€œDDDæ¯”MVCé«˜çº§â€â€œç”¨äº†DDDå°±ä¸èƒ½ç”¨MVCâ€ï¼Œè¿™å…¶å®æ˜¯è¯¯åŒºã€‚DDDå’ŒMVCä¸æ˜¯å¯¹ç«‹å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»â€”â€”MVCæä¾›äº†æ•´ä½“çš„æ¶æ„éª¨æ¶ï¼ŒDDDåˆ™æ˜¯å¯¹è¿™ä¸ªéª¨æ¶ä¸­â€œModelå±‚â€çš„ç²¾ç»†åŒ–è®¾è®¡æŒ‡å—ã€‚</p><h2 id="äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„"><a href="#äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„" class="headerlink" title="äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„"></a>äº”ã€å®è·µå»ºè®®ï¼šæ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„æ¶æ„</h2><p>æ¶æ„æ²¡æœ‰â€œæœ€ä¼˜è§£â€ï¼Œåªæœ‰â€œæœ€åˆé€‚â€ã€‚ç»“åˆè‡ªå·±çš„å®è·µç»éªŒï¼Œç»™å‡ºå‡ ç‚¹é€‰æ‹©å»ºè®®ï¼š</p><ol><li><p><strong>ç®€å•CRUDåœºæ™¯ï¼ˆå°å‹ç®¡ç†åå°ã€ä¸ªäººå·¥å…·ï¼‰</strong>ï¼šç›´æ¥ç”¨â€œController+Service+DAOâ€ï¼Œå¼€å‘æ•ˆç‡é«˜ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œæ²¡å¿…è¦è¿‡åº¦è®¾è®¡ï¼›</p></li><li><p><strong>ä¸­ç­‰å¤æ‚åº¦åœºæ™¯ï¼ˆå¸¸è§„ä¸šåŠ¡ç³»ç»Ÿï¼‰</strong>ï¼šå¯ä»¥å€Ÿé‰´DDDçš„æ€æƒ³ï¼Œåœ¨Serviceå±‚å†…éƒ¨åšç®€å•æ‹†åˆ†ï¼ˆæ¯”å¦‚æŠŠæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æŠ½æˆå•ç‹¬çš„æ–¹æ³•æˆ–ç±»ï¼‰ï¼Œé¿å…Serviceå±‚è‡ƒè‚¿ï¼›</p></li><li><p><strong>é«˜å¤æ‚åº¦åœºæ™¯ï¼ˆç”µå•†ã€é‡‘èã€ä¾›åº”é“¾ï¼‰</strong>ï¼šæ¨èä½¿ç”¨DDDå››å±‚æ¶æ„ï¼Œé€šè¿‡é¢†åŸŸå»ºæ¨¡è®©å¤æ‚ä¸šåŠ¡é€»è¾‘æ›´æ¸…æ™°ï¼Œä¸ºé•¿æœŸè¿­ä»£æ‰“ä¸‹åŸºç¡€ï¼›</p></li><li><p><strong>æ¸è¿›å¼æ”¹é€ </strong>ï¼šä¸ç”¨ä¸€å¼€å§‹å°±å…¨ç›˜é‡æ„ä¸ºDDDï¼Œå¯ä»¥ä»â€œæ‹†åˆ†Serviceå±‚â€å¼€å§‹ï¼Œå…ˆæŠŠæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æŠ½æˆé¢†åŸŸæœåŠ¡ï¼Œå†é€æ­¥å®Œå–„åº”ç”¨å±‚å’ŒåŸºç¡€è®¾æ–½å±‚ï¼Œé™ä½æ”¹é€ é£é™©ã€‚</p></li></ol><h2 id="å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>å…­ã€DDDè·Ÿå››å±‚æ¶æ„ä»€ä¹ˆå…³ç³»ï¼Ÿ</h2><p>DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æœ¬èº«ä¸å¼ºåˆ¶è§„å®š â€œå››å±‚æ¶æ„â€ã€‚DDD çš„æ ¸å¿ƒåœ¨äºæˆ˜ç•¥è®¾è®¡ï¼ˆé™ç•Œä¸Šä¸‹æ–‡ã€é¢†åŸŸæ¨¡å‹ï¼‰å’Œæˆ˜æœ¯è®¾è®¡ï¼ˆå®ä½“ã€å€¼å¯¹è±¡ã€èšåˆæ ¹ã€é¢†åŸŸæœåŠ¡ã€ä»“å‚¨ç­‰ï¼‰ï¼Œè€Œ â€œå››å±‚æ¶æ„â€ ç¡®å®æ˜¯ä¸ºäº†è®©è¿™äº›æˆ˜æœ¯è®¾è®¡æ¨¡å¼åœ¨ä»£ç å±‚é¢æ›´å¥½è½åœ°è€Œæ€»ç»“å‡ºçš„ä¸€å¥—ç»å…¸å·¥ç¨‹å®è·µã€‚</p><p>åœ¨å®é™…è½åœ° DDD æ—¶ï¼Œä»£ç æ¶æ„çš„é€‰æ‹©ç¡®å®éå¸¸é‡è¦ã€‚è™½ç„¶ DDD æ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸å¼ºæ±‚ç‰¹å®šç›®å½•ç»“æ„ï¼Œä½†ä¸šç•Œå·²ç»æ²‰æ·€å‡ºä¸¤å¥—æœ€ä¸»æµçš„æ¶æ„æ¨¡å¼ï¼š</p><ol><li><strong>ç»å…¸çš„å››å±‚æ¶æ„ï¼ˆLayered Architectureï¼‰</strong> â€”â€” æœ€å®¹æ˜“ç†è§£ï¼Œé€‚åˆèµ·æ­¥ã€‚</li><li><strong>æ•´æ´/å…­è¾¹å½¢æ¶æ„ï¼ˆClean / Hexagonal Architectureï¼‰</strong> â€”â€” ä¾èµ–å€’ç½®æ›´å½»åº•ï¼Œç°ä»£å¾®æœåŠ¡ä¸»æµã€‚</li></ol><p>æ­¤å¤–ï¼Œå›½å†… Java åœˆï¼ˆç‰¹åˆ«æ˜¯é˜¿é‡Œç³»ï¼‰è¿˜å¸¸ç”¨ <strong>COLA æ¶æ„</strong>ã€‚</p><p>ä¸‹é¢è¯¦ç»†æ‹†è§£è¿™å‡ ç§æ¶æ„çš„ä»£ç ç›®å½•ç»“æ„å’Œæ ¸å¿ƒè¦ç‚¹ã€‚</p><hr><h3 id="æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„-Standard-4-Layer"><a href="#æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„-Standard-4-Layer" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„ (Standard 4-Layer)"></a>æ–¹æ¡ˆä¸€ï¼šç»å…¸çš„å››å±‚æ¶æ„ (Standard 4-Layer)</h3><p>è¿™æ˜¯æœ€ç¬¦åˆä¸Šæ–‡æ‰€æå‡ºè§‚ç‚¹çš„ç†è§£çš„ç»“æ„ï¼Œç»“æ„æ¸…æ™°ï¼Œé€‚åˆä»ä¸‰å±‚æ¶æ„è½¬å‹è¿‡æ¥çš„å›¢é˜Ÿã€‚</p><h4 id="æ ¸å¿ƒåŸåˆ™"><a href="#æ ¸å¿ƒåŸåˆ™" class="headerlink" title="æ ¸å¿ƒåŸåˆ™"></a>æ ¸å¿ƒåŸåˆ™</h4><p><strong>ä¾èµ–å€’ç½®ï¼ˆDIPï¼‰</strong>ï¼šè™½ç„¶ç‰©ç†ä¸Šæ˜¯å››å±‚ï¼Œä½†åœ¨é€»è¾‘ä¸Šï¼Œ<strong>é¢†åŸŸå±‚ï¼ˆDomainï¼‰å¿…é¡»æ˜¯ç‹¬ç«‹çš„</strong>ã€‚</p><ul><li><strong>é”™è¯¯çš„åšæ³•</strong>ï¼šDomain å±‚ <code>import</code> Infrastructure å±‚çš„ä»£ç ã€‚</li><li><strong>æ­£ç¡®çš„åšæ³•</strong>ï¼šDomain å±‚å®šä¹‰æ¥å£ï¼ˆRepository Interfaceï¼‰ï¼ŒInfrastructure å±‚å»å®ç°å®ƒã€‚</li></ul><h4 id="ç›®å½•ç»“æ„ç¤ºä¾‹"><a href="#ç›®å½•ç»“æ„ç¤ºä¾‹" class="headerlink" title="ç›®å½•ç»“æ„ç¤ºä¾‹"></a>ç›®å½•ç»“æ„ç¤ºä¾‹</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">com.company.project</span><br><span class="line">â”œâ”€â”€ interfaces (ç”¨æˆ·æ¥å£å±‚ / Web)</span><br><span class="line">â”‚   â”œâ”€â”€ controller       // å¤„ç† HTTP è¯·æ±‚</span><br><span class="line">â”‚   â””â”€â”€ dto              // æ•°æ®ä¼ è¾“å¯¹è±¡ (Request/Response)</span><br><span class="line">â”œâ”€â”€ application (åº”ç”¨å±‚)</span><br><span class="line">â”‚   â”œâ”€â”€ service          // åº”ç”¨æœåŠ¡ (æµç¨‹ç¼–æ’)</span><br><span class="line">â”‚   â””â”€â”€ assembler        // DTO ä¸ Entity çš„è½¬æ¢å™¨</span><br><span class="line">â”œâ”€â”€ domain (é¢†åŸŸå±‚ - æ ¸å¿ƒ)</span><br><span class="line">â”‚   â”œâ”€â”€ model            // èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ aggregate    // èšåˆ</span><br><span class="line">â”‚   â”‚   â””â”€â”€ entity       // å®ä½“</span><br><span class="line">â”‚   â”œâ”€â”€ service          // é¢†åŸŸæœåŠ¡ (è·¨å®ä½“é€»è¾‘)</span><br><span class="line">â”‚   â””â”€â”€ repository       // ä»“å‚¨æ¥å£ (æ³¨æ„ï¼šè¿™é‡Œåªæ”¾æ¥å£ï¼)</span><br><span class="line">â””â”€â”€ infrastructure (åŸºç¡€è®¾æ–½å±‚)</span><br><span class="line">    â”œâ”€â”€ repository       // ä»“å‚¨å®ç° (Implï¼Œè¿™é‡Œä¾èµ– JPA/MyBatis)</span><br><span class="line">    â”œâ”€â”€ entity           // PO (Persistent Objectï¼Œå¯¹åº”æ•°æ®åº“è¡¨)</span><br><span class="line">    â””â”€â”€ util             // é€šç”¨å·¥å…·</span><br></pre></td></tr></table></figure><hr><h3 id="æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„-å…­è¾¹å½¢æ¶æ„-Clean-Hexagonal"><a href="#æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„-å…­è¾¹å½¢æ¶æ„-Clean-Hexagonal" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„ / å…­è¾¹å½¢æ¶æ„ (Clean / Hexagonal)"></a>æ–¹æ¡ˆäºŒï¼šæ•´æ´æ¶æ„ / å…­è¾¹å½¢æ¶æ„ (Clean / Hexagonal)</h3><p>è¿™æ˜¯ç›®å‰ DDD ç¤¾åŒº<strong>æœ€æ¨è</strong>çš„æ¶æ„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾®æœåŠ¡åœºæ™¯ä¸‹ã€‚å®ƒä¸å†å¼ºè°ƒâ€œä¸Šä¸‹å±‚â€ï¼Œè€Œæ˜¯å¼ºè°ƒâ€œ<strong>å†…å¤–</strong>â€ã€‚</p><ul><li><strong>å†…æ ¸ï¼ˆInnerï¼‰</strong>ï¼šDomain + Applicationã€‚è¿™æ˜¯é›·æ‰“ä¸åŠ¨çš„ä¸šåŠ¡æ ¸å¿ƒã€‚</li><li><strong>å¤–å£³ï¼ˆOuterï¼‰</strong>ï¼šWebã€Databaseã€Redisã€MQã€‚è¿™äº›éƒ½æ˜¯â€œæ’ä»¶â€ã€‚</li></ul><h4 id="æ ¸å¿ƒåŸåˆ™-1"><a href="#æ ¸å¿ƒåŸåˆ™-1" class="headerlink" title="æ ¸å¿ƒåŸåˆ™"></a>æ ¸å¿ƒåŸåˆ™</h4><p><strong>ä¾èµ–åªèƒ½ç”±å¤–å‘å†…</strong>ã€‚å¤–å£³ï¼ˆWebã€DBï¼‰ä¾èµ–å†…æ ¸ï¼ˆDomainï¼‰ï¼Œå†…æ ¸è°ä¹Ÿä¸ä¾èµ–ã€‚</p><h4 id="ç›®å½•ç»“æ„ç¤ºä¾‹-1"><a href="#ç›®å½•ç»“æ„ç¤ºä¾‹-1" class="headerlink" title="ç›®å½•ç»“æ„ç¤ºä¾‹"></a>ç›®å½•ç»“æ„ç¤ºä¾‹</h4><p>è¿™ç§æ¶æ„é€šå¸¸ä¼šæŠŠæ–‡ä»¶å¤¹åˆ†ä¸º <code>adapter</code>ï¼ˆé€‚é…å™¨/å¤–å£³ï¼‰å’Œ <code>core</code>ï¼ˆå†…æ ¸ï¼‰ã€‚</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">com.company.project</span><br><span class="line">â”œâ”€â”€ adapter (é€‚é…å™¨å±‚ - å¯¹åº”â€œå…­è¾¹å½¢â€çš„ç«¯å£)</span><br><span class="line">â”‚   â”œâ”€â”€ inbound (è¾“å…¥ç«¯ / é©±åŠ¨ç«¯)</span><br><span class="line">â”‚   â”‚   â””â”€â”€ web          // RestController</span><br><span class="line">â”‚   â””â”€â”€ outbound (è¾“å‡ºç«¯ / è¢«é©±åŠ¨ç«¯)</span><br><span class="line">â”‚       â”œâ”€â”€ persistence  // æ•°æ®åº“å®ç° (Repository Impl)</span><br><span class="line">â”‚       â””â”€â”€ thirdparty   // ç¬¬ä¸‰æ–¹è°ƒç”¨ (å¦‚è°ƒç”¨æ”¯ä»˜æ¥å£)</span><br><span class="line">â”œâ”€â”€ application (åº”ç”¨å±‚ - ä¸šåŠ¡æµç¨‹)</span><br><span class="line">â”‚   â”œâ”€â”€ service          // åº”ç”¨æœåŠ¡</span><br><span class="line">â”‚   â””â”€â”€ port             // ç«¯å£å®šä¹‰ (å¦‚æœæ˜¯ä¸¥æ ¼å…­è¾¹å½¢ï¼Œæ¥å£å®šä¹‰åœ¨è¿™é‡Œ)</span><br><span class="line">â””â”€â”€ domain (é¢†åŸŸå±‚ - ä¸šåŠ¡æ ¸å¿ƒ)</span><br><span class="line">    â”œâ”€â”€ model            // å®ä½“ã€èšåˆæ ¹</span><br><span class="line">    â”œâ”€â”€ service          // é¢†åŸŸæœåŠ¡</span><br><span class="line">    â””â”€â”€ repository       // ä»“å‚¨æ¥å£ (å®šä¹‰æ•°æ®è¯¥æ€ä¹ˆå­˜ï¼Œä½†ä¸å…³å¿ƒå­˜å“ªé‡Œ)</span><br></pre></td></tr></table></figure><p><strong>åŒºåˆ«ç‚¹</strong>ï¼š<br>ä½ ä¼šå‘ç° <code>Controller</code> å’Œ <code>RepositoryImpl</code> å˜æˆäº†å…„å¼Ÿå…³ç³»ï¼Œéƒ½å±äº <code>Adapter</code>ï¼ˆå¤–å›´è®¾æ–½ï¼‰ï¼Œè€Œ <code>Domain</code> è¢«å±‚å±‚ä¿æŠ¤åœ¨æœ€é‡Œé¢ã€‚</p><hr><h3 id="æ–¹æ¡ˆä¸‰ï¼šCOLA-æ¶æ„-Clean-Object-Oriented-and-Layered-Architecture"><a href="#æ–¹æ¡ˆä¸‰ï¼šCOLA-æ¶æ„-Clean-Object-Oriented-and-Layered-Architecture" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šCOLA æ¶æ„ (Clean Object-Oriented and Layered Architecture)"></a>æ–¹æ¡ˆä¸‰ï¼šCOLA æ¶æ„ (Clean Object-Oriented and Layered Architecture)</h3><p>å¦‚æœä½ æ˜¯ Java å¼€å‘è€…ï¼Œç‰¹åˆ«æ˜¯åœ¨å›½å†…å¤§å‚ç¯å¢ƒï¼Œé˜¿é‡Œå¼€æºçš„ <strong>COLA æ¶æ„</strong> æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ DDD è½åœ°æ¨¡æ¿ã€‚å®ƒç»“åˆäº†å››å±‚æ¶æ„å’Œæ•´æ´æ¶æ„çš„ä¼˜ç‚¹ã€‚</p><p>å®ƒçš„ç‰¹ç‚¹æ˜¯æŠŠ<strong>å¯¹å¤–æš´éœ²çš„æ¥å£ï¼ˆAPIï¼‰</strong>å•ç‹¬æŠ½ç¦»æˆä¸€ä¸ªæ¨¡å—ï¼Œæ–¹ä¾¿å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ã€‚</p><h4 id="Maven-æ¨¡å—ç»“æ„"><a href="#Maven-æ¨¡å—ç»“æ„" class="headerlink" title="Maven æ¨¡å—ç»“æ„"></a>Maven æ¨¡å—ç»“æ„</h4><p>COLA é€šå¸¸æ˜¯å¤š Module çš„ Maven é¡¹ç›®ï¼š</p><ol><li><strong><code>start</code> (å¯åŠ¨å±‚)</strong><ul><li>Spring Boot å¯åŠ¨ç±»ï¼Œå„ç§é…ç½®ã€‚</li></ul></li><li><strong><code>adapter</code> (é€‚é…å±‚)</strong><ul><li>Controller (Web), Consumer (MQ)ã€‚</li></ul></li><li><strong><code>client</code> (API å±‚ / SDK)</strong><ul><li><strong>é‡ç‚¹</strong>ï¼šè¿™é‡Œæ”¾ DTO å’Œ API æ¥å£å®šä¹‰ã€‚å¤–éƒ¨ç³»ç»Ÿåªéœ€è¦ä¾èµ–è¿™ä¸ª jar åŒ…ã€‚</li></ul></li><li><strong><code>app</code> (åº”ç”¨å±‚)</strong><ul><li>Application Service, Command Handlerã€‚</li></ul></li><li><strong><code>domain</code> (é¢†åŸŸå±‚)</strong><ul><li>Entity, ValueObject, DomainService, Repository Interfaceã€‚</li><li><strong>æœ€çº¯å‡€çš„ä¸€å±‚ï¼Œä¸ä¾èµ– Springï¼Œåªä¾èµ– JDKã€‚</strong></li></ul></li><li><strong><code>infrastructure</code> (åŸºç¡€è®¾æ–½å±‚)</strong><ul><li>MyBatis Mapper, Repository Impl, Redis Utilã€‚</li></ul></li></ol><hr><h3 id="æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ"><a href="#æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ" class="headerlink" title="æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ"></a>æ€»ç»“ï¼šæˆ‘è¯¥æ€ä¹ˆé€‰ï¼Ÿ</h3><ol><li><p><strong>å¦‚æœä½ æ˜¯åˆå­¦è€…ï¼Œæˆ–è€…é¡¹ç›®è§„æ¨¡ä¸å¤§</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆä¸€ï¼ˆç»å…¸çš„å››å±‚æ¶æ„ï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šæœ€ç¬¦åˆç›´è§‰ï¼Œæ–‡ä»¶å¤¹åˆ†å±‚æ¸…æ™°ï¼Œä» MVC è¿ç§»è¿‡æ¥è®¤çŸ¥è´Ÿæ‹…æœ€å°ã€‚</li><li><em>æ³¨æ„ç‚¹ï¼šä¸€å®šè¦åšæŒâ€œé¢†åŸŸå±‚å®šä¹‰æ¥å£ï¼ŒåŸºç¡€å±‚å®ç°æ¥å£â€ï¼Œä¸è¦è®©é¢†åŸŸå±‚ä¾èµ– MyBatisã€‚</em></li></ul></li><li><p><strong>å¦‚æœä½ åœ¨åšå¾®æœåŠ¡ï¼Œæˆ–è€…ä¸šåŠ¡é€»è¾‘æåº¦å¤æ‚</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆäºŒï¼ˆæ•´æ´/å…­è¾¹å½¢æ¶æ„ï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šèƒ½å¤Ÿå®Œç¾éš”ç¦»æŠ€æœ¯å®ç°çš„å˜åŠ¨ï¼ˆæ¯”å¦‚ä» MySQL æ¢åˆ° MongoDBï¼Œæ ¸å¿ƒä¸šåŠ¡ä»£ç ä¸€è¡Œéƒ½ä¸ç”¨æ”¹ï¼‰ã€‚</li></ul></li><li><p><strong>å¦‚æœä½ çš„å›¢é˜Ÿç”¨ Java ä¸”ç”±äºè§„èŒƒè¦æ±‚</strong>ï¼š<br>æ¨è <strong>æ–¹æ¡ˆä¸‰ï¼ˆCOLAï¼‰</strong>ã€‚</p><ul><li>ç†ç”±ï¼šå›½å†…èµ„æ–™å¤šï¼Œè§„èŒƒçº¦æŸæ€§å¼ºï¼Œé€‚åˆå›¢é˜Ÿåä½œã€‚</li></ul></li></ol><h3 id="å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰"><a href="#å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰" class="headerlink" title="å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰"></a>å…³é”®ç‚¹ï¼ˆæ— è®ºé€‰å“ªä¸ªæ¶æ„ï¼‰</h3><p>ä¸ç®¡ä½ é€‰å“ªä¸ªæ–‡ä»¶ç»“æ„ï¼ŒDDD è½åœ°çš„<strong>ç”Ÿæ­»çº¿</strong>åªæœ‰ä¸€æ¡ï¼š</p><blockquote><p><strong>Domain å±‚ï¼ˆé¢†åŸŸå±‚ï¼‰å¿…é¡»æ˜¯â€œçº¯å‡€â€çš„ã€‚</strong></p></blockquote><ul><li>å®ƒå¯ä»¥å¼•ç”¨ <code>java.util.List</code>ã€‚</li><li>å®ƒ<strong>ç»å¯¹ä¸èƒ½</strong>å¼•ç”¨ <code>javax.sql.DataSource</code>ã€<code>org.springframework.xxx</code>ã€<code>com.github.pagehelper</code>ã€‚</li><li>å®ƒåªè°ˆä¸šåŠ¡ï¼ˆè´¦å·ã€é‡‘é¢ã€å†»ç»“ï¼‰ï¼Œä¸è°ˆæŠ€æœ¯ï¼ˆè¡¨ã€JSONã€HTTPï¼‰ã€‚</li></ul><p>åªè¦å®ˆä½äº†è¿™æ¡çº¿ï¼Œä½ çš„æ¶æ„å°±æ˜¯åˆæ ¼çš„ DDD æ¶æ„ã€‚</p><h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>ä»MVCåˆ°Service+DAOï¼Œå†åˆ°DDDï¼Œä¸æ˜¯æ¶æ„çš„â€œæ›¿ä»£â€ï¼Œè€Œæ˜¯æ¶æ„çš„â€œæ¼”è¿›â€ã€‚å®ƒä»¬çš„æ ¸å¿ƒéƒ½æ˜¯é€šè¿‡åˆ†å±‚å®ç°è§£è€¦ï¼Œåªæ˜¯é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡å¤æ‚åº¦ï¼Œé€‰æ‹©äº†ä¸åŒçš„æ‹†åˆ†ç²’åº¦ã€‚</p><p>å¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œä¸ç”¨ç›²ç›®è¿½æ±‚â€œé«˜å¤§ä¸Šâ€çš„æ¶æ„ï¼Œè€Œåº”è¯¥ç†è§£æ¯ç§æ¶æ„çš„æ ¸å¿ƒä»·å€¼å’Œé€‚ç”¨åœºæ™¯ï¼šç®€å•ä¸šåŠ¡ç”¨ç®€å•æ¶æ„ï¼Œå¤æ‚ä¸šåŠ¡ç”¨ç²¾ç»†æ¶æ„ã€‚åŒæ—¶ï¼Œè¦æŠ“ä½æ¶æ„è®¾è®¡çš„æœ¬è´¨â€”â€”è®©ä»£ç ç»“æ„æ¸…æ™°ã€èŒè´£æ˜ç¡®ï¼Œä¾¿äºç»´æŠ¤å’Œè¿­ä»£ã€‚è¿™æ‰æ˜¯æˆ‘ä»¬å­¦ä¹ å„ç§æ¶æ„æ€æƒ³çš„æœ€ç»ˆç›®çš„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot;&gt;&lt;a href=&quot;#MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot; class=&quot;headerlink&quot; title=&quot;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&quot;&gt;&lt;/a&gt;MVCåˆ°DDDï¼šä»æ¶æ„åˆ†å±‚åˆ°ä¸šåŠ¡å»ºæ¨¡çš„æ€è€ƒ&lt;/</summary>
      
    
    
    
    
    <category term="DDD" scheme="https://nmcb666.vip/tags/DDD/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œé—®é¢˜æ€»ç»“</title>
    <link href="https://nmcb666.vip/posts/a3a5550f.html"/>
    <id>https://nmcb666.vip/posts/a3a5550f.html</id>
    <published>2026-01-08T15:32:51.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘"><a href="#å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘" class="headerlink" title="å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘"></a>å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘</h2><h3 id="é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢"><a href="#é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢" class="headerlink" title="é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€  é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢ é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢"></a>é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€  é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢ é‚£æˆ‘åº”è¯¥å¾—åˆ°è°çš„macåœ°å€å‘¢</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸ä¸”å…³é”®çš„ç½‘ç»œé—®é¢˜ã€‚</p><p>ç®€å•ç›´æ¥çš„å›ç­”æ˜¯ï¼š<strong>ä½ ä¼šå¾—åˆ°ä½ æ‰€åœ¨å±€åŸŸç½‘çš„â€œç½‘å…³â€ï¼ˆGatewayï¼‰çš„ MAC åœ°å€ã€‚</strong></p><h4 id="è¯¦ç»†åŸç†è§£æ"><a href="#è¯¦ç»†åŸç†è§£æ" class="headerlink" title="è¯¦ç»†åŸç†è§£æ"></a>è¯¦ç»†åŸç†è§£æ</h4><p>å½“ä½ çš„ç”µè„‘ï¼ˆä¸»æœº Aï¼‰æƒ³è¦å‘é€æ•°æ®åŒ…ç»™ä¸€ä¸ª IP åœ°å€ï¼ˆä¸»æœº Bï¼‰æ—¶ï¼Œå®ƒä¼šç»å†ä»¥ä¸‹é€»è¾‘åˆ¤æ–­æµç¨‹ï¼š</p><ol><li><p><strong>åˆ¤æ–­ç›®æ ‡ IP æ˜¯å¦åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ï¼ˆå­ç½‘ï¼‰å†…ï¼š</strong></p><ul><li>ç”µè„‘ä¼šæŸ¥çœ‹è‡ªå·±çš„å­ç½‘æ©ç ï¼ˆSubnet Maskï¼‰ã€‚</li><li>å¦‚æœ <code>ç›®æ ‡IP</code> å’Œ <code>æœ¬æœºIP</code> åœ¨åŒä¸€ä¸ªç½‘æ®µå†…ï¼Œç”µè„‘è®¤ä¸ºå®ƒå¯ä»¥ç›´æ¥é€šä¿¡ã€‚</li><li><strong>å¦‚æœä¸åœ¨åŒä¸€ä¸ªç½‘æ®µå†…</strong>ï¼Œç”µè„‘è®¤ä¸ºâ€œæˆ‘å¤Ÿä¸ç€å®ƒâ€ï¼Œå¿…é¡»æ‰¾ä¸€ä¸ªâ€œä¸­ä»‹â€æ¥å¸®å¿™è½¬å‘ã€‚</li></ul></li><li><p><strong>å¯»æ‰¾â€œä¸­ä»‹â€ï¼ˆç½‘å…³ï¼‰ï¼š</strong></p><ul><li>è¿™ä¸ªâ€œä¸­ä»‹â€å°±æ˜¯ä½ é…ç½®çš„<strong>é»˜è®¤ç½‘å…³ï¼ˆDefault Gatewayï¼‰</strong>ã€‚é€šå¸¸è¿™æ˜¯ä½ è·¯ç”±å™¨ï¼ˆRouterï¼‰çš„å†…ç½‘ IP åœ°å€ï¼ˆä¾‹å¦‚ <code>192.168.1.1</code> æˆ– <code>192.168.0.1</code>ï¼‰ã€‚</li><li>ç”µè„‘ä¼šæŠŠæ•°æ®åŒ…å‘ç»™ç½‘å…³ï¼Œç”±ç½‘å…³è´Ÿè´£æŠŠæ•°æ®åŒ…æŠ•é€’åˆ°å¤–ç½‘ã€‚</li></ul></li><li><p><strong>ARP è§£æçš„å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼š</strong></p><ul><li>æ—¢ç„¶æ•°æ®åŒ…è¦å‘ç»™ç½‘å…³ï¼Œé‚£ä¹ˆåœ¨æ•°æ®é“¾è·¯å±‚ï¼ˆäºŒå±‚ï¼‰ï¼Œç›®æ ‡ MAC åœ°å€å°±å¿…é¡»æ˜¯ç½‘å…³çš„ MAC åœ°å€ã€‚</li><li>å› æ­¤ï¼Œä½ çš„ç”µè„‘ä¼šå‘èµ·ä¸€ä¸ª <strong>ARP è¯·æ±‚</strong>ï¼Œä½†æ˜¯è¯·æ±‚çš„ç›®æ ‡ IP ä¸å†æ˜¯â€œç›®çš„ IPâ€ï¼Œè€Œæ˜¯ <strong>â€œç½‘å…³çš„ IPâ€</strong>ã€‚</li></ul></li><li><p><strong>è·å– MAC åœ°å€ï¼š</strong></p><ul><li>ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰æ”¶åˆ° ARP è¯·æ±‚åï¼Œå›å¤å®ƒçš„ MAC åœ°å€ã€‚</li><li>ä½ çš„ç”µè„‘å°†æ•°æ®åŒ…å°è£…ï¼Œ<strong>ç›®æ ‡ IP ä»ç„¶æ˜¯è¿œæ–¹çš„ IPï¼Œä½†ç›®æ ‡ MAC åœ°å€å˜æˆäº†ç½‘å…³çš„ MAC åœ°å€</strong>ã€‚</li></ul></li></ol><h4 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h4><p>å‡è®¾ä½ çš„ç½‘ç»œç¯å¢ƒå¦‚ä¸‹ï¼š</p><ul><li><strong>ä½ çš„ç”µè„‘ IPï¼š</strong> <code>192.168.1.100</code></li><li><strong>ä½ çš„ç½‘å…³ IPï¼š</strong> <code>192.168.1.1</code> ï¼ˆMAC: <code>AA:AA:AA:AA:AA:AA</code>ï¼‰</li><li><strong>ä½ æƒ³è®¿é—®çš„ç™¾åº¦æœåŠ¡å™¨ IPï¼š</strong> <code>110.242.68.4</code> ï¼ˆè¿™æ˜¾ç„¶ä¸åœ¨ä½ çš„å±€åŸŸç½‘ï¼‰</li></ul><p><strong>å‘ç”Ÿçš„è¿‡ç¨‹ï¼š</strong></p><ol><li>ä½ è¦ ping <code>110.242.68.4</code>ã€‚</li><li>ä½ çš„ç”µè„‘è®¡ç®—ä¸€ä¸‹ï¼Œå‘ç° <code>110.242.68.4</code> ä¸åœ¨ <code>192.168.1.x</code> è¿™ä¸ªåœˆå­é‡Œã€‚</li><li>ä½ çš„ç”µè„‘å†³å®šï¼šâ€œæˆ‘è¦æŠŠè¿™ä¸ªåŒ…äº¤ç»™ç½‘å…³ <code>192.168.1.1</code> å¤„ç†ã€‚â€</li><li>ä½ çš„ç”µè„‘å‘å‡º ARP è¯·æ±‚ï¼šâ€œè°æ˜¯ <code>192.168.1.1</code>ï¼Ÿè¯·å‘Šè¯‰æˆ‘ä½ çš„ MAC åœ°å€ã€‚â€</li><li>è·¯ç”±å™¨å›å¤ï¼šâ€œæˆ‘æ˜¯ <code>192.168.1.1</code>ï¼Œæˆ‘çš„ MAC æ˜¯ <code>AA:AA:AA:AA:AA:AA</code>ã€‚â€</li><li>ä½ çš„ç”µè„‘å‘é€æ•°æ®åŒ…ï¼š<ul><li><strong>æº IPï¼š</strong> <code>192.168.1.100</code></li><li><strong>ç›®çš„ IPï¼š</strong> <code>110.242.68.4</code> ï¼ˆIP å¤´ä¸å˜ï¼‰</li><li><strong>æº MACï¼š</strong> <code>ä½ çš„ç”µè„‘ MAC</code></li><li><strong>ç›®çš„ MACï¼š</strong> <code>AA:AA:AA:AA:AA:AA</code> ï¼ˆå˜æˆäº†ç½‘å…³çš„ MACï¼‰</li></ul></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li><strong>åŒç½‘æ®µé€šä¿¡ï¼š</strong> ARP è§£æ <strong>ç›®æ ‡ IP</strong> çš„ MACã€‚</li><li><strong>è·¨ç½‘æ®µé€šä¿¡ï¼š</strong> ARP è§£æ <strong>ç½‘å…³ IP</strong> çš„ MACã€‚</li></ul><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“ä½ è®¿é—®äº’è”ç½‘ä¸Šä»»ä½•ç½‘ç«™æ—¶ï¼Œä½ ç”µè„‘çš„ ARP ç¼“å­˜è¡¨ä¸­ï¼Œä¸»è¦å˜åŠ¨çš„å…¶å®æ˜¯ç½‘å…³çš„è®°å½•ï¼Œè€Œä¸æ˜¯äº’è”ç½‘ä¸Šæ— æ•°æœåŠ¡å™¨çš„ MAC åœ°å€ï¼ˆä½ ä¹Ÿæ— æ³•ç›´æ¥è·å–äº’è”ç½‘æœåŠ¡å™¨çš„ MAC åœ°å€ï¼Œå› ä¸ºè·¯ç”±å™¨ä¼šéš”ç¦»å¹¿æ’­åŸŸï¼‰ã€‚</p><h3 id="å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ"><a href="#å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ" class="headerlink" title="å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ"></a>å°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPï¼Ÿ</h3><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œâ€œå°è£…å¥½ç½‘ç»œåŒ…åå¦‚ä½•é€è¾¾ç›®æ ‡IPâ€æ˜¯æœ€æ ¸å¿ƒçš„åŸºç¡€é—®é¢˜ä¹‹ä¸€ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠé“¾è·¯å±‚ã€ç½‘ç»œå±‚çš„ååŒå·¥ä½œï¼Œä»¥åŠäº¤æ¢æœºã€è·¯ç”±å™¨ç­‰è®¾å¤‡çš„æ ¸å¿ƒæœºåˆ¶ã€‚æœ¬æ–‡å°†ç»“åˆæ­¤å‰çš„è®¨è®ºï¼Œä»¥æŠ€æœ¯æ€è€ƒçš„è§†è§’ï¼Œå®Œæ•´æ¢³ç†ä»ç½‘ç»œåŒ…å°è£…å®Œæˆåˆ°æœ€ç»ˆé€è¾¾ç›®æ ‡IPçš„å…¨æµç¨‹ï¼Œæ‹†è§£å…¶ä¸­çš„å…³é”®é€»è¾‘ä¸è®¾å¤‡åˆ†å·¥ã€‚</p><h4 id="ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ "><a href="#ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ " class="headerlink" title="ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ "></a>ä¸€ã€æ ¸å¿ƒå‰æï¼šç½‘ç»œåŒ…çš„â€œä¸¤å±‚èº«ä»½â€ä¸æ ¸å¿ƒå¯»å€è¦ç´ </h4><p>å½“æˆ‘ä»¬åœ¨ä¸»æœºä¸Šå®Œæˆç½‘ç»œåŒ…å°è£…åï¼ˆé€šå¸¸æ˜¯TCP/UDPå¤´éƒ¨+IPå¤´éƒ¨+æ•°æ®çš„å°è£…ï¼‰ï¼Œè¿™ä¸ªåŒ…è¦åœ¨ç‰©ç†ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¿…é¡»å…·å¤‡â€œä¸¤å±‚èº«ä»½æ ‡è¯†â€ï¼Œå¯¹åº”ç½‘ç»œåˆ†å±‚æ¨¡å‹çš„ä¸åŒèŒè´£ï¼š</p><ul><li><p><strong>ç½‘ç»œå±‚èº«ä»½</strong>ï¼šå³æºIPåœ°å€ï¼ˆå‘é€æ–¹ä¸»æœºIPï¼‰å’Œç›®æ ‡IPåœ°å€ï¼ˆæœ€ç»ˆæ¥æ”¶æ–¹IPï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯â€œè·¨ç½‘æ®µå¯¼èˆªâ€ï¼Œç¡®å®šæ•°æ®åŒ…çš„æœ€ç»ˆç›®çš„åœ°ï¼Œå…¨ç¨‹ä¸å˜ã€‚</p></li><li><p><strong>é“¾è·¯å±‚èº«ä»½</strong>ï¼šå³æºMACåœ°å€ï¼ˆå½“å‰å‘é€è®¾å¤‡ç½‘å¡MACï¼‰å’Œç›®æ ‡MACåœ°å€ï¼ˆå½“å‰é“¾è·¯ä¸‹ä¸€è·³è®¾å¤‡MACï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯â€œå±€åŸŸç½‘å†…å®šä½â€ï¼Œæ¯ç»è¿‡ä¸€è·³é“¾è·¯éƒ½ä¼šæ›´æ–°ï¼Œä»…åœ¨å½“å‰é“¾è·¯æœ‰æ•ˆã€‚</p></li></ul><p>æ ¸å¿ƒç»“è®ºï¼šIPåœ°å€è´Ÿè´£â€œæ‰¾æœ€ç»ˆç›®çš„åœ°åœ¨å“ªâ€ï¼ŒMACåœ°å€è´Ÿè´£â€œæ‰¾å½“å‰é“¾è·¯ä¸Šä¸‹ä¸€è·³æ˜¯è°â€ï¼Œä¸¤è€…ååŒå®Œæˆå…¨è·¯å¾„ä¼ è¾“ã€‚</p><h4 id="äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ"><a href="#äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ" class="headerlink" title="äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ"></a>äºŒã€å‘é€å‰çš„å…³é”®å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ</h4><p>å°è£…å®Œæˆåï¼Œä¸»æœºçš„TCP/IPåè®®æ ˆé¦–å…ˆä¼šè¿›è¡Œä¸€ä¸ªæ ¸å¿ƒåˆ¤æ–­â€”â€”ç›®æ ‡IPæ˜¯å¦ä¸æœ¬æœºåœ¨åŒä¸€å±€åŸŸç½‘ï¼ˆé€šè¿‡å­ç½‘æ©ç è®¡ç®—ç½‘æ®µï¼‰ã€‚è¿™ä¸ªåˆ¤æ–­ç›´æ¥å†³å®šäº†åç»­çš„å‘é€é€»è¾‘ï¼šæ˜¯ç›´æ¥å‘é€ç»™ç›®æ ‡ä¸»æœºï¼Œè¿˜æ˜¯å…ˆå‘é€ç»™ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰ã€‚</p><h4 id="ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº"><a href="#ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº" class="headerlink" title="ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº"></a>ä¸‰ã€åŒä¸€å±€åŸŸç½‘åœºæ™¯ï¼šç›´æ¥å‘é€è‡³ç›®æ ‡ä¸»æœº</h4><p>å½“ç›®æ ‡IPåœ¨åŒä¸€ç½‘æ®µæ—¶ï¼Œä¸»æœºéœ€è¦ç›´æ¥ä¸ç›®æ ‡ä¸»æœºé€šä¿¡ï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯â€œå¦‚ä½•è·å–ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€â€ï¼Œè¿™å°±éœ€è¦ARPåè®®çš„å‚ä¸ã€‚</p><h5 id="3-1-æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨"><a href="#3-1-æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨" class="headerlink" title="3.1 æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨"></a>3.1 æ­¥éª¤1ï¼šæŸ¥è¯¢ARPç¼“å­˜è¡¨</h5><p>ä¸»æœºæœ¬åœ°ä¼šç»´æŠ¤ä¸€ä¸ªARPç¼“å­˜è¡¨ï¼Œå­˜å‚¨â€œIPåœ°å€-MACåœ°å€â€çš„æ˜ å°„å…³ç³»ã€‚åè®®æ ˆä¼šå…ˆæŸ¥è¯¢è¯¥è¡¨ï¼š</p><ul><li><p>è‹¥å­˜åœ¨ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€ï¼šç›´æ¥è¿›å…¥é“¾è·¯å±‚å°è£…ï¼Œå°†ç›®æ ‡MACå¡«å…¥ä»¥å¤ªç½‘å¸§å¤´ï¼ŒæºMACå¡«å…¥æœ¬æœºç½‘å¡MACï¼Œç„¶åå°†å¸§å‘é€è‡³äº¤æ¢æœºã€‚</p></li><li><p>è‹¥ä¸å­˜åœ¨ç›®æ ‡IPå¯¹åº”çš„MACåœ°å€ï¼šè§¦å‘ARPå¹¿æ’­æµç¨‹ã€‚</p></li></ul><h5 id="3-2-æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC"><a href="#3-2-æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC" class="headerlink" title="3.2 æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC"></a>3.2 æ­¥éª¤2ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC</h5><p>ä¸»æœºå‘é€ARPè¯·æ±‚åŒ…ï¼ˆé“¾è·¯å±‚ç›®æ ‡MACä¸ºå¹¿æ’­åœ°å€FF:FF:FF:FF:FF:FFï¼‰ï¼Œè¯¥å¹¿æ’­åŒ…ä¼šè¢«äº¤æ¢æœºæ³›æ´ªè‡³å±€åŸŸç½‘å†…æ‰€æœ‰è®¾å¤‡ï¼š</p><ul><li><p>éç›®æ ‡è®¾å¤‡æ”¶åˆ°åï¼Œå‘ç°ç›®æ ‡IPä¸æ˜¯è‡ªå·±ï¼Œç›´æ¥ä¸¢å¼ƒï¼›</p></li><li><p>ç›®æ ‡è®¾å¤‡æ”¶åˆ°åï¼Œè¯†åˆ«å‡ºç›®æ ‡IPæ˜¯è‡ªå·±ï¼Œå›å¤ARPå“åº”åŒ…ï¼ŒåŒ…å«è‡ªèº«MACåœ°å€ï¼›</p></li><li><p>ä¸»æœºæ”¶åˆ°ARPå“åº”åï¼Œå°†â€œç›®æ ‡IP-ç›®æ ‡MACâ€æ˜ å°„å­˜å…¥ARPç¼“å­˜è¡¨ï¼Œåç»­é€šä¿¡å¯ç›´æ¥ä½¿ç”¨ã€‚</p></li></ul><h5 id="3-3-æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘"><a href="#3-3-æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘" class="headerlink" title="3.3 æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘"></a>3.3 æ­¥éª¤3ï¼šäº¤æ¢æœºçš„è½¬å‘é€»è¾‘</h5><p>ä¸»æœºå°†å°è£…å¥½çš„ä»¥å¤ªç½‘å¸§å‘é€è‡³äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šé€šè¿‡è‡ªèº«çš„MACåœ°å€è¡¨ï¼ˆè®°å½•â€œMACåœ°å€-ç«¯å£â€æ˜ å°„ï¼‰è¿›è¡Œè½¬å‘ï¼š</p><ul><li><p>è‹¥MACåœ°å€è¡¨å­˜åœ¨ç›®æ ‡MACå¯¹åº”çš„ç«¯å£ï¼šç›´æ¥å°†å¸§ä»è¯¥ç«¯å£è½¬å‘ï¼ˆå•æ’­ï¼‰ï¼Œä»…ç›®æ ‡è®¾å¤‡èƒ½æ¥æ”¶ï¼›</p></li><li><p>è‹¥MACåœ°å€è¡¨ä¸å­˜åœ¨ç›®æ ‡MACå¯¹åº”çš„ç«¯å£ï¼šäº¤æ¢æœºæ‰§è¡Œâ€œæ³›æ´ªâ€ï¼Œå°†å¸§ä»é™¤æ¥æ”¶ç«¯å£å¤–çš„æ‰€æœ‰ç«¯å£è½¬å‘ï¼Œç›´åˆ°ç›®æ ‡è®¾å¤‡æ¥æ”¶åï¼Œäº¤æ¢æœºé€šè¿‡æºMACå­¦ä¹ ï¼Œå°†ç›®æ ‡MACä¸å¯¹åº”ç«¯å£çš„æ˜ å°„å­˜å…¥MACåœ°å€è¡¨ï¼Œåç»­é€šä¿¡ç›´æ¥å•æ’­ã€‚</p></li></ul><p>æ ¸å¿ƒè¦ç‚¹ï¼šäº¤æ¢æœºä»…è¯†åˆ«MACåœ°å€ï¼Œä¸å…³å¿ƒIPåœ°å€ï¼›ARPå¹¿æ’­ä»…åœ¨å½“å‰å±€åŸŸç½‘å†…ä¼ æ’­ï¼Œä¸ä¼šè·¨ç½‘æ®µã€‚</p><h4 id="å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP"><a href="#å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP" class="headerlink" title="å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP"></a>å››ã€è·¨å±€åŸŸç½‘åœºæ™¯ï¼šé€šè¿‡ç½‘å…³è½¬å‘è‡³ç›®æ ‡IP</h4><p>å½“ç›®æ ‡IPä¸åœ¨åŒä¸€ç½‘æ®µæ—¶ï¼Œä¸»æœºæ— æ³•ç›´æ¥ä¸ç›®æ ‡ä¸»æœºé€šä¿¡ï¼Œå¿…é¡»é€šè¿‡ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰è½¬å‘â€”â€”ç½‘å…³æ˜¯è¿æ¥æœ¬åœ°å±€åŸŸç½‘ä¸å¤–éƒ¨ç½‘ç»œçš„â€œæ¡¥æ¢â€ï¼ŒåŒæ—¶å±äºä¸¤ä¸ªç½‘ç»œï¼ˆæœ¬åœ°å±€åŸŸç½‘å’Œå¤–ç½‘ï¼‰ï¼Œæ‹¥æœ‰ä¸¤ä¸ªIPå’Œä¸¤ä¸ªMACï¼ˆå±€åŸŸç½‘ä¾§IP/MACã€å¤–ç½‘ä¾§IP/MACï¼‰ã€‚</p><h5 id="4-1-æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€"><a href="#4-1-æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€" class="headerlink" title="4.1 æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€"></a>4.1 æ­¥éª¤1ï¼šè·å–ç½‘å…³çš„IPå’ŒMACåœ°å€</h5><ul><li><p>ç½‘å…³IPçš„è·å–ï¼šä¸»æœºé€šè¿‡DHCPè‡ªåŠ¨è·å–ï¼ˆå¸¸è§ï¼‰æˆ–æ‰‹åŠ¨é…ç½®ï¼Œå­˜å‚¨åœ¨æœ¬åœ°ç½‘ç»œè®¾ç½®ä¸­ï¼›</p></li><li><p>ç½‘å…³MACçš„è·å–ï¼šä¸åŒä¸€å±€åŸŸç½‘è·å–ç›®æ ‡MACé€»è¾‘ä¸€è‡´ï¼Œé€šè¿‡æŸ¥è¯¢ARPç¼“å­˜è¡¨æˆ–å‘é€ARPå¹¿æ’­è·å–ç½‘å…³IPå¯¹åº”çš„MACåœ°å€ã€‚</p></li></ul><h5 id="4-2-æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³"><a href="#4-2-æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³" class="headerlink" title="4.2 æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³"></a>4.2 æ­¥éª¤2ï¼šå‘é€è‡³ç½‘å…³</h5><p>ä¸»æœºå°†ä»¥å¤ªç½‘å¸§çš„ç›®æ ‡MACå¡«å…¥ç½‘å…³çš„å±€åŸŸç½‘ä¾§MACï¼ŒæºMACå¡«å…¥æœ¬æœºMACï¼Œå‘é€è‡³äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºè½¬å‘è‡³ç½‘å…³ã€‚</p><h5 id="4-3-æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰"><a href="#4-3-æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰" class="headerlink" title="4.3 æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰"></a>4.3 æ­¥éª¤3ï¼šç½‘å…³çš„è½¬å‘é€»è¾‘ï¼ˆè·¨ç½‘æ®µæ ¸å¿ƒï¼‰</h5><p>ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰æ”¶åˆ°å¸§åï¼Œä¼šæ‰§è¡Œâ€œå‰¥å¸§-è·¯ç”±-é‡æ–°å°è£…â€çš„æ ¸å¿ƒæµç¨‹ï¼š</p><ol><li><p>å‰¥å¸§ï¼šè·¯ç”±å™¨å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œä¼šå‰¥ç¦»é“¾è·¯å±‚ä»¥å¤ªç½‘å¸§å¤´ï¼ˆMACåœ°å€ä¿¡æ¯å¤±æ•ˆï¼‰ï¼ŒæŸ¥çœ‹IPå¤´éƒ¨çš„ç›®æ ‡IPï¼›</p></li><li><p>è·¯ç”±å†³ç­–ï¼šæŸ¥è¯¢è‡ªèº«è·¯ç”±è¡¨ï¼Œç¡®å®šç›®æ ‡IPå¯¹åº”çš„â€œä¸‹ä¸€è·³ç½‘å…³â€ï¼ˆå¯èƒ½æ˜¯è¿è¥å•†è·¯ç”±å™¨ã€éª¨å¹²ç½‘è·¯ç”±å™¨ç­‰ï¼‰ï¼›</p></li><li><p>é‡æ–°å°è£…ï¼šé€šè¿‡ARPè·å–ä¸‹ä¸€è·³ç½‘å…³çš„MACåœ°å€ï¼Œå°†æ–°çš„ä»¥å¤ªç½‘å¸§å¤´å°è£…ï¼ˆæºMACä¸ºç½‘å…³çš„å¤–ç½‘ä¾§MACï¼Œç›®æ ‡MACä¸ºä¸‹ä¸€è·³ç½‘å…³çš„MACï¼‰ï¼Œå‘é€è‡³ä¸‹ä¸€è·³ï¼›</p></li><li><p>é‡å¤è½¬å‘ï¼šæ•°æ®åŒ…åœ¨äº’è”ç½‘ä¸­ç»è¿‡å¤šä¸ªè·¯ç”±å™¨æ¥åŠ›è½¬å‘ï¼Œæ¯ä¸€è·³éƒ½é‡å¤â€œå‰¥å¸§-è·¯ç”±-é‡æ–°å°è£…â€ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡IPæ‰€åœ¨çš„å±€åŸŸç½‘ç½‘å…³ã€‚</p></li></ol><h5 id="4-4-æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­-ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰"><a href="#4-4-æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­-ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰" class="headerlink" title="4.4 æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­/ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰"></a>4.4 æ­¥éª¤4ï¼šNATåœ°å€è½¬æ¢ï¼ˆå®¶åº­/ä¼ä¸šç½‘ç»œå¿…å¤‡ï¼‰</h5><p>å®¶åº­/ä¼ä¸šå†…ç½‘ä½¿ç”¨ç§æœ‰IPï¼ˆå¦‚192.168.x.xï¼‰ï¼Œæ— æ³•ç›´æ¥åœ¨äº’è”ç½‘ä¸­è·¯ç”±ã€‚å› æ­¤ï¼Œç½‘å…³åœ¨è½¬å‘æ—¶ä¼šè§¦å‘NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰ï¼š</p><ul><li><p>å‡ºå£è½¬æ¢ï¼šå°†æ•°æ®åŒ…çš„æºIPä»ç§æœ‰IPæ”¹ä¸ºç½‘å…³çš„å…¬ç½‘IPï¼ŒåŒæ—¶è®°å½•â€œç§æœ‰IP:ç«¯å£-å…¬ç½‘IP:ç«¯å£â€çš„æ˜ å°„å…³ç³»ï¼ˆNATè¡¨ï¼‰ï¼›</p></li><li><p>å…¥å£è½¬æ¢ï¼šå½“ç›®æ ‡IPçš„å“åº”åŒ…è¿”å›è‡³ç½‘å…³æ—¶ï¼Œç½‘å…³é€šè¿‡NATè¡¨åå‘æŸ¥è¯¢ï¼Œå°†ç›®æ ‡IPæ”¹ä¸ºå¯¹åº”çš„å†…ç½‘ç§æœ‰IPï¼Œç›®æ ‡MACæ”¹ä¸ºè¯¥ä¸»æœºçš„MACï¼Œè½¬å‘è‡³ç›®æ ‡ä¸»æœºã€‚</p></li></ul><p>æ ¸å¿ƒè¦ç‚¹ï¼šNATä»…å‘ç”Ÿåœ¨æœ¬åœ°ç½‘å…³çš„å‡ºå£å¤„ï¼Œæ˜¯ç§æœ‰IPè®¿é—®äº’è”ç½‘çš„å¿…è¦æ¡ä»¶ï¼›æºIPåœ¨NATè½¬æ¢åï¼Œåœ¨äº’è”ç½‘ä¼ è¾“è¿‡ç¨‹ä¸­ä¿æŒä¸å˜ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡å±€åŸŸç½‘ã€‚</p><h5 id="4-5-æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³"><a href="#4-5-æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³" class="headerlink" title="4.5 æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³"></a>4.5 æ­¥éª¤5ï¼šç›®æ ‡å±€åŸŸç½‘å†…çš„æœ€åä¸€è·³</h5><p>å½“æ•°æ®åŒ…åˆ°è¾¾ç›®æ ‡IPæ‰€åœ¨çš„å±€åŸŸç½‘ç½‘å…³åï¼Œç½‘å…³ä¼šå†æ¬¡æ‰§è¡Œâ€œå‰¥å¸§-è·¯ç”±â€ï¼Œå‘ç°ç›®æ ‡IPåœ¨å½“å‰å±€åŸŸç½‘å†…ï¼Œé€šè¿‡ARPè·å–ç›®æ ‡ä¸»æœºçš„MACåœ°å€ï¼Œé‡æ–°å°è£…å¸§åå‘é€è‡³ç›®æ ‡ä¸»æœºï¼Œå®Œæˆå…¨é“¾è·¯ä¼ è¾“ã€‚</p><h4 id="äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“"><a href="#äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“" class="headerlink" title="äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“"></a>äº”ã€å…³é”®è®¾å¤‡åˆ†å·¥æ€»ç»“</h4><div class="table-container"><table><thead><tr><th>è®¾å¤‡</th><th>å·¥ä½œå±‚çº§</th><th>æ ¸å¿ƒèŒè´£</th><th>å…³é”®ç‰¹æ€§</th></tr></thead><tbody><tr><td>ä¸»æœº</td><td>ç½‘ç»œå±‚+é“¾è·¯å±‚</td><td>å°è£…ç½‘ç»œåŒ…ã€ARPæŸ¥è¯¢/å¹¿æ’­ã€åˆ¤æ–­ç›®æ ‡IPç½‘æ®µ</td><td>ç»´æŠ¤ARPç¼“å­˜è¡¨ï¼Œä¸ç›´æ¥è·¨ç½‘æ®µè½¬å‘</td></tr><tr><td>äº¤æ¢æœº</td><td>é“¾è·¯å±‚</td><td>æ ¹æ®MACåœ°å€è¡¨è½¬å‘å¸§ã€æ³›æ´ªæœªçŸ¥MACå¸§ã€å­¦ä¹ æºMAC</td><td>ä¸è¯†åˆ«IPåœ°å€ï¼Œä¸éš”ç¦»å¹¿æ’­åŸŸï¼ˆäºŒå±‚äº¤æ¢æœºï¼‰</td></tr><tr><td>è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰</td><td>ç½‘ç»œå±‚+é“¾è·¯å±‚</td><td>è·¯ç”±å†³ç­–ã€è·¨ç½‘æ®µè½¬å‘ã€NATè½¬æ¢ã€éš”ç¦»å¹¿æ’­åŸŸ</td><td>ä¸¢å¼ƒå¹¿æ’­åŒ…ï¼ŒåŒæ—¶å±äºå¤šä¸ªç½‘ç»œï¼Œç»´æŠ¤è·¯ç”±è¡¨</td></tr></tbody></table></div><h4 id="å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰"><a href="#å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰" class="headerlink" title="å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰"></a>å…­ã€å…¨æµç¨‹æ ¸å¿ƒæ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾å¼ï¼‰</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">å°è£…å®Œæˆç½‘ç»œåŒ…</span><br><span class="line">â”œâ”€ å†³ç­–ï¼šç›®æ ‡IPæ˜¯å¦åœ¨åŒä¸€å±€åŸŸç½‘ï¼Ÿ</span><br><span class="line">â”‚  â”œâ”€ æ˜¯ï¼š</span><br><span class="line">â”‚  â”‚  â”œâ”€ æŸ¥è¯¢ARPç¼“å­˜è¡¨ â†’ æœ‰ç›®æ ‡MACï¼Ÿ</span><br><span class="line">â”‚  â”‚  â”‚  â”œâ”€ æ˜¯ï¼šå°è£…å¸§ï¼ˆç›®æ ‡MAC=ç›®æ ‡ä¸»æœºMACï¼‰â†’ äº¤æ¢æœºè½¬å‘ â†’ ç›®æ ‡ä¸»æœº</span><br><span class="line">â”‚  â”‚  â”‚  â””â”€ å¦ï¼šARPå¹¿æ’­è·å–ç›®æ ‡MAC â†’ å­˜å…¥ç¼“å­˜ â†’ å°è£…è½¬å‘</span><br><span class="line">â”‚  â””â”€ å¦ï¼š</span><br><span class="line">â”‚     â”œâ”€ è·å–ç½‘å…³IPï¼ˆDHCP/æ‰‹åŠ¨é…ç½®ï¼‰</span><br><span class="line">â”‚     â”œâ”€ è·å–ç½‘å…³MACï¼ˆARPæŸ¥è¯¢/å¹¿æ’­ï¼‰</span><br><span class="line">â”‚     â”œâ”€ å°è£…å¸§ï¼ˆç›®æ ‡MAC=ç½‘å…³MACï¼‰â†’ äº¤æ¢æœºè½¬å‘ â†’ ç½‘å…³</span><br><span class="line">â”‚     â”œâ”€ ç½‘å…³NATï¼šæºIPä»ç§æœ‰IPæ”¹ä¸ºå…¬ç½‘IP</span><br><span class="line">â”‚     â”œâ”€ ç½‘å…³è·¯ç”±å†³ç­– â†’ è½¬å‘è‡³ä¸‹ä¸€è·³ï¼ˆäº’è”ç½‘å¤šè·¯ç”±å™¨æ¥åŠ›ï¼‰</span><br><span class="line">â”‚     â”œâ”€ åˆ°è¾¾ç›®æ ‡å±€åŸŸç½‘ç½‘å…³ â†’ å‰¥å¸§è·¯ç”± â†’ è·å–ç›®æ ‡ä¸»æœºMAC</span><br><span class="line">â”‚     â””â”€ è½¬å‘è‡³ç›®æ ‡ä¸»æœº</span><br><span class="line">â””â”€ æ ¸å¿ƒä¸å˜é‡ï¼šç›®æ ‡IPå…¨ç¨‹ä¸å˜ï¼›æ ¸å¿ƒå˜é‡ï¼šMACåœ°å€æ¯è·³æ›´æ–°</span><br></pre></td></tr></table></figure><h4 id="ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰"><a href="#ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰" class="headerlink" title="ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰"></a>ä¸ƒã€å…³é”®ç–‘é—®è§£ç­”ï¼ˆè¡¥å……æ€è€ƒï¼‰</h4><ul><li><p>Qï¼šå¦‚æœæŒ‡å®šçš„MACåœ°å€ä¸åœ¨å±€åŸŸç½‘å†…æ€ä¹ˆåŠï¼Ÿ<br>Aï¼šä¸»æœºå‘é€å‰ä¼šé€šè¿‡ARPéªŒè¯ï¼Œè‹¥ARPå¹¿æ’­æ— å“åº”ï¼Œä¼šåˆ¤å®šâ€œç›®æ ‡ä¸å¯è¾¾â€ï¼Œç›´æ¥æŠ¥é”™ï¼Œæ•°æ®åŒ…ä¸ä¼šå‘é€ã€‚</p></li><li><p>Qï¼šäº¤æ¢æœºæœ‰ARPå—ï¼ŸçŸ¥é“IPå¯¹åº”MACå—ï¼Ÿ<br>Aï¼šäºŒå±‚äº¤æ¢æœºæ— ARPï¼Œä¸è¯†åˆ«IPï¼Œä»…é€šè¿‡MACåœ°å€è½¬å‘ï¼›ä¸‰å±‚äº¤æ¢æœºé›†æˆè·¯ç”±åŠŸèƒ½ï¼Œæ‰ä¼šæœ‰ARPè¡¨ã€‚</p></li><li><p>Qï¼šARPæ˜¯å¹¿æ’­ï¼Œå¦‚ä½•éš”ç¦»å¹¿æ’­åŸŸï¼Ÿ<br>Aï¼šè·¯ç”±å™¨ä¼šä¸¢å¼ƒå¹¿æ’­åŒ…ï¼Œä¸è·¨ç½‘æ®µè½¬å‘ï¼Œå› æ­¤å¹¿æ’­åŸŸè¢«è·¯ç”±å™¨éš”ç¦»ï¼Œä»…åœ¨å½“å‰å±€åŸŸç½‘å†…ä¼ æ’­ã€‚</p></li></ul><h4 id="å…«ã€æ€»ç»“"><a href="#å…«ã€æ€»ç»“" class="headerlink" title="å…«ã€æ€»ç»“"></a>å…«ã€æ€»ç»“</h4><p>ç½‘ç»œåŒ…ä»å°è£…å®Œæˆåˆ°é€è¾¾ç›®æ ‡IPçš„è¿‡ç¨‹ï¼Œæœ¬è´¨æ˜¯â€œIPåœ°å€å¯¼èˆª+MACåœ°å€å®šä½â€çš„ååŒè¿‡ç¨‹ï¼Œæ¶‰åŠARPå¯»å€ã€äº¤æ¢æœºæ³›æ´ª/è½¬å‘ã€è·¯ç”±å™¨è·¯ç”±/NATç­‰æ ¸å¿ƒæœºåˆ¶ã€‚ç†è§£è¿™ä¸€è¿‡ç¨‹çš„å…³é”®ï¼Œæ˜¯åˆ†æ¸…ç½‘ç»œå±‚ä¸é“¾è·¯å±‚çš„èŒè´£è¾¹ç•Œï¼Œä»¥åŠå„è®¾å¤‡çš„åˆ†å·¥é€»è¾‘â€”â€”IPè´Ÿè´£â€œæ‰¾ç»ˆç‚¹â€ï¼ŒMACè´Ÿè´£â€œæ‰¾ä¸‹ä¸€è·³â€ï¼Œäº¤æ¢æœºç®¡â€œå±€åŸŸç½‘å†…æ¬è¿â€ï¼Œè·¯ç”±å™¨ç®¡â€œè·¨ç½‘æ®µå¯¼èˆª+éš”ç¦»å¹¿æ’­â€ï¼Œæœ€ç»ˆå®ç°æ•°æ®åŒ…çš„ç²¾å‡†ä¼ è¾“ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot;&gt;&lt;a href=&quot;#å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot; class=&quot;headerlink&quot; title=&quot;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&quot;&gt;&lt;/a&gt;å­¦ä¹ è¿‡ç¨‹ä¸­çš„ç–‘æƒ‘&lt;/h2&gt;&lt;h3 id=&quot;é€šè¿‡ARPåè®®æˆ‘ä»¬å¯ä»¥çŸ¥é“ç›®çš„ipçš„macåœ°å€-é‚£è¦æ˜¯è¿™ä¸ªipä¸åœ¨æˆ‘çš„å±€åŸŸç½‘é‡Œé¢-</summary>
      
    
    
    
    
    <category term="å…«è‚¡" scheme="https://nmcb666.vip/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰</title>
    <link href="https://nmcb666.vip/posts/d323df1a.html"/>
    <id>https://nmcb666.vip/posts/d323df1a.html</id>
    <published>2026-01-05T18:03:11.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰"><a href="#ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰" class="headerlink" title="ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰"></a>ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰</h1><h2 id="å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ"><a href="#å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ" class="headerlink" title="å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ"></a>å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ</h2><h3 id="å¼‚æˆ–è§£é‡Š"><a href="#å¼‚æˆ–è§£é‡Š" class="headerlink" title="å¼‚æˆ–è§£é‡Š"></a>å¼‚æˆ–è§£é‡Š</h3><ol><li>å¼‚æˆ–è¿ç®—ï¼Œç›¸åŒçš„å€¼å¼‚æˆ–ä¸º0ï¼Œä¸åŒçš„å€¼å¼‚æˆ–ä¸º1</li><li>ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ— è¿›ä½çš„åŠ æ³•</li><li>å¼‚æˆ–è¿ç®—æ»¡è¶³äº¤æ¢å¾‹ï¼Œç»“åˆå¾‹</li><li>ä¸€ä¸ªæ•°ç»„ä¸­æ‰€æœ‰æ•°çš„å¼‚æˆ–å’Œ è·Ÿ æŸäº›æ•°å¼‚æˆ–çš„ç»“æœ ç›¸å½“äº å‡å»æŸäº›æ•°çš„å¼‚æˆ–å’Œ</li></ol><h3 id="ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°"><a href="#ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°"></a>ä½¿ç”¨å¼‚æˆ–è¿›è¡Œäº¤æ¢ä¸¤ä¸ªæ•°</h3><ol><li>a = a^b</li><li>b = a^b (æ­¤æ—¶ç›¸å½“äºa^b^b = a , å°±è®©bç­‰äºa)</li><li>a = a^b (æ­¤æ—¶ç›¸å½“äºa^b^a = b , å°±è®©aç­‰äºb)</li></ol><p><em>å±€é™æ€§ï¼šæ³¨æ„è¿™ä¸ªäº¤æ¢ä¸èƒ½å¯¹åŒä¸€ä¸ªåœ°å€çš„ä¸¤ä¸ªå˜é‡è¿›è¡Œæ“ä½œã€‚å› ä¸ºç¬¬ä¸€æ­¥å°±ä¼šæŠŠä»–ä»¬éƒ½å˜ä¸º0</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> -<span class="number">2323</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">a = a ^ b;</span><br><span class="line">b = a ^ b;</span><br><span class="line">a = a ^ b;</span><br><span class="line">System.out.println(a);</span><br><span class="line">System.out.println(b);</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°"><a href="#ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°"></a>ä½¿ç”¨å¼‚æˆ–ä¸ç”¨åˆ¤æ–­è¯­å¥å»åˆ¤æ–­ä¸¤ä¸ªæ•°çš„å¤§å°</h3><p>å¤§ä½“æ€è·¯å°±æ˜¯æ ¹æ®a-bçš„ç¬¦å·ï¼Œæ¥åˆ¤æ–­aå’Œbçš„å¤§å°ã€‚<br>ä½†æ˜¯è¿™æ ·æœ‰æº¢å‡ºçš„é£é™©ï¼ˆa-bä¼šæº¢å‡ºï¼‰<br>ä¼˜åŒ–æ€è·¯ï¼š</p><ol><li>è·å–aå’Œbçš„ç¬¦å·</li><li>è·å–c=a-bçš„ç¬¦å·</li><li>ç»¼åˆåˆ¤æ–­</li><li>å¦‚æœa,bç¬¦å·ç›¸åŒï¼Œåˆ™ä¸å¯èƒ½æº¢å‡ºï¼Œç›´æ¥æ ¹æ®cçš„ç¬¦å·æ¥åˆ¤æ–­å¤§å°</li><li>å¦‚æœa,bç¬¦å·ä¸åŒï¼Œåˆ™a-bå¯èƒ½ä¼šæº¢å‡ºï¼Œåˆ¤æ–­açš„ç¬¦å· å¦‚æœaæ˜¯éè´Ÿçš„ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›aæ›´å¤§</li><li>é™¤äº†ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œå…¶ä½™æƒ…å†µéƒ½è¿”å›b</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å¿…é¡»ä¿è¯nä¸€å®šæ˜¯0æˆ–è€…1</span></span><br><span class="line"><span class="comment">// 0å˜1ï¼Œ1å˜0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">flip</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n ^ <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éè´Ÿæ•°è¿”å›1</span></span><br><span class="line"><span class="comment">// è´Ÿæ•°è¿”å›0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sign</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> flip(n &gt;&gt;&gt; <span class="number">31</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰æº¢å‡ºé£é™©çš„å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getMax1</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a - b;</span><br><span class="line"><span class="comment">// céè´Ÿï¼ŒreturnA -&gt; 1</span></span><br><span class="line"><span class="comment">// céè´Ÿï¼ŒreturnB -&gt; 0</span></span><br><span class="line"><span class="comment">// cè´Ÿæ•°ï¼ŒreturnA -&gt; 0</span></span><br><span class="line"><span class="comment">// cè´Ÿæ•°ï¼ŒreturnB -&gt; 1</span></span><br><span class="line"><span class="type">int</span> <span class="variable">returnA</span> <span class="operator">=</span> sign(c);</span><br><span class="line"><span class="type">int</span> <span class="variable">returnB</span> <span class="operator">=</span> flip(returnA);</span><br><span class="line"><span class="keyword">return</span> a * returnA + b * returnB;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ²¡æœ‰ä»»ä½•é—®é¢˜çš„å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getMax2</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="comment">// cå¯èƒ½æ˜¯æº¢å‡ºçš„</span></span><br><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a - b;</span><br><span class="line"><span class="comment">// açš„ç¬¦å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sa</span> <span class="operator">=</span> sign(a);</span><br><span class="line"><span class="comment">// bçš„ç¬¦å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sb</span> <span class="operator">=</span> sign(b);</span><br><span class="line"><span class="comment">// cçš„ç¬¦å·</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sc</span> <span class="operator">=</span> sign(c);</span><br><span class="line"><span class="comment">// åˆ¤æ–­Aå’ŒBï¼Œç¬¦å·æ˜¯ä¸æ˜¯ä¸ä¸€æ ·ï¼Œå¦‚æœä¸ä¸€æ ·diffAB=1ï¼Œå¦‚æœä¸€æ ·diffAB=0</span></span><br><span class="line"><span class="type">int</span> <span class="variable">diffAB</span> <span class="operator">=</span> sa ^ sb;</span><br><span class="line"><span class="comment">// åˆ¤æ–­Aå’ŒBï¼Œç¬¦å·æ˜¯ä¸æ˜¯ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·sameAB=1ï¼Œå¦‚æœä¸ä¸€æ ·sameAB=0</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sameAB</span> <span class="operator">=</span> flip(diffAB);</span><br><span class="line"><span class="type">int</span> <span class="variable">returnA</span> <span class="operator">=</span> diffAB * sa + sameAB * sc;</span><br><span class="line"><span class="type">int</span> <span class="variable">returnB</span> <span class="operator">=</span> flip(returnA);</span><br><span class="line"><span class="keyword">return</span> a * returnA + b * returnB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"><a href="#ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"></a>ä½¿ç”¨å¼‚æˆ–å»è¿”å›å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰</h3><p>æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰çš„æ•°å¼‚æˆ–ä¸€éï¼Œæœ€åå‰©ä¸‹çš„æ•°å°±æ˜¯å‡ºç°äº†å¥‡æ•°æ¬¡çš„æ•°ã€‚<br>å› ä¸ºå¼‚æˆ–æ»¡è¶³äº¤æ¢å¾‹ã€‚å‡¡æ˜¯å‡ºç°å¶æ•°æ¬¡çš„æ•°ï¼Œå¼‚æˆ–ç»“æœéƒ½ä¸º0ï¼Œæœ€åç»“æœå°±æ˜¯å¥‡æ•°æ¬¡çš„æ•°^0 = å¥‡æ•°æ¬¡çš„æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">singleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">eor</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">eor ^= num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> eor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"><a href="#ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰" class="headerlink" title="ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰"></a>ä½¿ç”¨å¼‚æˆ–å»è¿”å›ä¸¤ä¸ªå‡ºç°å¥‡æ•°æ¬¡çš„æ•°ï¼ˆå…¶ä½™æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡ï¼‰</h3><p>æ€è·¯ï¼š(å‡è®¾é‚£ä¸¤ä¸ªæ•°ä¸ºaå’Œb)</p><ol><li>å…ˆå°†æ•°ç»„ä¸­æ‰€æœ‰æ•°å¼‚æˆ–ä¸€éï¼Œå¾—åˆ°ä¸€ä¸ªæ•°xor1=a^b</li><li>æ‰¾åˆ°xor1æœ€å³è¾¹çš„1ï¼Œå³xor1 &amp; (-xor1) (è§£é‡Šï¼šxor1 &amp; (-xor1)å¯ä»¥è·å–xor1æœ€å³è¾¹çš„1ã€‚å¹¶ä¸”è¿™ä¸ª1å°±æ˜¯aè·Ÿbè‚¯å®šä¸ä¸€æ ·çš„æ•°ä½ï¼ˆå½“ç„¶ä¸åªè¿™ä¸€ä¸ªï¼Œä½†æ˜¯åªéœ€è¦è¿™ä¸€ä¸ªæˆ‘ä»¬å°±å¯ä»¥åŒºåˆ†å®ƒä»¬äº†ï¼‰)</li><li>å°†æ•°ç»„ä¸­æ‰€æœ‰æ•°åˆ†ä¸ºä¸¤ç»„ï¼Œä¸€ç»„æ˜¯xor1æœ€å³è¾¹çš„1ä¸º1çš„æ•°ï¼Œä¸€ç»„æ˜¯xor1æœ€å³è¾¹çš„1ä¸º0çš„æ•° ï¼ˆa,bè‚¯å®šåœ¨ä¸åŒçš„ç»„ä¸­ï¼‰</li><li>å¯¹å…¶ä¸­ä¸€ç»„æ•°å¼‚æˆ–ï¼Œå¾—åˆ°XOR2  (XORå¯èƒ½æ˜¯aä¹Ÿæœ‰å¯èƒ½æ˜¯b) ï¼ˆæ¯ç»„è¿˜æ˜¯æ»¡è¶³é™¤äº†a,bä¹‹å¤–æ‰€æœ‰æ•°å‡ºç°æ¬¡æ•°éƒ½æ˜¯å¶æ•°ï¼‰</li><li>è®²XOR2ä¸XOR1å¼‚æˆ–ï¼Œå¾—åˆ°å¦ä¸€ä¸ªæ•° ï¼ˆXOR2^XOR1=a^b^b=a (å‡è®¾XORæ˜¯b)ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] singleNumber(<span class="type">int</span>[] nums) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">eor1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line"><span class="comment">// numsä¸­æœ‰2ç§æ•°aã€bå‡ºç°äº†å¥‡æ•°æ¬¡ï¼Œå…¶ä»–çš„æ•°éƒ½å‡ºç°äº†å¶æ•°æ¬¡</span></span><br><span class="line">eor1 ^= num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// eor1 : a ^ b</span></span><br><span class="line"><span class="comment">// Brian Kernighanç®—æ³•</span></span><br><span class="line"><span class="comment">// æå–å‡ºäºŒè¿›åˆ¶é‡Œæœ€å³ä¾§çš„1</span></span><br><span class="line"><span class="type">int</span> <span class="variable">rightOne</span> <span class="operator">=</span> eor1 &amp; (-eor1);</span><br><span class="line"><span class="type">int</span> <span class="variable">eor2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line"><span class="keyword">if</span> ((num &amp; rightOne) == <span class="number">0</span>) &#123;</span><br><span class="line">eor2 ^= num;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; eor2, eor1 ^ eor2 &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ"><a href="#å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ" class="headerlink" title="å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ"></a>å…¶ä»–ä½è¿ç®—çš„éªšæ“ä½œ</h2><h3 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚"><a href="#åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚"></a>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„å¹‚</h3><p>åŸç†ï¼š å¦‚æœæ˜¯2çš„å¹‚ï¼Œé‚£ä¹ˆäºŒè¿›åˆ¶æ•°åªæœ‰ä¸€ä½ä¸º1ï¼Œå…¶ä»–ä¸º0 ã€‚è¿™æ—¶å€™æˆ‘ä»¬ç”¨a&amp;-a æ‹¿åˆ°åˆ°çš„æ•°ï¼Œå°±æ˜¯aæœ€å³è¾¹çš„1ã€‚ç„¶ååˆ¤æ–­aæ˜¯ä¸æ˜¯ç­‰äºa&amp;-a ç­‰äºçš„è¯ï¼Œé‚£ä¹ˆaå°±æ˜¯2çš„å¹‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPowerOfTwo</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a &gt; <span class="number">0</span> &amp;&amp; a==(a&amp;-a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚"><a href="#åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚"></a>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯ä¸‰çš„å¹‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å¦‚æœä¸€ä¸ªæ•°å­—æ˜¯3çš„æŸæ¬¡å¹‚ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ä¸€å®šåªå«æœ‰3è¿™ä¸ªè´¨æ•°å› å­</span></span><br><span class="line"><span class="comment">// 1162261467æ˜¯intå‹èŒƒå›´å†…ï¼Œæœ€å¤§çš„3çš„å¹‚ï¼Œå®ƒæ˜¯3çš„19æ¬¡æ–¹</span></span><br><span class="line"><span class="comment">// è¿™ä¸ª1162261467åªå«æœ‰3è¿™ä¸ªè´¨æ•°å› å­ï¼Œå¦‚æœnä¹Ÿæ˜¯åªå«æœ‰3è¿™ä¸ªè´¨æ•°å› å­ï¼Œé‚£ä¹ˆ</span></span><br><span class="line"><span class="comment">// 1162261467 % n == 0</span></span><br><span class="line"><span class="comment">// åä¹‹å¦‚æœ1162261467 % n != 0 è¯´æ˜nä¸€å®šå«æœ‰å…¶ä»–å› å­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPowerOfThree</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> n &gt; <span class="number">0</span> &amp;&amp; <span class="number">1162261467</span> % n == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹"><a href="#è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹" class="headerlink" title="è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹"></a>è¿”å›å¤§äºç­‰äºnçš„æœ€å°çš„2æŸæ¬¡æ–¹</h3><p>å…ˆå¯¹n-1 ç„¶åæŠŠnæœ€å·¦è¾¹çš„1ä¸€ç›´è®©å³è¾¹å…¨å˜ä¸º1.æœ€åçš„ç­”æ¡ˆå°±æ˜¯n+1 (00111111 -&gt; 01000000)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">near2power</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (n &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">n--;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line"><span class="keyword">return</span> n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­—-amp-çš„ç»“æœ-è¿ç»­"><a href="#æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­—-amp-çš„ç»“æœ-è¿ç»­" class="headerlink" title="æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­— &amp; çš„ç»“æœ(è¿ç»­)"></a>æ­¤åŒºé—´å†…æ‰€æœ‰æ•°å­— &amp; çš„ç»“æœ(è¿ç»­)</h3><p>å½¢å¦‚ 0111001000 å¦‚æœæ­¤æ—¶è¿˜å­˜åœ¨ä¸€ä¸ªæ¯”è‡ªå·±è¿˜å°çš„æ•°ï¼Œé‚£ä¹ˆæˆ‘æœ€å³è¾¹çš„1è‚¯å®šä¼šè¢«ä¸è¿ç®—å˜æˆ0.ç›´åˆ°æœ€å°çš„æ•°éƒ½å¤§äºæˆ‘ï¼Œæˆ‘çš„æœ€å³ä¾§çš„1æ‰èƒ½ä¿ç•™ä¸‹æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">rangeBitwiseAnd</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">right -= right &amp; -right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"><a href="#ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°" class="headerlink" title="ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"></a>ç»Ÿè®¡ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</h3><p>å…·ä½“æ€è·¯å‚è€ƒ ã€ç®—æ³•è®²è§£031ã€å¿…å¤‡ã€‘ä½è¿ç®—çš„éªšæ“ä½œã€‘<a href="https://www.bilibili.com/video/BV1ch4y1Q7vd?vd_source=c6cdeb45f015e4ab4447a6c61482633a">https://www.bilibili.com/video/BV1ch4y1Q7vd?vd_source=c6cdeb45f015e4ab4447a6c61482633a</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">cntOnes</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">n = (n &amp; <span class="number">0x55555555</span>) + ((n &gt;&gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x33333333</span>) + ((n &gt;&gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x0f0f0f0f</span>) + ((n &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f0f0f0f</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x00ff00ff</span>) + ((n &gt;&gt;&gt; <span class="number">8</span>) &amp; <span class="number">0x00ff00ff</span>);</span><br><span class="line">n = (n &amp; <span class="number">0x0000ffff</span>) + ((n &gt;&gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x0000ffff</span>);</span><br><span class="line"><span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ"><a href="#ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ" class="headerlink" title="ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ"></a>ä½è¿ç®—å®ç°åŠ å‡ä¹˜é™¤æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MIN</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (a == MIN &amp;&amp; b == MIN) &#123;</span><br><span class="line"><span class="comment">// aå’Œbéƒ½æ˜¯æ•´æ•°æœ€å°</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (a != MIN &amp;&amp; b != MIN) &#123;</span><br><span class="line"><span class="comment">// aå’Œbéƒ½ä¸æ˜¯æ•´æ•°æœ€å°ï¼Œé‚£ä¹ˆæ­£å¸¸å»é™¤</span></span><br><span class="line"><span class="keyword">return</span> div(a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (b == MIN) &#123;</span><br><span class="line"><span class="comment">// aä¸æ˜¯æ•´æ•°æœ€å°ï¼Œbæ˜¯æ•´æ•°æœ€å°</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// aæ˜¯æ•´æ•°æœ€å°ï¼Œbæ˜¯-1ï¼Œè¿”å›æ•´æ•°æœ€å¤§ï¼Œå› ä¸ºé¢˜ç›®é‡Œæ˜ç¡®è¿™ä¹ˆè¯´äº†</span></span><br><span class="line"><span class="keyword">if</span> (b == neg(<span class="number">1</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// aæ˜¯æ•´æ•°æœ€å°ï¼Œbä¸æ˜¯æ•´æ•°æœ€å°ï¼Œbä¹Ÿä¸æ˜¯-1</span></span><br><span class="line">a = add(a, b &gt; <span class="number">0</span> ? b : neg(b));</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> div(a, b);</span><br><span class="line"><span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> b &gt; <span class="number">0</span> ? neg(<span class="number">1</span>) : <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> add(ans, offset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»ä¿è¯aå’Œbéƒ½ä¸æ˜¯æ•´æ•°æœ€å°å€¼ï¼Œè¿”å›aé™¤ä»¥bçš„ç»“æœ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> a &lt; <span class="number">0</span> ? neg(a) : a;</span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> b &lt; <span class="number">0</span> ? neg(b) : b;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">30</span>; i &gt;= <span class="number">0</span>; i = minus(i, <span class="number">1</span>)) &#123;</span><br><span class="line"><span class="keyword">if</span> ((x &gt;&gt; i) &gt;= y) &#123;</span><br><span class="line">ans |= (<span class="number">1</span> &lt;&lt; i);</span><br><span class="line">x = minus(x, y &lt;&lt; i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a &lt; <span class="number">0</span> ^ b &lt; <span class="number">0</span> ? neg(ans) : ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> a;</span><br><span class="line"><span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// ans : aå’Œbæ— è¿›ä½ç›¸åŠ çš„ç»“æœ</span></span><br><span class="line">ans = a ^ b;</span><br><span class="line"><span class="comment">// b : aå’Œbç›¸åŠ æ—¶çš„è¿›ä½ä¿¡æ¯</span></span><br><span class="line">b = (a &amp; b) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">a = ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">minus</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> add(a, neg(b));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">neg</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> add(~n, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ç§ä¹˜æ³•åé¢æœ‰å¤§ç”¨å¤„ï¼Œå°¤å…¶æ˜¯æ±‚(açš„bæ¬¡æ–¹ % m)çš„ç»“æœï¼Œä¹Ÿå«é¾Ÿé€Ÿä¹˜</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> ((b &amp; <span class="number">1</span>) != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// è€ƒå¯Ÿbå½“å‰æœ€å³çš„çŠ¶æ€ï¼</span></span><br><span class="line">ans = add(ans, a);</span><br><span class="line">&#125;</span><br><span class="line">a &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">b &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&quot;&gt;&lt;a href=&quot;#ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&quot;&gt;&lt;/a&gt;ç®—æ³•æ€»ç»“ï¼ˆäºŒï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ&quot;&gt;&lt;a href=&quot;#å¼‚æˆ–è¿ç®—çš„éªšæ“ä½œ&quot; class=&quot;headerli</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰</title>
    <link href="https://nmcb666.vip/posts/e33533c2.html"/>
    <id>https://nmcb666.vip/posts/e33533c2.html</id>
    <published>2026-01-02T15:26:44.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰"><a href="#ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰" class="headerlink" title="ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰"></a>ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰</h1><h2 id="å½’å¹¶åˆ†æ²»"><a href="#å½’å¹¶åˆ†æ²»" class="headerlink" title="å½’å¹¶åˆ†æ²»"></a>å½’å¹¶åˆ†æ²»</h2><h3 id="ä½¿ç”¨æƒ…å†µ"><a href="#ä½¿ç”¨æƒ…å†µ" class="headerlink" title="ä½¿ç”¨æƒ…å†µ"></a>ä½¿ç”¨æƒ…å†µ</h3><ol><li>å·¦è¾¹ç»“æœ+å³è¾¹ç»“æœ+è·¨è¶Šä¸¤è¾¹çš„ç»“æœæ˜¯å¦ç­‰äºæœ€ç»ˆç»“æœ</li><li>å¯¹äºä¸¤è¾¹æ’åºä¹‹åå¯¹äºç»Ÿè®¡è·¨è¶Šä¸¤è¾¹çš„ç»“æœæ˜¯å¦æœ‰å¸®åŠ©</li></ol><h3 id="æ³¨æ„ä¸æ€»ç»“"><a href="#æ³¨æ„ä¸æ€»ç»“" class="headerlink" title="æ³¨æ„ä¸æ€»ç»“"></a>æ³¨æ„ä¸æ€»ç»“</h3><ol><li>ä¸»è¦æ€æƒ³è·Ÿå½’å¹¶æ’åºä¸€æ · åªä¸è¿‡æ˜¯åœ¨mergeçš„æ—¶å€™è¿›è¡Œä¸€äº›é¢å¤–ç»Ÿè®¡æ“ä½œï¼ˆç»Ÿè®¡è·¨è¶Šä¸¤è¾¹çš„ç»“æœï¼‰</li><li>å¦‚æœåªæ˜¯å•çº¯çš„æ¯”å¤§å°ï¼ˆæ¯”å¦‚ å°å’Œï¼Œé€†åºå¯¹ï¼‰å¯ä»¥ç›´æ¥åœ¨mergeçš„æ—¶å€™è¿›è¡Œæ¯”è¾ƒ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°å’Œ ç›´æ¥åœ¨åˆå¹¶çš„æ—¶å€™è¿›è¡Œæ¯”è¾ƒç»Ÿè®¡</span></span><br><span class="line">        <span class="keyword">while</span>(a &lt;=m &amp;&amp; b&lt;=r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[a]&lt;nums[b])&#123;</span><br><span class="line">                help[i++] = nums[a];</span><br><span class="line">                sum+= (nums[a]*(r-b+<span class="number">1</span>));</span><br><span class="line">                a++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                help[i++] = nums[b++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li><li>å¦‚æœä¸åªæ˜¯æ¯”å¤§å° è€Œæ˜¯æ¯”è¾ƒä¹˜ä»¥äºŒå€çš„ç»“æœï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨mergeçš„æ—¶å€™ æ·»åŠ é¢å¤–çš„ç»Ÿè®¡æ“ä½œ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“å·¦è¾¹çš„æ•°å¤§äºå³è¾¹çš„ä¸¤å€æ—¶è¿›è¡Œç»Ÿè®¡</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> ll=l,rr=m+<span class="number">1</span>;ll&lt;=m;ll++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(rr&lt;=r &amp;&amp; (<span class="type">long</span>)nums[ll]&gt;((<span class="type">long</span>)nums[rr]&lt;&lt;<span class="number">1</span>))&#123;</span><br><span class="line">                sum++;</span><br><span class="line">                rr++;</span><br><span class="line">            &#125;</span><br><span class="line">            ans+=sum;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><h3 id="ä¸¤ç§partition-æ™®é€š-è·å…°å›½æ——"><a href="#ä¸¤ç§partition-æ™®é€š-è·å…°å›½æ——" class="headerlink" title="ä¸¤ç§partition (æ™®é€š+è·å…°å›½æ——)"></a>ä¸¤ç§partition (æ™®é€š+è·å…°å›½æ——)</h3><ol><li>æ™®é€špartition ä¸€æ¬¡åªèƒ½ç¡®å®šä¸€ä¸ªæ•°çš„ä½ç½®</li></ol><p>æ ¸å¿ƒæ€æƒ³ï¼šåˆå§‹åŒ–ç´¢å¼•i a xi<br>1.1 éå†æ•°ç»„ï¼Œå¦‚æœå½“å‰æ•°å°äºç­‰äºxï¼Œåˆ™äº¤æ¢iå’Œaæ•° i++ a++<br>1.2 å¦‚æœå¤§äºxï¼Œåˆ™i++ aä¸åŠ¨<br>1.3 å¦‚æœé‡åˆ°nums[a] == x,ç”¨xiè®°å½•ä»–çš„ä½ç½®<br>1.4 éå†ç»“æŸåï¼Œäº¤æ¢xiå’Œa-1çš„ä½ç½®ï¼Œè®©xæ”¾åˆ°å¯¹åº”çš„ä½ç½®ã€‚<br>1.5 è¿”å›a-1ï¼ˆxåº”è¯¥åœ¨çš„ä½ç½®ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸¤ä¸ªåŒºå· å°äºç­‰äº   å¤§äº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition1</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> l;</span><br><span class="line">        <span class="type">int</span> <span class="variable">xi</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;=r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &lt;= x)&#123;</span><br><span class="line">                swap(nums,a,i);</span><br><span class="line">                <span class="keyword">if</span>(nums[a] == x)&#123;</span><br><span class="line">                    xi = a;</span><br><span class="line">                &#125;</span><br><span class="line">                a++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums,xi,a-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> a-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol><li>è·å…°å›½æ——partition ä¸€æ¬¡å¯ä»¥ç¡®å®šå¤šä¸ªç›¸åŒçš„æ•°çš„ä½ç½®</li></ol><p>æ ¸å¿ƒæ€è·¯ï¼šåˆå§‹åŒ–ç´¢å¼•i a(å°äºåŒºé—´) bï¼ˆå¤§äºåŒºé—´ï¼‰<br>1.1 éå†æ•°ç»„ï¼Œå¦‚æœå½“å‰æ•°å°äºxï¼Œåˆ™äº¤æ¢iå’Œaæ•° i++ a++<br>1.2 å¦‚æœå¤§äºxï¼Œåˆ™iä¸åŠ¨ bâ€”<br>1.3 å¦‚æœç­‰äºxï¼Œåˆ™i++<br>1.4 éå†ç»“æŸåï¼Œa-1ï¼ˆå°äºåŒºé—´çš„æœ«å°¾ï¼‰ b+1ï¼ˆå¤§äºåŒºé—´çš„å¼€å¤´ï¼‰ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> first,last;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸‰ä¸ªåŒºé—´ å°äº  å¤§äº   ç­‰äº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">partition2</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> a=l;</span><br><span class="line">    <span class="type">int</span> b=r;</span><br><span class="line">    <span class="type">int</span> i=l;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i] &lt; x)&#123;</span><br><span class="line">            swap(nums,a++,i++);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums[i] &gt; x)&#123;</span><br><span class="line">            swap(nums,i,b--);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    first = a;</span><br><span class="line">    last = b;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰©å±•-å¿«é€Ÿé€‰æ‹©"><a href="#æ‰©å±•-å¿«é€Ÿé€‰æ‹©" class="headerlink" title="æ‰©å±• å¿«é€Ÿé€‰æ‹©"></a>æ‰©å±• å¿«é€Ÿé€‰æ‹©</h3><p>å¿«é€Ÿé€‰æ‹©ï¼šç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œè¿”å›ç¬¬kå°çš„æ•°</p><ol><li>å¿«é€Ÿæ’åºçš„æ€æƒ³ï¼Œpartitionä¹‹åï¼Œå¦‚æœåœ¨å½“å‰åŒºé—´å†…çš„æ’åå¤§äºæŒ‡å®šçš„æ’åï¼Œåˆ™é€’å½’quickselect(l,left-1,k)</li><li>å¿«é€Ÿæ’åºçš„æ€æƒ³ï¼Œpartitionä¹‹åï¼Œå¦‚æœåœ¨å½“å‰åŒºé—´å†…çš„æ’åå°äºæŒ‡å®šçš„æ’åï¼Œåˆ™é€’å½’quickselect(right+1,r,k-rightNow)  (rightNowæŒ‡å®šçš„æ•°åœ¨å½“å‰åŒºé—´å†…çš„æœ€é å³çš„æ’å)</li><li>å¿«é€Ÿæ’åºçš„æ€æƒ³ï¼Œpartitionä¹‹åï¼Œå¦‚æœåœ¨å½“å‰åŒºé—´å†…çš„æ’åç­‰äºæŒ‡å®šçš„æ’åï¼Œåˆ™è¿”å›ç”¨äºpartitionçš„æ•°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">quick</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> pos)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=r)&#123;</span><br><span class="line">        <span class="keyword">return</span> nums[l];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">partitor</span> <span class="operator">=</span> nums[l+ (<span class="type">int</span>)(Math.random()*(r-l+<span class="number">1</span>))];</span><br><span class="line">    <span class="comment">//è·å…°å›½æ——</span></span><br><span class="line">    partition2(nums,l,r,partitor);</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> first;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> last;</span><br><span class="line">    <span class="type">int</span> <span class="variable">leftNow</span> <span class="operator">=</span> left -l +<span class="number">1</span>; <span class="comment">//å½“å‰åŒºé—´å†…partitoré å·¦çš„æ’åï¼ˆå¯èƒ½å­˜åœ¨å¤šä¸ªpartitorï¼‰</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">rightNow</span> <span class="operator">=</span> right -l+<span class="number">1</span>; <span class="comment">//å½“å‰åŒºé—´å†…partitoré å³çš„æ’å</span></span><br><span class="line">    <span class="keyword">if</span>(pos&lt;leftNow)&#123; <span class="comment">//è¦æ‰¾çš„ä½ç½®åœ¨å·¦è¾¹ å†å»å·¦è¾¹æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> quick(nums,l,left-<span class="number">1</span>,pos);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(pos&gt;rightNow)&#123; <span class="comment">//è¦æ‰¾çš„ä½ç½®åœ¨å³è¾¹ å†å»å³è¾¹æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> quick(nums,right+<span class="number">1</span>,r,pos-rightNow);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; <span class="comment">//è¦æ‰¾çš„ä½ç½®åœ¨ä¸­é—´ ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> nums[pos+l-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><p>å †æ’åºæœ¬èº«æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯åˆ©ç”¨å †è¿™ä¸ªæ•°æ®ç»“æ„è¿›è¡Œæ’åºã€‚è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹heapify è·Ÿ heapInsert</p><h3 id="heapify"><a href="#heapify" class="headerlink" title="heapify"></a>heapify</h3><p>å°†èŠ‚ç‚¹ä¸‹ç§»åˆ°åˆé€‚çš„ä½ç½®ï¼Œç›´æ¥è´´ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// iä½ç½®çš„æ•°ï¼Œå˜å°äº†ï¼Œåˆæƒ³ç»´æŒå¤§æ ¹å †ç»“æ„</span></span><br><span class="line"><span class="comment">// å‘ä¸‹è°ƒæ•´å¤§æ ¹å †</span></span><br><span class="line"><span class="comment">// å½“å‰å †çš„å¤§å°ä¸ºsize</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> size)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> i * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (l &lt; size) &#123;</span><br><span class="line"><span class="comment">// æœ‰å·¦å­©å­ï¼Œl</span></span><br><span class="line"><span class="comment">// å³å­©å­ï¼Œl+1</span></span><br><span class="line"><span class="comment">// è¯„é€‰ï¼Œæœ€å¼ºçš„å­©å­ï¼Œæ˜¯å“ªä¸ªä¸‹æ ‡çš„å­©å­</span></span><br><span class="line"><span class="type">int</span> <span class="variable">best</span> <span class="operator">=</span> l + <span class="number">1</span> &lt; size &amp;&amp; arr[l + <span class="number">1</span>] &gt; arr[l] ? l + <span class="number">1</span> : l;</span><br><span class="line"><span class="comment">// ä¸Šé¢å·²ç»è¯„é€‰äº†æœ€å¼ºçš„å­©å­ï¼Œæ¥ä¸‹æ¥ï¼Œå½“å‰çš„æ•°å’Œæœ€å¼ºçš„å­©å­ä¹‹å‰ï¼Œæœ€å¼ºä¸‹æ ‡æ˜¯è°</span></span><br><span class="line">best = arr[best] &gt; arr[i] ? best : i;</span><br><span class="line"><span class="keyword">if</span> (best == i) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">swap(arr, best, i);</span><br><span class="line">i = best;</span><br><span class="line">l = i * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¹Ÿæœ‰é€’å½’çš„ç‰ˆæœ¬ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œä¸è¯¦ç»†è¯´äº†ã€‚</p><p>æ­¤å¤–ä½¿ç”¨heapifyå¯ä»¥è‡ªåº•å‘ä¸Šçš„æ„å»ºå † æ—¶é—´å¤æ‚åº¦ä¸ºO(n)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n/<span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">heapify(arr, i, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="heapInsert"><a href="#heapInsert" class="headerlink" title="heapInsert"></a>heapInsert</h3><p>å°†èŠ‚ç‚¹ä¸Šç§»åˆ°åˆé€‚ä½ç½®ï¼Œç›´æ¥è´´ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// iä½ç½®çš„æ•°ï¼Œå˜å¤§äº†ï¼Œåˆæƒ³ç»´æŒå°æ ¹å †ç»“æ„</span></span><br><span class="line"><span class="comment">// å‘ä¸Šè°ƒæ•´å°æ ¹å †</span></span><br><span class="line"><span class="comment">// å½“å‰å †çš„å¤§å°ä¸ºsize</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapInsert</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i)</span> &#123;</span><br><span class="line"><span class="keyword">while</span> (arr[i] &gt; arr[(i - <span class="number">1</span>) / <span class="number">2</span>]) &#123;</span><br><span class="line">swap(arr, i, (i - <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">i = (i - <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤å¤–ä½¿ç”¨heapInsertå¯ä»¥è‡ªä¸Šåˆ°ä¸‹çš„æ„å»ºå † æ—¶é—´å¤æ‚åº¦ä¸ºO(n*logn) (ä¸å¦‚ä¸Šé¢çš„æ–¹æ³•)<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">heapInsert(arr, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜"><a href="#åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜" class="headerlink" title="åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜"></a>åˆ©ç”¨å †ç»“æ„å»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜</h3><h4 id="1-åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨"><a href="#1-åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="1. åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨"></a>1. åˆå¹¶kä¸ªæœ‰åºé“¾è¡¨</h4><ol><li>åˆ›å»ºä¸€ä¸ªæœ€å°å †ï¼Œå°†kä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹åŠ å…¥å †ä¸­</li><li>å¼¹å‡ºæœ€å°çš„èŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°ç»“æœé“¾è¡¨ä¸­</li><li>å¼¹å‡ºçš„èŠ‚ç‚¹çš„nextèŠ‚ç‚¹åŠ å…¥å †ä¸­</li><li>é‡å¤2-3ï¼Œç›´åˆ°å †ä¸ºç©º</li><li>è¿”å›ç»“æœé“¾è¡¨</li></ol><p>å¤æ‚åº¦ O(n*logk)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">    PriorityQueue&lt;ListNode&gt; heap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;a.val-b.val);</span><br><span class="line">    <span class="keyword">for</span> (ListNode listNode : lists) &#123;</span><br><span class="line">        <span class="keyword">if</span>(listNode!=<span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            heap.add(listNode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(heap.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">h</span> <span class="operator">=</span> heap.poll();</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span>h;</span><br><span class="line">    <span class="keyword">if</span>(pre.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">        heap.add(pre.next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!heap.isEmpty())&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> heap.poll();</span><br><span class="line">        pre.next = node;</span><br><span class="line">        <span class="keyword">if</span>(node.next!=<span class="literal">null</span>)&#123;</span><br><span class="line">            heap.add(node.next);</span><br><span class="line">        &#125;</span><br><span class="line">        pre = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜"><a href="#2-çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜" class="headerlink" title="2. çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜"></a>2. çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜</h4><p> çº¿æ®µæœ€å¤šé‡åˆé—®é¢˜ï¼Œå°±æ˜¯ç»™å®šå¾ˆå¤šçº¿æ®µï¼Œæ±‚çº¿æ®µæœ€å¤šé‡åˆçš„æ¬¡æ•° </p><ol><li>å°†æ‰€æœ‰çº¿æ®µæŒ‰å¼€å§‹çš„ç‚¹è¿›è¡Œæ’åº</li><li>ä¾æ¬¡å¼€å§‹éå†çº¿æ®µ</li><li>å¼¹å‡ºå †ä¸­çš„æœ€å°ç‚¹ï¼Œå¦‚æœæœ€å°ç‚¹å°äºå½“å‰çº¿æ®µçš„å¼€å§‹ç‚¹ï¼Œåˆ™è¯´æ˜åœ¨å½“å‰çº¿æ®µå¼€å§‹æ—¶ï¼Œè¿™é‡Œé¢çš„çº¿æ®µå·²ç»ç»“æŸä¸ä¼šé‡åˆã€‚å¼¹å‡ºå †ä¸­çš„æœ€å°ç‚¹</li><li>å¾ªç¯3æ­¥ç›´åˆ°å †é‡Œé¢çš„å…ƒç´ ä¸å°äºå½“å‰çº¿æ®µçš„å¼€å§‹ç‚¹ã€‚</li><li>å°†å½“å‰çº¿æ®µçš„ç»“æŸç‚¹åŠ å…¥æœ€å°å †ä¸­</li><li>å½“å‰æœ€å°å †çš„sizeå°±æ˜¯ä»¥è¿™ä¸ªçº¿æ®µå¼€å§‹ä¸ºé‡åˆå¼€å§‹åŒºé—´çš„é‡åˆçš„æ¬¡æ•°ï¼Œç”¨è¿™ä¸ªè·Ÿè®°å½•çš„æœ€å¤§æ¬¡æ•°è¿›è¡Œæ¯”è¾ƒï¼Œæ›´æ–°æœ€å¤§æ¬¡æ•°</li><li>å¾ªç¯2-6ï¼Œç›´åˆ°æ‰€æœ‰çº¿æ®µéƒ½éå†ç»“æŸ</li><li>è¿”å›æœ€å¤§æ¬¡æ•°</li></ol><p>æ—¶é—´å¤æ‚åº¦  O(n*logn)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// å †çš„æ¸…ç©º</span></span><br><span class="line">size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿æ®µä¸€å…±æœ‰næ¡ï¼Œline[0...n-1][2] : line[i][0] line[i][1], å·¦é—­å³é—­</span></span><br><span class="line"><span class="comment">// æ‰€æœ‰çº¿æ®µï¼Œæ ¹æ®å¼€å§‹ä½ç½®æ’åºï¼Œç»“æŸä½ç½®æ— æ‰€è°“</span></span><br><span class="line"><span class="comment">// æ¯”è¾ƒå™¨çš„ç”¨æ³•</span></span><br><span class="line"><span class="comment">// line [0...n) æ’åº : æ‰€æœ‰å°æ•°ç»„ï¼Œå¼€å§‹ä½ç½®è°å°è°åœ¨å‰</span></span><br><span class="line">Arrays.sort(line, <span class="number">0</span>, n, (a, b) -&gt; a[<span class="number">0</span>] - b[<span class="number">0</span>]);</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line"><span class="comment">// i : line[i][0] line[i][1]</span></span><br><span class="line"><span class="keyword">while</span> (size &gt; <span class="number">0</span> &amp;&amp; heap[<span class="number">0</span>] &lt;= line[i][<span class="number">0</span>]) &#123;</span><br><span class="line">pop();</span><br><span class="line">&#125;</span><br><span class="line">add(line[i][<span class="number">1</span>]);</span><br><span class="line">ans = Math.max(ans, size);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°"><a href="#3-ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°" class="headerlink" title="3.ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°"></a>3.ç´¯åŠ å’Œå‡åŠæœ€å°æ“ä½œæ¬¡æ•°</h4><p>ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ nums ã€‚æ¯ä¸€æ¬¡æ“ä½œä¸­ï¼Œä½ å¯ä»¥ä» nums ä¸­é€‰æ‹©ä»»æ„ä¸€ä¸ªæ•°å¹¶å°†å®ƒå‡å°åˆ°æ°å¥½ä¸€åŠã€‚ï¼ˆæ³¨æ„ï¼Œåœ¨åç»­æ“ä½œä¸­ä½ å¯ä»¥å¯¹å‡åŠè¿‡çš„æ•°ç»§ç»­æ‰§è¡Œæ“ä½œï¼‰<br>è¯·ä½ è¿”å›å°† nums æ•°ç»„å’Œè‡³å°‘å‡å°‘ä¸€åŠçš„æœ€å°‘æ“ä½œæ•°ã€‚</p><p>æ€è·¯ï¼š å…¶å®å°±æ˜¯è´ªå¿ƒç®—æ³•ï¼Œæ¯æ¬¡æŠŠæœ€å¤§çš„æ•°å‡åˆ°ä¸€åŠï¼Œç›´åˆ°å’Œå‡å°‘åˆ°ä¸€åŠã€‚å…¶ä¸­æ‰¾æœ€å¤§çš„æ•°å°±å¯ä»¥ç”¨å¤§æ ¹å †æ¥å®ç°ã€‚</p><ol><li>åˆ›å»ºä¸€ä¸ªå¤§æ ¹å †ï¼Œå°†æ•°ç»„ä¸­çš„æ•°æ”¾å…¥å¤§æ ¹å †ä¸­ã€‚</li><li>å–å‡ºæœ€å¤§çš„æ•°ï¼Œé™¤ä»¥2 ï¼Œæ“ä½œæ•°++ï¼Œå¹¶åˆ¤æ–­å’Œæ˜¯å¦å‡å°‘åˆ°ä¸€åŠã€‚å¦‚æœå’Œå‡å°‘åˆ°ä¸€åŠï¼Œåˆ™è¿”å›å½“å‰æ“ä½œæ•°ã€‚</li><li>å¾ªç¯ç¬¬äºŒæ­¥ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">halveArray1</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"><span class="comment">// å¤§æ ¹å †</span></span><br><span class="line">PriorityQueue&lt;Double&gt; heap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; b.compareTo(a));</span><br><span class="line"><span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">heap.add((<span class="type">double</span>) num);</span><br><span class="line">sum += num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// sumï¼Œæ•´ä½“ç´¯åŠ å’Œï¼Œ-&gt; è¦å‡å°‘çš„ç›®æ ‡ï¼</span></span><br><span class="line">sum /= <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">double</span> <span class="variable">minus</span> <span class="operator">=</span> <span class="number">0</span>, cur; minus &lt; sum; ans++, minus += cur) &#123;</span><br><span class="line">cur = heap.poll() / <span class="number">2</span>;</span><br><span class="line">heap.add(cur);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ–æ€è·¯ï¼šå¯ä»¥è‡ªå·±å®ç°å¤§æ ¹å †ï¼Œå¹¶ä¸”ä¸ç”¨Doubleç±»å‹ï¼Œç”¨longç±»å‹å°†æ‰€æœ‰æ•°ä¹˜ä»¥2çš„20æ¬¡æ–¹ï¼Œç›¸å½“äºå°æ•°éƒ¨åˆ†å¯ä»¥ä¿ç•™20ä½ï¼Œå¯ä»¥ç²¾ç¡®åˆ°å°æ•°ç‚¹å20ä½ã€‚</p><h2 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h2><p>åŸç†å¾ˆç®€å• ä¸ç»†è¯´ ä¸»è¦è¯´è¯´æ„Ÿæ‚Ÿ</p><p>ä¸ºä»€ä¹ˆè¦é€†åºéå† Arrayï¼š</p><ol><li>æ’åºçš„ç¨³å®šæ€§ï¼š<br>åœ¨åŸºæ•°æ’åºçš„å®ç°ä¸­ï¼Œé€†åºè®¿é—®åŸæ•°ç»„ arr çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ’åºçš„ç¨³å®šæ€§ã€‚ç¨³å®šæ€§æ˜¯æŒ‡æ’åºç®—æ³•åœ¨å¤„ç†ç›¸ç­‰å…ƒç´ æ—¶èƒ½å¤Ÿä¿æŒå®ƒä»¬åœ¨åŸæ•°ç»„ä¸­çš„ç›¸å¯¹é¡ºåºä¸å˜ã€‚<br>åœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬é€†åºéå†åŸæ•°ç»„ arrã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå½“å­˜åœ¨ç›¸ç­‰çš„å…ƒç´ æ—¶ï¼Œå…ˆå‡ºç°çš„å…ƒç´ ä¼šå…ˆæ”¾å…¥å¯¹åº”çš„ä½ç½®ï¼Œè€Œåå‡ºç°çš„ç›¸ç­‰å…ƒç´ ä¼šæ”¾åœ¨å®ƒä»¬ä¹‹åçš„ä½ç½®ã€‚è¿™æ ·å¯ä»¥ä¿è¯ç›¸ç­‰å…ƒç´ çš„ç›¸å¯¹é¡ºåºä¸å˜ï¼Œä»è€Œä¿è¯äº†æ’åºçš„ç¨³å®šæ€§ã€‚<br>å¦‚æœæˆ‘ä»¬é‡‡ç”¨é¡ºåºè®¿é—® arr çš„æ–¹å¼ï¼Œé‚£ä¹ˆåœ¨å¤„ç†ç›¸ç­‰å…ƒç´ æ—¶ï¼Œåå‡ºç°çš„ç›¸ç­‰å…ƒç´ å¯èƒ½ä¼šå…ˆæ”¾å…¥å¯¹åº”çš„ä½ç½®ï¼Œä»è€Œæ‰“ç ´äº†å®ƒä»¬åœ¨åŸæ•°ç»„ä¸­çš„ç›¸å¯¹é¡ºåºï¼Œå¯¼è‡´æ’åºä¸ç¨³å®šã€‚<br>å› æ­¤ï¼Œä¸ºäº†ç¡®ä¿æ’åºçš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é€†åºéå†åŸæ•°ç»„ arr çš„æƒ…å†µä¸‹è¿›è¡Œå…ƒç´ çš„æ”¾ç½®æ“ä½œã€‚</li><li>è‡ªå·±çš„ç†è§£ï¼š<br>2.1 åŸºæ•°æ’åºï¼Œæ˜¯åŸºäºæ•°å­—çš„æ¯ä¸€ä½ï¼ˆä»ä½ä½åˆ°é«˜ä½ï¼‰è¿›è¡Œæ’åºï¼Œæ¯ä¸€ä½çš„æ’åº åŸºäº ä¸Šä¸€ä½ï¼ˆè¾ƒä½ä½ï¼‰æ’å¥½çš„åŸºç¡€ä¸Š<br>2.2 å…ˆå°†æ‰€æœ‰å…ƒç´ æŒ‰ç…§ä½ä½æ’åºï¼Œå†ä¿æŒä½ä½ä½åºä¸å˜çš„æƒ…å†µä¸‹å»æ’é«˜ä½çš„ä½åºï¼ˆèƒ½è®©å·²ç»æ’å¥½çš„ä½ä½çš„ä½åºå˜åŒ–çš„åŸå› åªèƒ½å—é«˜ä½æ•°å€¼çš„å½±å“ï¼‰<br>2.3 å¦‚æœæ˜¯é¡ºåºæ’åºï¼Œé‚£ä¹ˆä½ä½é¡ºåºçš„æ”¹å˜ä¸ä»…ä»…å—åˆ°é«˜ä½æ•°å€¼çš„å½±å“ï¼Œä¹Ÿå—åˆ°é”™ä½çš„å½±å“<br>2.4 é”™ä½çš„å½±å“ï¼šæœ‰æ•°ç»„ï¼šarrã€ 11 , 12 , 13 , 14 , 15ã€‘<br>ä½ä½åºå·²ç»æ’å¥½ï¼Œå¦‚æœæŒ‰ç…§é«˜ä½é¡ºåºéå†ï¼Œä¼šå¯¼è‡´æ•°ç»„å˜æˆ ã€15 , 14 , 13 , 12 , 11ã€‘<br>ä½¿å¾—åŸå…ˆåœ¨ 15 ä¹‹å‰çš„ 11 æ’åœ¨äº† 15 ä¹‹å<br>è¿™ç§é”™ä½çš„å½±å“æ˜¯ é¡ºåºéå† å’Œ ä½¿ç”¨è¯é¢‘ç»Ÿè®¡æ–¹æ³•å¾€Helpä¸­æ”¾å…ƒç´ (é€†åº) ç›¸äº’ä½œç”¨å†³å®šçš„</li></ol><h2 id="æ’åºç®—æ³•æ€»ç»“"><a href="#æ’åºç®—æ³•æ€»ç»“" class="headerlink" title="æ’åºç®—æ³•æ€»ç»“"></a>æ’åºç®—æ³•æ€»ç»“</h2><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/blog1.png" alt="ç¤ºä¾‹å›¾ç‰‡"/></div><span class="image-caption">ç¤ºä¾‹å›¾ç‰‡</span></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&quot;&gt;&lt;a href=&quot;#ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&quot;&gt;&lt;/a&gt;ç®—æ³•æ€»ç»“ï¼ˆä¸€ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å½’å¹¶åˆ†æ²»&quot;&gt;&lt;a href=&quot;#å½’å¹¶åˆ†æ²»&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    
    <category term="ç®—æ³•" scheme="https://nmcb666.vip/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>feignçš„ä¸‰ç§å¼‚å¸¸å¤„ç†å…³ç³»</title>
    <link href="https://nmcb666.vip/posts/20b8d2ff.html"/>
    <id>https://nmcb666.vip/posts/20b8d2ff.html</id>
    <published>2025-12-31T10:00:37.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜"><a href="#Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜" class="headerlink" title="Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜"></a>Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜</h1><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒFeignä½œä¸ºå£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼Œæ˜¯æœåŠ¡é—´è°ƒç”¨çš„æ ¸å¿ƒç»„ä»¶ã€‚è€Œå¼‚å¸¸å¤„ç†æ˜¯ä¿éšœå¾®æœåŠ¡ç¨³å®šæ€§çš„å…³é”®ç¯èŠ‚â€”â€”å½“Feignè°ƒç”¨ä¸‹æ¸¸æœåŠ¡æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬å¸¸é€šè¿‡ <code>ErrorDecoder</code>ã€å®¹é”™ç»„ä»¶çš„ <code>Fallback</code>ï¼ˆå¦‚Sentinel/Hystrixï¼‰ã€Springå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆ<code>@RestControllerAdvice</code>ï¼‰ä¸‰ç§æ–¹å¼å¤„ç†å¼‚å¸¸ã€‚ä½†ä¸‰è€…å¹¶å­˜æ—¶ï¼Œæ‰§è¡Œé¡ºåºå¦‚ä½•ï¼Ÿä¼˜å…ˆçº§èƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿç‰¹æ®Šåœºæ™¯ä¸‹åˆä¼šå‡ºç°å“ªäº›å˜åŒ–ï¼Ÿæœ¬æ–‡å°†ç»“åˆå®è·µæ‹†è§£è¿™ä¸€æ ¸å¿ƒé—®é¢˜ã€‚</p><h2 id="ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº"><a href="#ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº" class="headerlink" title="ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº"></a>ä¸€ã€æ ¸å¿ƒç»“è®ºï¼šä¸‰è€…çš„ä¼˜å…ˆæ‰§è¡Œé¡ºåº</h2><p>å½“Feignè°ƒç”¨å‘ç”Ÿå¼‚å¸¸ï¼ˆé2xx HTTPçŠ¶æ€ç ã€è¶…æ—¶ã€ç½‘ç»œå¼‚å¸¸ç­‰ï¼‰æ—¶ï¼Œä¸‰è€…çš„æ‰§è¡Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼š</p><p><strong>ErrorDecoderï¼ˆFeignåŸç”Ÿï¼‰ â†’ Fallbackï¼ˆå®¹é”™ç»„ä»¶ï¼‰ â†’ å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring MVCï¼‰</strong></p><p>å®Œæ•´æ‰§è¡Œé“¾è·¯å¯æ¦‚æ‹¬ä¸ºï¼š</p><blockquote><p>Feignè°ƒç”¨è§¦å‘å¼‚å¸¸ â†’ ResponseInterceptorï¼ˆOpenFeign 12.0+ å¯é€‰é¢„å¤„ç†ï¼‰ â†’ ErrorDecoderï¼ˆå¼‚å¸¸è§£ç /è½¬æ¢ï¼‰ â†’ å®¹é”™ç»„ä»¶æ‹¦æˆªå¼‚å¸¸ â†’ Fallbackï¼ˆå¼‚å¸¸å…œåº•ï¼Œè¿”å›æ­£å¸¸æ•°æ®ï¼‰ â†’ ï¼ˆFallbackå¤±æ•ˆæ—¶ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ â†’ ï¼ˆå‡æœªå¤„ç†æ—¶ï¼‰å‘ä¸ŠæŠ›å‡ºåŸå§‹å¼‚å¸¸</p></blockquote><p>å…¶ä¸­ï¼Œå‰ä¸¤è€…å±äºFeignè°ƒç”¨é“¾è·¯çš„â€œå‰ç½®å¤„ç†â€ï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨å±äºâ€œåç½®å…œåº•â€ï¼Œä¸”Fallbacké»˜è®¤ä¼šé˜»æ–­å¼‚å¸¸å‘ä¸Šä¼ æ’­ï¼Œä½¿å…¨å±€å¼‚å¸¸æ•è·å™¨æ— æ³•è§¦å‘ã€‚</p><h2 id="äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº"><a href="#äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº" class="headerlink" title="äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº"></a>äºŒã€ä¼˜å…ˆçº§åŸç†ï¼šå±‚çº§ä¸èŒè´£è¾¹ç•Œå†³å®šæ‰§è¡Œé¡ºåº</h2><p>ä¸‰è€…ä¼˜å…ˆçº§çš„æœ¬è´¨çš„æ˜¯æ‰§è¡Œå±‚çº§å’ŒèŒè´£è¾¹ç•Œçš„å·®å¼‚ï¼Œä¸åŒå±‚çº§å¯¹åº”ä¸åŒçš„å¼‚å¸¸å¤„ç†ç›®æ ‡ï¼Œå½¢æˆäº†â€œå±‚å±‚æ‹¦æˆªã€å„å¸å…¶èŒâ€çš„é“¾è·¯ã€‚</p><h3 id="1-ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰"><a href="#1-ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰" class="headerlink" title="1. ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰"></a>1. ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šErrorDecoderï¼ˆFeignåŸç”Ÿæ‰©å±•ç‚¹ï¼‰</h3><p><code>ErrorDecoder</code> æ˜¯FeignåŸç”Ÿæä¾›çš„å¼‚å¸¸è§£ç æ‰©å±•ç‚¹ï¼Œå±äºã€ŒFeignè°ƒç”¨å“åº”å¤„ç†å±‚çº§ã€ï¼Œæ˜¯å¼‚å¸¸è¿›å…¥ä¸šåŠ¡é“¾è·¯å‰çš„â€œç¬¬ä¸€é“å…³å£â€ã€‚</p><p>å…¶æ ¸å¿ƒèŒè´£æ˜¯ï¼šæ‹¦æˆªFeignè°ƒç”¨è¿”å›çš„é2xxå¼‚å¸¸å“åº”ï¼Œå°†Feigné»˜è®¤æŠ›å‡ºçš„ <code>FeignException</code>ï¼ˆåŒ…å«æ‚ä¹±çš„HTTPå“åº”ä¿¡æ¯ï¼‰è½¬æ¢ä¸ºæ ‡å‡†åŒ–çš„è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼ŒåŒæ—¶å¯è§£æå¼‚å¸¸å“åº”ä½“ã€æå–ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸è¯¦æƒ…ï¼Œä¸ºåç»­å¤„ç†æä¾›ç»Ÿä¸€çš„å¼‚å¸¸æ ¼å¼ã€‚</p><p>ä¼˜å…ˆçº§æœ€é«˜çš„åŸå› çš„æ˜¯ï¼šå®ƒç›´æ¥åµŒå…¥Feignçš„å“åº”å¤„ç†æµç¨‹ï¼Œåœ¨å¼‚å¸¸è¢«ä¼ é€’ç»™ä¸šåŠ¡å±‚æˆ–å®¹é”™ç»„ä»¶å‰ï¼Œå°±å®Œæˆäº†è§£ç å’Œè½¬æ¢ã€‚åç»­çš„Fallbackå’Œå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼Œå¤„ç†çš„éƒ½æ˜¯ç»è¿‡å®ƒè½¬æ¢åçš„å¼‚å¸¸ï¼ˆæˆ–æœªè‡ªå®šä¹‰æ—¶çš„é»˜è®¤å¼‚å¸¸ï¼‰ã€‚</p><h3 id="2-ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰"><a href="#2-ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰" class="headerlink" title="2. ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰"></a>2. ç¬¬äºŒä¼˜å…ˆçº§ï¼šFallbackï¼ˆå®¹é”™ç»„ä»¶èƒ½åŠ›ï¼‰</h3><p><code>Fallback</code> æ˜¯Sentinelã€Hystrixã€Resilience4jç­‰å®¹é”™ç»„ä»¶æä¾›çš„å…œåº•èƒ½åŠ›ï¼Œå±äºã€Œå¾®æœåŠ¡å®¹é”™é˜²æŠ¤å±‚çº§ã€ï¼Œæ˜¯å¼‚å¸¸ä¼ æ’­çš„â€œç¬¬äºŒé“å…³å£â€ã€‚</p><p>å…¶æ ¸å¿ƒèŒè´£æ˜¯ï¼šé€šè¿‡AOPæˆ–ä»£ç†æ¨¡å¼ï¼Œæ‹¦æˆªFeignè°ƒç”¨/ä¸šåŠ¡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆå·²è¢«ErrorDecoderå¤„ç†ï¼‰ï¼Œå°†â€œå¼‚å¸¸ç»“æœâ€è½¬æ¢ä¸ºâ€œåˆæ³•çš„ä¸šåŠ¡è¿”å›æ•°æ®â€ï¼Œæ¶ˆåŒ–å¼‚å¸¸ä»¥é˜²æ­¢æœåŠ¡é›ªå´©ï¼ŒåŒæ—¶é¿å…ä¸šåŠ¡å±‚æ‰‹åŠ¨try-catchã€‚</p><p>ä¼˜å…ˆçº§é«˜äºå…¨å±€å¼‚å¸¸æ•è·å™¨çš„åŸå› çš„æ˜¯ï¼šå®ƒåœ¨å¼‚å¸¸äº§ç”Ÿç‚¹é™„è¿‘ç›´æ¥æ‹¦æˆªï¼Œä¸”å¤„ç†åè¿”å›æ­£å¸¸æ•°æ®â€”â€”å¼‚å¸¸è¢«å®Œå…¨â€œæ¶ˆåŒ–â€ï¼Œä¸å†å‘ä¸Šä¼ æ’­ï¼Œå¯¼è‡´å…¨å±€å¼‚å¸¸æ•è·å™¨å¤±å»è§¦å‘å‰æï¼ˆå…¨å±€å¼‚å¸¸æ•è·å™¨ä»…å¤„ç†æœªè¢«æ‹¦æˆªçš„ä¼ æ’­å¼‚å¸¸ï¼‰ã€‚</p><h3 id="3-ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring-MVCå±‚çº§ï¼‰"><a href="#3-ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring-MVCå±‚çº§ï¼‰" class="headerlink" title="3. ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring MVCå±‚çº§ï¼‰"></a>3. ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆSpring MVCå±‚çº§ï¼‰</h3><p>å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆåŸºäº <code>@RestControllerAdvice</code> + <code>@ExceptionHandler</code>ï¼‰æ˜¯Spring MVCæä¾›çš„å…¨å±€èƒ½åŠ›ï¼Œå±äºã€Œåº”ç”¨å±‚å¼‚å¸¸å…œåº•å±‚çº§ã€ï¼Œæ˜¯å¼‚å¸¸å¤„ç†çš„â€œæœ€åä¸€é“å…³å£â€ã€‚</p><p>å…¶æ ¸å¿ƒèŒè´£æ˜¯ï¼šæ•è·æ‰€æœ‰å‘ä¸Šä¼ æ’­åˆ°Controllerå±‚åŠä»¥ä¸Šçš„æœªå¤„ç†å¼‚å¸¸ï¼Œç»Ÿä¸€è¿”å›æ ‡å‡†åŒ–é”™è¯¯å“åº”ï¼Œé¿å…è£¸å¼‚å¸¸æš´éœ²ç»™å‰ç«¯ã€‚</p><p>ä¼˜å…ˆçº§æœ€ä½çš„åŸå› çš„æ˜¯ï¼šå®ƒçš„æ‰§è¡Œä¾èµ–â€œå¼‚å¸¸æœªè¢«å‰ç½®é€»è¾‘å¤„ç†ä¸”æˆåŠŸä¼ æ’­â€ï¼Œè€ŒFallbacké€šå¸¸ä¼šæå‰æ¶ˆåŒ–å¼‚å¸¸ï¼Œåªæœ‰åœ¨Fallbackå¤±æ•ˆæ—¶ï¼Œå®ƒæ‰ä¼šè¡¥ä½ç”Ÿæ•ˆã€‚</p><h2 id="ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº"><a href="#ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº" class="headerlink" title="ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº"></a>ä¸‰ã€å®æˆ˜éªŒè¯ï¼šç›´è§‚æ„Ÿå—æ‰§è¡Œé¡ºåº</h2><p>æˆ‘ä»¬ä»¥ã€ŒOpenFeign 12.0+ + Sentinel + Spring Bootã€ä¸ºä¾‹ï¼Œé€šè¿‡ä»£ç éªŒè¯ä¸‰è€…çš„æ‰§è¡Œé¡ºåºï¼ŒåŒæ—¶è¦†ç›–æ­£å¸¸åœºæ™¯ä¸ç‰¹æ®Šåœºæ™¯ã€‚</p><h3 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. ç¯å¢ƒå‡†å¤‡"></a>1. ç¯å¢ƒå‡†å¤‡</h3><p>ä¾èµ–æ ¸å¿ƒç»„ä»¶ï¼šOpenFeignï¼ˆ12.0+ï¼‰ã€Spring Cloud Alibaba Sentinelã€Spring Webã€‚</p><h3 id="2-ä»£ç å®ç°"><a href="#2-ä»£ç å®ç°" class="headerlink" title="2. ä»£ç å®ç°"></a>2. ä»£ç å®ç°</h3><h4 id="ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰"><a href="#ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰"></a>ï¼ˆ1ï¼‰è‡ªå®šä¹‰ErrorDecoderï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Response;</span><br><span class="line"><span class="keyword">import</span> feign.Util;</span><br><span class="line"><span class="keyword">import</span> feign.codec.ErrorDecoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomErrorDecoder</span> <span class="keyword">implements</span> <span class="title class_">ErrorDecoder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ErrorDecoder</span> <span class="variable">defaultDecoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Default</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Exception <span class="title function_">decode</span><span class="params">(String methodKey, Response response)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =&quot;</span> + response.status());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">errorBody</span> <span class="operator">=</span> Util.toString(response.body().asReader(Util.UTF_8));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;æœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼ˆErrorDecoderè½¬æ¢ï¼‰ï¼š&quot;</span> + errorBody);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> defaultDecoder.decode(methodKey, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰"><a href="#ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰"></a>ï¼ˆ2ï¼‰é…ç½®Fallbackï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Feignæ¥å£</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;provider-service&quot;, fallback = ProviderFallback.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProviderClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/provider/getData&quot;)</span></span><br><span class="line">    String <span class="title function_">getData</span><span class="params">(<span class="meta">@RequestParam</span> String id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fallbackå…œåº•ç±»</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderFallback</span> <span class="keyword">implements</span> <span class="title class_">ProviderClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…œåº•æ•°æ®ï¼šid=&quot;</span> + id + <span class="string">&quot;ï¼ˆæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼‰&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰"><a href="#ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰"></a>ï¼ˆ3ï¼‰å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleAllException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€3. æ‰§è¡Œå…¨å±€å¼‚å¸¸æ•è·å™¨ã€‘ï¼šæ•è·å¼‚å¸¸ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…¨å±€å…œåº•ï¼š&quot;</span> + e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚"><a href="#ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚" class="headerlink" title="ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚"></a>ï¼ˆ4ï¼‰ä¸šåŠ¡è°ƒç”¨å±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProviderClient providerClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getData&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(<span class="meta">@RequestParam</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> providerClient.getData(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åœºæ™¯æµ‹è¯•ç»“æœ"><a href="#3-åœºæ™¯æµ‹è¯•ç»“æœ" class="headerlink" title="3. åœºæ™¯æµ‹è¯•ç»“æœ"></a>3. åœºæ™¯æµ‹è¯•ç»“æœ</h3><h4 id="ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘"><a href="#ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘" class="headerlink" title="ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘"></a>ï¼ˆ1ï¼‰æ­£å¸¸åœºæ™¯ï¼šä¸‰è€…å¹¶å­˜ï¼ŒFallbackæ­£å¸¸è§¦å‘</h4><p>å½“ä¸‹æ¸¸æœåŠ¡æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œæ§åˆ¶å°è¾“å‡ºé¡ºåºï¼š</p><figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =500</span><br><span class="line">ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®</span><br></pre></td></tr></table></figure><p>æ¥å£è¿”å›ï¼š<code>å…œåº•æ•°æ®ï¼šid=123ï¼ˆæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼‰</code>ï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨æœªè§¦å‘ï¼ˆè¢«Fallbacké˜»æ–­ï¼‰ã€‚</p><h4 id="ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸"><a href="#ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸"></a>ï¼ˆ2ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackè‡ªèº«æŠ›å‡ºå¼‚å¸¸</h4><p>ä¿®æ”¹Fallbacké€»è¾‘ï¼Œæ•…æ„æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderFallback</span> <span class="keyword">implements</span> <span class="title class_">ProviderClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">nullStr</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        nullStr.length(); <span class="comment">// ç©ºæŒ‡é’ˆå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;å…œåº•æ•°æ®ï¼šid=&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°è¾“å‡ºé¡ºåºï¼š</p><figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =500</span><br><span class="line">ã€2. æ‰§è¡Œ Fallbackã€‘ï¼šè§¦å‘å…œåº•é€»è¾‘ï¼Œè¿”å›æ­£å¸¸æ•°æ®</span><br><span class="line">ã€3. æ‰§è¡Œå…¨å±€å¼‚å¸¸æ•è·å™¨ã€‘ï¼šæ•è·å¼‚å¸¸ï¼šnull</span><br></pre></td></tr></table></figure><p>æ¥å£è¿”å›ï¼š<code>å…¨å±€å…œåº•ï¼šnull</code>ï¼ŒFallbackå¼‚å¸¸å‘ä¸Šä¼ æ’­ï¼Œè§¦å‘å…¨å±€å¼‚å¸¸æ•è·å™¨ã€‚</p><h4 id="ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰"><a href="#ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰"></a>ï¼ˆ3ï¼‰ç‰¹æ®Šåœºæ™¯ï¼šFallbackæœªè§¦å‘ï¼ˆé…ç½®å¤±æ•ˆï¼‰</h4><p>è‹¥æœªå¼€å¯Sentinelä¸Feignçš„æ•´åˆï¼ˆæœªé…ç½® <code>feign.sentinel.enabled=true</code>ï¼‰ï¼ŒFallbacké…ç½®å¤±æ•ˆï¼Œæ§åˆ¶å°è¾“å‡ºé¡ºåºï¼š</p><figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ã€1. æ‰§è¡Œ ErrorDecoderã€‘ï¼šè§£ç Feignå¼‚å¸¸ï¼ŒçŠ¶æ€ç =500</span><br><span class="line">ã€3. æ‰§è¡Œå…¨å±€å¼‚å¸¸æ•è·å™¨ã€‘ï¼šæ•è·å¼‚å¸¸ï¼šæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼ˆErrorDecoderè½¬æ¢ï¼‰ï¼šxxx</span><br></pre></td></tr></table></figure><p>æ¥å£è¿”å›ï¼š<code>å…¨å±€å…œåº•ï¼šæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼ˆErrorDecoderè½¬æ¢ï¼‰ï¼šxxx</code>ï¼ŒFallbackæœªè§¦å‘ï¼Œå¼‚å¸¸ä¼ æ’­è‡³å…¨å±€æ•è·å™¨ã€‚</p><h2 id="å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿"><a href="#å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿" class="headerlink" title="å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿"></a>å››ã€å®è·µå»ºè®®ï¼šä¸‰è€…ååŒçš„æœ€ä½³å§¿åŠ¿</h2><p>ä¸‰è€…å¹¶éäº’æ–¥å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»ï¼Œåˆç†æ­é…å¯å®ç°â€œå¼‚å¸¸æ ‡å‡†åŒ–+å®¹é”™å…œåº•+æœ€ç»ˆè¡¥ä½â€çš„ä¸‰å±‚é˜²æŠ¤ä½“ç³»ï¼Œæå‡å¾®æœåŠ¡ç¨³å®šæ€§ã€‚</p><h3 id="1-åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ"><a href="#1-åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ" class="headerlink" title="1. åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ"></a>1. åˆ†å·¥æ˜ç¡®ï¼Œå„å¸å…¶èŒ</h3><ul><li><p><strong>ErrorDecoder</strong>ï¼šä¸“æ³¨â€œå¼‚å¸¸æ ‡å‡†åŒ–â€ï¼Œç»Ÿä¸€è½¬æ¢FeignåŸç”Ÿå¼‚å¸¸ä¸ºä¸šåŠ¡å¼‚å¸¸ï¼Œè§£æå¼‚å¸¸è¯¦æƒ…ï¼Œä¸åšå…œåº•é€»è¾‘ï¼›</p></li><li><p><strong>Fallback</strong>ï¼šä¸“æ³¨â€œå®¹é”™å…œåº•â€ï¼Œé’ˆå¯¹æ ¸å¿ƒæœåŠ¡è°ƒç”¨ï¼Œè¿”å›é¢„è®¾å…œåº•æ•°æ®ï¼ˆå¦‚ç¼“å­˜æ•°æ®ã€é»˜è®¤å€¼ï¼‰ï¼Œé˜²æ­¢æœåŠ¡é›ªå´©ï¼›</p></li><li><p><strong>å…¨å±€å¼‚å¸¸æ•è·å™¨</strong>ï¼šä¸“æ³¨â€œæœ€ç»ˆè¡¥ä½â€ï¼Œæ•è·æ‰€æœ‰æ¼ç½‘å¼‚å¸¸ï¼ˆFallbackå¼‚å¸¸ã€é…ç½®é”™è¯¯å¯¼è‡´çš„å¼‚å¸¸ï¼‰ï¼Œç»Ÿä¸€è¿”å›å‰ç«¯å‹å¥½å“åº”ã€‚</p></li></ul><h3 id="2-è§„é¿å¸¸è§å‘ç‚¹"><a href="#2-è§„é¿å¸¸è§å‘ç‚¹" class="headerlink" title="2. è§„é¿å¸¸è§å‘ç‚¹"></a>2. è§„é¿å¸¸è§å‘ç‚¹</h3><ul><li><p>Fallbackæ–¹æ³•ç­¾åå¿…é¡»ä¸åŸæ–¹æ³•ä¸€è‡´ï¼ˆå‚æ•°ã€è¿”å›å€¼ç±»å‹åŒ¹é…ï¼‰ï¼Œå¦åˆ™é…ç½®å¤±æ•ˆï¼Œå¼‚å¸¸ç›´æ¥ä¼ æ’­ï¼›</p></li><li><p>Hystrixä¼šå¿½ç•¥ <code>HystrixBadRequestException</code> åŠ <code>ignoreExceptions</code> é…ç½®çš„å¼‚å¸¸ï¼Œè¿™ç±»å¼‚å¸¸ä¸è§¦å‘Fallbackï¼Œéœ€é€šè¿‡å…¨å±€æ•è·å™¨å¤„ç†ï¼›</p></li><li><p>ErrorDecoderä¸­é¿å…æŠ›å‡ºéä¸šåŠ¡å¼‚å¸¸ï¼Œå»ºè®®ç»Ÿä¸€è½¬æ¢ä¸ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œä¾¿äºFallbackå’Œå…¨å±€æ•è·å™¨è¯†åˆ«ã€‚</p></li></ul><h3 id="3-æ³¨æ„äº‹é¡¹"><a href="#3-æ³¨æ„äº‹é¡¹" class="headerlink" title="3.æ³¨æ„äº‹é¡¹"></a>3.æ³¨æ„äº‹é¡¹</h3><ul><li>å¼‚å¸¸å¤šå±‚åŒ…è£…ï¼ˆå« Error ç±»å‹ï¼‰ä¼šé˜»æ–­ Spring è‡ªåŠ¨ç©¿é€ã€‚å½“å¼‚å¸¸é“¾ä¸­å­˜åœ¨ AssertionError ç­‰ Error ç±»å‹å¼‚å¸¸æ—¶ï¼ˆå¦‚ Sentinel æ•´åˆ Feign åœºæ™¯ï¼Œåœ¨fallbackå‡½æ•°ä¸­æŠ›å‡ºRuntimeExceptionå¼‚å¸¸ä¼šè¢«Sentinelè‡ªåŠ¨åŒ…è£…ä¸ºAssertionError ç»§æ‰¿ Erroråˆ†æ”¯ï¼Œç„¶ååˆè¢«Spring MVC DispatcherServletè‡ªåŠ¨æŠ›å‡ºä¸ºNestedServletExceptionå¼‚å¸¸ï¼‰ï¼ŒSpring çš„ @ExceptionHandler è‡ªåŠ¨ç©¿é€åŠŸèƒ½ä»…æ”¯æŒ Exception åˆ†æ”¯ï¼Œæ— æ³•ç©¿é€ Error ç±»å‹å¼‚å¸¸ï¼Œå¯¼è‡´è‡ªå®šä¹‰å¼‚å¸¸ï¼ˆCommonExceptionï¼‰æ— æ³•è¢«ç²¾å‡†æ•è·ï¼Œæœ€ç»ˆè¢« Exception å…œåº•å¤„ç†å™¨æ•è·ï¼ˆæˆ–è€…è¢«NestedServletExceptionå¼‚å¸¸æ•è·å™¨æ•è·ï¼‰ï¼›</li><li><p>è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨è§£æå®Œæ•´çš„ Throwable é“¾ï¼ˆåŒ…å« Error å’Œ Exceptionï¼‰ï¼Œé€šè¿‡å¾ªç¯éå† cause é“¾ä¸»åŠ¨æå–ç›®æ ‡è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå†æ‰‹åŠ¨åˆ†å‘åˆ°å¯¹åº”å¼‚å¸¸å¤„ç†å™¨ï¼›</p></li><li><p>ä¸‹é¢æ˜¯springå¯¹äºå¼‚å¸¸å¤„ç†çš„æºç ã€‚å¯ä»¥çœ‹è§å¦‚æœé‡åˆ°éExceptionçš„Throwableã€‚å®ƒä¼šè‡ªåŠ¨æŠ›å‡ºNestedServletException</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨å¤„ç†å™¨æ–¹æ³•ï¼ˆControlleræ–¹æ³•ã€Feignè°ƒç”¨ã€Serviceæ–¹æ³•ç­‰éƒ½åœ¨è¿™ä¸€æ­¥æ‰§è¡Œï¼‰</span></span><br><span class="line">    mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">    <span class="comment">// æ•è·Exceptionç±»å‹å¼‚å¸¸ï¼Œç›´æ¥èµ‹å€¼ç»™dispatchExceptionï¼Œä¸åŒ…è£…</span></span><br><span class="line">    dispatchException = ex;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">    <span class="comment">// æ•è·Throwableç±»å‹ï¼ˆéExceptionï¼Œå¦‚Errorã€AssertionErrorç­‰ï¼‰ï¼ŒåŒ…è£…ä¸ºNestedServletException</span></span><br><span class="line">    dispatchException = <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler dispatch failed&quot;</span>, err);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-ç»„ä»¶é€‰æ‹©å»ºè®®"><a href="#4-ç»„ä»¶é€‰æ‹©å»ºè®®" class="headerlink" title="4. ç»„ä»¶é€‰æ‹©å»ºè®®"></a>4. ç»„ä»¶é€‰æ‹©å»ºè®®</h3><p>Hystrixå·²è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œæ¨èä½¿ç”¨ <strong>Resilience4j</strong>ï¼ˆè½»é‡ã€Springå®˜æ–¹æ¨èï¼‰æˆ– <strong>Sentinel</strong>ï¼ˆé˜¿é‡Œç”Ÿæ€ï¼Œæ”¯æŒæµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ç­‰ä¸°å¯Œç‰¹æ€§ï¼‰ä½œä¸ºFallbackè½½ä½“ï¼›OpenFeign 12.0+ å»ºè®®æ­é… <code>ResponseInterceptor</code> åšå“åº”æ—¥å¿—é¢„å¤„ç†ï¼Œä¸ErrorDecoderååŒæå‡å¼‚å¸¸æ’æŸ¥æ•ˆç‡ã€‚</p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>Feignå¼‚å¸¸å¤„ç†çš„ä¸‰é‡æœºåˆ¶ï¼Œæœ¬è´¨æ˜¯ä¸åŒå±‚çº§çš„â€œå¼‚å¸¸æ‹¦æˆª-å¤„ç†â€é“¾è·¯ï¼šErrorDecoderè´Ÿè´£â€œå…¥å£æ ‡å‡†åŒ–â€ï¼ŒFallbackè´Ÿè´£â€œä¸­é—´å®¹é”™â€ï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨è´Ÿè´£â€œæœ€ç»ˆè¡¥ä½â€ã€‚ä¼˜å…ˆçº§çš„æ ¸å¿ƒé€»è¾‘æ˜¯â€œå…ˆå¤„ç†å¼‚å¸¸ã€å†æ¶ˆåŒ–å¼‚å¸¸ã€æœ€åè¡¥ä½å¼‚å¸¸â€ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸‰è€…ååŒä½¿ç”¨ï¼Œæ—¢èƒ½ä¿è¯å¼‚å¸¸å¤„ç†çš„è§„èŒƒæ€§å’Œçµæ´»æ€§ï¼Œåˆèƒ½æå‡å¾®æœåŠ¡çš„é«˜å¯ç”¨æ€§ï¼Œé¿å…å› å•ä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶å¤±æ•ˆå¯¼è‡´çš„æœåŠ¡ä¸ç¨³å®šé—®é¢˜ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜&quot;&gt;&lt;a href=&quot;#Feignå¼‚å¸¸å¤„ç†ä¸‰é‡å¥ï¼šErrorDecoderã€Fallbackä¸å…¨å±€å¼‚å¸¸æ•è·å™¨çš„ä¼˜å…ˆçº§æ¢ç§˜&quot; class=&quot;headerlink&quot; tit</summary>
      
    
    
    
    
    <category term="spring cloud" scheme="https://nmcb666.vip/tags/spring-cloud/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡ä¹‹é—´çš„å…¨å±€å¼‚å¸¸æ•è·</title>
    <link href="https://nmcb666.vip/posts/df97f9d4.html"/>
    <id>https://nmcb666.vip/posts/df97f9d4.html</id>
    <published>2025-12-24T02:09:18.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨å•ä½“æ¶æ„ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆå¦‚@ControllerAdvice+@ExceptionHandlerï¼‰å°±èƒ½ä¼˜é›…åœ°å¤„ç†å„ç±»å¼‚å¸¸ï¼Œè‡ªå®šä¹‰å“åº”çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ã€‚ä½†è¿ç§»åˆ°Spring Cloudå¾®æœåŠ¡æ¶æ„åï¼Œå´é‡åˆ°äº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šæ— è®ºå‘ç”Ÿä½•ç§å¼‚å¸¸ï¼Œæ¥å£è¿”å›çš„çŠ¶æ€ç å§‹ç»ˆæ˜¯500ï¼Œé”™è¯¯ä¿¡æ¯å›ºå®šä¸ºINTERNAL_SERVER_ERRORï¼Œå…¨å±€å¼‚å¸¸æ•è·å™¨å½¢åŒè™šè®¾ï¼Œå°¤å…¶åœ¨å¾®æœåŠ¡é—´é€šè¿‡OpenFeignè°ƒç”¨APIæ—¶ï¼Œè¯¥é—®é¢˜æ›´ä¸ºçªå‡ºã€‚æœ¬æ–‡å°†å›´ç»•è¿™ä¸€é—®é¢˜ï¼Œä»åŸå› åˆ†æã€è§£å†³æ–¹æ¡ˆåˆ°ç‰¹æ®Šåœºæ™¯é€‚é…ï¼Œé€æ­¥æ‹†è§£å®æˆ˜è¿‡ç¨‹ä¸­çš„æ€è€ƒä¸è¸©å‘ã€‚</p><h2 id="ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ"><a href="#ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ" class="headerlink" title="ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ"></a>ä¸€ã€é—®é¢˜ç°è±¡ï¼šå•ä½“æ¶æ„å¼‚å¸¸æ•è·åœ¨å¾®æœåŠ¡ä¸­å¤±æ•ˆ</h2><p>åœ¨å•ä½“åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç¼–å†™å¦‚ä¸‹å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼Œé’ˆå¯¹ä¸åŒä¸šåŠ¡å¼‚å¸¸è¿”å›è‡ªå®šä¹‰çŠ¶æ€ç å’Œä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleBusinessException</span><span class="params">(BusinessException e)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(e.getCode(), e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleGlobalException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="number">500</span>, <span class="string">&quot;ç³»ç»Ÿå¼‚å¸¸&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå½“æœåŠ¡Aé€šè¿‡OpenFeignè°ƒç”¨æœåŠ¡Bï¼ŒæœåŠ¡BæŠ›å‡ºBusinessExceptionå¹¶è¢«è‡ªèº«å…¨å±€å¼‚å¸¸æ•è·å™¨å¤„ç†ï¼Œè¿”å›400çŠ¶æ€ç å’Œè‡ªå®šä¹‰ä¿¡æ¯æ—¶ï¼ŒæœåŠ¡Aæ¥æ”¶åˆ°çš„å“åº”å´ä¾ç„¶æ˜¯500 INTERNAL_SERVER_ERRORï¼Œæ— æ³•è·å–æœåŠ¡Bè¿”å›çš„çœŸå®å¼‚å¸¸ä¿¡æ¯ï¼Œå¯¼è‡´å¼‚å¸¸æ’æŸ¥å›°éš¾ï¼Œä¹Ÿæ— æ³•æ ¹æ®çœŸå®å¼‚å¸¸ç±»å‹åšåç»­ä¸šåŠ¡å¤„ç†ã€‚</p><h2 id="äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶"><a href="#äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶" class="headerlink" title="äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶"></a>äºŒã€æ ¹æºåˆ†æï¼šOpenFeignå¯¹é2XXå“åº”çš„é»˜è®¤å¤„ç†æœºåˆ¶</h2><p>é—®é¢˜çš„æ ¸å¿ƒåœ¨äºå¾®æœåŠ¡é—´çš„è°ƒç”¨æ–¹å¼â€”â€”OpenFeignçš„å¼‚å¸¸å¤„ç†é€»è¾‘ã€‚å½“è¢«è°ƒç”¨æ–¹ï¼ˆæœåŠ¡Bï¼‰æŠ›å‡ºå¼‚å¸¸åï¼Œå…¶è‡ªèº«çš„å…¨å±€å¼‚å¸¸æ•è·å™¨ä¼šæ­£å¸¸å·¥ä½œï¼Œè¿”å›è‡ªå®šä¹‰çš„é2XXçŠ¶æ€ç ï¼ˆå¦‚400ã€502ï¼‰å’Œé”™è¯¯ä¿¡æ¯ã€‚ä½†è°ƒç”¨æ–¹ï¼ˆæœåŠ¡Aï¼‰é€šè¿‡OpenFeignè°ƒç”¨æ—¶ï¼ŒOpenFeignæœ‰ä¸€ä¸ªé»˜è®¤è§„åˆ™ï¼š<strong>å¯¹æ‰€æœ‰é2XXçš„HTTPå“åº”ï¼Œéƒ½ä¼šè‡ªåŠ¨æŠ›å‡ºFeignExceptionå¼‚å¸¸</strong>ã€‚</p><p>è¿™å°±å¯¼è‡´æœåŠ¡Aæ— æ³•ç›´æ¥è·å–æœåŠ¡Bè¿”å›çš„è‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯ï¼Œåªèƒ½æ•è·åˆ°OpenFeignå°è£…çš„FeignExceptionï¼Œè€Œè¯¥å¼‚å¸¸é»˜è®¤å¯¹åº”500 INTERNAL_SERVER_ERRORçŠ¶æ€ç ï¼Œæœ€ç»ˆå‘ˆç°å‡ºâ€œæ‰€æœ‰å¼‚å¸¸éƒ½è¿”å›500â€çš„ç°è±¡ã€‚æœ¬è´¨ä¸Šæ˜¯OpenFeignçš„é»˜è®¤å¼‚å¸¸è½¬æ¢ï¼Œè¦†ç›–äº†è¢«è°ƒç”¨æ–¹çš„è‡ªå®šä¹‰å¼‚å¸¸å“åº”ã€‚</p><h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ErrorDecoderå¤„ç†çŠ¶æ€ç å¼‚å¸¸</h2><p>è¦è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ErrorDecoderæ¥å£å®ç°ï¼Œè¦†å†™decodeæ–¹æ³•ï¼Œå¯¹ä¸åŒçŠ¶æ€ç çš„å“åº”è¿›è¡Œå·®å¼‚åŒ–å¤„ç†ï¼Œè¿˜åŸè¢«è°ƒç”¨æ–¹çš„çœŸå®å¼‚å¸¸ä¿¡æ¯ï¼Œç”šè‡³è¿”å›è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹ã€‚</p><h3 id="3-1-è‡ªå®šä¹‰ErrorDecoderå®ç°"><a href="#3-1-è‡ªå®šä¹‰ErrorDecoderå®ç°" class="headerlink" title="3.1 è‡ªå®šä¹‰ErrorDecoderå®ç°"></a>3.1 è‡ªå®šä¹‰ErrorDecoderå®ç°</h3><p>æ³¨æ„ï¼šdecodeæ–¹æ³•çš„æ ¸å¿ƒæ˜¯<strong>è¿”å›FeignExceptionï¼Œè€Œéç›´æ¥æŠ›å‡ºå¼‚å¸¸</strong>ï¼ŒOpenFeignä¼šå¯¹è¯¥è¿”å›å€¼åšè¿›ä¸€æ­¥å¤„ç†å¹¶ä¼ é€’ç»™è°ƒç”¨æ–¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomErrorDecoder</span> <span class="keyword">implements</span> <span class="title class_">ErrorDecoder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ErrorDecoder</span> <span class="variable">defaultErrorDecoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Default</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Exception <span class="title function_">decode</span><span class="params">(String methodKey, Response response)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> response.body().asInputStream()) &#123;</span><br><span class="line">            responseBody = IOUtils.toString(inputStream, StandardCharsets.UTF_8);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FeignException</span>.InternalServerError(methodKey, response, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ®å“åº”çŠ¶æ€ç è‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">switch</span> (response.status()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">400</span>:</span><br><span class="line">                <span class="comment">// è§£æå“åº”ä½“ï¼Œå°è£…è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line">                <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> JSON.parseObject(responseBody, ErrorResponse.class);</span><br><span class="line">                <span class="keyword">return</span> FeignException.badRequest(methodKey, response, responseBody.getBytes(), <span class="literal">null</span>)</span><br><span class="line">                        .reason(errorResponse.getMsg());</span><br><span class="line">            <span class="keyword">case</span> <span class="number">502</span>:</span><br><span class="line">                <span class="keyword">return</span> FeignException.serviceUnavailable(methodKey, response, responseBody.getBytes(), <span class="literal">null</span>);</span><br><span class="line">            <span class="comment">// å…¶ä»–çŠ¶æ€ç å¯æŒ‰éœ€æ‰©å±•</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// é»˜è®¤ä½¿ç”¨OpenFeignåŸç”Ÿè§£ç å™¨</span></span><br><span class="line">                <span class="keyword">return</span> defaultErrorDecoder.decode(methodKey, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-é…ç½®FeignConfigæ³¨å†ŒBean"><a href="#3-2-é…ç½®FeignConfigæ³¨å†ŒBean" class="headerlink" title="3.2 é…ç½®FeignConfigæ³¨å†ŒBean"></a>3.2 é…ç½®FeignConfigæ³¨å†ŒBean</h3><p>å°†è‡ªå®šä¹‰çš„CustomErrorDecoderé…ç½®ä¸ºSpring Beanï¼Œçº³å…¥Feignçš„é…ç½®ä½“ç³»ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ErrorDecoder <span class="title function_">errorDecoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomErrorDecoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œå½“æœåŠ¡Aé€šè¿‡OpenFeignè°ƒç”¨æœåŠ¡Bæ—¶ï¼Œè‹¥æœåŠ¡Bè¿”å›é2XXçŠ¶æ€ç ï¼ŒCustomErrorDecoderä¼šè§£æå“åº”ä½“ï¼Œè¿”å›å¯¹åº”çŠ¶æ€ç çš„FeignExceptionï¼Œå¹¶æºå¸¦çœŸå®é”™è¯¯ä¿¡æ¯ï¼ŒæœåŠ¡Aå³å¯é€šè¿‡æ•è·FeignExceptionè·å–è¯¦ç»†å¼‚å¸¸å†…å®¹ï¼Œå†ç»“åˆè‡ªèº«å…¨å±€å¼‚å¸¸æ•è·å™¨åšè¿›ä¸€æ­¥å¤„ç†ã€‚</p><h2 id="å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†"><a href="#å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†" class="headerlink" title="å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†"></a>å››ã€ç‰¹æ®Šåœºæ™¯ï¼šåŸºäºä¸šåŠ¡çŠ¶æ€ç çš„å“åº”å¤„ç†</h2><p>ä¸Šè¿°æ–¹æ¡ˆé€‚ç”¨äºHTTPçŠ¶æ€ç åŒºåˆ†å¼‚å¸¸çš„åœºæ™¯ï¼Œä½†åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œå¾ˆå¤šå›¢é˜Ÿä¼šé‡‡ç”¨â€œç»Ÿä¸€HTTPçŠ¶æ€ç â€çš„è®¾è®¡ï¼šæ‰€æœ‰æ¥å£å‡è¿”å›200 OKï¼Œå¼‚å¸¸ä¿¡æ¯é€šè¿‡å“åº”ä½“ä¸­çš„è‡ªå®šä¹‰ä¸šåŠ¡çŠ¶æ€ç ï¼ˆå¦‚codeå­—æ®µï¼‰ã€msgå­—æ®µåŒºåˆ†ï¼Œdataå­—æ®µå­˜å‚¨ä¸šåŠ¡æ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">10001</span><span class="punctuation">,</span> <span class="comment">// 10001ä»£è¡¨ä¸šåŠ¡å¼‚å¸¸ï¼Œ200ä»£è¡¨æˆåŠŸ</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å‚æ•°æ ¡éªŒå¤±è´¥&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ç§åœºæ™¯ä¸‹ï¼ŒErrorDecoderå°†å®Œå…¨å¤±æ•ˆâ€”â€”å› ä¸ºErrorDecoderä»…æ‹¦æˆªHTTPçŠ¶æ€ç ä¸º4XXã€5XXçš„å“åº”ï¼Œè€Œå½“å‰æ‰€æœ‰è¯·æ±‚çš„HTTPçŠ¶æ€ç éƒ½æ˜¯200ï¼Œæ— æ³•è§¦å‘è‡ªå®šä¹‰è§£ç é€»è¾‘ã€‚æ­¤æ—¶éœ€è¦å¯»æ‰¾æ–°çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰"><a href="#äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰" class="headerlink" title="äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰"></a>äº”ã€è§£å†³æ–¹æ¡ˆäºŒï¼šCustomResponseInterceptorï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰</h2><p>é’ˆå¯¹HTTP 200å“åº”ä¸­åµŒå…¥ä¸šåŠ¡çŠ¶æ€ç çš„åœºæ™¯ï¼Œå¯é€šè¿‡è‡ªå®šä¹‰ResponseInterceptoræ¥å£å®ç°ï¼Œè¦†å†™interceptæ–¹æ³•ï¼Œåœ¨å“åº”è¿”å›åè§£æä¸šåŠ¡çŠ¶æ€ç ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸å¹¶å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomResponseInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ResponseInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">intercept</span><span class="params">(Response response, Chain chain)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£æå“åº”ä½“</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> response.body().asInputStream()) &#123;</span><br><span class="line">            responseBody = IOUtils.toString(inputStream, StandardCharsets.UTF_8);</span><br><span class="line">            <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> JSON.parseObject(responseBody, ErrorResponse.class);</span><br><span class="line">            <span class="comment">// æ ¹æ®ä¸šåŠ¡çŠ¶æ€ç åˆ¤æ–­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (errorResponse.getCode() != <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorResponse.getCode(), errorResponse.getMsg());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(<span class="string">&quot;å“åº”è§£æå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        chain.proceed(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·éœ€è¦åœ¨FeignConfigä¸­é…ç½®è¯¥æ‹¦æˆªå™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ResponseInterceptor <span class="title function_">responseInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomResponseInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¯¥æ–¹æ¡ˆå­˜åœ¨æ˜æ˜¾å±€é™æ€§ï¼š<strong>ResponseInterceptoræ¥å£ä»…åœ¨OpenFeign 12.0+ç‰ˆæœ¬ä¸­æä¾›</strong>ï¼Œå¯¹äºä¸€äº›åŸºäºä½ç‰ˆæœ¬OpenFeignï¼ˆå¦‚Spring Cloud Netflixæ—©æœŸç‰ˆæœ¬ï¼‰çš„è€é¡¹ç›®ï¼Œæ— æ³•ä½¿ç”¨è¯¥æ–¹æ¡ˆï¼Œå…¼å®¹æ€§è¾ƒå·®ã€‚</p><h2 id="å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰"><a href="#å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰" class="headerlink" title="å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰"></a>å…­ã€å°è¯•æ–¹æ¡ˆï¼šAOPæ‹¦æˆªFeignè°ƒç”¨ï¼ˆå¤±æ•ˆåŸå› åˆ†æï¼‰</h2><p>é’ˆå¯¹ä½ç‰ˆæœ¬OpenFeignæ— æ³•ä½¿ç”¨ResponseInterceptorçš„é—®é¢˜ï¼Œæˆ‘å°è¯•é€šè¿‡AOPåˆ‡é¢ï¼Œåœ¨Feignå®¢æˆ·ç«¯è°ƒç”¨APIåï¼Œå¯¹å“åº”ç»“æœè¿›è¡Œè§£æï¼Œæ ¹æ®ä¸šåŠ¡çŠ¶æ€ç æŠ›å‡ºå¯¹åº”å¼‚å¸¸ã€‚ä½†å®é™…æµ‹è¯•å‘ç°ï¼ŒAOPåˆ‡é¢å®Œå…¨ä¸ç”Ÿæ•ˆï¼Œæ— æ³•æ‹¦æˆªFeignå®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨ã€‚</p><p>æŸ¥é˜…èµ„æ–™åï¼Œæ˜ç¡®äº†å¤±æ•ˆçš„æ ¸å¿ƒåŸå› ï¼š</p><ol><li><p><strong>Feignå®¢æˆ·ç«¯çš„åˆ›å»ºæœºåˆ¶</strong>ï¼šFeignå®¢æˆ·ç«¯æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆçš„ï¼Œè€ŒéSpringå®¹å™¨ç®¡ç†çš„æ™®é€šBeanï¼Œå…¶ä»£ç†é€»è¾‘ç”±Feignè‡ªèº«æ§åˆ¶ã€‚</p></li><li><p><strong>Spring AOPçš„æ‹¦æˆªé™åˆ¶</strong>ï¼šSpring AOPé»˜è®¤é‡‡ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œä»…èƒ½æ‹¦æˆªSpringå®¹å™¨ç®¡ç†çš„Beançš„æ–¹æ³•è°ƒç”¨ï¼Œæ— æ³•ç›´æ¥æ‹¦æˆªFeignç”Ÿæˆçš„åŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</p></li><li><p><strong>ä»£ç†ä¼˜å…ˆçº§é—®é¢˜</strong>ï¼šFeignåŠ¨æ€ä»£ç†çš„ä¼˜å…ˆçº§é«˜äºSpring AOPä»£ç†ï¼Œå¯¼è‡´AOPåˆ‡é¢æ— æ³•åˆ‡å…¥Feignå®¢æˆ·ç«¯çš„æ–¹æ³•æ‰§è¡Œæµç¨‹ã€‚</p></li></ol><p>å³ä¾¿å°è¯•åˆ‡æ¢ä¸ºCGLIBä»£ç†ï¼Œä¹Ÿæ— æ³•æœ‰æ•ˆæ‹¦æˆªFeignå®¢æˆ·ç«¯çš„è°ƒç”¨ï¼Œè¯¥æ–¹æ¡ˆæœ€ç»ˆå®£å‘Šå¤±è´¥ã€‚</p><h2 id="ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹"><a href="#ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹" class="headerlink" title="ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹"></a>ä¸ƒã€ç°çŠ¶ä¸æ€è€ƒï¼šå¾…è§£å†³çš„ç—›ç‚¹</h2><p>ç»¼åˆä»¥ä¸Šå®è·µï¼Œç›®å‰é’ˆå¯¹å¾®æœåŠ¡é—´å¼‚å¸¸æ•è·çš„è§£å†³æ–¹æ¡ˆå­˜åœ¨æ˜æ˜¾çš„åœºæ™¯å±€é™æ€§ï¼š</p><ul><li><p>åŸºäºErrorDecoderçš„æ–¹æ¡ˆï¼šé€‚ç”¨äºHTTPçŠ¶æ€ç åŒºåˆ†å¼‚å¸¸çš„åœºæ™¯ï¼Œå…¼å®¹æ€§å¥½ï¼Œæ— ç‰ˆæœ¬é™åˆ¶ï¼Œæ˜¯ç›®å‰æœ€æˆç†Ÿçš„æ–¹æ¡ˆã€‚</p></li><li><p>åŸºäºResponseInterceptorçš„æ–¹æ¡ˆï¼šé€‚ç”¨äºHTTP 200+ä¸šåŠ¡çŠ¶æ€ç çš„åœºæ™¯ï¼Œä½†ä»…æ”¯æŒOpenFeign 12.0+ç‰ˆæœ¬ï¼Œè€é¡¹ç›®æ— æ³•é€‚é…ã€‚</p></li><li><p>AOPæ–¹æ¡ˆï¼šç†è®ºä¸Šå¯é€‚é…æ‰€æœ‰ç‰ˆæœ¬ï¼Œä½†å› FeignåŠ¨æ€ä»£ç†æœºåˆ¶é™åˆ¶ï¼Œæ— æ³•ç”Ÿæ•ˆï¼Œæš‚æ— å¯è¡Œçš„ä¼˜åŒ–æ–¹å‘ã€‚</p></li></ul><p>å¯¹äºâ€œä½ç‰ˆæœ¬OpenFeign + HTTP 200 + ä¸šåŠ¡çŠ¶æ€ç â€çš„ç»„åˆåœºæ™¯ï¼Œç›®å‰ä»æ²¡æœ‰ä¼˜é›…ä¸”å…¼å®¹çš„è§£å†³æ–¹æ¡ˆã€‚å¯ä»¥è€ƒè™‘åœ¨è°ƒç”¨apiçš„æ–¹æ³•ä¸­ï¼Œå»æ¥å—apiè¿”å›çš„å“åº”ç»“æœï¼Œæ ¹æ®ä¸šåŠ¡çŠ¶æ€ç åˆ¤æ–­æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œä½†è¿™ç§æ–¹æ¡ˆä¾µå…¥æ€§å¼ºï¼Œè¿èƒŒäº†é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ€æƒ³ã€‚</p><p>åœ¨æ­¤ä¹Ÿæ¬¢è¿å„ä½åŒè¡Œåˆ†äº«å®è·µç»éªŒï¼Œæ¢è®¨æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆï¼Œå…±åŒå®Œå–„å¾®æœåŠ¡å¼‚å¸¸å¤„ç†ä½“ç³»ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¾®æœåŠ¡é—´çš„å¼‚å¸¸æ•è·ç›¸æ¯”å•ä½“æ¶æ„æ›´å¤æ‚ï¼Œæ ¸å¿ƒéš¾ç‚¹åœ¨äºOpenFeignçš„ä»£ç†æœºåˆ¶å’Œå“åº”å¤„ç†é€»è¾‘ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®ä¼˜å…ˆé‡‡ç”¨â€œHTTPçŠ¶æ€ç +è‡ªå®šä¹‰å“åº”ä½“â€çš„æ–¹å¼è®¾è®¡æ¥å£ï¼Œé€šè¿‡CustomErrorDecoderå®ç°å¼‚å¸¸é€ä¼ ï¼Œå…¼é¡¾å…¼å®¹æ€§å’Œä¼˜é›…æ€§ï¼›è‹¥å› ä¸šåŠ¡éœ€æ±‚å¿…é¡»ä½¿ç”¨ç»Ÿä¸€HTTP 200çŠ¶æ€ç ï¼Œåˆ™éœ€è¯„ä¼°å‡çº§OpenFeignç‰ˆæœ¬çš„å¯è¡Œæ€§ï¼Œæˆ–æƒè¡¡ä¾µå…¥æ€§æ–¹æ¡ˆçš„å–èˆã€‚åç»­å°†æŒç»­å…³æ³¨OpenFeignçš„ç‰ˆæœ¬æ›´æ–°å’Œç¤¾åŒºå®è·µï¼Œå¯»æ‰¾æ›´å®Œå–„çš„è§£å†³æ–¹æ¡ˆã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨å•ä½“æ¶æ„ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å…¨å±€å¼‚å¸¸æ•è·å™¨ï¼ˆå¦‚@ControllerAdvice+@ExceptionHandlerï¼‰å°±èƒ½ä¼˜é›…åœ°å¤„ç†å„ç±»å¼‚å¸¸ï¼Œè‡ªå®šä¹‰å“åº”çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ã€‚ä½†è¿ç§»åˆ°Spring Cloudå¾®æœåŠ¡æ¶æ„åï¼Œå´é‡åˆ°äº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šæ— è®ºå‘ç”Ÿä½•ç§å¼‚å¸¸ï¼Œæ¥å£è¿”å›çš„çŠ¶æ€ç å§‹ç»ˆæ˜¯</summary>
      
    
    
    
    
    <category term="spring cloud" scheme="https://nmcb666.vip/tags/spring-cloud/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis-Plusçš„åˆ†é¡µæŸ¥è¯¢åŸç†</title>
    <link href="https://nmcb666.vip/posts/3ecdcd9c.html"/>
    <id>https://nmcb666.vip/posts/3ecdcd9c.html</id>
    <published>2025-12-11T22:27:30.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†"><a href="#MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†" class="headerlink" title="MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†"></a>MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†</h1><h3 id="ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸-MP-çš„è§£å†³æ–¹æ¡ˆ"><a href="#ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸-MP-çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸ MP çš„è§£å†³æ–¹æ¡ˆ"></a>ä¸€ã€åˆ†é¡µæŸ¥è¯¢çš„æ ¸å¿ƒç—›ç‚¹ä¸ MP çš„è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨ä¼ ç»Ÿ MyBatis å¼€å‘ä¸­ï¼Œåˆ†é¡µå®ç°å¾€å¾€éœ€è¦æ‰‹åŠ¨æ‹¼æ¥<code>LIMIT</code>è¯­å¥ï¼ˆMySQLï¼‰æˆ–<code>ROWNUM</code>ï¼ˆOracleï¼‰ï¼Œä¸ä»…ç¹çä¸”æ˜“å‡ºé”™ï¼Œè¿˜å­˜åœ¨ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š</p><ol><li><p><strong>SQL ä¾µå…¥æ€§å¼º</strong>ï¼šä¸šåŠ¡ SQL ä¸åˆ†é¡µè¯­æ³•è€¦åˆï¼Œåˆ‡æ¢æ•°æ®åº“æ—¶éœ€æ‰¹é‡ä¿®æ”¹ï¼›</p></li><li><p><strong>æ€»æ¡æ•°ç»Ÿè®¡å†—ä½™</strong>ï¼šéœ€æ‰‹åŠ¨ç¼–å†™ count æŸ¥è¯¢ï¼Œä¸”éœ€å¤„ç†å¤æ‚æŸ¥è¯¢ï¼ˆå¦‚å¤šè¡¨å…³è”ã€åˆ†ç»„ç»Ÿè®¡ï¼‰çš„ count é€‚é…ã€‚</p></li></ol><p>MyBatis-Plusï¼ˆä»¥ä¸‹ç®€ç§° MPï¼‰çš„åˆ†é¡µæ’ä»¶é€šè¿‡<strong>æ‹¦æˆªå™¨æœºåˆ¶</strong>+<strong>æ•°æ®åº“æ–¹è¨€é€‚é…</strong>ï¼Œå®ç°äº† â€œæ— ä¾µå…¥å¼åˆ†é¡µâ€ï¼Œå…¶æ ¸å¿ƒè®¾è®¡æ€è·¯æ˜¯ï¼š<strong>åœ¨ SQL æ‰§è¡Œå‰åŠ¨æ€æ”¹å†™ SQLï¼Œè‡ªåŠ¨æ·»åŠ åˆ†é¡µè¯­æ³•å’Œ count æŸ¥è¯¢ï¼ŒåŒæ—¶å°è£…åˆ†é¡µç»“æœ</strong>ã€‚</p><h3 id="äºŒã€MP-åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»"><a href="#äºŒã€MP-åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»" class="headerlink" title="äºŒã€MP åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»"></a>äºŒã€MP åˆ†é¡µçš„æ ¸å¿ƒç»„ä»¶ä¸ä¾èµ–å…³ç³»</h3><p>MP åˆ†é¡µåŠŸèƒ½çš„å®ç°ä¾èµ– 3 ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬çš„åä½œæµç¨‹å†³å®šäº†åˆ†é¡µçš„åº•å±‚é€»è¾‘ï¼š</p><div class="table-container"><table><thead><tr><th>ç»„ä»¶åç§°</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>PaginationInnerInterceptor</code></td><td>æ ¸å¿ƒæ‹¦æˆªå™¨ï¼Œè´Ÿè´£æ‹¦æˆª SQL æ‰§è¡Œã€æ”¹å†™ SQLã€ç»Ÿè®¡æ€»æ¡æ•°ï¼ˆMP 3.4.0 + æ¨èä½¿ç”¨ï¼‰</td></tr><tr><td><code>Page</code></td><td>åˆ†é¡µå‚æ•°è½½ä½“ï¼Œå°è£…é¡µç ã€æ¯é¡µæ¡æ•°ã€æ€»æ¡æ•°ã€åˆ†é¡µç»“æœé›†ç­‰ä¿¡æ¯</td></tr><tr><td><code>Dialect</code></td><td>æ•°æ®åº“æ–¹è¨€æ¥å£ï¼Œé€‚é…ä¸åŒæ•°æ®åº“çš„åˆ†é¡µè¯­æ³•ï¼ˆå¦‚ MySQL çš„ LIMITã€PostgreSQL çš„ OFFSETï¼‰</td></tr></tbody></table></div><p><strong>ä¾èµ–å…³ç³»</strong>ï¼š<code>Page</code>ä¼ é€’åˆ†é¡µå‚æ•° â†’ <code>PaginationInnerInterceptor</code>æ‹¦æˆª SQL â†’ è°ƒç”¨<code>Dialect</code>ç”Ÿæˆé€‚é… SQL â†’ æ‰§è¡ŒæŸ¥è¯¢å¹¶å°è£…ç»“æœã€‚</p><h3 id="ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä»-SQL-æ‹¦æˆªåˆ°ç»“æœè¿”å›"><a href="#ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä»-SQL-æ‹¦æˆªåˆ°ç»“æœè¿”å›" class="headerlink" title="ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä» SQL æ‹¦æˆªåˆ°ç»“æœè¿”å›"></a>ä¸‰ã€åº•å±‚æ ¸å¿ƒæµç¨‹ï¼šä» SQL æ‹¦æˆªåˆ°ç»“æœè¿”å›</h3><h4 id="1-æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶"><a href="#1-æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶" class="headerlink" title="1. æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶"></a>1. æ‹¦æˆªå™¨è§¦å‘æ¡ä»¶</h4><p>MP çš„åˆ†é¡µæ’ä»¶æœ¬è´¨æ˜¯ MyBatis çš„<code>Interceptor</code>æ¥å£å®ç°ç±»ï¼Œé€šè¿‡<code>@Intercepts</code>æ³¨è§£æŒ‡å®šæ‹¦æˆª<code>StatementHandler</code>çš„<code>prepare</code>æ–¹æ³•ï¼ˆSQL é¢„å¤„ç†é˜¶æ®µï¼‰å’Œ<code>query</code>æ–¹æ³•ï¼ˆç»“æœæŸ¥è¯¢é˜¶æ®µï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">   @Signature(type = StatementHandler.class, method = &quot;prepare&quot;, args = &#123;Connection.class, Integer.class&#125;),</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">   @Signature(type = StatementHandler.class, method = &quot;query&quot;, args = &#123;Statement.class, ResultHandler.class&#125;)</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaginationInnerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">InnerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ ¸å¿ƒé€»è¾‘å®ç°</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œ<code>mapper.selectPage(page, queryWrapper)</code>æ—¶ï¼ŒMyBatis çš„æ’ä»¶é“¾ä¼šè§¦å‘è¯¥æ‹¦æˆªå™¨ã€‚</p><h4 id="2-SQL-åŠ¨æ€æ”¹å†™åŸç†"><a href="#2-SQL-åŠ¨æ€æ”¹å†™åŸç†" class="headerlink" title="2. SQL åŠ¨æ€æ”¹å†™åŸç†"></a>2. SQL åŠ¨æ€æ”¹å†™åŸç†</h4><p>è¿™æ˜¯åˆ†é¡µåŠŸèƒ½çš„æ ¸å¿ƒæ­¥éª¤ï¼ŒMP ä¼šæ ¹æ®æ•°æ®åº“æ–¹è¨€ï¼Œå°†åŸå§‹æŸ¥è¯¢ SQL æ”¹å†™æˆ â€œåˆ†é¡µæŸ¥è¯¢ SQLâ€ å’Œ â€œæ€»æ¡æ•°æŸ¥è¯¢ SQLâ€ï¼š</p><h5 id="ï¼ˆ1ï¼‰åŸå§‹-SQL-ç¤ºä¾‹ï¼ˆMySQLï¼‰"><a href="#ï¼ˆ1ï¼‰åŸå§‹-SQL-ç¤ºä¾‹ï¼ˆMySQLï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰åŸå§‹ SQL ç¤ºä¾‹ï¼ˆMySQLï¼‰"></a>ï¼ˆ1ï¼‰åŸå§‹ SQL ç¤ºä¾‹ï¼ˆMySQLï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, age FROM user WHERE age &gt; 18</span><br></pre></td></tr></table></figure><h5 id="ï¼ˆ2ï¼‰åˆ†é¡µ-SQL-æ”¹å†™ï¼ˆæ·»åŠ -LIMITï¼‰"><a href="#ï¼ˆ2ï¼‰åˆ†é¡µ-SQL-æ”¹å†™ï¼ˆæ·»åŠ -LIMITï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰åˆ†é¡µ SQL æ”¹å†™ï¼ˆæ·»åŠ  LIMITï¼‰"></a>ï¼ˆ2ï¼‰åˆ†é¡µ SQL æ”¹å†™ï¼ˆæ·»åŠ  LIMITï¼‰</h5><p>MP é€šè¿‡<code>BoundSql</code>è§£æåŸå§‹ SQLï¼Œæ‹¼æ¥åˆ†é¡µè¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id, name, age FROM user WHERE age &gt; 18 LIMIT 0, 10  -- ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡</span><br></pre></td></tr></table></figure><p><strong>å…³é”®é€»è¾‘</strong>ï¼šåœ¨<code>prepare</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>Dialect.buildPaginationSql</code>ç”Ÿæˆé€‚é… SQLï¼Œä¸åŒæ•°æ®åº“çš„æ–¹è¨€å®ç°ä¸åŒï¼š</p><ul><li><p>MySQLï¼š<code>LIMIT offset, size</code></p></li><li><p>Oracleï¼š<code>SELECT * FROM (SELECT t.*, ROWNUM rn FROM (...) t WHERE ROWNUM  ?) WHERE rn &gt; ?</code></p></li><li><p>PostgreSQLï¼š<code>OFFSET ? LIMIT ?</code></p></li></ul><h5 id="ï¼ˆ3ï¼‰æ€»æ¡æ•°-SQL-è‡ªåŠ¨ç”Ÿæˆ"><a href="#ï¼ˆ3ï¼‰æ€»æ¡æ•°-SQL-è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="ï¼ˆ3ï¼‰æ€»æ¡æ•° SQL è‡ªåŠ¨ç”Ÿæˆ"></a>ï¼ˆ3ï¼‰æ€»æ¡æ•° SQL è‡ªåŠ¨ç”Ÿæˆ</h5><p>MP ä¼šè‡ªåŠ¨å‰¥ç¦»åŸå§‹ SQL çš„<code>SELECT</code>å­—æ®µå’Œ<code>ORDER BY</code>ï¼ˆé¿å… count ç»Ÿè®¡é”™è¯¯ï¼‰ï¼Œç”Ÿæˆ count æŸ¥è¯¢ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(1) FROM user WHERE age &gt; 18</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŒ–ç‚¹</strong>ï¼š</p><ul><li><p>è‹¥åŸå§‹ SQL å«<code>GROUP BY</code>ï¼Œcount ä¼šæ”¹ä¸º<code>COUNT(DISTINCT åˆ†ç»„å­—æ®µ)</code>ï¼›</p></li><li><p>å¯é€šè¿‡<code>page.setSearchCount(false)</code>å…³é—­æ€»æ¡æ•°ç»Ÿè®¡ï¼ˆé€‚ç”¨äºæ— éœ€æ€»é¡µæ•°çš„åœºæ™¯ï¼‰ã€‚</p></li></ul><h4 id="3-åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…"><a href="#3-åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…" class="headerlink" title="3. åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…"></a>3. åˆ†é¡µå‚æ•°ä¼ é€’ä¸ç»“æœå°è£…</h4><ul><li><p><strong>å‚æ•°ä¼ é€’</strong>ï¼š<code>Page</code>å¯¹è±¡ä¸­çš„<code>current</code>ï¼ˆå½“å‰é¡µï¼‰å’Œ<code>size</code>ï¼ˆæ¯é¡µæ¡æ•°ï¼‰ä¼šè¢«è½¬æ¢ä¸º<code>offset = (current - 1) * size</code>ï¼Œä½œä¸ºåˆ†é¡µå‚æ•°æ³¨å…¥æ”¹å†™åçš„ SQLï¼›</p></li><li><p><strong>ç»“æœå°è£…</strong>ï¼šæ‰§è¡Œåˆ†é¡µ SQL åï¼ŒæŸ¥è¯¢ç»“æœä¼šè¢«è®¾ç½®åˆ°<code>page.getRecords()</code>ï¼›æ‰§è¡Œ countSQL åï¼Œæ€»æ¡æ•°ä¼šè®¾ç½®åˆ°<code>page.setTotal(total)</code>ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—<code>pages = (total + size - 1) / size</code>ï¼ˆæ€»é¡µæ•°ï¼‰ã€‚</p></li></ul><h3 id="å››ã€ç‰©ç†åˆ†é¡µ-vs-é€»è¾‘åˆ†é¡µï¼šMP-ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ"><a href="#å››ã€ç‰©ç†åˆ†é¡µ-vs-é€»è¾‘åˆ†é¡µï¼šMP-ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ" class="headerlink" title="å››ã€ç‰©ç†åˆ†é¡µ vs é€»è¾‘åˆ†é¡µï¼šMP ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ"></a>å››ã€ç‰©ç†åˆ†é¡µ vs é€»è¾‘åˆ†é¡µï¼šMP ä¸ºä½•é€‰æ‹©ç‰©ç†åˆ†é¡µï¼Ÿ</h3><p>å¾ˆå¤šäººä¼šç–‘æƒ‘ï¼šMP ä¸ºä½•é‡‡ç”¨ â€œç‰©ç†åˆ†é¡µâ€ï¼ˆä¾èµ–æ•°æ®åº“ SQL è¯­æ³•ï¼‰è€Œé â€œé€»è¾‘åˆ†é¡µâ€ï¼ˆæŸ¥è¯¢å…¨é‡æ•°æ®åå†…å­˜æˆªå–ï¼‰ï¼Ÿ</p><div class="table-container"><table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>ç‰©ç†åˆ†é¡µï¼ˆMP å®ç°ï¼‰</th><th>é€»è¾‘åˆ†é¡µï¼ˆå†…å­˜æˆªå–ï¼‰</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>åªæŸ¥è¯¢å½“å‰é¡µæ•°æ®ï¼Œæ•°æ®åº“å‹åŠ›å°</td><td>æŸ¥è¯¢å…¨é‡æ•°æ®ï¼Œå¤§æ•°æ®é‡ä¸‹å†…å­˜æº¢å‡º</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å¤§æ•°æ®é‡ã€è·¨åº“å…¼å®¹</td><td>å°æ•°æ®é‡ã€æœ¬åœ°æµ‹è¯•</td></tr><tr><td>ä¾èµ–</td><td>æ•°æ®åº“æ–¹è¨€æ”¯æŒ</td><td>æ— ä¾èµ–ï¼Œçº¯ Java é€»è¾‘</td></tr></tbody></table></div><p>MP é€‰æ‹©ç‰©ç†åˆ†é¡µçš„æ ¸å¿ƒåŸå› æ˜¯<strong>æ€§èƒ½ä¼˜åŒ–</strong>â€”â€” å¯¹äºç™¾ä¸‡çº§æ•°æ®ï¼Œé€»è¾‘åˆ†é¡µä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œè€Œç‰©ç†åˆ†é¡µé€šè¿‡æ•°æ®åº“çš„ç´¢å¼•ä¼˜åŒ–ï¼Œä»…è¿”å›å½“å‰é¡µæ•°æ®ï¼Œå¤§å¹…é™ä½ IO å¼€é”€ã€‚</p><h3 id="äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP-3-5-3-ç‰ˆæœ¬ï¼‰"><a href="#äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP-3-5-3-ç‰ˆæœ¬ï¼‰" class="headerlink" title="äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP 3.5.3 ç‰ˆæœ¬ï¼‰"></a>äº”ã€æºç å…³é”®ç‰‡æ®µè§£æï¼ˆMP 3.5.3 ç‰ˆæœ¬ï¼‰</h3><h4 id="1-åˆ†é¡µ-SQL-æ”¹å†™æ ¸å¿ƒä»£ç "><a href="#1-åˆ†é¡µ-SQL-æ”¹å†™æ ¸å¿ƒä»£ç " class="headerlink" title="1. åˆ†é¡µ SQL æ”¹å†™æ ¸å¿ƒä»£ç "></a>1. åˆ†é¡µ SQL æ”¹å†™æ ¸å¿ƒä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PaginationInnerInterceptor.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforePrepare</span><span class="params">(StatementHandler sh, Connection conn, Integer transactionTimeout)</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 1. è·å–åŸå§‹BoundSqlï¼ˆå°è£…SQLå’Œå‚æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line">   <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> sh.getBoundSql();</span><br><span class="line"></span><br><span class="line">   <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> boundSql.getSql();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†é¡µï¼ˆæ˜¯å¦åŒ…å«Pageå‚æ•°ï¼‰</span></span><br><span class="line"></span><br><span class="line">   <span class="type">Page</span> <span class="variable">page</span> <span class="operator">=</span> getPage(sh);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (page != <span class="literal">null</span> &amp;&amp; page.isNeedPagination()) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. è·å–æ•°æ®åº“æ–¹è¨€ï¼ˆæ ¹æ®Connectionè‡ªåŠ¨è¯†åˆ«ï¼‰</span></span><br><span class="line"></span><br><span class="line">       <span class="type">Dialect</span> <span class="variable">dialect</span> <span class="operator">=</span> getDialect(conn);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. æ”¹å†™åˆ†é¡µSQL</span></span><br><span class="line"></span><br><span class="line">       <span class="type">String</span> <span class="variable">paginationSql</span> <span class="operator">=</span> dialect.buildPaginationSql(sql, page.getOffset(), page.getSize());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 5. æ›¿æ¢åŸå§‹SQL</span></span><br><span class="line"></span><br><span class="line">      ReflectUtil.setFieldValue(boundSql, <span class="string">&quot;sql&quot;</span>, paginationSql);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç "><a href="#2-æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç " class="headerlink" title="2. æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç "></a>2. æ€»æ¡æ•°ç»Ÿè®¡æ ¸å¿ƒä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PaginationInnerInterceptor.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="title function_">count</span><span class="params">(Connection conn, String sql, List Class</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">   // <span class="number">1.</span> ç”Ÿæˆcount SQL</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">   String countSql = DialectBuilder.buildCountSql(sql)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 2. æ‰§è¡ŒcountæŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> SqlHelper.executeQuery(conn, countSql, paramList, rs -&gt; &#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> rs.getLong(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ"><a href="#å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ" class="headerlink" title="å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ"></a>å…­ã€å¸¸è§é—®é¢˜ä¸åº•å±‚åŸç†å…³è”åˆ†æ</h3><h4 id="1-åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€”-æ‹¦æˆªå™¨æœªæ³¨å†Œ"><a href="#1-åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€”-æ‹¦æˆªå™¨æœªæ³¨å†Œ" class="headerlink" title="1. åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€” æ‹¦æˆªå™¨æœªæ³¨å†Œ"></a>1. åˆ†é¡µå¤±æ•ˆï¼Ÿâ€”â€” æ‹¦æˆªå™¨æœªæ³¨å†Œ</h4><p>è‹¥åˆ†é¡µ SQL æœªæ·»åŠ  LIMITï¼Œå¤§æ¦‚ç‡æ˜¯åˆ†é¡µæ’ä»¶æœªæ³¨å…¥ Spring å®¹å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­£ç¡®é…ç½®ï¼ˆSpring Bootï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ·»åŠ åˆ†é¡µæ‹¦æˆªå™¨ï¼Œå¹¶æŒ‡å®šæ•°æ®åº“ç±»å‹</span></span><br><span class="line"></span><br><span class="line">       interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> interceptor;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šæœªæ³¨å†Œæ‹¦æˆªå™¨æ—¶ï¼ŒSQL ä¸ä¼šè¢«æ”¹å†™ï¼Œè‡ªç„¶æ— æ³•å®ç°åˆ†é¡µã€‚</p><h4 id="2-æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€”-SQL-è§£æå¼‚å¸¸"><a href="#2-æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€”-SQL-è§£æå¼‚å¸¸" class="headerlink" title="2. æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€” SQL è§£æå¼‚å¸¸"></a>2. æ€»æ¡æ•°ç»Ÿè®¡é”™è¯¯ï¼Ÿâ€”â€” SQL è§£æå¼‚å¸¸</h4><p>è‹¥ count ç»“æœä¸å®é™…ä¸ç¬¦ï¼Œå¯èƒ½æ˜¯åŸå§‹ SQL å«å¤æ‚è¯­æ³•ï¼ˆå¦‚<code>UNION</code>ã€<code>å­æŸ¥è¯¢</code>ï¼‰ï¼Œå¯¼è‡´ MP çš„ SQL è§£æå¤±è´¥ã€‚æ­¤æ—¶å¯æ‰‹åŠ¨æŒ‡å®š countSQLï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page.setCountSql(&quot;SELECT COUNT(1) FROM (åŸå§‹å¤æ‚SQL) t&quot;);</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šMP çš„è‡ªåŠ¨ countSQL ç”Ÿæˆä¾èµ– SQL è§£æå™¨ï¼Œå¤æ‚è¯­æ³•å¯èƒ½å¯¼è‡´è§£æåå·®ï¼Œæ‰‹åŠ¨æŒ‡å®šå¯ç»•è¿‡è§£æé€»è¾‘ã€‚</p><h4 id="3-è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€”-æ–¹è¨€æœªé€‚é…"><a href="#3-è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€”-æ–¹è¨€æœªé€‚é…" class="headerlink" title="3. è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€” æ–¹è¨€æœªé€‚é…"></a>3. è·¨åº“åˆ†é¡µå…¼å®¹é—®é¢˜ï¼Ÿâ€”â€” æ–¹è¨€æœªé€‚é…</h4><p>åˆ‡æ¢æ•°æ®åº“ååˆ†é¡µå¤±æ•ˆï¼Œéœ€ç¡®ä¿<code>DbType</code>ä¸å®é™…æ•°æ®åº“ä¸€è‡´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// é€‚é…PostgreSQL</span><br><span class="line"></span><br><span class="line">interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.POSTGRE\_SQL));</span><br></pre></td></tr></table></figure><p><strong>åŸç†</strong>ï¼šä¸åŒæ•°æ®åº“çš„åˆ†é¡µè¯­æ³•å·®å¼‚ï¼Œæ–¹è¨€æ˜¯è¿æ¥ SQL æ”¹å†™ä¸æ•°æ®åº“çš„æ¡¥æ¢ã€‚</p><h3 id="ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ"><a href="#ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ" class="headerlink" title="ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ"></a>ä¸ƒã€æ€»ç»“ä¸æ€è€ƒ</h3><p>MyBatis-Plus çš„åˆ†é¡µåŠŸèƒ½ä¹‹æ‰€ä»¥å¼ºå¤§ï¼Œæ ¸å¿ƒåœ¨äº **â€œæ— ä¾µå…¥å¼è®¾è®¡â€ å’Œ â€œæ•°æ®åº“æ–¹è¨€é€‚é…â€**ï¼š</p><ol><li><p>åŸºäº MyBatis æ‹¦æˆªå™¨æœºåˆ¶ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ SQLï¼Œå®ç°åˆ†é¡µé€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼›</p></li><li><p>é€šè¿‡æ–¹è¨€æ¥å£å°è£…ä¸åŒæ•°æ®åº“çš„åˆ†é¡µè¯­æ³•ï¼Œè§£å†³è·¨åº“å…¼å®¹é—®é¢˜ï¼›</p></li><li><p>è‡ªåŠ¨ç”Ÿæˆ countSQLï¼Œå‡å°‘é‡å¤ç¼–ç ï¼ŒåŒæ—¶æ”¯æŒçµæ´»é…ç½®ï¼ˆå…³é—­ç»Ÿè®¡ã€æ‰‹åŠ¨æŒ‡å®š countSQLï¼‰ã€‚</p></li></ol><p>ä»åº•å±‚åŸç†æ¥çœ‹ï¼ŒMP çš„åˆ†é¡µæ’ä»¶æœ¬è´¨æ˜¯ â€œSQL è§£æä¸æ”¹å†™çš„è‡ªåŠ¨åŒ–å·¥å…·â€ï¼Œå…¶è®¾è®¡æ€è·¯å€¼å¾—å€Ÿé‰´ï¼š<strong>å°†é€šç”¨é€»è¾‘ï¼ˆåˆ†é¡µï¼‰æŠ½ç¦»ä¸ºæ’ä»¶ï¼Œé€šè¿‡æ‹¦æˆªå™¨åµŒå…¥æ¡†æ¶æµç¨‹ï¼Œæ—¢ä¸ç ´ååŸæœ‰æ¶æ„ï¼Œåˆèƒ½æå‡å¼€å‘æ•ˆç‡</strong>ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œéœ€æ³¨æ„ï¼š</p><ul><li><p>å¤æ‚ SQL åœºæ™¯ä¸‹ï¼Œå»ºè®®æ‰‹åŠ¨éªŒè¯åˆ†é¡µ SQL å’Œ countSQL çš„æ­£ç¡®æ€§ï¼›</p></li><li><p>å¤§æ•°æ®é‡åˆ†é¡µï¼ˆå¦‚åƒä¸‡çº§æ•°æ®ï¼‰ï¼Œå¯ç»“åˆ<code>PageHelper</code>çš„ â€œåˆç†åŒ–åˆ†é¡µâ€ æˆ– MP çš„<code>page.setReasonable(true)</code>é¿å…é¡µç è¶Šç•Œï¼›</p></li><li><p>æ— éœ€æ€»æ¡æ•°æ—¶ï¼Œå…³é—­<code>searchCount</code>å¯æå‡æŸ¥è¯¢æ€§èƒ½ã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&quot;&gt;&lt;a href=&quot;#MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&quot; class=&quot;headerlink&quot; title=&quot;MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&quot;&gt;&lt;/a&gt;MyBatis-Plusåˆ†é¡µæŸ¥è¯¢åº•å±‚åŸç†&lt;/h1&gt;&lt;</summary>
      
    
    
    
    
    <category term="MyBatis-Plus" scheme="https://nmcb666.vip/tags/MyBatis-Plus/"/>
    
  </entry>
  
  <entry>
    <title>bitMapå®ç°ç­¾åˆ°åŠŸèƒ½</title>
    <link href="https://nmcb666.vip/posts/61e739c3.html"/>
    <id>https://nmcb666.vip/posts/61e739c3.html</id>
    <published>2025-12-07T17:44:51.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç”¨æˆ·ç­¾åˆ°æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚APPçš„æ¯æ—¥ç­¾åˆ°é¢†ç§¯åˆ†ã€è¿ç»­ç­¾åˆ°å¥–åŠ±ç­‰ã€‚é¢å¯¹æµ·é‡ç”¨æˆ·çš„ç­¾åˆ°æ•°æ®ï¼Œå¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ï¼Œä¸ä»…ä¼šå ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”åœ¨ç»Ÿè®¡ç­¾åˆ°æƒ…å†µæ—¶æ•ˆç‡ä¹Ÿä¼šæ¯”è¾ƒä½ä¸‹ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´é«˜æ•ˆã€æ›´èŠ‚çœç©ºé—´çš„æ–¹æ¡ˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé‚£å°±æ˜¯åˆ©ç”¨Redisä¸­çš„Bitmapï¼ˆä½å›¾ï¼‰æ¥å®ç°ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½ã€‚æœ¬æ–‡å°±æ¥è¯¦ç»†æ¢è®¨ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Redis Bitmapç»“åˆJavaå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Œå¹¶åˆ†æå…¶ä¼˜åŠ¿å’Œæ³¨æ„äº‹é¡¹ã€‚</p><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ"></a>ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Ÿ</h2><p>åœ¨ä»‹ç»å…·ä½“å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆRedis Bitmapé€‚åˆç”¨æ¥å®ç°ç”¨æˆ·ç­¾åˆ°ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹Bitmapçš„åŸºæœ¬æ¦‚å¿µï¼šBitmapæ˜¯ä¸€ç§åŸºäºä½çš„æ•°æ®ç»“æ„ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªä½ï¼ˆbitï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„çŠ¶æ€ï¼Œ0è¡¨ç¤ºä¸å­˜åœ¨æˆ–æœªå‘ç”Ÿï¼Œ1è¡¨ç¤ºå­˜åœ¨æˆ–å·²å‘ç”Ÿã€‚åœ¨ç”¨æˆ·ç­¾åˆ°åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä½æ¥è¡¨ç¤ºç”¨æˆ·æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæå¤§åœ°èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰1000ä¸‡ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·æ¯å¹´ç­¾åˆ°æ•°æ®éœ€è¦365ä¸ª bit æ¥å­˜å‚¨ï¼Œé‚£ä¹ˆä¸€å¹´çš„ç­¾åˆ°æ•°æ®æ€»å­˜å‚¨ç©ºé—´ä¸ºï¼š1000ä¸‡ <em> 365 bit = 10000000 </em> 365 / 8 / 1024 / 1024 â‰ˆ 430MBã€‚å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„æ•°æ®åº“è¡¨ï¼Œæ¯ä¸ªç­¾åˆ°è®°å½•è‡³å°‘éœ€è¦å­˜å‚¨ç”¨æˆ·IDã€ç­¾åˆ°æ—¥æœŸç­‰å­—æ®µï¼Œå‡è®¾æ¯æ¡è®°å½•å ç”¨20å­—èŠ‚ï¼Œé‚£ä¹ˆ1000ä¸‡ç”¨æˆ·ä¸€å¹´çš„ç­¾åˆ°æ•°æ®å­˜å‚¨ç©ºé—´ä¸ºï¼š1000ä¸‡ <em> 365 </em> 20 byte = 10000000 <em> 365 </em> 20 / 1024 / 1024 / 1024 â‰ˆ 6.8GBã€‚é€šè¿‡å¯¹æ¯”å¯ä»¥æ˜æ˜¾çœ‹å‡ºï¼ŒBitmapåœ¨å­˜å‚¨ç©ºé—´ä¸Šå…·æœ‰å·¨å¤§çš„ä¼˜åŠ¿ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒRedis Bitmapè¿˜æä¾›äº†ä¸°å¯Œçš„ä½æ“ä½œå‘½ä»¤ï¼Œæ¯”å¦‚<code>SETBIT</code>ï¼ˆè®¾ç½®æŸä¸€ä½çš„å€¼ï¼‰ã€<code>GETBIT</code>ï¼ˆè·å–æŸä¸€ä½çš„å€¼ï¼‰ã€<code>BITCOUNT</code>ï¼ˆç»Ÿè®¡å€¼ä¸º1çš„ä½çš„ä¸ªæ•°ï¼‰ã€<code>BITOP</code>ï¼ˆä½è¿ç®—ï¼‰ç­‰ï¼Œè¿™äº›å‘½ä»¤èƒ½å¤Ÿé«˜æ•ˆåœ°æ»¡è¶³ç­¾åˆ°åŠŸèƒ½ä¸­çš„ç­¾åˆ°æ ‡è®°ã€ç­¾åˆ°æŸ¥è¯¢ã€è¿ç»­ç­¾åˆ°ç»Ÿè®¡ç­‰éœ€æ±‚ï¼Œæ“ä½œæ•ˆç‡éå¸¸é«˜ã€‚</p><h2 id="äºŒã€Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ"><a href="#äºŒã€Redis-Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ" class="headerlink" title="äºŒã€Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ"></a>äºŒã€Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°çš„å…·ä½“æ–¹æ¡ˆ</h2><h3 id="2-1-é”®çš„è®¾è®¡"><a href="#2-1-é”®çš„è®¾è®¡" class="headerlink" title="2.1 é”®çš„è®¾è®¡"></a>2.1 é”®çš„è®¾è®¡</h3><p>è¦ä½¿ç”¨Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°ï¼Œé¦–å…ˆéœ€è¦è®¾è®¡åˆç†çš„é”®åã€‚ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ä¸åŒç”¨æˆ·ã€ä¸åŒå¹´ä»½å’Œæœˆä»½çš„ç­¾åˆ°æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¿™æ ·çš„é”®åæ ¼å¼ï¼š<code>user:checkin:uid:year:month</code>ã€‚å…¶ä¸­ï¼Œ<code>uid</code>æ˜¯ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œ<code>year</code>æ˜¯å¹´ä»½ï¼Œ<code>month</code>æ˜¯æœˆä»½ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œæ¯ä¸ªç”¨æˆ·æ¯ä¸ªæœˆçš„ç­¾åˆ°æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç‹¬ç«‹çš„Bitmapä¸­ï¼Œæ—¢æ–¹ä¾¿ç®¡ç†ï¼Œåˆèƒ½é¿å…å•ä¸ªBitmapè¿‡å¤§å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</p><h3 id="2-2-ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰"><a href="#2-2-ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰" class="headerlink" title="2.2 ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰"></a>2.2 ç­¾åˆ°æ ‡è®°ï¼ˆSETBITå‘½ä»¤ï¼‰</h3><p>å½“ç”¨æˆ·è¿›è¡Œç­¾åˆ°æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å¯¹åº”æ—¥æœŸçš„ä½è®¾ç½®ä¸º1ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>è·å–å½“å‰æ—¥æœŸï¼Œå¹¶è®¡ç®—å‡ºè¯¥æ—¥æœŸåœ¨å½“æœˆæ˜¯ç¬¬å‡ å¤©ï¼ˆå‡è®¾ä¸ºdayï¼Œå–å€¼èŒƒå›´1-31ï¼‰ã€‚</p></li><li><p>ç”±äºBitmapçš„ä½æ˜¯ä»0å¼€å§‹è®¡æ•°çš„ï¼Œæ‰€ä»¥éœ€è¦å°†dayå‡1å¾—åˆ°å¯¹åº”çš„ä½ç´¢å¼•ï¼ˆindex = day - 1ï¼‰ã€‚</p></li><li><p>ä½¿ç”¨Redisçš„<code>SETBIT</code>å‘½ä»¤ï¼Œå°†é”®<code>user:checkin:uid:year:month</code>å¯¹åº”indexä½ç½®çš„ä½è®¾ç½®ä¸º1ã€‚</p></li></ol><p><code>SETBIT</code>å‘½ä»¤çš„è¯­æ³•ä¸ºï¼š<code>SETBIT key offset value</code>ï¼Œå…¶ä¸­offsetæ˜¯ä½ç´¢å¼•ï¼Œvalueæ˜¯è¦è®¾ç½®çš„å€¼ï¼ˆ0æˆ–1ï¼‰ã€‚è¯¥å‘½ä»¤çš„è¿”å›å€¼æ˜¯è¯¥ä½åœ¨è®¾ç½®å‰çš„å€¼ã€‚</p><h3 id="2-3-ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰"><a href="#2-3-ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰" class="headerlink" title="2.3 ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰"></a>2.3 ç­¾åˆ°æŸ¥è¯¢ï¼ˆGETBITå‘½ä»¤ï¼‰</h3><p>å½“éœ€è¦æŸ¥è¯¢ç”¨æˆ·æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>GETBIT</code>å‘½ä»¤ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>è·å–è¦æŸ¥è¯¢çš„æ—¥æœŸï¼Œå¹¶è®¡ç®—å‡ºè¯¥æ—¥æœŸåœ¨å½“æœˆæ˜¯ç¬¬å‡ å¤©ï¼ˆdayï¼‰ã€‚</p></li><li><p>è®¡ç®—ä½ç´¢å¼•index = day - 1ã€‚</p></li><li><p>ä½¿ç”¨<code>GETBIT</code>å‘½ä»¤ï¼Œè·å–é”®<code>user:checkin:uid:year:month</code>å¯¹åº”indexä½ç½®çš„ä½å€¼ã€‚å¦‚æœè¿”å›1ï¼Œè¡¨ç¤ºç”¨æˆ·å½“å¤©å·²ç­¾åˆ°ï¼›å¦‚æœè¿”å›0ï¼Œè¡¨ç¤ºç”¨æˆ·å½“å¤©æœªç­¾åˆ°ã€‚</p></li></ol><p><code>GETBIT</code>å‘½ä»¤çš„è¯­æ³•ä¸ºï¼š<code>GETBIT key offset</code>ã€‚</p><h3 id="2-4-ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰"><a href="#2-4-ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰" class="headerlink" title="2.4 ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰"></a>2.4 ç­¾åˆ°ç»Ÿè®¡ï¼ˆBITCOUNTå‘½ä»¤ï¼‰</h3><p>åœ¨ç­¾åˆ°åŠŸèƒ½ä¸­ï¼Œç»å¸¸éœ€è¦ç»Ÿè®¡ç”¨æˆ·åœ¨æŸä¸ªæ—¶é—´æ®µå†…çš„ç­¾åˆ°å¤©æ•°ï¼Œæ¯”å¦‚å½“æœˆç­¾åˆ°å¤©æ•°ã€è¿‘7å¤©ç­¾åˆ°å¤©æ•°ç­‰ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>BITCOUNT</code>å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç”¨äºç»Ÿè®¡Bitmapä¸­å€¼ä¸º1çš„ä½çš„ä¸ªæ•°ã€‚</p><p><code>BITCOUNT</code>å‘½ä»¤çš„è¯­æ³•ä¸ºï¼š<code>BITCOUNT key [start end]</code>ï¼Œå…¶ä¸­startå’Œendæ˜¯å­—èŠ‚çš„ç´¢å¼•ï¼ˆæ³¨æ„ä¸æ˜¯ä½çš„ç´¢å¼•ï¼‰ï¼Œç”¨äºæŒ‡å®šç»Ÿè®¡çš„èŒƒå›´ã€‚å¦‚æœä¸æŒ‡å®šstartå’Œendï¼Œåˆ™ç»Ÿè®¡æ•´ä¸ªBitmapã€‚</p><p>ä¾‹å¦‚ï¼Œè¦ç»Ÿè®¡ç”¨æˆ·å½“æœˆçš„ç­¾åˆ°å¤©æ•°ï¼Œç›´æ¥ä½¿ç”¨<code>BITCOUNT user:checkin:uid:year:month</code>å³å¯ã€‚å¦‚æœè¦ç»Ÿè®¡ç”¨æˆ·è¿‘7å¤©çš„ç­¾åˆ°å¤©æ•°ï¼Œéœ€è¦å…ˆç¡®å®šè¿™7å¤©å¯¹åº”çš„ä½ç´¢å¼•èŒƒå›´ï¼Œç„¶åå°†ä½ç´¢å¼•è½¬æ¢ä¸ºå­—èŠ‚ç´¢å¼•ï¼ˆå­—èŠ‚ç´¢å¼• = ä½ç´¢å¼• / 8ï¼‰ï¼Œå†ä½¿ç”¨<code>BITCOUNT</code>å‘½ä»¤è¿›è¡Œç»Ÿè®¡ã€‚</p><h3 id="2-5-è¿ç»­ç­¾åˆ°ç»Ÿè®¡"><a href="#2-5-è¿ç»­ç­¾åˆ°ç»Ÿè®¡" class="headerlink" title="2.5 è¿ç»­ç­¾åˆ°ç»Ÿè®¡"></a>2.5 è¿ç»­ç­¾åˆ°ç»Ÿè®¡</h3><p>è¿ç»­ç­¾åˆ°ç»Ÿè®¡æ˜¯ç­¾åˆ°åŠŸèƒ½ä¸­çš„ä¸€ä¸ªéš¾ç‚¹ï¼Œæ¯”å¦‚ç»Ÿè®¡ç”¨æˆ·å½“å‰çš„è¿ç»­ç­¾åˆ°å¤©æ•°ã€‚å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li><p>ä»å½“å‰æ—¥æœŸå¼€å§‹ï¼Œä¾æ¬¡å‘å‰æŸ¥è¯¢æ¯å¤©çš„ç­¾åˆ°çŠ¶æ€ï¼ˆä½¿ç”¨<code>GETBIT</code>å‘½ä»¤ï¼‰ã€‚</p></li><li><p>å¦‚æœæŸ¥è¯¢åˆ°æŸä¸€å¤©æœªç­¾åˆ°ï¼Œåˆ™åœæ­¢æŸ¥è¯¢ï¼Œè¿ç»­ç­¾åˆ°å¤©æ•°ä¸ºå·²æŸ¥è¯¢åˆ°çš„ç­¾åˆ°å¤©æ•°ã€‚</p></li><li><p>å¦‚æœæŸ¥è¯¢åˆ°æœ¬æœˆç¬¬ä¸€å¤©éƒ½å·²ç­¾åˆ°ï¼Œåˆ™ç»§ç»­æŸ¥è¯¢ä¸Šä¸€ä¸ªæœˆçš„ç­¾åˆ°æ•°æ®ï¼Œç›´åˆ°æŸ¥è¯¢åˆ°æœªç­¾åˆ°çš„æ—¥æœŸä¸ºæ­¢ã€‚</p></li></ol><p>åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„è·¨æœˆä»½çš„æƒ…å†µï¼Œéœ€è¦åˆ†åˆ«å¤„ç†ä¸åŒæœˆä»½çš„Bitmapã€‚</p><h2 id="ä¸‰ã€Javaä»£ç å®ç°"><a href="#ä¸‰ã€Javaä»£ç å®ç°" class="headerlink" title="ä¸‰ã€Javaä»£ç å®ç°"></a>ä¸‰ã€Javaä»£ç å®ç°</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡Javaä»£ç æ¥å…·ä½“å®ç°Redis Bitmapç”¨æˆ·ç­¾åˆ°åŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥Redisçš„Javaå®¢æˆ·ç«¯ä¾èµ–ï¼Œè¿™é‡Œä»¥Jedisä¸ºä¾‹ã€‚</p><h3 id="3-1-ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰"><a href="#3-1-ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰" class="headerlink" title="3.1 ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰"></a>3.1 ä¾èµ–å¼•å…¥ï¼ˆMavenï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2-ç­¾åˆ°å·¥å…·ç±»å®ç°"><a href="#3-2-ç­¾åˆ°å·¥å…·ç±»å®ç°" class="headerlink" title="3.2 ç­¾åˆ°å·¥å…·ç±»å®ç°"></a>3.2 ç­¾åˆ°å·¥å…·ç±»å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckinUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_KEY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;user:checkin:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">YEAR_MONTH_FORMATTER</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyMM&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CheckinUtil</span><span class="params">(Jedis jedis)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jedis = jedis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç­¾åˆ°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date ç­¾åˆ°æ—¥æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç­¾åˆ°å‰çš„çŠ¶æ€ï¼ˆ0ï¼šæœªç­¾åˆ°ï¼Œ1ï¼šå·²ç­¾åˆ°ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">checkin</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> getCheckinKey(uid, date);</span><br><span class="line">        <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> date.getDayOfMonth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> dayOfMonth - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> jedis.setbit(key, offset, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç”¨æˆ·æŸä¸€å¤©æ˜¯å¦ç­¾åˆ°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date æŸ¥è¯¢æ—¥æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueï¼šå·²ç­¾åˆ°ï¼Œfalseï¼šæœªç­¾åˆ°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">isCheckin</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> getCheckinKey(uid, date);</span><br><span class="line">        <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> date.getDayOfMonth();</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> dayOfMonth - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> jedis.getbit(key, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»Ÿè®¡ç”¨æˆ·å½“æœˆç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date å½“æœˆä»»æ„ä¸€å¤©</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">countMonthCheckin</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> getCheckinKey(uid, date);</span><br><span class="line">        <span class="keyword">return</span> jedis.bitcount(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»Ÿè®¡ç”¨æˆ·å½“å‰è¿ç»­ç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿ç»­ç­¾åˆ°å¤©æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countContinuousCheckin</span><span class="params">(Long uid)</span> &#123;</span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">currentDate</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">        <span class="type">int</span> <span class="variable">continuousDays</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">LocalDate</span> <span class="variable">tempDate</span> <span class="operator">=</span> currentDate;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">Boolean</span> <span class="variable">isCheckin</span> <span class="operator">=</span> isCheckin(uid, tempDate);</span><br><span class="line">            <span class="keyword">if</span> (isCheckin) &#123;</span><br><span class="line">                continuousDays++;</span><br><span class="line">                tempDate = tempDate.minusDays(<span class="number">1</span>);</span><br><span class="line">                <span class="comment">// é¿å…æ— é™å¾ªç¯ï¼Œå½“æŸ¥è¯¢åˆ°ä¸€å¹´å‰ä»æœªæ–­ç­¾æ—¶ï¼Œåœæ­¢æŸ¥è¯¢</span></span><br><span class="line">                <span class="keyword">if</span> (tempDate.isBefore(currentDate.minusYears(<span class="number">1</span>))) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> continuousDays;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç­¾åˆ°Redisé”®å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date æ—¥æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é”®å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getCheckinKey</span><span class="params">(Long uid, LocalDate date)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">yearMonth</span> <span class="operator">=</span> date.format(YEAR_MONTH_FORMATTER);</span><br><span class="line">        <span class="keyword">return</span> REDIS_KEY_PREFIX + uid + <span class="string">&quot;:&quot;</span> + yearMonth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€æ³¨æ„äº‹é¡¹"><a href="#å››ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€æ³¨æ„äº‹é¡¹"></a>å››ã€æ³¨æ„äº‹é¡¹</h2><ul><li><p><strong>Bitmapçš„å¤§å°é™åˆ¶</strong>ï¼šRedisä¸­å•ä¸ªBitMapçš„åç§»é‡æœ€å¤§ä¸º 2^32-1ã€‚åœ¨è®¾è®¡é”®åæ—¶ï¼ŒæŒ‰ç”¨æˆ·æ¯æœˆæ‹†åˆ†Bitmapï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶å•ä¸ªBitmapçš„å¤§å°ï¼Œé¿å…å› Bitmapè¿‡å¤§å¯¼è‡´æŠ¥é”™ã€‚</p></li><li><p><strong>æ—¥æœŸå¤„ç†çš„å‡†ç¡®æ€§</strong>ï¼šåœ¨è®¡ç®—ä½ç´¢å¼•æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ—¥æœŸçš„å‡†ç¡®æ€§ï¼Œç‰¹åˆ«æ˜¯è·¨æœˆä»½å’Œé—°å¹´çš„æƒ…å†µã€‚ä½¿ç”¨Java 8çš„<code>LocalDate</code>ç±»å¯ä»¥æ–¹ä¾¿ã€å‡†ç¡®åœ°å¤„ç†æ—¥æœŸç›¸å…³æ“ä½œã€‚</p></li><li><p><strong>Redisè¿æ¥ç®¡ç†</strong>ï¼šåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸èƒ½æ¯æ¬¡æ“ä½œéƒ½åˆ›å»ºæ–°çš„Jedisè¿æ¥ï¼Œåº”è¯¥ä½¿ç”¨è¿æ¥æ± æ¥ç®¡ç†Redisè¿æ¥ï¼Œä»¥æé«˜æ€§èƒ½å’Œé¿å…èµ„æºæ³„éœ²ã€‚ï¼ˆè¿™ä¸ªæ— éœ€æ‹…å¿ƒï¼Œå®é™…å¼€å‘å¤§å¤šé‡‡ç”¨spring-data-redisè¿›è¡Œæ“ä½œ ä¼šè‡ªè¡Œç®¡ç†ï¼‰</p></li><li><p><strong>æ•°æ®æŒä¹…åŒ–</strong>ï¼šRedisæ”¯æŒRDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œä¸ºäº†é˜²æ­¢ç­¾åˆ°æ•°æ®ä¸¢å¤±ï¼Œéœ€è¦åˆç†é…ç½®Redisçš„æŒä¹…åŒ–ç­–ç•¥ã€‚</p></li><li><p><strong>è¿‡æœŸç­–ç•¥</strong>ï¼šå¯¹äºä¸€äº›è¿‡æœŸçš„ç­¾åˆ°æ•°æ®ï¼ˆæ¯”å¦‚å‡ å¹´å‰çš„ç­¾åˆ°æ•°æ®ï¼‰ï¼Œå¦‚æœä¸šåŠ¡ä¸Šä¸å†éœ€è¦ï¼Œå¯ä»¥è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ï¼Œè®©Redisè‡ªåŠ¨æ¸…ç†è¿™äº›æ•°æ®ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p></li></ul><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>ä½¿ç”¨Redis Bitmapå®ç°ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½ï¼Œå…·æœ‰å­˜å‚¨ç©ºé—´å°ã€æ“ä½œæ•ˆç‡é«˜ã€å‘½ä»¤ä¸°å¯Œç­‰ä¼˜ç‚¹ï¼Œéå¸¸é€‚åˆå¤„ç†æµ·é‡ç”¨æˆ·çš„ç­¾åˆ°æ•°æ®ã€‚é€šè¿‡åˆç†çš„é”®åè®¾è®¡å’ŒJavaä»£ç å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®Œæˆç­¾åˆ°æ ‡è®°ã€ç­¾åˆ°æŸ¥è¯¢ã€ç­¾åˆ°ç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚åŒæ—¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦æ³¨æ„Bitmapçš„å¤§å°é™åˆ¶ã€æ—¥æœŸå¤„ç†ã€Redisè¿æ¥ç®¡ç†ç­‰é—®é¢˜ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒRedis Bitmapæ˜¯å®ç°ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½çš„ä¸€ç§ä¼˜ç§€æ–¹æ¡ˆï¼Œå€¼å¾—åœ¨é¡¹ç›®ä¸­æ¨å¹¿å’Œåº”ç”¨ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç”¨æˆ·ç­¾åˆ°æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚APPçš„æ¯æ—¥ç­¾åˆ°é¢†ç§¯åˆ†ã€è¿ç»­ç­¾åˆ°å¥–åŠ±ç­‰ã€‚é¢å¯¹æµ·é‡ç”¨æˆ·çš„ç­¾åˆ°æ•°æ®ï¼Œå¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å­˜å‚¨ï¼Œä¸ä»…ä¼šå ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”åœ¨ç»Ÿè®¡ç­¾åˆ°æƒ…å†µæ—¶æ•ˆç‡ä¹Ÿä¼šæ¯”è¾ƒä½ä¸‹ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´é«˜æ•ˆã€æ›´èŠ‚çœç©ºé—´çš„æ–¹æ¡ˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé‚£å°±æ˜¯åˆ©</summary>
      
    
    
    
    
    <category term="redis" scheme="https://nmcb666.vip/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨Redis Sorted Setå®ç°Javaæ»šåŠ¨åˆ†é¡µæŸ¥è¯¢</title>
    <link href="https://nmcb666.vip/posts/7be5306f.html"/>
    <id>https://nmcb666.vip/posts/7be5306f.html</id>
    <published>2025-12-06T19:13:16.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆ†é¡µæŸ¥è¯¢æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ã€‚ä¼ ç»Ÿçš„åŸºäºæ•°æ®åº“çš„Limit Offsetåˆ†é¡µæ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†åœ¨æ•°æ®é‡è¾ƒå¤§æˆ–æ•°æ®å®æ—¶å˜åŠ¨ï¼ˆå¦‚æ’å…¥æ–°æ•°æ®ï¼‰çš„åœºæ™¯ä¸‹ï¼Œä¼šå‡ºç°<strong>é‡å¤æ•°æ®</strong>æˆ–<strong>æ•°æ®é—æ¼</strong>çš„é—®é¢˜ã€‚æœ¬æ–‡å°†æ¢è®¨å¦‚ä½•åˆ©ç”¨Redisçš„Sorted Setï¼ˆæœ‰åºé›†åˆï¼‰æ•°æ®ç»“æ„æ¥å®ç°é«˜æ•ˆã€å‡†ç¡®çš„æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢ï¼Œå¹¶ç»“åˆå…·ä½“Javaä»£ç è¿›è¡Œè¯¦ç»†è§£æã€‚</p><h2 id="ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ"><a href="#ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ" class="headerlink" title="ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ"></a>ä¸€ã€ä¼ ç»Ÿåˆ†é¡µçš„ç—›ç‚¹ï¼šä¸ºä»€ä¹ˆéœ€è¦æ»šåŠ¨åˆ†é¡µï¼Ÿ</h2><p>æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ä¼ ç»Ÿçš„Limit Offsetåˆ†é¡µã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¼ åšå®¢è¡¨ï¼Œè¦æŸ¥è¯¢ç¬¬2é¡µæ•°æ®ï¼ˆæ¯é¡µ2æ¡ï¼‰ï¼ŒSQLé€šå¸¸æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> blog <span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time <span class="keyword">DESC</span> LIMIT <span class="number">2</span> <span class="keyword">OFFSET</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºï¼šå¦‚æœåœ¨æŸ¥è¯¢ç¬¬1é¡µåã€ç¬¬2é¡µå‰ï¼Œæœ‰ä¸€æ¡æ–°çš„åšå®¢æ’å…¥ï¼ˆcreate_timeæ¯”ç¬¬1é¡µçš„éƒ¨åˆ†æ•°æ®æ›´æ–°ï¼‰ï¼Œé‚£ä¹ˆç¬¬2é¡µçš„ç»“æœå°±ä¼šåŒ…å«åŸæœ¬ç¬¬1é¡µçš„æœ€åä¸€æ¡æ•°æ®ï¼Œå¯¼è‡´é‡å¤æŸ¥è¯¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ul><li><p>åˆå§‹æ•°æ®ï¼š[A(æ—¶é—´10), B(æ—¶é—´9), C(æ—¶é—´8), D(æ—¶é—´7)]</p></li><li><p>ç¬¬1é¡µï¼ˆLIMIT 2 OFFSET 0ï¼‰ï¼š[A, B]</p></li><li><p>æ’å…¥æ–°æ•°æ®E(æ—¶é—´11)ï¼Œæ•°æ®å˜ä¸ºï¼š[E(11), A(10), B(9), C(8), D(7)]</p></li><li><p>ç¬¬2é¡µï¼ˆLIMIT 2 OFFSET 2ï¼‰ï¼š[B, C] â†’ Bé‡å¤å‡ºç°</p></li></ul><p>æ»šåŠ¨åˆ†é¡µï¼ˆä¹Ÿå«æ¸¸æ ‡åˆ†é¡µï¼‰åˆ™é€šè¿‡<strong>ä¸Šä¸€é¡µçš„æœ€åä¸€ä¸ªæ ‡è®°ï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰</strong>æ¥å®šä½ä¸‹ä¸€é¡µçš„èµ·å§‹ä½ç½®ï¼Œé¿å…äº†Offsetå¸¦æ¥çš„é—®é¢˜ã€‚è€ŒRedisçš„Sorted Setæ°å¥½èƒ½å®Œç¾æ”¯æŒè¿™ç§åœºæ™¯ã€‚</p><h2 id="äºŒã€Redis-Sorted-Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ"><a href="#äºŒã€Redis-Sorted-Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ" class="headerlink" title="äºŒã€Redis Sorted Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ"></a>äºŒã€Redis Sorted Setçš„ç‰¹æ€§ï¼šä¸ºä»€ä¹ˆé€‚åˆæ»šåŠ¨åˆ†é¡µï¼Ÿ</h2><p>Redisçš„Sorted Setï¼ˆæœ‰åºé›†åˆï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå®ƒä¸ºæ¯ä¸ªå…ƒç´ åˆ†é…ä¸€ä¸ª<strong>åˆ†æ•°ï¼ˆScoreï¼‰</strong>ï¼Œå¹¶æŒ‰ç…§åˆ†æ•°å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚å…¶æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</p><ol><li><p><strong>æœ‰åºæ€§</strong>ï¼šå…ƒç´ å¤©ç„¶æŒ‰ç…§Scoreå‡åºæˆ–é™åºæ’åˆ—ï¼Œæ— éœ€é¢å¤–æ’åºæ“ä½œã€‚</p></li><li><p><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šæ”¯æŒé€šè¿‡ScoreèŒƒå›´ï¼ˆå¦‚0åˆ°maxScoreï¼‰æŸ¥è¯¢å…ƒç´ ï¼Œè¿™æ˜¯å®ç°æ»šåŠ¨åˆ†é¡µçš„å…³é”®ã€‚</p></li><li><p><strong>é«˜æ•ˆæ€§</strong>ï¼šæ— è®ºæ˜¯æ’å…¥ã€æŸ¥è¯¢è¿˜æ˜¯åˆ é™¤æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å‡ä¸ºO(logN)ï¼Œé€‚åˆå¤§æ•°æ®é‡åœºæ™¯ã€‚</p></li></ol><p>åœ¨æ»šåŠ¨åˆ†é¡µåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†<strong>ä¸šåŠ¡æ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚åšå®¢IDï¼‰</strong>ä½œä¸ºSorted Setçš„å…ƒç´ ï¼ˆValueï¼‰ï¼Œå°†<strong>æ’åºå­—æ®µï¼ˆå¦‚åˆ›å»ºæ—¶é—´æˆ³ï¼‰</strong>ä½œä¸ºå…ƒç´ çš„åˆ†æ•°ï¼ˆScoreï¼‰ã€‚è¿™æ ·ï¼Œé€šè¿‡ScoreèŒƒå›´å°±èƒ½å¿«é€Ÿå®šä½ä¸‹ä¸€é¡µæ•°æ®ã€‚</p><h2 id="ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ"><a href="#ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ" class="headerlink" title="ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ"></a>ä¸‰ã€æ»šåŠ¨åˆ†é¡µçš„å®ç°æ€è·¯ä¸ä»£ç è§£æ</h2><p>ä¸‹é¢ç»“åˆæä¾›çš„Javaä»£ç ï¼Œè¯¦ç»†æ‹†è§£åˆ©ç”¨Redis Sorted Setå®ç°æ»šåŠ¨åˆ†é¡µçš„å®Œæ•´æµç¨‹ã€‚æœ¬æ–‡ä»¥â€œæŸ¥è¯¢å…³æ³¨çš„åšå®¢åŠ¨æ€â€ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="3-1-æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ"><a href="#3-1-æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ" class="headerlink" title="3.1 æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ"></a>3.1 æ ¸å¿ƒæµç¨‹æ¦‚è§ˆ</h3><p>æ»šåŠ¨åˆ†é¡µçš„æ ¸å¿ƒæ˜¯é€šè¿‡â€œä¸Šä¸€é¡µçš„æœ€å°æ—¶é—´æˆ³ï¼ˆminTimeï¼‰â€å’Œâ€œåç§»é‡ï¼ˆoffsetï¼‰â€æ¥å®šä½ä¸‹ä¸€é¡µæ•°æ®ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>å®šä¹‰Redisçš„Sorted Seté”®ï¼šä»¥ç”¨æˆ·IDä¸ºç»´åº¦ï¼Œå­˜å‚¨è¯¥ç”¨æˆ·å…³æ³¨çš„åšå®¢IDé›†åˆï¼ˆå¦‚<code>feed:1001</code>è¡¨ç¤ºç”¨æˆ·1001çš„å…³æ³¨åŠ¨æ€ï¼‰ã€‚</p></li><li><p>æŸ¥è¯¢ä¸Šä¸€é¡µæ•°æ®ï¼šé€šè¿‡<code>reverseRangeByScoreWithScores</code>æ–¹æ³•ï¼ŒæŸ¥è¯¢Scoreåœ¨0åˆ°maxï¼ˆä¸Šä¸€é¡µçš„minTimeï¼‰ä¹‹é—´çš„å…ƒç´ ï¼ŒåŒæ—¶æŒ‡å®šåç§»é‡å’Œæ¯é¡µæ•°é‡ã€‚</p></li><li><p>å¤„ç†æŸ¥è¯¢ç»“æœï¼šæå–åšå®¢IDã€è®¡ç®—å½“å‰é¡µçš„æœ€å°æ—¶é—´æˆ³å’Œåç§»é‡ï¼Œç”¨äºä¸‹ä¸€é¡µæŸ¥è¯¢ã€‚</p></li><li><p>å°è£…å¹¶è¿”å›ç»“æœï¼šå°†åšå®¢è¯¦æƒ…ã€minTimeã€offsetè¿”å›ç»™å‰ç«¯ï¼Œä½œä¸ºä¸‹ä¸€é¡µè¯·æ±‚çš„å‚æ•°ã€‚</p></li></ol><h3 id="3-2-ä»£ç é€è¡Œè§£æ"><a href="#3-2-ä»£ç é€è¡Œè§£æ" class="headerlink" title="3.2 ä»£ç é€è¡Œè§£æ"></a>3.2 ä»£ç é€è¡Œè§£æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(Long max, Integer offset)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;feed:&quot;</span> + userId; <span class="comment">// Redisé”®ï¼šfeed:ç”¨æˆ·ID</span></span><br><span class="line">    <span class="comment">// 2. ä»RedisæŸ¥è¯¢blogIdåˆ—è¡¨</span></span><br><span class="line">    <span class="comment">// reverseRangeByScoreWithScoresï¼šå€’åºæŸ¥è¯¢Scoreåœ¨[0, max]ä¹‹é—´çš„å…ƒç´ </span></span><br><span class="line">    <span class="comment">// å‚æ•°è¯´æ˜ï¼škey, æœ€å°Score, æœ€å¤§Score, åç§»é‡, æ¯é¡µæ•°é‡</span></span><br><span class="line">    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; result = stringRedisTemplate.opsForZSet()</span><br><span class="line">            .reverseRangeByScoreWithScores(key, <span class="number">0</span>, max, offset, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 3. å¤„ç†ç©ºç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span>(result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;æ— æ–°æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. æå–åšå®¢IDã€è®¡ç®—å½“å‰é¡µçš„minTimeå’Œoffset</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">minTime</span> <span class="operator">=</span> System.currentTimeMillis(); <span class="comment">// åˆå§‹åŒ–ä¸ºå½“å‰æ—¶é—´</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">offset1</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// åˆå§‹åç§»é‡ä¸º1</span></span><br><span class="line">    List&lt;Long&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(result.size());</span><br><span class="line">    <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; tuple : result) &#123;</span><br><span class="line">        <span class="comment">// æå–åšå®¢ID</span></span><br><span class="line">        ids.add(Long.valueOf(Objects.requireNonNull(tuple.getValue())));</span><br><span class="line">        <span class="comment">// æå–Scoreï¼ˆå³åšå®¢åˆ›å»ºæ—¶é—´æˆ³ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> Objects.requireNonNull(tuple.getScore()).longValue();</span><br><span class="line">        <span class="comment">// å¤„ç†ç›¸åŒæ—¶é—´æˆ³çš„æƒ…å†µï¼šè‹¥æ—¶é—´ç­‰äºå½“å‰minTimeï¼Œåç§»é‡+1ï¼›å¦åˆ™æ›´æ–°minTimeå’Œåç§»é‡</span></span><br><span class="line">        <span class="keyword">if</span>(time == minTime) &#123;</span><br><span class="line">            offset1++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            minTime = time;</span><br><span class="line">            offset1 = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5. æŸ¥è¯¢åšå®¢è¯¦æƒ…ï¼ˆæ‰¹é‡æŸ¥è¯¢é¿å…N+1é—®é¢˜ï¼Œæ­¤å¤„ä¸ºç®€åŒ–ç¤ºä¾‹ï¼‰</span></span><br><span class="line">    List&lt;Blog&gt; blogs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(ids.size());</span><br><span class="line">    ids.forEach(id -&gt; &#123;</span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id); <span class="comment">// ä»æ•°æ®åº“æŸ¥è¯¢åšå®¢è¯¦æƒ…</span></span><br><span class="line">        setBlogIsLiked(blog); <span class="comment">// å¤„ç†åšå®¢ç‚¹èµçŠ¶æ€</span></span><br><span class="line">        queryUser(blog); <span class="comment">// å¡«å……åšå®¢ä½œè€…ä¿¡æ¯</span></span><br><span class="line">        blogs.add(blog);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 6. å°è£…æ»šåŠ¨åˆ†é¡µç»“æœ</span></span><br><span class="line">    ScrollResult&lt;Blog&gt; scrollResult = <span class="keyword">new</span> <span class="title class_">ScrollResult</span>&lt;&gt;();</span><br><span class="line">    scrollResult.setList(blogs); <span class="comment">// å½“å‰é¡µåšå®¢åˆ—è¡¨</span></span><br><span class="line">    scrollResult.setMinTime(minTime); <span class="comment">// å½“å‰é¡µæœ€å°æ—¶é—´æˆ³ï¼ˆä¸‹ä¸€é¡µçš„maxå‚æ•°ï¼‰</span></span><br><span class="line">    scrollResult.setOffset(offset1); <span class="comment">// å½“å‰é¡µæœ€å°æ—¶é—´æˆ³å¯¹åº”çš„åç§»é‡</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(scrollResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-å…³é”®ç»†èŠ‚è¯´æ˜"><a href="#3-3-å…³é”®ç»†èŠ‚è¯´æ˜" class="headerlink" title="3.3 å…³é”®ç»†èŠ‚è¯´æ˜"></a>3.3 å…³é”®ç»†èŠ‚è¯´æ˜</h3><div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">**ä¸ºä»€ä¹ˆç”¨reverseRangeByScoreWithScoresï¼Ÿ**å› ä¸ºæˆ‘ä»¬é€šå¸¸éœ€è¦æŒ‰æ—¶é—´å€’åºå±•ç¤ºæ•°æ®ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰ï¼Œè¯¥æ–¹æ³•ä¼šæŒ‰ç…§Scoreä»å¤§åˆ°å°è¿”å›å…ƒç´ ï¼Œæ­£å¥½ç¬¦åˆéœ€æ±‚ã€‚</p></div><div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">**maxå’Œoffsetå‚æ•°çš„ä½œç”¨ï¼Ÿ**- `max`ï¼šä¸Šä¸€é¡µè¿”å›çš„minTimeï¼Œä»£è¡¨ä¸‹ä¸€é¡µæ•°æ®çš„Scoreä¸èƒ½è¶…è¿‡è¿™ä¸ªå€¼ï¼ˆå³æ—¶é—´ä¸èƒ½æ™šäºè¿™ä¸ªå€¼ï¼‰ã€‚- `offset`ï¼šå½“å­˜åœ¨å¤šä¸ªScoreç›¸åŒçš„å…ƒç´ æ—¶ï¼Œç”¨äºè·³è¿‡å‰Nä¸ªå…ƒç´ ï¼Œé¿å…é‡å¤ã€‚</p></div><div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">**å¦‚ä½•å¤„ç†ç›¸åŒæ—¶é—´æˆ³çš„æ•°æ®ï¼Ÿ**å¦‚æœå¤šæ¡åšå®¢çš„åˆ›å»ºæ—¶é—´æˆ³ç›¸åŒï¼ˆScoreç›¸åŒï¼‰ï¼Œä¸‹ä¸€é¡µæŸ¥è¯¢æ—¶éœ€è¦é€šè¿‡offsetè·³è¿‡è¿™äº›é‡å¤çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå½“å‰é¡µæœ‰3æ¡æ•°æ®çš„Scoreéƒ½æ˜¯1620000000ï¼Œé‚£ä¹ˆminTime=1620000000ï¼Œoffset=3ï¼Œä¸‹ä¸€é¡µæŸ¥è¯¢æ—¶ä¼šä»ç¬¬4ä¸ªScore=1620000000çš„å…ƒç´ å¼€å§‹ã€‚</p></div><h2 id="å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹"><a href="#å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹"></a>å››ã€æ»šåŠ¨åˆ†é¡µçš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹</h2><h3 id="4-1-ä¼˜åŠ¿"><a href="#4-1-ä¼˜åŠ¿" class="headerlink" title="4.1 ä¼˜åŠ¿"></a>4.1 ä¼˜åŠ¿</h3><ul><li><p><strong>æ— é‡å¤æ— é—æ¼</strong>ï¼šåŸºäºæ—¶é—´æˆ³å®šä½ï¼Œå³ä½¿ä¸­é—´æ’å…¥æ–°æ•°æ®ï¼Œä¹Ÿä¸ä¼šå½±å“ä¸‹ä¸€é¡µçš„æŸ¥è¯¢ç»“æœã€‚</p></li><li><p><strong>é«˜æ€§èƒ½</strong>ï¼šRedisçš„Sorted SetæŸ¥è¯¢æ•ˆç‡é«˜ï¼Œå°¤å…¶é€‚åˆå¤§æ•°æ®é‡åœºæ™¯ï¼Œé¿å…äº†æ•°æ®åº“Limit Offsetçš„å…¨è¡¨æ‰«æé—®é¢˜ã€‚</p></li><li><p><strong>å®æ—¶æ€§å¥½</strong>ï¼šæ•°æ®æ’å…¥Redisåå¯ç«‹å³æŸ¥è¯¢ï¼Œæ— éœ€ç­‰å¾…æ•°æ®åº“åŒæ­¥ã€‚</p></li></ul><h3 id="4-2-æ³¨æ„äº‹é¡¹"><a href="#4-2-æ³¨æ„äº‹é¡¹" class="headerlink" title="4.2 æ³¨æ„äº‹é¡¹"></a>4.2 æ³¨æ„äº‹é¡¹</h3><ul><li><p><strong>Scoreçš„å”¯ä¸€æ€§é—®é¢˜</strong>ï¼šå¦‚æœæ’åºå­—æ®µï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰å­˜åœ¨å¤§é‡é‡å¤ï¼Œéœ€è¦é€šè¿‡offsetæ¥å¤„ç†ï¼Œå¦åˆ™å¯èƒ½å‡ºç°æ•°æ®æ¼æŸ¥ã€‚</p></li><li><p><strong>Redisæ•°æ®ä¸€è‡´æ€§</strong>ï¼šéœ€è¦ä¿è¯ä¸šåŠ¡æ•°æ®ï¼ˆå¦‚åšå®¢ï¼‰ä¸Redisä¸­çš„Sorted SetåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œåšå®¢åˆ é™¤æ—¶ï¼Œè¦åŠæ—¶ä»Redisä¸­ç§»é™¤å¯¹åº”çš„å…ƒç´ ã€‚</p></li><li><p><strong>åˆ†é¡µå‚æ•°çš„ä¼ é€’</strong>ï¼šå‰ç«¯éœ€è¦å°†ä¸Šä¸€é¡µè¿”å›çš„minTimeå’Œoffsetä½œä¸ºä¸‹ä¸€é¡µè¯·æ±‚çš„å‚æ•°ï¼Œå› æ­¤éœ€è¦åœ¨æ¥å£è®¾è®¡ä¸­æ˜ç¡®è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p></li></ul><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>ç›¸æ¯”ä¼ ç»Ÿçš„Limit Offsetåˆ†é¡µï¼ŒåŸºäºRedis Sorted Setçš„æ»šåŠ¨åˆ†é¡µåœ¨å®æ—¶æ€§ã€å‡†ç¡®æ€§å’Œé«˜æ€§èƒ½æ–¹é¢éƒ½æœ‰æ˜æ˜¾ä¼˜åŠ¿ï¼Œå°¤å…¶é€‚åˆåŠ¨æ€æ•°æ®ï¼ˆå¦‚å…³æ³¨åŠ¨æ€ã€æ¶ˆæ¯æµï¼‰çš„åˆ†é¡µåœºæ™¯ã€‚å…¶æ ¸å¿ƒæ˜¯åˆ©ç”¨Sorted Setçš„Scoreæœ‰åºæ€§å’ŒèŒƒå›´æŸ¥è¯¢èƒ½åŠ›ï¼Œé€šè¿‡â€œä¸Šä¸€é¡µçš„æœ€å°æ—¶é—´æˆ³+åç§»é‡â€æ¥å®šä½ä¸‹ä¸€é¡µæ•°æ®ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»Ÿåˆ†é¡µçš„é‡å¤å’Œé—æ¼é—®é¢˜ã€‚</p><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ä¼˜åŒ–ç»†èŠ‚ï¼Œä¾‹å¦‚ç»“åˆRedisçš„è¿‡æœŸç­–ç•¥æ¸…ç†å†å²æ•°æ®ã€ä½¿ç”¨ç®¡é“ï¼ˆPipelineï¼‰å‡å°‘Redisäº¤äº’æ¬¡æ•°ç­‰ï¼Œè¿›ä¸€æ­¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆ†é¡µæŸ¥è¯¢æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„éœ€æ±‚ã€‚ä¼ ç»Ÿçš„åŸºäºæ•°æ®åº“çš„Limit Offsetåˆ†é¡µæ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†åœ¨æ•°æ®é‡è¾ƒå¤§æˆ–æ•°æ®å®æ—¶å˜åŠ¨ï¼ˆå¦‚æ’å…¥æ–°æ•°æ®ï¼‰çš„åœºæ™¯ä¸‹ï¼Œä¼šå‡ºç°&lt;strong&gt;é‡å¤æ•°æ®&lt;/strong&gt;æˆ–&lt;strong&gt;æ•°æ®é—æ¼&lt;/strong&gt;çš„é—®é¢˜ã€‚æœ¬æ–‡å°†æ¢è®¨å¦‚ä½•åˆ©</summary>
      
    
    
    
    
    <category term="redis" scheme="https://nmcb666.vip/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†ã€ACKæœºåˆ¶ä¸åœ¨Javaä¸­çš„å®è·µ</title>
    <link href="https://nmcb666.vip/posts/da8941bc.html"/>
    <id>https://nmcb666.vip/posts/da8941bc.html</id>
    <published>2025-12-03T18:42:18.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis-Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†ã€ACKæœºåˆ¶ä¸Javaå®è·µ"><a href="#Redis-Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†ã€ACKæœºåˆ¶ä¸Javaå®è·µ" class="headerlink" title="Redis Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†ã€ACKæœºåˆ¶ä¸Javaå®è·µ"></a>Redis Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†ã€ACKæœºåˆ¶ä¸Javaå®è·µ</h1><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯è§£è€¦æœåŠ¡ã€å‰Šå³°å¡«è°·çš„æ ¸å¿ƒç»„ä»¶ã€‚Redisä½œä¸ºé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œä»5.0ç‰ˆæœ¬å¼€å§‹å¼•å…¥Streamæ•°æ®ç»“æ„ï¼ŒåŸç”Ÿæ”¯æŒæ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½ã€‚ç›¸è¾ƒäºRedisä»¥å¾€çš„Pub/Subï¼ˆæ— æŒä¹…åŒ–ï¼‰ã€Listï¼ˆç®€å•é˜Ÿåˆ—ï¼‰ï¼ŒStreamæä¾›äº†<strong>æŒä¹…åŒ–ã€å¤šæ¶ˆè´¹è€…ç»„ã€ACKç¡®è®¤ã€æ¶ˆæ¯å›æº¯</strong>ç­‰ä¼ä¸šçº§ç‰¹æ€§ï¼Œå°¤å…¶åœ¨å¤šæ¶ˆè´¹è€…ç»„åœºæ™¯ä¸‹ï¼Œèƒ½çµæ´»å®ç°æ¶ˆæ¯çš„åˆ†å‘ä¸å¤„ç†ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æStreamå¤šæ¶ˆè´¹è€…ç»„çš„å®ç°åŸç†ï¼Œé‡ç‚¹è§£è¯»ACKç¡®è®¤æœºåˆ¶ä¸Pending Listçš„ä½œç”¨ï¼Œå¹¶ç»“åˆJavaä»£ç æ¼”ç¤ºå®é™…è¿ç”¨åœºæ™¯ã€‚</p><h1 id="ä¸€ã€Redis-Streamæ ¸å¿ƒæ¦‚å¿µä¸å¤šæ¶ˆè´¹è€…ç»„æ¨¡å‹"><a href="#ä¸€ã€Redis-Streamæ ¸å¿ƒæ¦‚å¿µä¸å¤šæ¶ˆè´¹è€…ç»„æ¨¡å‹" class="headerlink" title="ä¸€ã€Redis Streamæ ¸å¿ƒæ¦‚å¿µä¸å¤šæ¶ˆè´¹è€…ç»„æ¨¡å‹"></a>ä¸€ã€Redis Streamæ ¸å¿ƒæ¦‚å¿µä¸å¤šæ¶ˆè´¹è€…ç»„æ¨¡å‹</h1><p>åœ¨ç†è§£å¤šæ¶ˆè´¹è€…ç»„ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ˜ç¡®Streamçš„å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼š</p><ul><li><p><strong>Stream</strong>ï¼šæ¶ˆæ¯çš„è½½ä½“ï¼Œç±»ä¼¼æ—¥å¿—æ–‡ä»¶çš„ç»“æ„ï¼Œæ¯æ¡æ¶ˆæ¯æœ‰å”¯ä¸€çš„IDï¼ˆæ ¼å¼ä¸ºâ€œæ—¶é—´æˆ³-åºåˆ—å·â€ï¼Œå¦‚1690000000000-0ï¼‰ï¼Œæ¶ˆæ¯å†…å®¹ä»¥é”®å€¼å¯¹å­˜å‚¨ã€‚</p></li><li><p><strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼šä¸€ç»„æ¶ˆè´¹è€…çš„é›†åˆï¼ŒåŒä¸€ä¸ªStreamå¯ä»¥åˆ›å»ºå¤šä¸ªæ¶ˆè´¹è€…ç»„ã€‚<strong>ä¸åŒæ¶ˆè´¹è€…ç»„ä¹‹é—´æ˜¯ç‹¬ç«‹çš„</strong>ï¼Œå³åŒä¸€æ¡æ¶ˆæ¯ä¼šè¢«æ¯ä¸ªæ¶ˆè´¹è€…ç»„æ¶ˆè´¹ä¸€æ¬¡ï¼›è€ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…åˆ™ç«äº‰æ¶ˆè´¹æ¶ˆæ¯ï¼Œç¡®ä¿ä¸€æ¡æ¶ˆæ¯åªè¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ã€‚</p></li><li><p><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼šéš¶å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå®é™…å¤„ç†æ¶ˆæ¯çš„ä¸ªä½“ã€‚</p></li><li><p><strong>Pending Listï¼ˆPENDINGåˆ—è¡¨ï¼‰</strong>ï¼šæ¶ˆè´¹è€…ä»ç»„å†…è·å–æ¶ˆæ¯åï¼Œè‹¥æœªå‘é€ACKç¡®è®¤ï¼Œæ¶ˆæ¯ä¼šè¢«æ”¾å…¥è¯¥æ¶ˆè´¹è€…çš„Pending Listä¸­ï¼Œæ ‡è®°ä¸ºâ€œå·²è¯»å–ä½†æœªç¡®è®¤â€ã€‚</p></li></ul><p>å¤šæ¶ˆè´¹è€…ç»„çš„æ ¸å¿ƒæ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæ¦‚å¿µç¤ºæ„ï¼‰ï¼š</p><blockquote><p>Streamï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ â†’ æ¶ˆè´¹è€…ç»„Aï¼ˆConsumer1ã€Consumer2ï¼‰ â†’ å„è‡ªPending List</p><pre><code>  â””â†’ æ¶ˆè´¹è€…ç»„Bï¼ˆConsumer3ã€Consumer4ï¼‰ â†’ å„è‡ªPending List</code></pre></blockquote><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªè®¢å•Streamå¯ä»¥åˆ›å»ºâ€œæ”¯ä»˜ç»„â€å’Œâ€œç‰©æµç»„â€ï¼Œæ”¯ä»˜ç»„å¤„ç†è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œç‰©æµç»„å¤„ç†è®¢å•å‘è´§ï¼Œä¸¤è€…ç‹¬ç«‹æ¶ˆè´¹åŒä¸€æ¡è®¢å•æ¶ˆæ¯ï¼Œäº’ä¸å¹²æ‰°ã€‚</p><h1 id="äºŒã€å…³é”®æœºåˆ¶ï¼šACKç¡®è®¤ä¸Pending-Listæ·±åº¦è§£æ"><a href="#äºŒã€å…³é”®æœºåˆ¶ï¼šACKç¡®è®¤ä¸Pending-Listæ·±åº¦è§£æ" class="headerlink" title="äºŒã€å…³é”®æœºåˆ¶ï¼šACKç¡®è®¤ä¸Pending Listæ·±åº¦è§£æ"></a>äºŒã€å…³é”®æœºåˆ¶ï¼šACKç¡®è®¤ä¸Pending Listæ·±åº¦è§£æ</h1><p>Streamçš„å¯é æ€§ä¾èµ–äº<strong>ACKç¡®è®¤æœºåˆ¶</strong>ï¼Œè€ŒPending Liståˆ™æ˜¯ACKæœºåˆ¶çš„æ ¸å¿ƒè½½ä½“ã€‚è¿™ä¸¤è€…å…±åŒç¡®ä¿æ¶ˆæ¯â€œè‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡â€ï¼ˆAt-Least-Onceï¼‰ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚</p><h2 id="2-1-ACKç¡®è®¤æœºåˆ¶æµç¨‹"><a href="#2-1-ACKç¡®è®¤æœºåˆ¶æµç¨‹" class="headerlink" title="2.1 ACKç¡®è®¤æœºåˆ¶æµç¨‹"></a>2.1 ACKç¡®è®¤æœºåˆ¶æµç¨‹</h2><p>å½“æ¶ˆè´¹è€…ä»ç»„å†…è·å–æ¶ˆæ¯åï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šç«‹å³ä»Streamä¸­åˆ é™¤ï¼Œè€Œæ˜¯éœ€è¦æ¶ˆè´¹è€…å¤„ç†å®Œæˆåä¸»åŠ¨å‘é€ACKå‘½ä»¤ï¼ˆ<code>XACK</code>ï¼‰ï¼ŒRedisæ‰ä¼šå°†æ¶ˆæ¯ä»è¯¥æ¶ˆè´¹è€…çš„Pending Listä¸­ç§»é™¤ï¼Œæ ‡è®°ä¸ºâ€œå·²å¤„ç†â€ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>æ¶ˆè´¹è€…é€šè¿‡<code>XREADGROUP</code>å‘½ä»¤ä»ç»„å†…è¯»å–æ¶ˆæ¯ï¼ˆå¦‚<code>XREADGROUP GROUP group1 consumer1 COUNT 1 STREAMS stream1 &gt;</code>ï¼Œå…¶ä¸­â€œ&gt;â€è¡¨ç¤ºè¯»å–ç»„å†…æœªè¢«æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ï¼‰ã€‚</p></li><li><p>Rediså°†æ¶ˆæ¯æ ‡è®°ä¸ºâ€œå·²åˆ†é…ç»™consumer1â€ï¼Œå¹¶åŠ å…¥consumer1çš„Pending Listã€‚</p></li><li><p>æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯ï¼ˆå¦‚ä¸šåŠ¡é€»è¾‘è®¡ç®—ã€æ•°æ®åº“å†™å…¥ç­‰ï¼‰ã€‚</p></li><li><p>å¤„ç†æˆåŠŸåï¼Œæ¶ˆè´¹è€…å‘é€<code>XACK stream1 group1 msgId</code>å‘½ä»¤ç¡®è®¤æ¶ˆæ¯ã€‚</p></li><li><p>Redisæ”¶åˆ°ACKåï¼Œä»consumer1çš„Pending Listä¸­åˆ é™¤è¯¥æ¶ˆæ¯ã€‚</p></li></ol><h2 id="2-2-Pending-Listçš„ä½œç”¨ä¸æ ¸å¿ƒæ“ä½œ"><a href="#2-2-Pending-Listçš„ä½œç”¨ä¸æ ¸å¿ƒæ“ä½œ" class="headerlink" title="2.2 Pending Listçš„ä½œç”¨ä¸æ ¸å¿ƒæ“ä½œ"></a>2.2 Pending Listçš„ä½œç”¨ä¸æ ¸å¿ƒæ“ä½œ</h2><p>Pending Listï¼ˆç®€ç§°PENDINGï¼‰æ˜¯æ¯ä¸ªæ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…ç‹¬æœ‰çš„â€œæœªç¡®è®¤æ¶ˆæ¯åˆ—è¡¨â€ï¼Œå®ƒè§£å†³äº†â€œæ¶ˆæ¯å·²è¯»å–ä½†å¤„ç†å¤±è´¥â€çš„é—®é¢˜ã€‚å½“æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯å¼‚å¸¸ï¼ˆå¦‚æœåŠ¡å®•æœºã€ä¸šåŠ¡æŠ¥é”™ï¼‰æ—¶ï¼Œæ¶ˆæ¯ä¼šä¸€ç›´ç•™åœ¨Pending Listä¸­ï¼Œç›´åˆ°è¢«é‡æ–°å¤„ç†å¹¶ACKã€‚</p><div class="tip warning faa-horizontal animated-hover"><p><strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼šPending Listä¸­çš„æ¶ˆæ¯ä¼šè®°å½•ä¸‰ä¸ªå…³é”®ä¿¡æ¯â€”â€”æ¶ˆæ¯IDã€æ¶ˆè´¹è€…IDã€æœªç¡®è®¤æ—¶é•¿ï¼ˆidle timeï¼‰ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œæ¶ˆæ¯é‡è¯•æˆ–æ­»ä¿¡å¤„ç†ã€‚</p></div><p>æ“ä½œPending Listçš„å¸¸ç”¨å‘½ä»¤ï¼š</p><ul><li><p><code>XPENDING</code>ï¼šæŸ¥çœ‹æ¶ˆè´¹è€…ç»„æˆ–æ¶ˆè´¹è€…çš„Pendingæ¶ˆæ¯ç»Ÿè®¡ï¼Œå¦‚<code>XPENDING stream1 group1</code>å¯æŸ¥çœ‹group1çš„Pendingæ€»æ•°ã€æœ€å°/æœ€å¤§idle timeç­‰ã€‚</p></li><li><p><code>XPENDING stream1 group1 - + 10 consumer1</code>ï¼šæŸ¥çœ‹consumer1çš„å‰10æ¡Pendingæ¶ˆæ¯ï¼ˆâ€œ-â€è¡¨ç¤ºæœ€å°IDï¼Œâ€œ+â€è¡¨ç¤ºæœ€å¤§IDï¼‰ã€‚</p></li><li><p><code>XCLAIM</code>ï¼šå°†Pending Listä¸­çš„æ¶ˆæ¯â€œè®¤é¢†â€ç»™å…¶ä»–æ¶ˆè´¹è€…å¤„ç†ï¼Œé€‚ç”¨äºæ¶ˆè´¹è€…å®•æœºåçš„æ¶ˆæ¯è½¬ç§»ï¼Œå¦‚<code>XCLAIM stream1 group1 consumer2 60000 1690000000000-0</code>ï¼ˆ60000è¡¨ç¤ºidle timeè¶…è¿‡60ç§’çš„æ¶ˆæ¯ï¼‰ã€‚</p></li></ul><h1 id="ä¸‰ã€Javaä¸­çš„å®è·µï¼šä»é˜Ÿåˆ—æ¶ˆè´¹ä¸Pending-Listé‡è¯•"><a href="#ä¸‰ã€Javaä¸­çš„å®è·µï¼šä»é˜Ÿåˆ—æ¶ˆè´¹ä¸Pending-Listé‡è¯•" class="headerlink" title="ä¸‰ã€Javaä¸­çš„å®è·µï¼šä»é˜Ÿåˆ—æ¶ˆè´¹ä¸Pending Listé‡è¯•"></a>ä¸‰ã€Javaä¸­çš„å®è·µï¼šä»é˜Ÿåˆ—æ¶ˆè´¹ä¸Pending Listé‡è¯•</h1><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡Javaä»£ç æ¼”ç¤ºStreamçš„æ ¸å¿ƒç”¨æ³•ï¼š<strong>å…ˆæ¶ˆè´¹Streamä¸­çš„æ–°æ¶ˆæ¯ï¼Œè‹¥å¤„ç†å¼‚å¸¸åˆ™å°†æ¶ˆæ¯ç•™åœ¨Pending Listï¼Œä¸‹æ¬¡æ¶ˆè´¹å‰å…ˆå¤„ç†Pending Listä¸­çš„æ¶ˆæ¯</strong>ã€‚æˆ‘ä»¬ä½¿ç”¨Spring Data Redisä½œä¸ºå®¢æˆ·ç«¯ï¼ˆéœ€å¼•å…¥ä¾èµ–ï¼š<code>spring-boot-starter-data-redis</code>ï¼‰ã€‚</p><h2 id="3-1-åˆå§‹åŒ–Streamä¸æ¶ˆè´¹è€…ç»„"><a href="#3-1-åˆå§‹åŒ–Streamä¸æ¶ˆè´¹è€…ç»„" class="headerlink" title="3.1 åˆå§‹åŒ–Streamä¸æ¶ˆè´¹è€…ç»„"></a>3.1 åˆå§‹åŒ–Streamä¸æ¶ˆè´¹è€…ç»„</h2><p>é¦–å…ˆéœ€è¦åˆ›å»ºStreamå¹¶åˆå§‹åŒ–æ¶ˆè´¹è€…ç»„ï¼ˆå¯åœ¨é¡¹ç›®å¯åŠ¨æ—¶æ‰§è¡Œï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.stream.Consumer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.stream.ObjectRecord;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.stream.ReadOffset;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.stream.StreamInfo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamInitializer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STREAM_KEY</span> <span class="operator">=</span> <span class="string">&quot;order_stream&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GROUP_NAME</span> <span class="operator">=</span> <span class="string">&quot;order_group&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StreamInitializer</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initStreamAndGroup</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.execute((RedisConnection connection) -&gt; &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥Streamæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ˆå¯é€‰ï¼ŒXADDä¼šè‡ªåŠ¨åˆ›å»ºï¼‰</span></span><br><span class="line">            StreamInfo.<span class="type">XInfoStream</span> <span class="variable">info</span> <span class="operator">=</span> connection.streamCommands().xInfoStream(STREAM_KEY.getBytes());</span><br><span class="line">            <span class="keyword">if</span> (info == <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Streamä¸å­˜åœ¨ï¼Œåˆ›å»ºStreamï¼š&quot;</span> + STREAM_KEY);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥æ¶ˆè´¹è€…ç»„æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.streamCommands().xInfoGroup(STREAM_KEY.getBytes(), GROUP_NAME.getBytes());</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…ç»„å·²å­˜åœ¨ï¼š&quot;</span> + GROUP_NAME);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// MKSTREAMé€‰é¡¹ï¼šè‹¥Streamä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">                connection.streamCommands().xGroupCreate(</span><br><span class="line">                        STREAM_KEY.getBytes(),</span><br><span class="line">                        GROUP_NAME.getBytes(),</span><br><span class="line">                        ReadOffset.latest(),</span><br><span class="line">                        <span class="literal">true</span></span><br><span class="line">                );</span><br><span class="line">                System.out.println(<span class="string">&quot;åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š&quot;</span> + GROUP_NAME);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#3-2-æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="3.2 æ¶ˆæ¯ç”Ÿäº§è€…"></a>3.2 æ¶ˆæ¯ç”Ÿäº§è€…</h2><p>æ¨¡æ‹Ÿå‘é€è®¢å•æ¶ˆæ¯åˆ°Streamï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.stream.ObjectRecord;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamProducer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">STREAM_KEY</span> <span class="operator">=</span> <span class="string">&quot;order_stream&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StreamProducer</span><span class="params">(RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€è®¢å•æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendOrderMessage</span><span class="params">(OrderMessage message)</span> &#123;</span><br><span class="line">        <span class="comment">// ObjectRecordä¼šè‡ªåŠ¨å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºHashï¼ˆéœ€é…ç½®RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼ï¼‰</span></span><br><span class="line">        ObjectRecord&lt;String, OrderMessage&gt; record = ObjectRecord.create(STREAM_KEY, message);</span><br><span class="line">        <span class="comment">// XADDå‘½ä»¤ï¼šæ·»åŠ æ¶ˆæ¯åˆ°Stream</span></span><br><span class="line">        redisTemplate.opsForStream().add(record);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢å•æ¶ˆæ¯å®ä½“</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OrderMessage</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String orderId;</span><br><span class="line">        <span class="keyword">private</span> String userId;</span><br><span class="line">        <span class="keyword">private</span> Double amount;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// getterã€setterã€toString</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-æ¶ˆæ¯æ¶ˆè´¹è€…ï¼šä¼˜å…ˆå¤„ç†Pending-List"><a href="#3-3-æ¶ˆæ¯æ¶ˆè´¹è€…ï¼šä¼˜å…ˆå¤„ç†Pending-List" class="headerlink" title="3.3 æ¶ˆæ¯æ¶ˆè´¹è€…ï¼šä¼˜å…ˆå¤„ç†Pending List"></a>3.3 æ¶ˆæ¯æ¶ˆè´¹è€…ï¼šä¼˜å…ˆå¤„ç†Pending List</h2><p>æ ¸å¿ƒé€»è¾‘ï¼šæ¶ˆè´¹è€…å¯åŠ¨åï¼Œ<strong>å…ˆå¤„ç†Pending Listä¸­çš„æ¶ˆæ¯</strong>ï¼Œå¤„ç†å®Œåå†æŒç»­æ¶ˆè´¹Streamä¸­çš„æœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼›è‹¥å¤„ç†æ¶ˆæ¯å¼‚å¸¸ï¼Œä¸å‘é€ACKï¼Œæ¶ˆæ¯ç•™åœ¨Pending Listä¸‹æ¬¡é‡è¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰çº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SAVE_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨æ—¶æ‰§è¡Œ æŒç»­ç›‘å¬æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        SAVE_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderTask</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//ä»æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢è¯»å–æ¶ˆæ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS streams.order &gt;</span></span><br><span class="line">                    List&lt;MapRecord&lt;String, Object, Object&gt;&gt; read = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                            Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                            StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                            StreamOffset.create(<span class="string">&quot;stream.order&quot;</span>, ReadOffset.lastConsumed())</span><br><span class="line">                    );</span><br><span class="line">                    <span class="keyword">if</span>(read == <span class="literal">null</span> || read.isEmpty())</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//è·å–æ¶ˆæ¯ å¹¶ä¸”å°†æ¶ˆæ¯è½¬åŒ–ä¸ºè®¢å•</span></span><br><span class="line">                    MapRecord&lt;String, Object, Object&gt; record = read.getFirst();</span><br><span class="line">                    Map&lt;Object, Object&gt; orderMap = record.getValue();</span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(orderMap, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                    voucherOrderSaveHandler(voucherOrder);</span><br><span class="line">                    <span class="comment">//ç¡®è®¤æ¶ˆæ¯ å‘é€ack</span></span><br><span class="line">                    stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;stream.order&quot;</span>,<span class="string">&quot;g1&quot;</span>,record.getId());</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>);</span><br><span class="line">                    <span class="comment">//é‡åˆ°å¼‚å¸¸åº”å…ˆå¤„ç†pending listä¸­çš„æ¶ˆæ¯  ç¡®ä¿æ¯ä¸ªæ¶ˆæ¯éƒ½è¢«å¤„ç†ä¸€æ¬¡</span></span><br><span class="line">                    handPendingMessagesList();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handPendingMessagesList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//ä»pendingé˜Ÿåˆ—é‡Œé¢è·å–å¾…å¤„ç†çš„æ¶ˆæ¯</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; read = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                        Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                        StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                        StreamOffset.create(<span class="string">&quot;stream.order&quot;</span>, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">if</span>(read == <span class="literal">null</span> || read.isEmpty())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//è·å–æ¶ˆæ¯ å¹¶ä¸”å°†æ¶ˆæ¯è½¬åŒ–ä¸ºè®¢å•</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = read.getFirst();</span><br><span class="line">                Map&lt;Object, Object&gt; orderMap = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(orderMap, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                voucherOrderSaveHandler(voucherOrder);</span><br><span class="line">                <span class="comment">//ç¡®è®¤æ¶ˆæ¯ å‘é€ack</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;stream.order&quot;</span>,<span class="string">&quot;g1&quot;</span>,record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†pending-listè®¢å•å¼‚å¸¸&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">50</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="å››ã€æ€»ç»“ä¸æ³¨æ„äº‹é¡¹"><a href="#å››ã€æ€»ç»“ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€æ€»ç»“ä¸æ³¨æ„äº‹é¡¹"></a>å››ã€æ€»ç»“ä¸æ³¨æ„äº‹é¡¹</h1><p>Redis Streamçš„å¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼é€šè¿‡ACKæœºåˆ¶å’ŒPending Listï¼Œå®ç°äº†æ¶ˆæ¯çš„å¯é æ¶ˆè´¹ï¼Œå°¤å…¶é€‚åˆä¸­å°å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„è½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ—åœºæ™¯ã€‚ä½†åœ¨ä½¿ç”¨æ—¶éœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šStreamæ¶ˆæ¯é»˜è®¤æŒä¹…åŒ–åˆ°Redisçš„RDB/AOFä¸­ï¼Œéœ€ç¡®ä¿Redisçš„æŒä¹…åŒ–é…ç½®åˆç†ï¼Œé¿å…å®•æœºä¸¢å¤±æ¶ˆæ¯ã€‚</p></li><li><p><strong>Pending Listç§¯å‹</strong>ï¼šéœ€å®šæœŸç›‘æ§Pending Listçš„æ¶ˆæ¯é‡ï¼Œè‹¥ç§¯å‹è¿‡å¤šï¼Œéœ€æ’æŸ¥æ¶ˆè´¹è€…æ˜¯å¦å¼‚å¸¸ï¼Œå¹¶é€šè¿‡<code>XCLAIM</code>è½¬ç§»æ¶ˆæ¯æˆ–è®¾ç½®æ­»ä¿¡æœºåˆ¶ï¼ˆå¦‚è¶…è¿‡é‡è¯•æ¬¡æ•°åè½¬ç§»åˆ°å…¶ä»–Streamï¼‰ã€‚</p></li><li><p><strong>æ¶ˆè´¹è€…å¼¹æ€§</strong>ï¼šåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…å¯åŠ¨æ€å¢å‡æ¶ˆè´¹è€…ï¼Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œä½†éœ€é¿å…æ¶ˆè´¹è€…IDé‡å¤ã€‚</p></li><li><p><strong>æ€§èƒ½è€ƒé‡</strong>ï¼šRediså•çº¿ç¨‹å¤„ç†å‘½ä»¤ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹éœ€è¯„ä¼°Streamçš„æ¶ˆæ¯ç”Ÿäº§é€Ÿç‡ï¼Œé¿å…Redisæˆä¸ºç“¶é¢ˆï¼ˆå¯ç»“åˆåˆ†ç‰‡æˆ–é›†ç¾¤æ‰©å±•ï¼‰ã€‚</p></li></ul><p>æ€»ä¹‹ï¼ŒRedis Streamä»¥å…¶è½»é‡ã€é«˜æ•ˆã€å¯é çš„ç‰¹æ€§ï¼Œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›äº†ä¸€ç§çµæ´»çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶åœ¨å¤šæ¶ˆè´¹è€…ç»„å’Œæ¶ˆæ¯é‡è¯•åœºæ™¯ä¸‹ï¼Œå±•ç°äº†ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Redis-Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†ã€ACKæœºåˆ¶ä¸Javaå®è·µ&quot;&gt;&lt;a href=&quot;#Redis-Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†ã€ACKæœºåˆ¶ä¸Javaå®è·µ&quot; class=&quot;headerlink&quot; title=&quot;Redis Streamå¤šæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼šåŸç†</summary>
      
    
    
    
    
    <category term="redis" scheme="https://nmcb666.vip/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°</title>
    <link href="https://nmcb666.vip/posts/3a74c7b3.html"/>
    <id>https://nmcb666.vip/posts/3a74c7b3.html</id>
    <published>2025-12-02T08:40:27.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°æ–¹å¼"><a href="#Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°æ–¹å¼" class="headerlink" title="Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°æ–¹å¼"></a>Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°æ–¹å¼</h1><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†å¸ƒå¼é”æ˜¯è§£å†³å¹¶å‘é—®é¢˜çš„å…³é”®å·¥å…·ï¼Œè€ŒRedissonä½œä¸ºåŸºäºRedisçš„Javaå®¢æˆ·ç«¯ï¼Œå…¶æä¾›çš„åˆ†å¸ƒå¼é”å› å…¶é«˜æ•ˆã€å¯é çš„ç‰¹æ€§è¢«å¹¿æ³›åº”ç”¨ã€‚åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç”±äºç½‘ç»œæŠ–åŠ¨ã€RedisæœåŠ¡çŸ­æš‚ä¸å¯ç”¨ç­‰åŸå› ï¼Œé”çš„è·å–å¯èƒ½ä¼šå‡ºç°æš‚æ—¶æ€§å¤±è´¥ï¼Œæ­¤æ—¶<strong>å¯é‡è¯•æœºåˆ¶</strong>å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Redissoné”å¯é‡è¯•çš„å®ç°æ–¹å¼ï¼Œä»æ ¸å¿ƒæ€è·¯åˆ°å…·ä½“ä»£ç ï¼Œå†åˆ°æ³¨æ„äº‹é¡¹ï¼Œä¸ºå¤§å®¶æ¢³ç†è¿™ä¸€å®ç”¨ç‰¹æ€§çš„æ¥é¾™å»è„‰ã€‚</p><h2 id="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦Redissoné”çš„å¯é‡è¯•æœºåˆ¶ï¼Ÿ"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦Redissoné”çš„å¯é‡è¯•æœºåˆ¶ï¼Ÿ" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦Redissoné”çš„å¯é‡è¯•æœºåˆ¶ï¼Ÿ"></a>ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦Redissoné”çš„å¯é‡è¯•æœºåˆ¶ï¼Ÿ</h2><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œè·å–Redissoné”å¤±è´¥å¹¶ä¸æ€»æ˜¯æ„å‘³ç€â€œé”è¢«å ç”¨â€ï¼Œè¿˜å¯èƒ½æ˜¯ç”±ä»¥ä¸‹æš‚æ—¶æ€§å› ç´ å¯¼è‡´ï¼š</p><ul><li><p><strong>ç½‘ç»œæ³¢åŠ¨</strong>ï¼šå®¢æˆ·ç«¯ä¸RedisæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥å‡ºç°çŸ­æš‚ä¸ç¨³å®šï¼Œå¯¼è‡´é”è¯·æ±‚è¶…æ—¶ã€‚</p></li><li><p><strong>RedisæœåŠ¡è´Ÿè½½è¿‡é«˜</strong>ï¼šRedisåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¤„ç†è¯·æ±‚çš„é€Ÿåº¦å˜æ…¢ï¼Œä½¿å¾—é”è·å–æ“ä½œæœªèƒ½åœ¨é¢„æœŸæ—¶é—´å†…å®Œæˆã€‚</p></li><li><p><strong>é”ç«äº‰æ¿€çƒˆ</strong>ï¼šå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶ç«äº‰åŒä¸€æŠŠé”ï¼Œå½“å‰å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶é”æ­£è¢«å ç”¨ï¼Œä½†çŸ­æ—¶é—´å†…é”å°±ä¼šè¢«é‡Šæ”¾ã€‚</p></li></ul><p>å¦‚æœæ­¤æ—¶ç›´æ¥è¿”å›å¤±è´¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡æµç¨‹ä¸­æ–­ï¼Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚è€Œå¯é‡è¯•æœºåˆ¶èƒ½å¤Ÿè®©å®¢æˆ·ç«¯åœ¨ä¸€å®šæ¡ä»¶ä¸‹é‡å¤å°è¯•è·å–é”ï¼Œä»è€Œè§„é¿ä¸Šè¿°æš‚æ—¶æ€§é—®é¢˜ï¼Œæé«˜é”è·å–çš„æˆåŠŸç‡ã€‚</p><h2 id="äºŒã€Redissoné”å¯é‡è¯•å®ç°çš„æ ¸å¿ƒæ€è·¯"><a href="#äºŒã€Redissoné”å¯é‡è¯•å®ç°çš„æ ¸å¿ƒæ€è·¯" class="headerlink" title="äºŒã€Redissoné”å¯é‡è¯•å®ç°çš„æ ¸å¿ƒæ€è·¯"></a>äºŒã€Redissoné”å¯é‡è¯•å®ç°çš„æ ¸å¿ƒæ€è·¯</h2><p>Redissoné”çš„å¯é‡è¯•å¹¶éç®€å•å¾ªç¯+å›ºå®šç­‰å¾…ï¼Œè€Œæ˜¯åŸºäº<strong>â€œRediså‘å¸ƒè®¢é˜…çš„ç­‰å¾…-å”¤é†’æœºåˆ¶â€</strong>å®ç°ï¼Œæ ¸å¿ƒæ˜¯é¿å…æ— æ„ä¹‰çš„è½®è¯¢ï¼Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚å…¶æœ¬è´¨æ˜¯ç»“åˆ<code>tryLock</code>çš„é˜»å¡ç­‰å¾…é€»è¾‘ä¸Redisçš„æ¶ˆæ¯é€šçŸ¥ï¼Œå…·ä½“æ‹†è§£ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><p><strong>åˆå§‹å°è¯•è·å–é”</strong>ï¼šå®¢æˆ·ç«¯é€šè¿‡<code>SET NX</code>å‘½ä»¤å°è¯•è·å–é”ï¼Œè‹¥æˆåŠŸåˆ™è¿”å›é”å®ä¾‹ï¼ŒåŒæ—¶è®°å½•é”çš„ç§ŸæœŸ(å¦‚æœè¿˜éœ€è¦å®ç°å¯é‡å…¥åˆ™éœ€è¦ç”¨Hashç»“æ„å»è®°å½•é”çš„æŒæœ‰è€…ä»¥åŠé”çš„æ•°é‡ï¼Œè¿™é‡Œé»˜è®¤ä¸æ”¯æŒå¯é‡å…¥)ã€‚</p></li><li><p><strong>å¤±è´¥åˆ™è®¢é˜…é”é‡Šæ”¾é€šçŸ¥</strong>ï¼šè‹¥é”å·²è¢«å ç”¨ï¼Œå®¢æˆ·ç«¯ä¸ä¼šç«‹å³é‡è¯•ï¼Œè€Œæ˜¯é€šè¿‡Redisçš„<code>SUBSCRIBE</code>å‘½ä»¤è®¢é˜…è¯¥é”çš„é‡Šæ”¾é€šçŸ¥é¢‘é“ï¼ˆå¦‚<code>redisson_lock__channel:&#123;lockKey&#125;</code>ï¼‰ã€‚</p></li><li><p><strong>é˜»å¡ç­‰å¾…é€šçŸ¥æˆ–è¶…æ—¶</strong>ï¼šå®¢æˆ·ç«¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç­‰å¾…ä¸¤ä¸ªè§¦å‘æ¡ä»¶ä¹‹ä¸€ï¼šâ‘  æ”¶åˆ°é”é‡Šæ”¾çš„<code>PUBLISH</code>é€šçŸ¥ï¼›â‘¡ è¾¾åˆ°é¢„è®¾çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆ<code>waitTime</code>ï¼‰ã€‚</p></li><li><p><strong>å”¤é†’åé‡è¯•æˆ–ç»ˆæ­¢</strong>ï¼šè‹¥æ”¶åˆ°é‡Šæ”¾é€šçŸ¥ï¼Œå®¢æˆ·ç«¯ç«‹å³å”¤é†’å¹¶é‡æ–°å°è¯•è·å–é”ï¼›è‹¥ç­‰å¾…è¶…æ—¶ï¼Œåˆ™ç»ˆæ­¢é‡è¯•å¹¶è¿”å›å¤±è´¥ã€‚</p></li></ol><div class="tip warning faa-horizontal animated"><p>å…³é”®åœ¨äºâ€œç²¾å‡†å”¤é†’â€è€Œéâ€œç›²ç›®é‡è¯•â€ï¼šé€šè¿‡Redisçš„å‘å¸ƒè®¢é˜…æœºåˆ¶ï¼Œåªæœ‰å½“é”çœŸæ­£é‡Šæ”¾æ—¶æ‰è§¦å‘é‡è¯•ï¼Œæ—¢å‡å°‘äº†Redisçš„è¯·æ±‚å‹åŠ›ï¼Œåˆèƒ½ä¿è¯é‡è¯•çš„åŠæ—¶æ€§ã€‚</p></div><h2 id="ä¸‰ã€Redissoné”å¯é‡è¯•çš„åº•å±‚å®ç°ä¸æ‰‹åŠ¨å°è£…"><a href="#ä¸‰ã€Redissoné”å¯é‡è¯•çš„åº•å±‚å®ç°ä¸æ‰‹åŠ¨å°è£…" class="headerlink" title="ä¸‰ã€Redissoné”å¯é‡è¯•çš„åº•å±‚å®ç°ä¸æ‰‹åŠ¨å°è£…"></a>ä¸‰ã€Redissoné”å¯é‡è¯•çš„åº•å±‚å®ç°ä¸æ‰‹åŠ¨å°è£…</h2><p>Redissonçš„åŸç”Ÿ<code>tryLock(waitTime, leaseTime, TimeUnit)</code>æ–¹æ³•å·²å†…ç½®â€œç­‰å¾…-å”¤é†’â€çš„å¯é‡è¯•é€»è¾‘ï¼Œå…¶åº•å±‚é€šè¿‡<code>RedissonLock#tryAcquireAsync</code>å®ç°å¼‚æ­¥è·å–+é€šçŸ¥è®¢é˜…ã€‚æˆ‘ä»¬æ— éœ€é‡å¤å¼€å‘æ ¸å¿ƒæœºåˆ¶ï¼Œåªéœ€åŸºäºåŸç”Ÿæ–¹æ³•å°è£…ä¸šåŠ¡çº§çš„é‡è¯•ç­–ç•¥ï¼ˆå¦‚æ€»è¶…æ—¶æ§åˆ¶ã€å¤šè½®ç­‰å¾…ç­‰ï¼‰ï¼Œä»¥ä¸‹æ˜¯å…·ä½“å®ç°ã€‚</p><h3 id="æ–¹å¼ä¸€ï¼šåŸºäºåŸç”ŸtryLockçš„å¤šè½®ç­‰å¾…å°è£…"><a href="#æ–¹å¼ä¸€ï¼šåŸºäºåŸç”ŸtryLockçš„å¤šè½®ç­‰å¾…å°è£…" class="headerlink" title="æ–¹å¼ä¸€ï¼šåŸºäºåŸç”ŸtryLockçš„å¤šè½®ç­‰å¾…å°è£…"></a>æ–¹å¼ä¸€ï¼šåŸºäºåŸç”ŸtryLockçš„å¤šè½®ç­‰å¾…å°è£…</h3><p>RedissonåŸç”Ÿ<code>tryLock(waitTime, ...)</code>å·²å®ç°â€œç­‰å¾…é€šçŸ¥+å•æ¬¡é‡è¯•â€ï¼Œè‹¥éœ€æ”¯æŒå¤šè½®ç­‰å¾…ï¼ˆå¦‚æ€»ç­‰å¾…æ—¶é—´è¾ƒé•¿æ—¶ï¼‰ï¼Œå¯å°è£…å¤šè½®<code>tryLock</code>è°ƒç”¨ï¼Œæ¯è½®åˆ©ç”¨åŸç”Ÿçš„ç­‰å¾…-å”¤é†’æœºåˆ¶ï¼Œé¿å…å›ºå®šä¼‘çœ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RLock;</span><br><span class="line"><span class="keyword">import</span> org.redisson.api.RedissonClient;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonLockRetryDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedissonClient redissonClient;</span><br><span class="line">    <span class="comment">// æ€»æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">TOTAL_MAX_WAIT_MS</span> <span class="operator">=</span> <span class="number">3000</span>;</span><br><span class="line">    <span class="comment">// æ¯è½®ç­‰å¾…æ—¶é—´ï¼ˆåˆ©ç”¨åŸç”ŸtryLockçš„ç­‰å¾…-å”¤é†’ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">PER_ROUND_WAIT_MS</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedissonLockRetryDemo</span><span class="params">(RedissonClient redissonClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redissonClient = redissonClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäºåŸç”ŸtryLockç­‰å¾…-å”¤é†’çš„å¤šè½®é‡è¯•å°è£…</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lockKey é”é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> leaseTime é”ç§ŸæœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit æ—¶é—´å•ä½</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> é”å®ä¾‹ï¼Œè‹¥è·å–å¤±è´¥åˆ™è¿”å›null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> RLock <span class="title function_">tryLockWithRetry</span><span class="params">(String lockKey, <span class="type">long</span> leaseTime, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(lockKey);</span><br><span class="line">        <span class="type">AtomicLong</span> <span class="variable">remainingWaitMs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(TOTAL_MAX_WAIT_MS);</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTimestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (remainingWaitMs.get() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æ¯è½®è°ƒç”¨åŸç”ŸtryLockï¼Œåˆ©ç”¨å…¶ç­‰å¾…-å”¤é†’æœºåˆ¶</span></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">locked</span> <span class="operator">=</span> lock.tryLock(remainingWaitMs.get(), leaseTime, unit);</span><br><span class="line">                <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">usedWaitMs</span> <span class="operator">=</span> System.currentTimeMillis() - startTimestamp;</span><br><span class="line">                    System.out.println(<span class="string">&quot;è·å–é”æˆåŠŸï¼Œç´¯è®¡ç­‰å¾…æ—¶é—´ï¼š&quot;</span> + usedWaitMs + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> lock;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ›´æ–°å‰©ä½™ç­‰å¾…æ—¶é—´ï¼ˆé¿å…æ€»ç­‰å¾…è¶…æ—¶ï¼‰</span></span><br><span class="line">                remainingWaitMs.addAndGet(-PER_ROUND_WAIT_MS);</span><br><span class="line">                System.out.println(<span class="string">&quot;æœ¬è½®ç­‰å¾…è¶…æ—¶ï¼Œå‰©ä½™ç­‰å¾…æ—¶é—´ï¼š&quot;</span> + remainingWaitMs.get() + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                System.out.println(<span class="string">&quot;è·å–é”è¿‡ç¨‹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ€»ç­‰å¾…æ—¶é—´å·²è€—å°½ï¼Œè·å–é”å¤±è´¥&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<strong><code>tryLock</code></strong> <strong>æ ¸å¿ƒæ˜¯å¤ç”¨RedissonåŸç”Ÿçš„ç­‰å¾…é€»è¾‘</strong>ï¼šæ¯è½®è°ƒç”¨<code>tryLock(remainingWaitMs, ...)</code>æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè®¢é˜…é”é‡Šæ”¾é€šçŸ¥å¹¶é˜»å¡ï¼Œç›´åˆ°æ”¶åˆ°é€šçŸ¥ï¼ˆç«‹å³é‡è¯•ï¼‰æˆ–æœ¬è½®ç­‰å¾…è¶…æ—¶ã€‚é€šè¿‡<code>remainingWaitMs</code>æ§åˆ¶æ€»ç­‰å¾…æ—¶é—´ï¼Œæ—¢ä¿è¯äº†â€œç²¾å‡†å”¤é†’â€ï¼Œåˆå®ç°äº†ä¸šåŠ¡çº§çš„å¤šè½®é‡è¯•æ§åˆ¶ã€‚</p><h3 id="æ–¹å¼äºŒï¼šç†è§£RedissonåŸç”Ÿç­‰å¾…-å”¤é†’çš„åº•å±‚é€»è¾‘"><a href="#æ–¹å¼äºŒï¼šç†è§£RedissonåŸç”Ÿç­‰å¾…-å”¤é†’çš„åº•å±‚é€»è¾‘" class="headerlink" title="æ–¹å¼äºŒï¼šç†è§£RedissonåŸç”Ÿç­‰å¾…-å”¤é†’çš„åº•å±‚é€»è¾‘"></a>æ–¹å¼äºŒï¼šç†è§£RedissonåŸç”Ÿç­‰å¾…-å”¤é†’çš„åº•å±‚é€»è¾‘</h3><p>ä¸ºæ›´æ·±å…¥ç†è§£â€œç­‰å¾…-å”¤é†’â€æœºåˆ¶ï¼Œä»¥ä¸‹ç®€è¦åˆ†æRedissonLockçš„åº•å±‚å®ç°æµç¨‹ï¼ˆåŸºäºRedisson 3.xç‰ˆæœ¬ï¼‰ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´åˆç†åœ°ä½¿ç”¨å¯é‡è¯•åŠŸèƒ½ï¼š</p><h4 id="1-é”è·å–å¤±è´¥åçš„è®¢é˜…é€»è¾‘"><a href="#1-é”è·å–å¤±è´¥åçš„è®¢é˜…é€»è¾‘" class="headerlink" title="1. é”è·å–å¤±è´¥åçš„è®¢é˜…é€»è¾‘"></a>1. é”è·å–å¤±è´¥åçš„è®¢é˜…é€»è¾‘</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// RedissonLock#tryAcquireAsyncç®€åŒ–é€»è¾‘</span></span><br><span class="line"><span class="keyword">private</span> CompletableFuture&lt;Boolean&gt; <span class="title function_">tryAcquireAsync</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. å°è¯•è·å–é”</span></span><br><span class="line">    CompletableFuture&lt;Boolean&gt; acquiredFuture = tryLockInnerAsync(waitTime, leaseTime, unit);</span><br><span class="line">    <span class="keyword">return</span> acquiredFuture.thenCompose(acquired -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (acquired) &#123;</span><br><span class="line">            <span class="keyword">return</span> CompletableFuture.completedFuture(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. è·å–å¤±è´¥ï¼Œè®¢é˜…é”é‡Šæ”¾é€šçŸ¥</span></span><br><span class="line">        <span class="keyword">return</span> subscribeToLockRelease(waitTime, unit);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…é”é‡Šæ”¾é¢‘é“</span></span><br><span class="line"><span class="keyword">private</span> CompletableFuture&lt;Boolean&gt; <span class="title function_">subscribeToLockRelease</span><span class="params">(<span class="type">long</span> waitTime, TimeUnit unit)</span> &#123;</span><br><span class="line">    <span class="type">RTopic</span> <span class="variable">topic</span> <span class="operator">=</span> redisson.getTopic(getChannelName()); <span class="comment">// é¢‘é“åï¼šredisson_lock__channel:&#123;lockKey&#125;</span></span><br><span class="line">    CompletableFuture&lt;Boolean&gt; future = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// è®¢é˜…æ¶ˆæ¯ï¼Œæ”¶åˆ°é€šçŸ¥åå®Œæˆfuture</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">listenerId</span> <span class="operator">=</span> topic.addListener(String.class, (channel, message) -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (message.equals(getLockName())) &#123; <span class="comment">// éªŒè¯æ˜¯å½“å‰é”çš„é‡Šæ”¾é€šçŸ¥</span></span><br><span class="line">            topic.removeListener(listenerId);</span><br><span class="line">            future.complete(<span class="literal">true</span>); <span class="comment">// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 3. åŒæ—¶è®¾ç½®è¶…æ—¶ä»»åŠ¡ï¼Œé¿å…æ— é™ç­‰å¾…</span></span><br><span class="line">    scheduleTimeout(future, waitTime, unit, listenerId, topic);</span><br><span class="line">    <span class="keyword">return</span> future.thenCompose(ignored -&gt; &#123;</span><br><span class="line">        <span class="comment">// 4. è¢«å”¤é†’åé‡æ–°å°è¯•è·å–é”</span></span><br><span class="line">        <span class="keyword">return</span> tryAcquireAsync(waitTime - usedTime, leaseTime, unit);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-é”é‡Šæ”¾æ—¶çš„é€šçŸ¥é€»è¾‘"><a href="#2-é”é‡Šæ”¾æ—¶çš„é€šçŸ¥é€»è¾‘" class="headerlink" title="2. é”é‡Šæ”¾æ—¶çš„é€šçŸ¥é€»è¾‘"></a>2. é”é‡Šæ”¾æ—¶çš„é€šçŸ¥é€»è¾‘</h4><p>å½“æŒæœ‰é”çš„å®¢æˆ·ç«¯é‡Šæ”¾é”æ—¶ï¼Œä¼šé€šè¿‡<code>PUBLISH</code>å‘½ä»¤å‘å¯¹åº”é¢‘é“å‘é€é€šçŸ¥ï¼Œå”¤é†’æ‰€æœ‰è®¢é˜…çš„ç­‰å¾…çº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// RedissonLock#unlockAsyncç®€åŒ–é€»è¾‘</span></span><br><span class="line"><span class="keyword">public</span> CompletableFuture&lt;Void&gt; <span class="title function_">unlockAsync</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1. é‡Šæ”¾é”ï¼ˆåˆ é™¤Redisä¸­çš„é”é”®ï¼‰</span></span><br><span class="line">    CompletableFuture&lt;Boolean&gt; releaseFuture = unlockInnerAsync();</span><br><span class="line">    <span class="keyword">return</span> releaseFuture.thenAccept(released -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (released) &#123;</span><br><span class="line">            <span class="comment">// 2. å‘å¸ƒé”é‡Šæ”¾é€šçŸ¥</span></span><br><span class="line">            <span class="type">RTopic</span> <span class="variable">topic</span> <span class="operator">=</span> redisson.getTopic(getChannelName());</span><br><span class="line">            topic.publish(getLockName()); <span class="comment">// å‘é€å½“å‰é”çš„æ ‡è¯†</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“"><a href="#3-æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“" class="headerlink" title="3. æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“"></a>3. æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“</h4><figure class="highlight plaintext"><figcaption><span>Text</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">// åŸç”ŸtryLockçš„æ ¸å¿ƒä»·å€¼</span><br><span class="line">1. æ— è½®è¯¢ï¼šç­‰å¾…æœŸé—´çº¿ç¨‹é˜»å¡ï¼Œä¸æ¶ˆè€—CPUèµ„æº</span><br><span class="line">2. ç²¾å‡†å”¤é†’ï¼šä»…å½“é”é‡Šæ”¾æ—¶æ‰è§¦å‘é‡è¯•ï¼Œå“åº”åŠæ—¶</span><br><span class="line">3. è‡ªåŠ¨è¶…æ—¶ï¼šé¿å…å› é€šçŸ¥ä¸¢å¤±å¯¼è‡´çš„æ— é™ç­‰å¾…</span><br><span class="line">4. å¼‚æ­¥éé˜»å¡ï¼šåº•å±‚åŸºäºNettyå®ç°å¼‚æ­¥æ“ä½œï¼Œæ€§èƒ½é«˜æ•ˆ</span><br></pre></td></tr></table></figure><p>åŸºäºä¸Šè¿°åº•å±‚é€»è¾‘ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Redissoné”å¯é‡è¯•åŠŸèƒ½æ—¶ï¼Œéœ€é‡ç‚¹å…³æ³¨ä»¥ä¸‹å‚æ•°è®¾è®¡ï¼š</p><ul><li><p><code>waitTime</code>ï¼šå•è½®æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆéå›ºå®šç­‰å¾…ï¼‰ï¼Œå»ºè®®è®¾ä¸ºä¸šåŠ¡å¯æ¥å—çš„å•æ¬¡é˜»å¡æ—¶é•¿ï¼Œå¦‚1ç§’ï¼›</p></li><li><p><code>totalWaitTime</code>ï¼šä¸šåŠ¡çº§æ€»ç­‰å¾…æ—¶é—´ï¼Œé€šè¿‡å¤šè½®<code>tryLock</code>ç´¯åŠ æ§åˆ¶ï¼Œé¿å…æ•´ä½“è¶…æ—¶ï¼›</p></li><li><p><code>leaseTime</code>ï¼šé”ç§ŸæœŸï¼Œéœ€å¤§äºä¸šåŠ¡æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®ç»“åˆ<code>lockWatchdogTimeout</code>ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ï¼‰è‡ªåŠ¨ç»­æœŸï¼Œé¿å…é”æå‰é‡Šæ”¾ã€‚</p></li></ul><h2 id="å››ã€Redissoné”å¯é‡è¯•å®ç°çš„æ³¨æ„äº‹é¡¹"><a href="#å››ã€Redissoné”å¯é‡è¯•å®ç°çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€Redissoné”å¯é‡è¯•å®ç°çš„æ³¨æ„äº‹é¡¹"></a>å››ã€Redissoné”å¯é‡è¯•å®ç°çš„æ³¨æ„äº‹é¡¹</h2><p>åœ¨å®ç°Redissoné”çš„å¯é‡è¯•æœºåˆ¶æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ­£ç¡®æ€§ï¼š</p><h3 id="1-åˆç†è®¾ç½®é‡è¯•å‚æ•°"><a href="#1-åˆç†è®¾ç½®é‡è¯•å‚æ•°" class="headerlink" title="1. åˆç†è®¾ç½®é‡è¯•å‚æ•°"></a>1. åˆç†è®¾ç½®é‡è¯•å‚æ•°</h3><p>é‡è¯•æ¬¡æ•°å’Œç­‰å¾…æ—¶é—´éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯è¿›è¡Œè°ƒæ•´ï¼š</p><ul><li><p>è‹¥ä¸šåŠ¡å¯¹å“åº”æ—¶é—´æ•æ„Ÿï¼Œåº”å‡å°‘é‡è¯•æ¬¡æ•°å’Œç­‰å¾…æ—¶é—´ï¼›</p></li><li><p>è‹¥é”ç«äº‰æ¿€çƒˆæˆ–ç½‘ç»œä¸ç¨³å®šï¼Œå¯é€‚å½“å¢åŠ é‡è¯•æ¬¡æ•°ï¼Œå¹¶é‡‡ç”¨æŒ‡æ•°é€€é¿ç­‰ç­–ç•¥å»¶é•¿ç­‰å¾…æ—¶é—´ã€‚</p></li></ul><h3 id="2-é¿å…æ­»é”é£é™©"><a href="#2-é¿å…æ­»é”é£é™©" class="headerlink" title="2. é¿å…æ­»é”é£é™©"></a>2. é¿å…æ­»é”é£é™©</h3><p>Redissoné”æœ¬èº«å…·æœ‰è‡ªåŠ¨è¿‡æœŸæœºåˆ¶ï¼ˆ<code>leaseTime</code>ï¼‰ï¼Œå¯ä»¥é¿å…æ­»é”ï¼Œä½†åœ¨é‡è¯•è¿‡ç¨‹ä¸­ä»éœ€æ³¨æ„ï¼š</p><ul><li><p>ç¡®ä¿æ¯æ¬¡è·å–é”åéƒ½æœ‰å¯¹åº”çš„é‡Šæ”¾æ“ä½œï¼ˆå»ºè®®ä½¿ç”¨<code>try-finally</code>å—ï¼‰ï¼›</p></li><li><p>ä¸è¦åœ¨é‡è¯•è¿‡ç¨‹ä¸­æŒæœ‰å…¶ä»–èµ„æºï¼Œä»¥å…é‡è¯•å¤±è´¥æ—¶å¯¼è‡´èµ„æºæ³„æ¼ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®çš„é”é‡Šæ”¾æ–¹å¼</span></span><br><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> tryLockWithRetry(<span class="string">&quot;testLock&quot;</span>, <span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line"><span class="keyword">if</span> (lock != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-è€ƒè™‘Redisé›†ç¾¤çš„ä¸€è‡´æ€§"><a href="#3-è€ƒè™‘Redisé›†ç¾¤çš„ä¸€è‡´æ€§" class="headerlink" title="3. è€ƒè™‘Redisé›†ç¾¤çš„ä¸€è‡´æ€§"></a>3. è€ƒè™‘Redisé›†ç¾¤çš„ä¸€è‡´æ€§</h3><p>åœ¨Redisé›†ç¾¤ç¯å¢ƒä¸‹ï¼ŒRedissoné”çš„å®ç°åŸºäºRedisçš„<code>SET NX</code>å‘½ä»¤ï¼Œè‹¥é‡‡ç”¨ä¸»ä»å¤åˆ¶æ¶æ„ï¼Œä¸»èŠ‚ç‚¹å®•æœºå¯èƒ½å¯¼è‡´é”ä¿¡æ¯æœªåŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼Œä»è€Œå‡ºç°â€œé”ä¸¢å¤±â€é—®é¢˜ã€‚æ­¤æ—¶å¯è€ƒè™‘ä½¿ç”¨Redissonçš„<code>RedissonRedLock</code>ï¼ˆçº¢é”ï¼‰ï¼Œå®ƒé€šè¿‡åœ¨å¤šä¸ªç‹¬ç«‹çš„RedisèŠ‚ç‚¹ä¸Šè·å–é”ï¼Œæé«˜é”çš„å¯é æ€§ï¼Œä½†ä¼šå¢åŠ æ€§èƒ½å¼€é”€ï¼Œéœ€æ ¹æ®ä¸šåŠ¡åœºæ™¯æƒè¡¡ã€‚</p><h3 id="4-ç›‘æ§é‡è¯•-metrics"><a href="#4-ç›‘æ§é‡è¯•-metrics" class="headerlink" title="4. ç›‘æ§é‡è¯• metrics"></a>4. ç›‘æ§é‡è¯• metrics</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®å¯¹é”çš„é‡è¯•æƒ…å†µè¿›è¡Œç›‘æ§ï¼Œè®°å½•é‡è¯•æ¬¡æ•°ã€æˆåŠŸç‡ã€å¤±è´¥åŸå› ç­‰metricsï¼Œä»¥ä¾¿åŠæ—¶å‘ç°é—®é¢˜å¹¶è°ƒæ•´é‡è¯•ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Prometheus + Grafanaç›‘æ§é‡è¯•ç›¸å…³æŒ‡æ ‡ã€‚</p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>Redissoné”çš„å¯é‡è¯•æœºåˆ¶æ˜¯åº”å¯¹åˆ†å¸ƒå¼ç¯å¢ƒä¸­æš‚æ—¶æ€§é—®é¢˜çš„æœ‰æ•ˆæ‰‹æ®µï¼Œé€šè¿‡â€œå¾ªç¯å°è¯• + æ¡ä»¶åˆ¤æ–­ + ç­‰å¾…ç­–ç•¥â€çš„æ ¸å¿ƒæ€è·¯ï¼Œç»“åˆæ‰‹åŠ¨å®ç°æˆ–Spring Retryæ¡†æ¶ï¼Œèƒ½å¤Ÿçµæ´»æ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€åˆç†è®¾ç½®é‡è¯•å‚æ•°ã€é¿å…æ­»é”é£é™©ã€è€ƒè™‘Redisé›†ç¾¤ä¸€è‡´æ€§ï¼Œå¹¶åŠ å¼ºç›‘æ§ï¼Œä»¥ç¡®ä¿å¯é‡è¯•æœºåˆ¶çš„é«˜æ•ˆä¸å¯é ã€‚</p><p>å¸Œæœ›æœ¬æ–‡çš„æ€è€ƒèƒ½å¤Ÿä¸ºå¤§å®¶åœ¨ä½¿ç”¨Redissoné”æ—¶æä¾›ä¸€äº›å¸®åŠ©ï¼Œè‹¥æœ‰ä¸åŒçš„è§è§£æˆ–æ›´å¥½çš„å®ç°æ–¹å¼ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°æ–¹å¼&quot;&gt;&lt;a href=&quot;#Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;Javaä¸­Redissoné”å¯¹äºå¯é‡è¯•çš„å®ç°æ–¹å¼&quot;&gt;&lt;/a&gt;Javaä¸­Redissoné”</summary>
      
    
    
    
    
    <category term="redis" scheme="https://nmcb666.vip/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>windows11å®‰è£…docker</title>
    <link href="https://nmcb666.vip/posts/fd5326b3.html"/>
    <id>https://nmcb666.vip/posts/fd5326b3.html</id>
    <published>2025-09-28T14:13:48.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Windows-11ä¸‹å®‰è£…Dockerå¹¶ä¿®æ”¹å®‰è£…ä½ç½®è‡³éCç›˜æ•™ç¨‹"><a href="#Windows-11ä¸‹å®‰è£…Dockerå¹¶ä¿®æ”¹å®‰è£…ä½ç½®è‡³éCç›˜æ•™ç¨‹" class="headerlink" title="Windows 11ä¸‹å®‰è£…Dockerå¹¶ä¿®æ”¹å®‰è£…ä½ç½®è‡³éCç›˜æ•™ç¨‹"></a>Windows 11ä¸‹å®‰è£…Dockerå¹¶ä¿®æ”¹å®‰è£…ä½ç½®è‡³éCç›˜æ•™ç¨‹</h1><h1 id="ä¸€ã€å®‰è£…å‰å‡†å¤‡"><a href="#ä¸€ã€å®‰è£…å‰å‡†å¤‡" class="headerlink" title="ä¸€ã€å®‰è£…å‰å‡†å¤‡"></a>ä¸€ã€å®‰è£…å‰å‡†å¤‡</h1><h2 id="1-1-æ£€æŸ¥ç³»ç»Ÿè¦æ±‚"><a href="#1-1-æ£€æŸ¥ç³»ç»Ÿè¦æ±‚" class="headerlink" title="1.1 æ£€æŸ¥ç³»ç»Ÿè¦æ±‚"></a>1.1 æ£€æŸ¥ç³»ç»Ÿè¦æ±‚</h2><p>åœ¨å®‰è£…Dockerå‰ï¼Œéœ€ç¡®ä¿Windows 11ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li><p>ç³»ç»Ÿç‰ˆæœ¬ï¼šWindows 11 64ä½ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆï¼ˆå®¶åº­ç‰ˆéœ€é€šè¿‡WSL 2æ”¯æŒï¼‰ã€‚</p></li><li><p>ç¡¬ä»¶è¦æ±‚ï¼šæ”¯æŒç¡¬ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆVT-x/AMD-Vï¼‰ï¼Œå¹¶åœ¨BIOS/UEFIä¸­å¯ç”¨ã€‚</p></li><li><p>WSL 2è¦æ±‚ï¼šå·²å®‰è£…å¹¶å¯ç”¨Windows Subsystem for Linux 2ï¼Œä¸”å†…æ ¸ç‰ˆæœ¬æ›´æ–°è‡³æœ€æ–°ã€‚</p></li><li><p>å­˜å‚¨ç©ºé—´ï¼šéCç›˜é¢„ç•™è‡³å°‘20GBç©ºé—²ç©ºé—´ï¼ˆç”¨äºDockerå®‰è£…åŠé•œåƒå­˜å‚¨ï¼‰ã€‚</p></li></ul><h2 id="1-2-å¯ç”¨å¿…è¦åŠŸèƒ½"><a href="#1-2-å¯ç”¨å¿…è¦åŠŸèƒ½" class="headerlink" title="1.2 å¯ç”¨å¿…è¦åŠŸèƒ½"></a>1.2 å¯ç”¨å¿…è¦åŠŸèƒ½</h2><p>æ‰“å¼€â€œæ§åˆ¶é¢æ¿â€â†’â€œç¨‹åºâ€â†’â€œç¨‹åºå’ŒåŠŸèƒ½â€â†’â€œå¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½â€ï¼Œå‹¾é€‰ä»¥ä¸‹é€‰é¡¹å¹¶ç‚¹å‡»â€œç¡®å®šâ€ï¼Œç­‰å¾…ç³»ç»Ÿé…ç½®å®Œæˆåé‡å¯ç”µè„‘ï¼š</p><ul><li><p>Hyper-Vï¼ˆå…¨éƒ¨ç»„ä»¶ï¼‰</p></li><li><p>å®¹å™¨</p></li><li><p>Windowsè™šæ‹Ÿæœºç›‘æ§ç¨‹åºå¹³å°</p></li></ul><p>è‹¥ä¸ºWindows 11å®¶åº­ç‰ˆï¼Œéœ€å…ˆå®‰è£…WSL 2ï¼šä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShellï¼Œè¾“å…¥å‘½ä»¤ <code>wsl --install</code>ï¼Œé‡å¯ç”µè„‘åå®ŒæˆWSL 2å®‰è£…ã€‚</p><h1 id="äºŒã€ä¸‹è½½Dockerå®‰è£…ç¨‹åº"><a href="#äºŒã€ä¸‹è½½Dockerå®‰è£…ç¨‹åº" class="headerlink" title="äºŒã€ä¸‹è½½Dockerå®‰è£…ç¨‹åº"></a>äºŒã€ä¸‹è½½Dockerå®‰è£…ç¨‹åº</h1><p>è®¿é—®Dockerå®˜æ–¹ç½‘ç«™ï¼ˆ<a href="https://www.docker.com/products/docker-desktop/">https://www.docker.com/products/docker-desktop/</a>ï¼‰ï¼Œç‚¹å‡»â€œDownload for Windowsâ€ä¸‹è½½æœ€æ–°ç‰ˆDocker Desktopå®‰è£…åŒ…ï¼ˆ.exeæ–‡ä»¶ï¼‰ï¼Œä¿å­˜è‡³éCç›˜çš„ä¸´æ—¶æ–‡ä»¶å¤¹ï¼ˆå¦‚D:\Tempï¼‰ã€‚</p><h1 id="ä¸‰ã€ä¿®æ”¹å®‰è£…ä½ç½®ï¼ˆå·²æœ‰å®‰è£…ç¨‹åºæ—¶ï¼‰"><a href="#ä¸‰ã€ä¿®æ”¹å®‰è£…ä½ç½®ï¼ˆå·²æœ‰å®‰è£…ç¨‹åºæ—¶ï¼‰" class="headerlink" title="ä¸‰ã€ä¿®æ”¹å®‰è£…ä½ç½®ï¼ˆå·²æœ‰å®‰è£…ç¨‹åºæ—¶ï¼‰"></a>ä¸‰ã€ä¿®æ”¹å®‰è£…ä½ç½®ï¼ˆå·²æœ‰å®‰è£…ç¨‹åºæ—¶ï¼‰</h1><h2 id="3-1-è§£å‹å®‰è£…ç¨‹åºï¼ˆå¯é€‰ï¼‰"><a href="#3-1-è§£å‹å®‰è£…ç¨‹åºï¼ˆå¯é€‰ï¼‰" class="headerlink" title="3.1 è§£å‹å®‰è£…ç¨‹åºï¼ˆå¯é€‰ï¼‰"></a>3.1 è§£å‹å®‰è£…ç¨‹åºï¼ˆå¯é€‰ï¼‰</h2><p>è‹¥å·²ä¸‹è½½Dockerå®‰è£…åŒ…ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹å®‰è£…æ–‡ä»¶ç»“æ„ï¼ˆéå¿…éœ€æ­¥éª¤ï¼‰ï¼š</p><ol><li><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShellï¼Œåˆ‡æ¢è‡³å®‰è£…åŒ…æ‰€åœ¨ç›®å½•ï¼Œä¾‹å¦‚ï¼š<code>cd D:\Temp</code>ã€‚</p></li><li><p>è¾“å…¥å‘½ä»¤è§£å‹å®‰è£…åŒ…ï¼š<code>Docker Desktop Installer.exe extract --destination D:\DockerTemp</code>ï¼Œå°†å®‰è£…æ–‡ä»¶æå–è‡³D:\DockerTempæ–‡ä»¶å¤¹ã€‚</p></li></ol><h2 id="3-2-é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå®‰è£…è·¯å¾„"><a href="#3-2-é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå®‰è£…è·¯å¾„" class="headerlink" title="3.2 é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå®‰è£…è·¯å¾„"></a>3.2 é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå®‰è£…è·¯å¾„</h2><p>è¿™æ˜¯ä¿®æ”¹Dockerå®‰è£…ä½ç½®çš„æ ¸å¿ƒæ­¥éª¤ï¼Œéœ€é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šéCç›˜å®‰è£…ç›®å½•ï¼š</p><ol><li><p>ä»¥<strong>ç®¡ç†å‘˜èº«ä»½</strong>æ‰“å¼€PowerShellï¼Œåˆ‡æ¢è‡³Dockerå®‰è£…åŒ…æ‰€åœ¨ç›®å½•ï¼ˆå¦‚D:\Tempï¼‰ã€‚</p></li><li><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå°†å®‰è£…ä½ç½®æŒ‡å®šä¸ºéCç›˜è·¯å¾„ï¼ˆä»¥D:\Dockerä¸ºä¾‹ï¼‰ï¼š<br><code>.\Docker Desktop Installer.exe install --installation-dir=D:\Docker --windows-containers=false --wsl2=true</code></p></li><li><p>å‘½ä»¤å‚æ•°è¯´æ˜ï¼š</p><pre><code> `--installation-dir=D:\Docker`ï¼šæŒ‡å®šDockerä¸»ç¨‹åºå®‰è£…ç›®å½•ï¼ˆéCç›˜è·¯å¾„ï¼‰ã€‚</code></pre></li><li><p><code>--windows-containers=false</code>ï¼šé»˜è®¤å¯ç”¨Linuxå®¹å™¨ï¼ˆå¦‚éœ€Windowså®¹å™¨å¯æ”¹ä¸ºtrueï¼‰ã€‚</p></li><li><p><code>--wsl2=true</code>ï¼šå¼ºåˆ¶ä½¿ç”¨WSL 2ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼ˆæ¨èï¼‰ã€‚</p></li><li><p>æ‰§è¡Œå‘½ä»¤åï¼Œç­‰å¾…å®‰è£…è¿›åº¦å®Œæˆï¼ŒæœŸé—´å¯èƒ½ä¼šæç¤ºé‡å¯ç”µè„‘ï¼Œç‚¹å‡»â€œç¡®å®šâ€å³å¯ã€‚</p></li></ol><div class="tip warning faa-horizontal animated-hover"><p>è‹¥ä¹‹å‰å·²å®‰è£…è¿‡Dockerå¹¶é»˜è®¤åœ¨Cç›˜ï¼Œéœ€å…ˆå¸è½½æ—§ç‰ˆæœ¬ï¼šæ‰“å¼€â€œè®¾ç½®â€â†’â€œåº”ç”¨â€â†’â€œåº”ç”¨å’ŒåŠŸèƒ½â€ï¼Œæ‰¾åˆ°â€œDocker Desktopâ€ï¼Œç‚¹å‡»â€œå¸è½½â€ï¼Œå¹¶åˆ é™¤æ®‹ç•™æ–‡ä»¶åå†æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚</p></div><h1 id="å››ã€éªŒè¯å®‰è£…ç»“æœ"><a href="#å››ã€éªŒè¯å®‰è£…ç»“æœ" class="headerlink" title="å››ã€éªŒè¯å®‰è£…ç»“æœ"></a>å››ã€éªŒè¯å®‰è£…ç»“æœ</h1><h2 id="4-1-å¯åŠ¨Docker-Desktop"><a href="#4-1-å¯åŠ¨Docker-Desktop" class="headerlink" title="4.1 å¯åŠ¨Docker Desktop"></a>4.1 å¯åŠ¨Docker Desktop</h2><p>å®‰è£…å®Œæˆåï¼Œåœ¨å¼€å§‹èœå•ä¸­æ‰¾åˆ°â€œDocker Desktopâ€å¹¶å¯åŠ¨ï¼Œé¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ï¼ˆåˆå§‹åŒ–WSL 2ç¯å¢ƒï¼‰ã€‚å¯åŠ¨æˆåŠŸåï¼Œä»»åŠ¡æ å³ä¸‹è§’ä¼šæ˜¾ç¤ºDockerå›¾æ ‡ï¼ˆè“è‰²é²¸é±¼å›¾æ ‡ï¼‰ã€‚</p><h2 id="4-2-æ£€æŸ¥å®‰è£…è·¯å¾„"><a href="#4-2-æ£€æŸ¥å®‰è£…è·¯å¾„" class="headerlink" title="4.2 æ£€æŸ¥å®‰è£…è·¯å¾„"></a>4.2 æ£€æŸ¥å®‰è£…è·¯å¾„</h2><p>æ‰“å¼€æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œå¯¼èˆªè‡³ä¹‹å‰æŒ‡å®šçš„å®‰è£…ç›®å½•ï¼ˆå¦‚D:\Dockerï¼‰ï¼Œå¯çœ‹åˆ°Dockerçš„ä¸»ç¨‹åºæ–‡ä»¶åŠç›¸å…³ç»„ä»¶ï¼Œç¡®è®¤å®‰è£…ä½ç½®æ­£ç¡®ã€‚</p><h2 id="4-3-æµ‹è¯•DockeråŠŸèƒ½"><a href="#4-3-æµ‹è¯•DockeråŠŸèƒ½" class="headerlink" title="4.3 æµ‹è¯•DockeråŠŸèƒ½"></a>4.3 æµ‹è¯•DockeråŠŸèƒ½</h2><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShellï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æµ‹è¯•Dockeræ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p><ol><li><p>æŸ¥çœ‹Dockerç‰ˆæœ¬ï¼š<code>docker --version</code>ï¼Œè‹¥è¾“å‡ºç±»ä¼¼â€œDocker version 26.1.4, build 5650f9bâ€åˆ™è¯´æ˜ç‰ˆæœ¬æŸ¥è¯¢æ­£å¸¸ã€‚</p></li><li><p>è¿è¡ŒHello Worldé•œåƒï¼š<code>docker run hello-world</code>ï¼Œè‹¥è¾“å‡ºâ€œHello from Docker!â€ç­‰ä¿¡æ¯ï¼Œè¯´æ˜Dockerå·²æˆåŠŸæ‹‰å–å¹¶è¿è¡Œé•œåƒï¼ŒåŠŸèƒ½æ­£å¸¸ã€‚</p></li></ol><h1 id="äº”ã€åç»­é…ç½®ï¼ˆå¯é€‰ï¼‰"><a href="#äº”ã€åç»­é…ç½®ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="äº”ã€åç»­é…ç½®ï¼ˆå¯é€‰ï¼‰"></a>äº”ã€åç»­é…ç½®ï¼ˆå¯é€‰ï¼‰</h1><h2 id="5-1-ä¿®æ”¹é•œåƒå­˜å‚¨ä½ç½®"><a href="#5-1-ä¿®æ”¹é•œåƒå­˜å‚¨ä½ç½®" class="headerlink" title="5.1 ä¿®æ”¹é•œåƒå­˜å‚¨ä½ç½®"></a>5.1 ä¿®æ”¹é•œåƒå­˜å‚¨ä½ç½®</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockeré•œåƒå­˜å‚¨åœ¨WSL 2åˆ†å‘ç‰ˆçš„è™šæ‹Ÿç£ç›˜ä¸­ï¼ˆé€šå¸¸ä½äºCç›˜ï¼‰ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿ç§»è‡³éCç›˜ï¼š</p><ol><li><p>å…³é—­Docker Desktopï¼šå³é”®ä»»åŠ¡æ Dockerå›¾æ ‡ï¼Œç‚¹å‡»â€œQuit Docker Desktopâ€ã€‚</p></li><li><p>å¯¼å‡ºWSL 2åˆ†å‘ç‰ˆï¼šåœ¨PowerShellä¸­è¾“å…¥<code>wsl --export docker-desktop-data D:\Docker\wsl\data\docker-desktop-data.tar</code>ã€‚</p></li><li><p>æ³¨é”€ç°æœ‰åˆ†å‘ç‰ˆï¼š<code>wsl --unregister docker-desktop-data</code>ã€‚</p></li><li><p>é‡æ–°å¯¼å…¥åˆ†å‘ç‰ˆè‡³éCç›˜ï¼š<code>wsl --import docker-desktop-data D:\Docker\wsl\data D:\Docker\wsl\data\docker-desktop-data.tar --version 2</code>ã€‚</p></li><li><p>é‡å¯Docker Desktopï¼Œé•œåƒå­˜å‚¨ä½ç½®å³è¿ç§»è‡³D:\Docker\wsl\dataã€‚</p></li></ol><h2 id="5-2-é…ç½®å›½å†…é•œåƒæº"><a href="#5-2-é…ç½®å›½å†…é•œåƒæº" class="headerlink" title="5.2 é…ç½®å›½å†…é•œåƒæº"></a>5.2 é…ç½®å›½å†…é•œåƒæº</h2><p>ä¸ºåŠ å¿«é•œåƒæ‹‰å–é€Ÿåº¦ï¼Œå¯é…ç½®å›½å†…é•œåƒæºï¼šæ‰“å¼€Docker Desktopï¼Œç‚¹å‡»â€œSettingsâ€â†’â€œDocker Engineâ€ï¼Œåœ¨JSONé…ç½®ä¸­æ·»åŠ é•œåƒæºï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;https://docker.1ms.run&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;https://docker-0.unsee.tech&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç‚¹å‡»â€œApply &amp; Restartâ€ä¿å­˜é…ç½®å¹¶é‡å¯Dockerã€‚</p><h1 id="å…­ã€å¸¸è§é—®é¢˜è§£å†³"><a href="#å…­ã€å¸¸è§é—®é¢˜è§£å†³" class="headerlink" title="å…­ã€å¸¸è§é—®é¢˜è§£å†³"></a>å…­ã€å¸¸è§é—®é¢˜è§£å†³</h1><ul><li><p><strong>é—®é¢˜1ï¼šå®‰è£…æ—¶æç¤ºâ€œHyper-Væœªå¯ç”¨â€</strong>ï¼šé‡æ–°æ£€æŸ¥â€œå¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½â€ä¸­Hyper-Vç»„ä»¶æ˜¯å¦å…¨éƒ¨å‹¾é€‰ï¼Œè‹¥å·²å‹¾é€‰ä»æŠ¥é”™ï¼Œå¯èƒ½æ˜¯BIOSä¸­è™šæ‹ŸåŒ–æœªå¯ç”¨ï¼Œéœ€é‡å¯ç”µè„‘è¿›å…¥BIOSå¼€å¯VT-x/AMD-Vã€‚</p></li><li><p><strong>é—®é¢˜2ï¼šDockerå¯åŠ¨å¡åœ¨â€œStartingâ€¦â€</strong>ï¼šå…³é—­Dockeråï¼Œåœ¨PowerShellä¸­è¾“å…¥<code>wsl --shutdown</code>å…³é—­WSL 2ï¼Œå†é‡æ–°å¯åŠ¨Dockerã€‚</p></li><li><p><strong>é—®é¢˜3ï¼šå‘½ä»¤è¡Œè¾“å…¥dockerå‘½ä»¤æç¤ºâ€œcommand not foundâ€</strong>ï¼šæ£€æŸ¥ç³»ç»Ÿç¯å¢ƒå˜é‡PATHä¸­æ˜¯å¦åŒ…å«Dockerå®‰è£…ç›®å½•ï¼ˆå¦‚D:\Docker\resources\binï¼‰ï¼Œè‹¥æœªåŒ…å«éœ€æ‰‹åŠ¨æ·»åŠ åé‡å¯PowerShellã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Windows-11ä¸‹å®‰è£…Dockerå¹¶ä¿®æ”¹å®‰è£…ä½ç½®è‡³éCç›˜æ•™ç¨‹&quot;&gt;&lt;a href=&quot;#Windows-11ä¸‹å®‰è£…Dockerå¹¶ä¿®æ”¹å®‰è£…ä½ç½®è‡³éCç›˜æ•™ç¨‹&quot; class=&quot;headerlink&quot; title=&quot;Windows 11ä¸‹å®‰è£…Dockerå¹¶ä¿®æ”¹å®‰è£…ä½ç½®è‡³é</summary>
      
    
    
    
    
    <category term="docker" scheme="https://nmcb666.vip/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºçˆ¬å–è´´å§çš„ä¸¤ç§ç½‘é¡µå·®å¼‚</title>
    <link href="https://nmcb666.vip/posts/cf38f81c.html"/>
    <id>https://nmcb666.vip/posts/cf38f81c.html</id>
    <published>2025-09-19T21:16:00.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚"><a href="#ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚" class="headerlink" title="ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚"></a>ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚</h1><p>ç™¾åº¦è´´å§ä½œä¸ºå›½å†…æå…·å½±å“åŠ›çš„ä¸­æ–‡ç¤¾åŒºï¼Œå…¶æµ·é‡çš„ç”¨æˆ·ç”Ÿæˆå†…å®¹ï¼ˆUGCï¼‰æ˜¯è¿›è¡Œå¸‚åœºè°ƒç ”ã€æƒ…æ„Ÿåˆ†æã€çƒ­ç‚¹è¿½è¸ªçš„å®è´µæ•°æ®èµ„æºã€‚ä½†åœ¨å®é™…çˆ¬å–è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šå¼€å‘è€…ä¼šé‡åˆ°â€œæ˜æ˜XPathè§„åˆ™æ­£ç¡®å´çˆ¬ä¸åˆ°æ•°æ®â€çš„é—®é¢˜ï¼Œå…¶æ ¸å¿ƒåŸå› åœ¨äºç™¾åº¦è´´å§å­˜åœ¨ä¸¤ç§å·®å¼‚åŒ–çš„å‰ç«¯æ¸²æŸ“ç»“æ„ã€‚</p><h2 id="ä¸€ã€å‰ç½®çŸ¥è¯†"><a href="#ä¸€ã€å‰ç½®çŸ¥è¯†" class="headerlink" title="ä¸€ã€å‰ç½®çŸ¥è¯†"></a>ä¸€ã€å‰ç½®çŸ¥è¯†</h2><h3 id="1-1-è´´å§URLç»“æ„åˆ†æ"><a href="#1-1-è´´å§URLç»“æ„åˆ†æ" class="headerlink" title="1.1 è´´å§URLç»“æ„åˆ†æ"></a>1.1 è´´å§URLç»“æ„åˆ†æ</h3><p>è´´å§çš„å¸–å­URLéµå¾ªå›ºå®šæ ¼å¼ï¼ŒæŒæ¡åå¯æ‰¹é‡æ„é€ çˆ¬å–é“¾æ¥ï¼š</p><ul><li><p><strong>å•é¡µå¸–å­URL</strong>ï¼š<code>https://tieba.baidu.com/p/[å¸–å­ID]</code>ï¼ˆé»˜è®¤æ˜¾ç¤ºç¬¬ä¸€é¡µï¼‰</p></li><li><p><strong>åˆ†é¡µå¸–å­URL</strong>ï¼š<code>https://tieba.baidu.com/p/[å¸–å­ID]?pn=[é¡µç ]</code>ï¼ˆpnå‚æ•°æŒ‡å®šé¡µç ï¼Œå¦‚pn=2è¡¨ç¤ºç¬¬äºŒé¡µï¼‰</p></li></ul><p>ä¾‹å¦‚ï¼šå¸–å­<code>https://tieba.baidu.com/p/789012345?pn=3</code>è¡¨ç¤ºIDä¸º789012345çš„å¸–å­çš„ç¬¬ä¸‰é¡µå†…å®¹ã€‚</p><h2 id="äºŒã€ä¸¤ç§ç½‘é¡µç»“æ„çš„æ·±åº¦å¯¹æ¯”"><a href="#äºŒã€ä¸¤ç§ç½‘é¡µç»“æ„çš„æ·±åº¦å¯¹æ¯”" class="headerlink" title="äºŒã€ä¸¤ç§ç½‘é¡µç»“æ„çš„æ·±åº¦å¯¹æ¯”"></a>äºŒã€ä¸¤ç§ç½‘é¡µç»“æ„çš„æ·±åº¦å¯¹æ¯”</h2><p>é€šè¿‡Chromeå¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹ç½‘é¡µæºç ï¼Œæˆ‘ä»¬å‘ç°ä¸¤ç§ç»“æ„çš„æ ¸å¿ƒå·®å¼‚é›†ä¸­åœ¨<strong>å¸–å­å†…å®¹å®¹å™¨</strong>å’Œ<strong>å‘å¸ƒæ—¶é—´èŠ‚ç‚¹</strong>ï¼Œä»¥ä¸‹æ˜¯å…·ä½“å¯¹æ¯”ï¼š</p><h3 id="2-1-ç»“æ„ä¸€ï¼šä¼ ç»Ÿç‰ˆï¼ˆæ— clearfixåç¼€ï¼‰"><a href="#2-1-ç»“æ„ä¸€ï¼šä¼ ç»Ÿç‰ˆï¼ˆæ— clearfixåç¼€ï¼‰" class="headerlink" title="2.1 ç»“æ„ä¸€ï¼šä¼ ç»Ÿç‰ˆï¼ˆæ— clearfixåç¼€ï¼‰"></a>2.1 ç»“æ„ä¸€ï¼šä¼ ç»Ÿç‰ˆï¼ˆæ— clearfixåç¼€ï¼‰</h3><p>é€šè¿‡â€œæ£€æŸ¥â€åŠŸèƒ½å®šä½åˆ°å¸–å­å†…å®¹å’Œå‘å¸ƒæ—¶é—´èŠ‚ç‚¹ï¼Œå…¶HTMLç»“æ„å¦‚ä¸‹ï¼š</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/1.png" alt="ç¤ºä¾‹å›¾ç‰‡"/></div><span class="image-caption">ç¤ºä¾‹å›¾ç‰‡</span></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/2.png" alt="ç¤ºä¾‹å›¾ç‰‡"/></div><span class="image-caption">ç¤ºä¾‹å›¾ç‰‡</span></div><p>å¯¹åº”çš„XPathè§£æè§„åˆ™ï¼š</p><ul><li><p>å›å¤å†…å®¹ï¼š<code>content_list = html.xpath(&#39;//cc/div[@class=&quot;d_post_content j_d_post_content &quot;]&#39;)</code><br>ä¹‹åå†å¾ªç¯è·å–è¯„è®ºå†…å®¹ï¼š<code>content_list = [&#39;&#39;.join(i.xpath(&#39;.//text()&#39;)) for i in content_list]</code></p></li><li><p>å‘å¸ƒæ—¶é—´ï¼š<code>create_time = html.xpath(&#39;//div/div[@class=&quot;core_reply_tail clearfix&quot;]&#39;)</code><br>ä¹‹åå†å¾ªç¯è·å–é‡Œé¢çš„æ—¶é—´ï¼š<code>create_time = [i.xpath(&#39;.//span[@class=&quot;tail-info&quot;]/text()&#39;)[-1] for i in create_time]</code>ï¼ˆå–æœ€åä¸€ä¸ªtail-infoçš„æ–‡æœ¬ï¼‰</p></li></ul><h3 id="2-2-ç»“æ„äºŒï¼šæ–°ç‰ˆï¼ˆå«clearfixåç¼€ï¼‰"><a href="#2-2-ç»“æ„äºŒï¼šæ–°ç‰ˆï¼ˆå«clearfixåç¼€ï¼‰" class="headerlink" title="2.2 ç»“æ„äºŒï¼šæ–°ç‰ˆï¼ˆå«clearfixåç¼€ï¼‰"></a>2.2 ç»“æ„äºŒï¼šæ–°ç‰ˆï¼ˆå«clearfixåç¼€ï¼‰</h3><p>å…¶HTMLç»“æ„è°ƒæ•´äº†classå±æ€§å’ŒèŠ‚ç‚¹å±‚çº§ï¼š</p><p><img src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/3.png" alt="code"><br><img src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/4.png" alt="code"></p><p>å¯¹åº”çš„XPathè§£æè§„åˆ™ï¼š</p><ul><li><p>å›å¤å†…å®¹ï¼š<code>content_list = html.xpath(&#39;//cc/div[@class=&quot;d_post_content j_d_post_content  clearfix&quot;]&#39;)</code><br>ä¹‹åå†å¾ªç¯è·å–è¯„è®ºå†…å®¹ï¼š<code>content_list = [&#39;&#39;.join(i.xpath(&#39;.//text()&#39;)) for i in content_list]</code>ï¼ˆæ³¨æ„ä¸¤ä¸ªç©ºæ ¼ï¼‰</p></li><li><p>å‘å¸ƒæ—¶é—´ï¼š<code>create_time = html.xpath(&#39;//div/div[@class=&quot;core_reply_tail &quot;]&#39;)</code>ï¼ˆ<br>ä¹‹åå†å¾ªç¯è·å–é‡Œé¢çš„æ—¶é—´ï¼š<code>create_time = [i.xpath(&#39;.//ul[@class=&quot;p_tail&quot;]/li[last()]/span/text()&#39;)[-1] for i in create_time]</code>å–p_tailæœ€åä¸€ä¸ªliçš„spanæ–‡æœ¬ï¼‰</p></li></ul><p><strong>å…³é”®æé†’</strong>ï¼šXPathä¸­classå±æ€§çš„åŒ¹é…æ˜¯<strong>ç²¾ç¡®åŒ¹é…</strong>ï¼Œç©ºæ ¼å’Œåç¼€çš„å·®å¼‚ä¼šå¯¼è‡´è§£æå¤±è´¥ã€‚åœ¨ç¼–å†™è§„åˆ™æ—¶ï¼Œå¿…é¡»å®Œå…¨å¤åˆ¶ç½‘é¡µæºç ä¸­çš„classå€¼ã€‚</p><h2 id="ä¸‰ã€ç¤ºä¾‹ä»£ç "><a href="#ä¸‰ã€ç¤ºä¾‹ä»£ç " class="headerlink" title="ä¸‰ã€ç¤ºä¾‹ä»£ç "></a>ä¸‰ã€ç¤ºä¾‹ä»£ç </h2><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># æå–å¸–å­è¯„è®ºæ•°æ®ç¬¬ä¸€ç§</span></span><br><span class="line">data_fields = html.xpath(<span class="string">&#x27;//*[@id=&quot;j_p_postlist&quot;]/div/@data-field&#x27;</span>)</span><br><span class="line">author_list = html.xpath(<span class="string">&#x27;//div[@id=&quot;j_p_postlist&quot;]/div/div[@class=&quot;d_author&quot;]/ul/li[@class=&quot;d_name&quot;]/a/text()&#x27;</span>)</span><br><span class="line">content_list = html.xpath(<span class="string">&#x27;//cc/div[@class=&quot;d_post_content j_d_post_content &quot;]&#x27;</span>)</span><br><span class="line">content_list = [<span class="string">&#x27;&#x27;</span>.join(i.xpath(<span class="string">&#x27;.//text()&#x27;</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> content_list]</span><br><span class="line">create_time = html.xpath(<span class="string">&#x27;//div/div[@class=&quot;core_reply_tail clearfix&quot;]&#x27;</span>)</span><br><span class="line">create_time = [i.xpath(<span class="string">&#x27;.//span[@class=&quot;tail-info&quot;]/text()&#x27;</span>)[-<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> create_time]</span><br><span class="line"><span class="comment"># æå–å¸–å­è¯„è®ºæ•°æ®ç¬¬äºŒç§</span></span><br><span class="line">data_fields = html.xpath(<span class="string">&#x27;//*[@id=&quot;j_p_postlist&quot;]/div/@data-field&#x27;</span>)</span><br><span class="line">author_list = html.xpath(<span class="string">&#x27;//div[@id=&quot;j_p_postlist&quot;]/div/div[@class=&quot;d_author&quot;]/ul/li[@class=&quot;d_name&quot;]/a/text()&#x27;</span>)</span><br><span class="line">content_list = html.xpath(<span class="string">&#x27;//cc/div[@class=&quot;d_post_content j_d_post_content  clearfix&quot;]&#x27;</span>)</span><br><span class="line">content_list = [<span class="string">&#x27;&#x27;</span>.join(i.xpath(<span class="string">&#x27;.//text()&#x27;</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> content_list]</span><br><span class="line">create_time = html.xpath(<span class="string">&#x27;//div/div[@class=&quot;core_reply_tail &quot;]&#x27;</span>)</span><br><span class="line">create_time_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> create_time:</span><br><span class="line">    time_elements = i.xpath(<span class="string">&#x27;.//ul[@class=&quot;p_tail&quot;]/li[last()]/span/text()&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> time_elements:</span><br><span class="line">        create_time_list.append(time_elements[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        create_time_list.append(<span class="string">&#x27;æœªçŸ¥&#x27;</span>)</span><br><span class="line">create_time = create_time_list</span><br></pre></td></tr></table></figure><h2 id="å››ã€å…³äºçˆ¬å–è´´å§åˆ—è¡¨"><a href="#å››ã€å…³äºçˆ¬å–è´´å§åˆ—è¡¨" class="headerlink" title="å››ã€å…³äºçˆ¬å–è´´å§åˆ—è¡¨"></a>å››ã€å…³äºçˆ¬å–è´´å§åˆ—è¡¨</h2><h3 id="1-é—®é¢˜åˆ†æ"><a href="#1-é—®é¢˜åˆ†æ" class="headerlink" title="1.é—®é¢˜åˆ†æ"></a>1.é—®é¢˜åˆ†æ</h3><p>è´´å§åˆ—è¡¨é¡µé¢å¦‚ä¸‹æ‰€ç¤º<br><img src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/5.png" alt="code"><br>ç°åœ¨æˆ‘ä»¬æƒ³è¦è·å–åˆ—è¡¨é¡µçš„è´´å­åç§°ï¼Œå¸–å­ä½œè€…ï¼Œå¸–å­é“¾æ¥ï¼Œå¸–å­æ—¶é—´<br>åŸæ¥çš„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æå–æ ‡é¢˜ã€é“¾æ¥ã€å‘å¸–äººå’Œæ—¶é—´</span></span><br><span class="line">        title_list = html.xpath(<span class="string">&#x27;//div[@class=&quot;threadlist_title pull_left j_th_tit &quot;]/a[1]/@title&#x27;</span>)</span><br><span class="line">        link_list = html.xpath(<span class="string">&#x27;//div[@class=&quot;threadlist_title pull_left j_th_tit &quot;]/a[1]/@href&#x27;</span>)</span><br><span class="line">        creator_list = html.xpath(<span class="string">&#x27;//div[@class=&quot;threadlist_author pull_right&quot;]/span[@class=&quot;tb_icon_author &quot;]/@title&#x27;</span>)</span><br><span class="line">        create_time_list = html.xpath(<span class="string">&#x27;//div[@class=&quot;threadlist_author pull_right&quot;]/span[@class=&quot;pull-right is_show_create_time&quot;]/text()&#x27;</span>)</span><br></pre></td></tr></table></figure><br>çœ‹ä¸Šå»ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ ï¼Œä½†æ˜¯è¿è¡Œä»£ç çš„æ—¶å€™ï¼Œå‘ç°çˆ¬å–çš„å¸–å­æœ‰äº›æ ‡é¢˜è·Ÿæ—¶é—´å¯¹ä¸ä¸Šè¿™ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ã€‚<br>æ‰€ä»¥è¿™åˆ°åº•æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>æˆ‘ä»¬å¯ä»¥æ‰“å¼€f12æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼ŒæŸ¥çœ‹åˆ—è¡¨é¡µé¢çš„htmlç»“æ„ï¼Œé€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œä¸€äº›å¸–å­çš„æ ‡é¢˜ï¼Œé“¾æ¥ï¼Œå‘å¸–äººçš„htmlç»“æ„è·Ÿå¤§éƒ¨åˆ†è¿˜ä¸ä¸€æ ·ã€‚<br>ä¾‹å¦‚æ™®é€šçš„æ ‡é¢˜é¡µé¢ç»“æ„å¦‚ä¸‹ï¼š<br><img src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/6.png" alt="code"><br>ä½†æ˜¯æŸäº›å¸–å­æ ‡é¢˜çš„htmlç»“æ„å¦‚ä¸‹ï¼š<br><img src="https://java-ai-nskk.oss-cn-beijing.aliyuncs.com/myblog/blogImg/7.png" alt="code"><br>å¯ä»¥å‘ç°å°‘éƒ¨åˆ†è´´å­çš„æ ‡é¢˜æ¯”æ™®é€šçš„å¤šäº†member_thread_title_frs è¿™ä¸€æ®µæ–‡å­— å¯¼è‡´è·å–ä¸åˆ°ä¸€äº›å¸–å­æ ‡é¢˜ï¼Œæ‰€ä»¥ä¹Ÿå°±é€ æˆäº†ä¹‹åçš„æ—¶é—´ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><h3 id="2-è§£å†³æ–¹æ³•"><a href="#2-è§£å†³æ–¹æ³•" class="headerlink" title="2.è§£å†³æ–¹æ³•"></a>2.è§£å†³æ–¹æ³•</h3><p>è§£å†³æ–¹æ³•å¾ˆç®€å•åªéœ€è¦åœ¨å¤šåŒ¹é…é‚£å°‘éƒ¨åˆ†çš„å†…å®¹å³å¯ã€‚<br>å¯ä»¥æŠŠåŸæ¥çš„æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢ä¸º<code>//div[contains(@class,&quot;threadlist_title&quot;) and contains(@class,&quot;j_th_tit&quot;)]/a[1]/@title</code>ã€‚<br>è¿™æ ·å°±èƒ½åŒ¹é…åªè¦æœ‰threadlist_title pull_left j_th_tit çš„å†…å®¹äº†ã€‚<br>ä½†æ˜¯æ³¨æ„è¿™é‡Œçš„ä½œè€…åç§°ï¼Œä¸€ä¸ªå¸–å­ä¼šæœ‰ä¸¤ä¸ªä½œè€…åç§°ã€‚ç¬¬ä¸€ä¸ªæ˜¯å¸–å­ä½œè€…ï¼Œç¬¬äºŒä¸ªæ˜¯æœ€åè¯„è®ºçš„äººçš„åç§°ã€‚è¿™é‡Œæˆ‘ä»¬åªéœ€è¦è·å–ç¬¬ä¸€ä¸ªä½œè€…åç§°å³å¯ã€‚<br>äºæ˜¯å…³äºä½œè€…åç§°çš„æ­£åˆ™è¡¨è¾¾å¼ç”¨orå³å¯ã€‚<br>ä¿®æ”¹çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æå–æ ‡é¢˜ã€é“¾æ¥ã€å‘å¸–äººå’Œæ—¶é—´</span></span><br><span class="line">title_list = html.xpath(<span class="string">&#x27;//div[contains(@class,&quot;threadlist_title&quot;) and contains(@class,&quot;j_th_tit&quot;)]/a[1]/@title&#x27;</span>)</span><br><span class="line">link_list = html.xpath(<span class="string">&#x27;//div[contains(@class,&quot;threadlist_title&quot;) and contains(@class,&quot;j_th_tit&quot;)]/a[1]/@href&#x27;</span>)</span><br><span class="line"><span class="comment"># ä¿®æ”¹åçš„ä½œè€…åŒ¹é…è§„åˆ™ï¼ŒåªåŒ¹é…æŒ‡å®šçš„ä¸¤ç§å½¢å¼</span></span><br><span class="line">creator_list = html.xpath(<span class="string">&#x27;//div[@class=&quot;threadlist_author pull_right&quot;]/span[@class=&quot;tb_icon_author &quot; or @class=&quot;tb_icon_author no_icon_author&quot;]/@title&#x27;</span>)</span><br><span class="line">create_time_list = html.xpath(<span class="string">&#x27;//div[@class=&quot;threadlist_author pull_right&quot;]/span[@class=&quot;pull-right is_show_create_time&quot;]/text()&#x27;</span>)</span><br></pre></td></tr></table></figure><br>è¿™æ ·ä¿®æ”¹ä¹‹åå°±å¯ä»¥åŒ¹é…åˆ°æ­£ç¡®çš„å®Œæ•´çš„æ•°æ®äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚&quot;&gt;&lt;a href=&quot;#ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚&quot; class=&quot;headerlink&quot; title=&quot;ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚&quot;&gt;&lt;/a&gt;ç™¾åº¦è´´å§çˆ¬å–æ—¶ä¸¤ç§ç½‘é¡µç»“æ„çš„å·®å¼‚&lt;/h1&gt;&lt;p&gt;ç™¾åº¦è´´å§ä½œä¸ºå›½å†…æå…·å½±å“åŠ›çš„</summary>
      
    
    
    
    
    <category term="çˆ¬è™«" scheme="https://nmcb666.vip/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>çˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®º</title>
    <link href="https://nmcb666.vip/posts/eb47d163.html"/>
    <id>https://nmcb666.vip/posts/eb47d163.html</id>
    <published>2025-09-19T16:58:21.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pythonçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºå®Œæ•´æ•™ç¨‹ï¼ˆåŸºç¡€-å¸¸è§é—®é¢˜ï¼‰"><a href="#Pythonçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºå®Œæ•´æ•™ç¨‹ï¼ˆåŸºç¡€-å¸¸è§é—®é¢˜ï¼‰" class="headerlink" title="Pythonçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºå®Œæ•´æ•™ç¨‹ï¼ˆåŸºç¡€+å¸¸è§é—®é¢˜ï¼‰"></a>Pythonçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºå®Œæ•´æ•™ç¨‹ï¼ˆåŸºç¡€+å¸¸è§é—®é¢˜ï¼‰</h1><p>åœ¨æ•°æ®é‡‡é›†é¢†åŸŸï¼Œå¾®åšä½œä¸ºå›½å†…ä¸»æµçš„ç¤¾äº¤åª’ä½“å¹³å°ï¼Œå…¶è¯„è®ºæ•°æ®è•´å«ç€ä¸°å¯Œçš„ç”¨æˆ·è§‚ç‚¹å’Œèˆ†è®ºå€¾å‘ã€‚ç›¸è¾ƒäºPCç«¯ï¼Œå¾®åšç§»åŠ¨ç«¯æ¥å£æ›´ç®€æ´ã€åçˆ¬æªæ–½ç›¸å¯¹å®½æ¾ï¼Œæ˜¯è·å–è¯„è®ºæ•°æ®çš„ä¼˜é€‰æ–¹æ¡ˆã€‚æœ¬æ–‡å°†ä»¥<strong>Python</strong>ä¸ºå·¥å…·ï¼Œä»ç¯å¢ƒæ­å»ºåˆ°ä»£ç å®ç°ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ çˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºï¼Œå¹¶è§£ç­”è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„å¸¸è§é—®é¢˜ã€‚</p><hr><h2 id="ä¸€ã€åŸºç¡€æ•™ç¨‹ï¼šä»é›¶å®ç°å¾®åšè¯„è®ºçˆ¬å–"><a href="#ä¸€ã€åŸºç¡€æ•™ç¨‹ï¼šä»é›¶å®ç°å¾®åšè¯„è®ºçˆ¬å–" class="headerlink" title="ä¸€ã€åŸºç¡€æ•™ç¨‹ï¼šä»é›¶å®ç°å¾®åšè¯„è®ºçˆ¬å–"></a>ä¸€ã€åŸºç¡€æ•™ç¨‹ï¼šä»é›¶å®ç°å¾®åšè¯„è®ºçˆ¬å–</h2><h3 id="1-1-ç¯å¢ƒå‡†å¤‡"><a href="#1-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1.1 ç¯å¢ƒå‡†å¤‡"></a>1.1 ç¯å¢ƒå‡†å¤‡</h3><p>é¦–å…ˆéœ€è¦æ­å»ºPythonçˆ¬è™«ç¯å¢ƒï¼Œæ ¸å¿ƒä¾èµ–åº“å¦‚ä¸‹ï¼š</p><ul><li><p><strong>requests</strong>ï¼šå‘é€HTTPè¯·æ±‚ï¼Œè·å–æ¥å£æ•°æ®</p></li><li><p><strong>json</strong>ï¼šè§£ææ¥å£è¿”å›çš„JSONæ•°æ®ï¼ˆPythonå†…ç½®ï¼Œæ— éœ€å®‰è£…ï¼‰</p></li><li><p><strong>pandas</strong>ï¼šæ•°æ®å­˜å‚¨ä¸å¯¼å‡ºï¼ˆå¯é€‰ï¼Œç”¨äºç”ŸæˆExcelæ–‡ä»¶ï¼‰</p></li><li><p><strong>time</strong>ï¼šè®¾ç½®è¯·æ±‚é—´éš”ï¼Œé¿å…è¢«åçˆ¬ï¼ˆPythonå†…ç½®ï¼‰</p></li></ul><p>å®‰è£…å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pip install requests pandas</span><br></pre></td></tr></table></figure><h3 id="1-2-æ ¸å¿ƒåŸç†ï¼šæ‰¾åˆ°è¯„è®ºæ¥å£"><a href="#1-2-æ ¸å¿ƒåŸç†ï¼šæ‰¾åˆ°è¯„è®ºæ¥å£" class="headerlink" title="1.2 æ ¸å¿ƒåŸç†ï¼šæ‰¾åˆ°è¯„è®ºæ¥å£"></a>1.2 æ ¸å¿ƒåŸç†ï¼šæ‰¾åˆ°è¯„è®ºæ¥å£</h3><p>å¾®åšç§»åŠ¨ç«¯è¯„è®ºé€šè¿‡AJAXå¼‚æ­¥åŠ è½½ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°çœŸå®çš„è¯„è®ºæ¥å£ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>æ‰“å¼€æ‰‹æœºæµè§ˆå™¨ï¼ˆæˆ–ç”µè„‘æµè§ˆå™¨åˆ‡æ¢åˆ°<strong>ç§»åŠ¨ç«¯æ¨¡å¼</strong>ï¼‰ï¼Œç™»å½•å¾®åšè´¦å·ï¼Œæ‰¾åˆ°ç›®æ ‡å¾®åšï¼ˆä¾‹å¦‚ï¼š<a href="https://m.weibo.cn/detail/4900000000000000">https://m.weibo.cn/detail/4900000000000000</a>ï¼‰</p></li><li><p>æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œåˆ‡æ¢åˆ°<strong>Network</strong>æ ‡ç­¾ï¼Œå‹¾é€‰<strong>XHR</strong>ï¼ˆç­›é€‰AJAXè¯·æ±‚ï¼‰</p></li><li><p>ä¸‹æ‹‰é¡µé¢åŠ è½½è¯„è®ºï¼Œæ­¤æ—¶ä¼šçœ‹åˆ°åä¸º<strong>comment</strong>çš„è¯·æ±‚ï¼Œç‚¹å‡»è¯¥è¯·æ±‚æŸ¥çœ‹è¯¦æƒ…</p></li><li><p>åœ¨<strong>Request URL</strong>ä¸­å¯ä»¥çœ‹åˆ°è¯„è®ºæ¥å£åœ°å€ï¼Œåœ¨<strong>Response</strong>ä¸­å¯ä»¥çœ‹åˆ°JSONæ ¼å¼çš„è¯„è®ºæ•°æ®</p></li></ol><div class="note primary modern"><p>å…¸å‹çš„å¾®åšè¯„è®ºæ¥å£æ ¼å¼ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">https://m.weibo.cn/comments/hotflow?id=å¾®åšID&amp;mid=å¾®åšID&amp;max_id=ä¸‹ä¸€é¡µæ ‡è¯†&amp;max_id_type=0</span><br></pre></td></tr></table></figure></div><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><p><strong>id/mid</strong>ï¼šç›®æ ‡å¾®åšçš„IDï¼ˆä»å¾®åšè¯¦æƒ…é¡µURLä¸­è·å–ï¼Œä¾‹å¦‚URLæœ«å°¾çš„æ•°å­—ä¸²ï¼‰</p></li><li><p><strong>max_id</strong>ï¼šåˆ†é¡µæ ‡è¯†ï¼Œåˆå§‹ä¸º0ï¼Œåç»­é¡µé¢çš„max_idä»å½“å‰å“åº”ä¸­è·å–</p></li><li><p><strong>max_id_type</strong>ï¼šå›ºå®šä¸º0å³å¯</p></li></ul><h3 id="1-3-ä»£ç å®ç°æ­¥éª¤"><a href="#1-3-ä»£ç å®ç°æ­¥éª¤" class="headerlink" title="1.3 ä»£ç å®ç°æ­¥éª¤"></a>1.3 ä»£ç å®ç°æ­¥éª¤</h3><h4 id="æ­¥éª¤1ï¼šè·å–è¯·æ±‚å¤´ï¼ˆHeadersï¼‰"><a href="#æ­¥éª¤1ï¼šè·å–è¯·æ±‚å¤´ï¼ˆHeadersï¼‰" class="headerlink" title="æ­¥éª¤1ï¼šè·å–è¯·æ±‚å¤´ï¼ˆHeadersï¼‰"></a>æ­¥éª¤1ï¼šè·å–è¯·æ±‚å¤´ï¼ˆHeadersï¼‰</h4><p>ä¸ºäº†æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¯·æ±‚ï¼Œéœ€è¦åœ¨è¯·æ±‚ä¸­æ·»åŠ Headersï¼Œæ ¸å¿ƒå‚æ•°åŒ…æ‹¬<strong>User-Agent</strong>å’Œ<strong>Cookie</strong>ï¼š</p><ul><li><p><strong>User-Agent</strong>ï¼šæ ‡è¯†æµè§ˆå™¨ç±»å‹ï¼Œç§»åŠ¨ç«¯UAç¤ºä¾‹ï¼š<code>Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1</code></p></li><li><p><strong>Cookie</strong>ï¼šåŒ…å«ç™»å½•çŠ¶æ€ä¿¡æ¯ï¼Œä»æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Request Headersä¸­å¤åˆ¶ï¼ˆç™»å½•åæ‰èƒ½è·å–æ›´å¤šè¯„è®ºï¼‰</p></li></ul><h4 id="æ­¥éª¤2ï¼šå‘é€è¯·æ±‚å¹¶è§£ææ•°æ®"><a href="#æ­¥éª¤2ï¼šå‘é€è¯·æ±‚å¹¶è§£ææ•°æ®" class="headerlink" title="æ­¥éª¤2ï¼šå‘é€è¯·æ±‚å¹¶è§£ææ•°æ®"></a>æ­¥éª¤2ï¼šå‘é€è¯·æ±‚å¹¶è§£ææ•°æ®</h4><p>ç¼–å†™ä»£ç å‘é€GETè¯·æ±‚ï¼Œè§£æJSONå“åº”ä¸­çš„è¯„è®ºå†…å®¹ï¼ˆç”¨æˆ·åã€è¯„è®ºæ—¶é—´ã€è¯„è®ºå†…å®¹ç­‰ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä¿¡æ¯</span></span><br><span class="line">weibo_id = <span class="string">&quot;4900000000000000&quot;</span>  <span class="comment"># ç›®æ ‡å¾®åšID</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;ä½ çš„Cookieä¿¡æ¯&quot;</span>  <span class="comment"># æ›¿æ¢ä¸ºè‡ªå·±çš„Cookie</span></span><br><span class="line">&#125;</span><br><span class="line">comments = []  <span class="comment"># å­˜å‚¨è¯„è®ºæ•°æ®</span></span><br><span class="line">max_id = <span class="number">0</span>  <span class="comment"># åˆå§‹åˆ†é¡µæ ‡è¯†</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># æ„å»ºè¯·æ±‚URL</span></span><br><span class="line">    url = <span class="string">f&quot;https://m.weibo.cn/comments/hotflow?id=<span class="subst">&#123;weibo_id&#125;</span>&amp;mid=<span class="subst">&#123;weibo_id&#125;</span>&amp;max_id=<span class="subst">&#123;max_id&#125;</span>&amp;max_id_type=0&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, headers=headers, timeout=<span class="number">10</span>)</span><br><span class="line">        response.raise_for_status()  <span class="comment"># è‹¥çŠ¶æ€ç ä¸æ˜¯200ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        data = json.loads(response.text)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æå–è¯„è®ºåˆ—è¡¨</span></span><br><span class="line">        comment_list = data.get(<span class="string">&quot;data&quot;</span>, &#123;&#125;).get(<span class="string">&quot;data&quot;</span>, [])</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> comment_list:  <span class="comment"># æ²¡æœ‰æ›´å¤šè¯„è®ºæ—¶é€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;å·²è·å–æ‰€æœ‰è¯„è®º&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è§£ææ¯æ¡è¯„è®º</span></span><br><span class="line">        <span class="keyword">for</span> comment <span class="keyword">in</span> comment_list:</span><br><span class="line">            item = &#123;</span><br><span class="line">                <span class="string">&quot;ç”¨æˆ·å&quot;</span>: comment.get(<span class="string">&quot;user&quot;</span>, &#123;&#125;).get(<span class="string">&quot;screen_name&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">                <span class="string">&quot;ç”¨æˆ·ID&quot;</span>: comment.get(<span class="string">&quot;user&quot;</span>, &#123;&#125;).get(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">                <span class="string">&quot;è¯„è®ºæ—¶é—´&quot;</span>: comment.get(<span class="string">&quot;created_at&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">                <span class="string">&quot;è¯„è®ºå†…å®¹&quot;</span>: comment.get(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">                <span class="string">&quot;ç‚¹èµæ•°&quot;</span>: comment.get(<span class="string">&quot;like_count&quot;</span>, <span class="number">0</span>),</span><br><span class="line">                <span class="string">&quot;å›å¤æ•°&quot;</span>: comment.get(<span class="string">&quot;reply_count&quot;</span>, <span class="number">0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            comments.append(item)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å·²è·å–<span class="subst">&#123;<span class="built_in">len</span>(comments)&#125;</span>æ¡è¯„è®º&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ›´æ–°ä¸‹ä¸€é¡µçš„max_id</span></span><br><span class="line">        max_id = data.get(<span class="string">&quot;data&quot;</span>, &#123;&#125;).get(<span class="string">&quot;max_id&quot;</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> max_id == <span class="number">0</span>:  <span class="comment"># æ²¡æœ‰ä¸‹ä¸€é¡µæ—¶é€€å‡º</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¾ç½®è¯·æ±‚é—´éš”ï¼Œé¿å…è¢«å°IP</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è¯·æ±‚å‡ºé”™ï¼š<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤3ï¼šæ•°æ®å­˜å‚¨"><a href="#æ­¥éª¤3ï¼šæ•°æ®å­˜å‚¨" class="headerlink" title="æ­¥éª¤3ï¼šæ•°æ®å­˜å‚¨"></a>æ­¥éª¤3ï¼šæ•°æ®å­˜å‚¨</h4><p>å°†çˆ¬å–åˆ°çš„è¯„è®ºæ•°æ®å¯¼å‡ºä¸ºExcelæ–‡ä»¶ï¼Œæ–¹ä¾¿åç»­åˆ†æï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºDataFrameå¹¶å¯¼å‡º</span></span><br><span class="line">df = pd.DataFrame(comments)</span><br><span class="line">df.to_excel(<span class="string">&quot;å¾®åšè¯„è®º.xlsx&quot;</span>, index=<span class="literal">False</span>, engine=<span class="string">&quot;openpyxl&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è¯„è®ºæ•°æ®å·²ä¿å­˜åˆ°å¾®åšè¯„è®º.xlsx&quot;</span>)</span><br></pre></td></tr></table></figure><hr><h2 id="äºŒã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#äºŒã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>äºŒã€å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h2><h3 id="2-1-é—®é¢˜1ï¼šè¯·æ±‚è¿”å›403-401é”™è¯¯"><a href="#2-1-é—®é¢˜1ï¼šè¯·æ±‚è¿”å›403-401é”™è¯¯" class="headerlink" title="2.1 é—®é¢˜1ï¼šè¯·æ±‚è¿”å›403/401é”™è¯¯"></a>2.1 é—®é¢˜1ï¼šè¯·æ±‚è¿”å›403/401é”™è¯¯</h3><p><strong>åŸå› </strong>ï¼šHeaderså‚æ•°ä¸å®Œæ•´æˆ–Cookieå¤±æ•ˆï¼ŒæœåŠ¡å™¨è¯†åˆ«ä¸ºçˆ¬è™«è¯·æ±‚ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>æ£€æŸ¥Cookieæ˜¯å¦æ­£ç¡®ï¼Œé‡æ–°ç™»å½•å¾®åšåå¤åˆ¶æœ€æ–°çš„Cookie</p></li><li><p>è¡¥å……Headersä¸­çš„å…¶ä»–å‚æ•°ï¼ˆå¦‚<strong>Referer</strong>ï¼šè®¾ç½®ä¸ºç›®æ ‡å¾®åšè¯¦æƒ…é¡µURLï¼‰</p></li><li><p>ç¡®ä¿User-Agentæ˜¯ç§»åŠ¨ç«¯æ ¼å¼ï¼Œé¿å…ä½¿ç”¨PCç«¯UA</p></li></ul><h3 id="2-2-é—®é¢˜2ï¼šåªèƒ½çˆ¬å–å‰20æ¡è¯„è®º"><a href="#2-2-é—®é¢˜2ï¼šåªèƒ½çˆ¬å–å‰20æ¡è¯„è®º" class="headerlink" title="2.2 é—®é¢˜2ï¼šåªèƒ½çˆ¬å–å‰20æ¡è¯„è®º"></a>2.2 é—®é¢˜2ï¼šåªèƒ½çˆ¬å–å‰20æ¡è¯„è®º</h3><p><strong>åŸå› </strong>ï¼šæœªæ­£ç¡®å¤„ç†åˆ†é¡µå‚æ•°max_idï¼Œæˆ–æœªç™»å½•å¯¼è‡´åªèƒ½è·å–å…¬å¼€è¯„è®ºã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>ç¡®ä¿ç™»å½•çŠ¶æ€ï¼ˆCookieæœ‰æ•ˆï¼‰ï¼Œç™»å½•åå¯è·å–æ›´å¤šè¯„è®º</p></li><li><p>æ£€æŸ¥max_idæ˜¯å¦æ­£ç¡®ä»å“åº”ä¸­æå–ï¼Œé¿å…æ‰‹åŠ¨è®¾ç½®å›ºå®šå€¼</p></li><li><p>éƒ¨åˆ†å¾®åšå¯èƒ½é™åˆ¶è¯„è®ºæŸ¥çœ‹æƒé™ï¼Œå±äºæ­£å¸¸æƒ…å†µ</p></li></ul><h3 id="2-3-é—®é¢˜3ï¼šIPè¢«å°ç¦ï¼Œæ— æ³•å‘é€è¯·æ±‚"><a href="#2-3-é—®é¢˜3ï¼šIPè¢«å°ç¦ï¼Œæ— æ³•å‘é€è¯·æ±‚" class="headerlink" title="2.3 é—®é¢˜3ï¼šIPè¢«å°ç¦ï¼Œæ— æ³•å‘é€è¯·æ±‚"></a>2.3 é—®é¢˜3ï¼šIPè¢«å°ç¦ï¼Œæ— æ³•å‘é€è¯·æ±‚</h3><p><strong>åŸå› </strong>ï¼šè¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè§¦å‘å¾®åšåçˆ¬æœºåˆ¶ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>å¢åŠ è¯·æ±‚é—´éš”æ—¶é—´ï¼ˆå¦‚time.sleep(3-5ç§’)ï¼‰ï¼Œé¿å…é«˜é¢‘è¯·æ±‚</p></li><li><p>ä½¿ç”¨ä»£ç†IPæ± ï¼Œè½®æ¢IPåœ°å€å‘é€è¯·æ±‚ï¼ˆæ¨èä½¿ç”¨é«˜åŒ¿ä»£ç†ï¼‰</p></li><li><p>æš‚åœçˆ¬å–1-2å°æ—¶ï¼ŒIPå°ç¦é€šå¸¸æ˜¯ä¸´æ—¶çš„</p></li></ul><h3 id="2-4-é—®é¢˜4ï¼šè¯„è®ºå†…å®¹å«HTMLæ ‡ç­¾"><a href="#2-4-é—®é¢˜4ï¼šè¯„è®ºå†…å®¹å«HTMLæ ‡ç­¾" class="headerlink" title="2.4 é—®é¢˜4ï¼šè¯„è®ºå†…å®¹å«HTMLæ ‡ç­¾"></a>2.4 é—®é¢˜4ï¼šè¯„è®ºå†…å®¹å«HTMLæ ‡ç­¾</h3><p><strong>åŸå› </strong>ï¼šæ¥å£è¿”å›çš„textå­—æ®µåŒ…å«HTMLæ ¼å¼ï¼ˆå¦‚è¡¨æƒ…ã€è¯é¢˜é“¾æ¥ç­‰ï¼‰ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨<strong>BeautifulSoup</strong>æ¸…ç†HTMLæ ‡ç­¾ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç†è¯„è®ºå†…å®¹ä¸­çš„HTMLæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_html</span>(<span class="params">text</span>):</span><br><span class="line">    soup = BeautifulSoup(text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> soup.get_text()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è§£æè¯„è®ºæ—¶è°ƒç”¨</span></span><br><span class="line"><span class="string">&quot;è¯„è®ºå†…å®¹&quot;</span>: clean_html(comment.get(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;&quot;</span>)),</span><br></pre></td></tr></table></figure><h3 id="2-5-é—®é¢˜5ï¼šå“åº”æ•°æ®æ ¼å¼å¼‚å¸¸"><a href="#2-5-é—®é¢˜5ï¼šå“åº”æ•°æ®æ ¼å¼å¼‚å¸¸" class="headerlink" title="2.5 é—®é¢˜5ï¼šå“åº”æ•°æ®æ ¼å¼å¼‚å¸¸"></a>2.5 é—®é¢˜5ï¼šå“åº”æ•°æ®æ ¼å¼å¼‚å¸¸</h3><p><strong>åŸå› </strong>ï¼šæ¥å£å‚æ•°å˜åŒ–æˆ–å¾®åšæ›´æ–°åçˆ¬ç­–ç•¥ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><p>é‡æ–°é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŠ“å–æœ€æ–°çš„è¯„è®ºæ¥å£ï¼Œç¡®è®¤å‚æ•°æ˜¯å¦å˜åŒ–</p></li><li><p>æ‰“å°response.textæŸ¥çœ‹åŸå§‹å“åº”ï¼Œåˆ†ææ•°æ®æ ¼å¼æ˜¯å¦ä¸é¢„æœŸä¸€è‡´</p></li><li><p>å…³æ³¨å¾®åšæ¥å£çš„å®˜æ–¹å˜åŒ–ï¼ˆè‹¥æœ‰ï¼‰ï¼ŒåŠæ—¶è°ƒæ•´ä»£ç </p></li></ul><h3 id="2-6-é—®é¢˜6ï¼šè¯·æ±‚ç¬¬ä¸€é¡µä¹‹åçš„æ•°æ®å“åº”ok-0"><a href="#2-6-é—®é¢˜6ï¼šè¯·æ±‚ç¬¬ä¸€é¡µä¹‹åçš„æ•°æ®å“åº”ok-0" class="headerlink" title="2.6 é—®é¢˜6ï¼šè¯·æ±‚ç¬¬ä¸€é¡µä¹‹åçš„æ•°æ®å“åº”ok{0}"></a>2.6 é—®é¢˜6ï¼šè¯·æ±‚ç¬¬ä¸€é¡µä¹‹åçš„æ•°æ®å“åº”ok{0}</h3><p><strong>åŸå› </strong>ï¼šè¯·æ±‚çš„Cookieå·²å¤±æ•ˆï¼Œéœ€è¦é‡æ–°ç™»å½•è·å–Cookieã€‚(å› ä¸ºå¾®åšéœ€è¦ç™»å½•æ‰èƒ½æŸ¥çœ‹æ›´å¤šè¯„è®º)</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li>ç™»å½•å¾®åšè´¦å·ï¼Œæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œé€‰æ‹©Networké€‰é¡¹å¡ï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®ã€‚</li><li>åœ¨Networké€‰é¡¹å¡ä¸­ï¼Œæ‰¾åˆ°å¯¹åº”çš„è¯·æ±‚ï¼ŒæŸ¥çœ‹å“åº”å¤´ï¼Œæ‰¾åˆ°Cookieå­—æ®µï¼Œå¤åˆ¶Cookieå€¼ã€‚</li><li>å°†Cookieå€¼æ›¿æ¢ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„Cookieå­—æ®µã€‚</li><li>é‡æ–°è¿è¡Œä»£ç ï¼Œå³å¯è·å–æœ€æ–°æ•°æ®ã€‚</li></ul><hr><h2 id="ä¸‰ã€æ³¨æ„äº‹é¡¹"><a href="#ä¸‰ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸‰ã€æ³¨æ„äº‹é¡¹"></a>ä¸‰ã€æ³¨æ„äº‹é¡¹</h2><ul><li><p><strong>åˆè§„æ€§</strong>ï¼šçˆ¬å–å¾®åšæ•°æ®éœ€éµå®ˆã€Šå¾®åšæœåŠ¡ä½¿ç”¨åè®®ã€‹ï¼Œä¸å¾—ç”¨äºå•†ä¸šç”¨é€”æˆ–æ¶æ„æ”»å‡»ï¼Œå»ºè®®ä»…ç”¨äºä¸ªäººå­¦ä¹ ç ”ç©¶</p></li><li><p><strong>ç™»å½•çŠ¶æ€</strong>ï¼šå°½é‡ä½¿ç”¨å°å·ç™»å½•ï¼Œé¿å…ä¸»å·å› çˆ¬è™«è¡Œä¸ºè¢«é™åˆ¶</p></li><li><p><strong>è¯·æ±‚é¢‘ç‡</strong>ï¼šä¿æŒä½è°ƒï¼Œé¿å…çŸ­æ—¶é—´å†…å‘é€å¤§é‡è¯·æ±‚ï¼Œå‹å¥½å¯¹å¾…æœåŠ¡å™¨</p></li><li><p><strong>æ•°æ®å¤‡ä»½</strong>ï¼šå®šæœŸä¿å­˜çˆ¬å–åˆ°çš„æ•°æ®ï¼Œé˜²æ­¢ç¨‹åºå¼‚å¸¸å¯¼è‡´æ•°æ®ä¸¢å¤±</p></li></ul><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å¯ä»¥æˆåŠŸçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºæ•°æ®ã€‚å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€äº¤æµï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Pythonçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºå®Œæ•´æ•™ç¨‹ï¼ˆåŸºç¡€-å¸¸è§é—®é¢˜ï¼‰&quot;&gt;&lt;a href=&quot;#Pythonçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºå®Œæ•´æ•™ç¨‹ï¼ˆåŸºç¡€-å¸¸è§é—®é¢˜ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;Pythonçˆ¬å–å¾®åšç§»åŠ¨ç«¯è¯„è®ºå®Œæ•´æ•™ç¨‹ï¼ˆåŸºç¡€+å¸¸è§é—®é¢˜ï¼‰&quot;&gt;&lt;/a&gt;Py</summary>
      
    
    
    
    
    <category term="çˆ¬è™«" scheme="https://nmcb666.vip/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºGitHub PagesåŠ è½½é™æ€æ–‡ä»¶å¤±è´¥</title>
    <link href="https://nmcb666.vip/posts/b1168866.html"/>
    <id>https://nmcb666.vip/posts/b1168866.html</id>
    <published>2025-09-17T23:50:28.000Z</published>
    <updated>2026-01-19T13:51:09.832Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è§£å†³Github-Pagesä¸åŠ è½½Vueæ¡†æ¶é¡¹ç›®é™æ€æ–‡ä»¶é—®é¢˜"><a href="#è§£å†³Github-Pagesä¸åŠ è½½Vueæ¡†æ¶é¡¹ç›®é™æ€æ–‡ä»¶é—®é¢˜" class="headerlink" title="è§£å†³Github Pagesä¸åŠ è½½Vueæ¡†æ¶é¡¹ç›®é™æ€æ–‡ä»¶é—®é¢˜"></a>è§£å†³Github Pagesä¸åŠ è½½Vueæ¡†æ¶é¡¹ç›®é™æ€æ–‡ä»¶é—®é¢˜</h1><p>åœ¨ä½¿ç”¨Vueæ¡†æ¶å¼€å‘é¡¹ç›®å¹¶éƒ¨ç½²åˆ°Github Pagesæ—¶ï¼Œå¾ˆå¤šå¼€å‘è€…éƒ½ä¼šé‡åˆ°ä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ï¼šé¡µé¢èƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼Œä½†é¡¹ç›®ä¸­çš„JSã€CSSç­‰é™æ€æ–‡ä»¶å´æ— æ³•åŠ è½½ï¼Œå¯¼è‡´é¡µé¢æ ·å¼é”™ä¹±ã€åŠŸèƒ½å¤±æ•ˆã€‚å…¶å®è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒåœ¨äºé™æ€æ–‡ä»¶çš„è·¯å¾„é…ç½®ä¸å½“ï¼Œæœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡é…ç½®æ‰“åŒ…å·¥å…·çš„è·¯å¾„ä»¥åŠGithub Pagesè®¾ç½®æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¹¶åˆ†åˆ«ä»¥Viteå’ŒWebpackä¸¤ç§å¸¸ç”¨æ‰“åŒ…å·¥å…·è¿›è¡Œæ¼”ç¤ºã€‚</p><h2 id="ä¸€ã€é—®é¢˜åŸå› åˆ†æ"><a href="#ä¸€ã€é—®é¢˜åŸå› åˆ†æ" class="headerlink" title="ä¸€ã€é—®é¢˜åŸå› åˆ†æ"></a>ä¸€ã€é—®é¢˜åŸå› åˆ†æ</h2><p>Github Pageséƒ¨ç½²çš„é¡¹ç›®ï¼Œå…¶è®¿é—®è·¯å¾„é€šå¸¸æ˜¯ <code>https://[ç”¨æˆ·å].github.io/[é¡¹ç›®å]/</code>ï¼Œè€ŒVueé¡¹ç›®é»˜è®¤çš„é™æ€æ–‡ä»¶è·¯å¾„æ˜¯åŸºäºæ ¹ç›®å½•ï¼ˆ<code>/</code>ï¼‰çš„ã€‚å½“é¡¹ç›®éƒ¨ç½²åˆ°Github Pagesåï¼Œé™æ€æ–‡ä»¶ä¼šè¢«è¯·æ±‚ä»æ ¹ç›®å½•è·å–ï¼Œè€Œå®é™…é™æ€æ–‡ä»¶å´åœ¨<code>/[é¡¹ç›®å]/</code>ç›®å½•ä¸‹ï¼Œè¿™å°±å¯¼è‡´äº†è·¯å¾„ä¸åŒ¹é…ï¼Œé™æ€æ–‡ä»¶åŠ è½½å¤±è´¥ã€‚</p><h2 id="äºŒã€ä¸åŒæ‰“åŒ…å·¥å…·çš„é…ç½®æ–¹æ³•"><a href="#äºŒã€ä¸åŒæ‰“åŒ…å·¥å…·çš„é…ç½®æ–¹æ³•" class="headerlink" title="äºŒã€ä¸åŒæ‰“åŒ…å·¥å…·çš„é…ç½®æ–¹æ³•"></a>äºŒã€ä¸åŒæ‰“åŒ…å·¥å…·çš„é…ç½®æ–¹æ³•</h2><div class="note primary modern"><p>è§£å†³è¯¥é—®é¢˜çš„å…³é”®æ˜¯ä¿®æ”¹æ‰“åŒ…å·¥å…·çš„é™æ€æ–‡ä»¶å…¬å…±è·¯å¾„ï¼ˆpublicPathï¼‰ï¼Œä½¿å…¶æŒ‡å‘Github Pagesçš„é¡¹ç›®åœ°å€ã€‚</p></div><div class="tip success"><p>å¦‚æœä½ ä¸æƒ³æ‰“åŒ…ï¼Œç›´æ¥åœ¨æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªindex.htmlé™æ€ç½‘é¡µæ–‡ä»¶ã€‚é‚£ä¹ˆå°†é‡Œé¢js,cssç­‰é™æ€æ–‡ä»¶çš„å¼•ç”¨è·¯å¾„å‰é¢åŠ ä¸Š<code>/[é¡¹ç›®å]/</code>å³å¯ã€‚ä¾‹å¦‚ï¼š/static/js/app.js â€”&gt; /[é¡¹ç›®å]/static/js/app.js å¦‚æœæˆåŠŸåˆ™æ— éœ€æ‰“åŒ…</p></div><p>ä¸‹é¢åˆ†åˆ«ä»‹ç»Viteå’ŒWebpackçš„é…ç½®æ­¥éª¤ã€‚</p><h3 id="2-1-Viteæ‰“åŒ…å·¥å…·é…ç½®"><a href="#2-1-Viteæ‰“åŒ…å·¥å…·é…ç½®" class="headerlink" title="2.1 Viteæ‰“åŒ…å·¥å…·é…ç½®"></a>2.1 Viteæ‰“åŒ…å·¥å…·é…ç½®</h3><p>Viteæ˜¯ç›®å‰Vueé¡¹ç›®å¸¸ç”¨çš„æ„å»ºå·¥å…·ï¼Œé…ç½®æ–¹å¼è¾ƒä¸ºç®€æ´ï¼Œåªéœ€ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<code>vite.config.js</code>æ–‡ä»¶ã€‚</p><ol><li><p><strong>æ‰¾åˆ°vite.config.jsæ–‡ä»¶</strong>ï¼šè¯¥æ–‡ä»¶ä½äºVueé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‰‹åŠ¨åˆ›å»ºã€‚</p></li><li><p><strong>é…ç½®publicPath</strong>ï¼šåœ¨<code>defineConfig</code>å¯¹è±¡ä¸­æ·»åŠ <code>base</code>å±æ€§ï¼ˆViteä¸­publicPathå¯¹åº”çš„æ˜¯baseï¼‰ï¼Œå…¶å€¼è®¾ç½®ä¸ºä½ çš„Github Pagesé¡¹ç›®åœ°å€ã€‚æ ¼å¼ä¸º <code>&#39;https://[ç”¨æˆ·å].github.io/[é¡¹ç›®å]/&#39;</code>ï¼Œä¾‹å¦‚å¦‚æœç”¨æˆ·åä¸º<code>testuser</code>ï¼Œé¡¹ç›®åä¸º<code>vue-demo</code>ï¼Œåˆ™é…ç½®ä¸º <code>base: &#39;https://testuser.github.io/vue-demo/&#39;</code>ã€‚</p></li><li><p><strong>è®¾ç½®æ‰“åŒ…è¾“å‡ºç›®å½•</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹Viteæ‰“åŒ…è¾“å‡ºåˆ°<code>dist</code>ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ”¹ä¸º<code>docs</code>ç›®å½•ï¼Œæ–¹ä¾¿åç»­Github Pagesé…ç½®ã€‚åœ¨<code>defineConfig</code>ä¸­æ·»åŠ <code>build</code>é€‰é¡¹ï¼Œè®¾ç½®<code>outDir: &#39;docs&#39;</code>ã€‚</p></li></ol><p>é…ç½®å®Œæˆåçš„<code>vite.config.js</code>æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="attr">base</span>: <span class="string">&#x27;https://testuser.github.io/vue-demo/&#x27;</span>, <span class="comment">// æ›¿æ¢ä¸ºä½ çš„é¡¹ç›®åœ°å€</span></span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&#x27;docs&#x27;</span> <span class="comment">// æ‰“åŒ…è¾“å‡ºåˆ°docsç›®å½•</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>baseè·¯å¾„ä¸å”¯ä¸€ å¯è‡ªè¡Œåœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æŸ¥çœ‹è¯·æ±‚è·¯å¾„  å°†è¯·æ±‚è·¯å¾„è°ƒæ•´ä¸º https://&lt;ä½ çš„åç§°&gt;.github.io/&lt;é¡¹ç›®åç§°&gt;/é™æ€æ–‡ä»¶è·¯å¾„ã€‚å³å¯<br>é…ç½®å®Œæˆåï¼Œæ‰§è¡Œ<code>npm run build</code>å‘½ä»¤è¿›è¡Œæ‰“åŒ…ï¼Œæ­¤æ—¶é¡¹ç›®æ ¹ç›®å½•ä¸‹ä¼šç”Ÿæˆ<code>docs</code>æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«äº†æ‰“åŒ…åçš„é™æ€æ–‡ä»¶ã€‚</p><h3 id="2-2-Webpackæ‰“åŒ…å·¥å…·é…ç½®ï¼ˆVue-CLIé¡¹ç›®ï¼‰"><a href="#2-2-Webpackæ‰“åŒ…å·¥å…·é…ç½®ï¼ˆVue-CLIé¡¹ç›®ï¼‰" class="headerlink" title="2.2 Webpackæ‰“åŒ…å·¥å…·é…ç½®ï¼ˆVue CLIé¡¹ç›®ï¼‰"></a>2.2 Webpackæ‰“åŒ…å·¥å…·é…ç½®ï¼ˆVue CLIé¡¹ç›®ï¼‰</h3><p>å¦‚æœä½ çš„Vueé¡¹ç›®æ˜¯ä½¿ç”¨Vue CLIåˆ›å»ºçš„ï¼Œé‚£ä¹ˆä½¿ç”¨çš„æ‰“åŒ…å·¥å…·æ˜¯Webpackï¼Œéœ€è¦ä¿®æ”¹<code>vue.config.js</code>æ–‡ä»¶ã€‚</p><ol><li><p><strong>æ‰¾åˆ°vue.config.jsæ–‡ä»¶</strong>ï¼šè¯¥æ–‡ä»¶ä½äºVueé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ‰‹åŠ¨åˆ›å»ºã€‚</p></li><li><p><strong>é…ç½®publicPath</strong>ï¼šåœ¨é…ç½®å¯¹è±¡ä¸­æ·»åŠ <code>publicPath</code>å±æ€§ï¼Œå€¼è®¾ç½®ä¸ºä½ çš„Github Pagesé¡¹ç›®åœ°å€ï¼Œæ ¼å¼ä¸Viteç›¸åŒï¼Œå³ <code>&#39;https://[ç”¨æˆ·å].github.io/[é¡¹ç›®å]/&#39;</code>ã€‚</p></li><li><p><strong>è®¾ç½®æ‰“åŒ…è¾“å‡ºç›®å½•</strong>ï¼šåŒæ ·å°†æ‰“åŒ…è¾“å‡ºç›®å½•æ”¹ä¸º<code>docs</code>ï¼Œåœ¨é…ç½®å¯¹è±¡ä¸­æ·»åŠ <code>outputDir: &#39;docs&#39;</code>ã€‚</p></li></ol><p>é…ç½®å®Œæˆåçš„<code>vue.config.js</code>æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;https://testuser.github.io/vue-demo/&#x27;</span>, <span class="comment">// æ›¿æ¢ä¸ºä½ çš„é¡¹ç›®åœ°å€</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&#x27;docs&#x27;</span> <span class="comment">// æ‰“åŒ…è¾“å‡ºåˆ°docsç›®å½•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>npm run build</code>å‘½ä»¤æ‰“åŒ…ï¼Œé¡¹ç›®æ ¹ç›®å½•ä¼šç”Ÿæˆ<code>docs</code>æ–‡ä»¶å¤¹ï¼ŒåŒ…å«æ‰“åŒ…åçš„é™æ€èµ„æºã€‚</p><h2 id="ä¸‰ã€Github-Pagesé…ç½®æ­¥éª¤"><a href="#ä¸‰ã€Github-Pagesé…ç½®æ­¥éª¤" class="headerlink" title="ä¸‰ã€Github Pagesé…ç½®æ­¥éª¤"></a>ä¸‰ã€Github Pagesé…ç½®æ­¥éª¤</h2><p>å®Œæˆæ‰“åŒ…å·¥å…·é…ç½®å¹¶ç”Ÿæˆ<code>docs</code>æ–‡ä»¶å¤¹åï¼Œéœ€è¦åœ¨Githubä»“åº“ä¸­è®¾ç½®Github Pagesçš„éƒ¨ç½²æºã€‚</p><ol><li><p><strong>æ¨é€ä»£ç åˆ°Githubä»“åº“</strong>ï¼šå°†åŒ…å«<code>docs</code>æ–‡ä»¶å¤¹çš„é¡¹ç›®ä»£ç æ¨é€åˆ°Githubä»“åº“çš„<code>main</code>åˆ†æ”¯ï¼ˆæˆ–ä½ ä½¿ç”¨çš„ä¸»åˆ†æ”¯ï¼‰ã€‚</p></li><li><p><strong>è¿›å…¥ä»“åº“è®¾ç½®</strong>ï¼šæ‰“å¼€ä½ çš„Githubé¡¹ç›®ä»“åº“ï¼Œç‚¹å‡»å³ä¸Šè§’çš„<code>Settings</code>é€‰é¡¹ã€‚</p></li><li><p><strong>æ‰¾åˆ°Github Pagesè®¾ç½®</strong>ï¼šåœ¨å·¦ä¾§å¯¼èˆªæ ä¸­æ‰¾åˆ°<code>Pages</code>é€‰é¡¹å¹¶ç‚¹å‡»è¿›å…¥ã€‚</p></li><li><p><strong>è®¾ç½®éƒ¨ç½²æº</strong>ï¼šåœ¨<code>Build and deployment</code>ä¸‹çš„<code>Source</code>é€‰é¡¹ä¸­ï¼Œé€‰æ‹©<code>Deploy from a branch</code>ã€‚ç„¶ååœ¨<code>Branch</code>é€‰é¡¹ä¸­ï¼Œé€‰æ‹©<code>main</code>åˆ†æ”¯ï¼Œå¹¶åœ¨åé¢çš„æ–‡ä»¶å¤¹é€‰æ‹©æ¡†ä¸­é€‰æ‹©<code>/docs</code>ï¼Œç‚¹å‡»<code>Save</code>ä¿å­˜è®¾ç½®ã€‚</p></li></ol><p>è®¾ç½®å®Œæˆåï¼ŒGithub Pagesä¼šè‡ªåŠ¨éƒ¨ç½²ä½ çš„é¡¹ç›®ï¼Œé€šå¸¸å‡ åˆ†é’Ÿåå³å¯é€šè¿‡<code>https://[ç”¨æˆ·å].github.io/[é¡¹ç›®å]/</code>è®¿é—®ï¼Œæ­¤æ—¶JSã€CSSç­‰é™æ€æ–‡ä»¶å°±èƒ½æ­£å¸¸åŠ è½½äº†ã€‚</p><h2 id="å››ã€å¸¸è§é—®é¢˜æ’æŸ¥"><a href="#å››ã€å¸¸è§é—®é¢˜æ’æŸ¥" class="headerlink" title="å››ã€å¸¸è§é—®é¢˜æ’æŸ¥"></a>å››ã€å¸¸è§é—®é¢˜æ’æŸ¥</h2><ul><li><p><strong>publicPathé…ç½®é”™è¯¯</strong>ï¼šç¡®ä¿publicPathï¼ˆViteä¸­ä¸ºbaseï¼‰çš„è·¯å¾„æ­£ç¡®ï¼Œæœ«å°¾å¿…é¡»åŠ ä¸Š<code>/</code>ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´éƒ¨åˆ†é™æ€æ–‡ä»¶è·¯å¾„æ‹¼æ¥é”™è¯¯ã€‚</p></li><li><p><strong>docsæ–‡ä»¶å¤¹æœªæ¨é€</strong>ï¼šæ£€æŸ¥æ˜¯å¦å°†æ‰“åŒ…ç”Ÿæˆçš„<code>docs</code>æ–‡ä»¶å¤¹æ¨é€åˆ°äº†Githubä»“åº“ï¼Œè‹¥æœªæ¨é€åˆ™éœ€è¦æ‰§è¡Œ<code>git add docs</code>ã€<code>git commit -m &quot;add docs&quot;</code>ã€<code>git push</code>å‘½ä»¤ã€‚</p></li><li><p><strong>åˆ†æ”¯æˆ–æ–‡ä»¶å¤¹é€‰æ‹©é”™è¯¯</strong>ï¼šç¡®è®¤Github Pagesè®¾ç½®ä¸­é€‰æ‹©çš„åˆ†æ”¯æ˜¯<code>main</code>ï¼ˆæˆ–ä½ çš„é¡¹ç›®ä¸»åˆ†æ”¯ï¼‰ï¼Œæ–‡ä»¶å¤¹æ˜¯<code>/docs</code>ã€‚</p></li></ul><h2 id="äº”ã€"><a href="#äº”ã€" class="headerlink" title="äº”ã€"></a>äº”ã€<wavy>é¢å¤–æ³¨æ„</wavy></h2><div class="tip warning faa-horizontal animated-hover"><p>github pages é»˜è®¤æ˜¯ä½¿ç”¨jekyllä½œä¸ºé™æ€æ–‡ä»¶å¤„ç†å¼•æ“ï¼Œè¿™ä¸ªä¼šé»˜è®¤åˆ é™¤é™æ€æ–‡ä»¶åçš„ä¸‹åˆ’çº¿_å¯¼è‡´é™æ€æ–‡ä»¶æ— æ³•åŠ è½½ã€‚</p></div><p>è§£å†³æ–¹æ³•ï¼šå³åœ¨è·Ÿç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º.nojekyllçš„æ–‡ä»¶å³å¯å–æ¶ˆjekyll<br>å…³äºjekyllçš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒï¼š<a href="https://jekyllcn.com/docs/home/">https://jekyllcn.com/docs/home/</a></p><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå°±èƒ½é¡ºåˆ©è§£å†³Github Pagesä¸åŠ è½½Vueé¡¹ç›®é™æ€æ–‡ä»¶çš„é—®é¢˜ã€‚æ ¸å¿ƒåœ¨äºæ­£ç¡®é…ç½®æ‰“åŒ…å·¥å…·çš„publicPathè·¯å¾„ï¼Œå¹¶å°†æ‰“åŒ…æ–‡ä»¶è¾“å‡ºåˆ°docsç›®å½•ï¼Œå†é…åˆGithub Pagesçš„éƒ¨ç½²æºè®¾ç½®ï¼Œå³å¯å®ç°é¡¹ç›®çš„æ­£å¸¸è®¿é—®ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;è§£å†³Github-Pagesä¸åŠ è½½Vueæ¡†æ¶é¡¹ç›®é™æ€æ–‡ä»¶é—®é¢˜&quot;&gt;&lt;a href=&quot;#è§£å†³Github-Pagesä¸åŠ è½½Vueæ¡†æ¶é¡¹ç›®é™æ€æ–‡ä»¶é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;è§£å†³Github Pagesä¸åŠ è½½Vueæ¡†æ¶é¡¹ç›®é™æ€æ–‡ä»¶é—®é¢˜&quot;&gt;</summary>
      
    
    
    
    
    <category term="hexo" scheme="https://nmcb666.vip/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>è®¡ç®—æœºä¸æ•°å­¦çš„é‚£äº›äº‹</title>
    <link href="https://nmcb666.vip/posts/f8b7ba6f.html"/>
    <id>https://nmcb666.vip/posts/f8b7ba6f.html</id>
    <published>2025-09-16T14:12:43.000Z</published>
    <updated>2026-01-19T13:51:09.833Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ"><a href="#å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ" class="headerlink" title="å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ"></a>å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ</h1><p>â€œæˆ‘æ•°å­¦ä¸å¥½ï¼Œæ˜¯ä¸æ˜¯å­¦ä¸äº†è®¡ç®—æœºï¼Ÿâ€è¿™æ˜¯å¾ˆå¤šæƒ³å…¥è¡Œè®¡ç®—æœºé¢†åŸŸçš„äººéƒ½ä¼šé—®çš„é—®é¢˜ã€‚å…¶å®è¿™ä¸ªé—®é¢˜æ²¡æœ‰ç»å¯¹çš„ç­”æ¡ˆï¼Œæ ¸å¿ƒåœ¨äºä½ æƒ³ä»äº‹è®¡ç®—æœºé¢†åŸŸçš„å“ªä¸ªå²—ä½ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œ<strong>æ™®é€šå¼€å‘å²—å¯¹æ•°å­¦åŠŸåº•çš„è¦æ±‚å¹¶ä¸é«˜ï¼Œè€Œç®—æ³•å²—å’Œäººå·¥æ™ºèƒ½å²—åˆ™éœ€è¦æ‰å®ä¸”ç”šè‡³é«˜äºè®¡ç®—æœºçŸ¥è¯†æœ¬èº«çš„æ•°å­¦åŸºç¡€</strong>ã€‚ä»Šå¤©å°±æ¥è¯¦ç»†èŠèŠä¸åŒå²—ä½å¯¹æ•°å­¦çš„çœŸå®éœ€æ±‚ï¼Œå¸®å¤§å®¶æ¶ˆé™¤è®¤çŸ¥è¯¯åŒºã€‚</p><h2 id="ä¸€ã€æ™®é€šå¼€å‘å²—ï¼šæ•°å­¦æ˜¯â€œåŠ åˆ†é¡¹â€è€Œéâ€œå¿…éœ€å“â€"><a href="#ä¸€ã€æ™®é€šå¼€å‘å²—ï¼šæ•°å­¦æ˜¯â€œåŠ åˆ†é¡¹â€è€Œéâ€œå¿…éœ€å“â€" class="headerlink" title="ä¸€ã€æ™®é€šå¼€å‘å²—ï¼šæ•°å­¦æ˜¯â€œåŠ åˆ†é¡¹â€è€Œéâ€œå¿…éœ€å“â€"></a>ä¸€ã€æ™®é€šå¼€å‘å²—ï¼šæ•°å­¦æ˜¯â€œåŠ åˆ†é¡¹â€è€Œéâ€œå¿…éœ€å“â€</h2><p>æ™®é€šå¼€å‘å²—æ¶µç›–çš„èŒƒå›´å¾ˆå¹¿ï¼Œæ¯”å¦‚å‰ç«¯å¼€å‘ã€åç«¯å¼€å‘ã€ç§»åŠ¨ç«¯å¼€å‘ã€å…¨æ ˆå¼€å‘ç­‰ï¼Œè¿™äº›å²—ä½çš„æ ¸å¿ƒæ˜¯â€œå®ç°ä¸šåŠ¡éœ€æ±‚â€ï¼Œæ›´çœ‹é‡çš„æ˜¯ç¼–ç¨‹èƒ½åŠ›ã€é€»è¾‘æ€ç»´å’Œä¸šåŠ¡ç†è§£èƒ½åŠ›ï¼Œå¯¹æ•°å­¦çš„è¦æ±‚è¿œæ²¡æœ‰å¤§å®¶æƒ³è±¡ä¸­é‚£ä¹ˆé«˜ã€‚</p><p>ä»¥å‰ç«¯å¼€å‘ä¸ºä¾‹ï¼Œæ—¥å¸¸å·¥ä½œä¸»è¦æ˜¯ç”¨HTMLã€CSSã€JavaScriptæ„å»ºç”¨æˆ·ç•Œé¢ï¼Œå®ç°é¡µé¢äº¤äº’æ•ˆæœã€‚å³ä½¿æ˜¯ç”¨åˆ°Reactã€Vueç­‰æ¡†æ¶ï¼Œæ ¸å¿ƒä¹Ÿæ˜¯ç»„ä»¶åŒ–æ€æƒ³å’ŒçŠ¶æ€ç®¡ç†ï¼Œæ¶‰åŠåˆ°çš„æ•°å­¦çŸ¥è¯†å¯èƒ½æœ€å¤šå°±æ˜¯ç®€å•çš„å¸ƒå±€è®¡ç®—ï¼ˆæ¯”å¦‚ç”¨Flexæˆ–Gridå¸ƒå±€æ—¶çš„ç™¾åˆ†æ¯”ã€åƒç´ æ¢ç®—ï¼‰ï¼Œè¿åˆä¸­æ•°å­¦çŸ¥è¯†éƒ½èƒ½åº”å¯¹ã€‚åç«¯å¼€å‘è™½ç„¶ä¼šæ¥è§¦åˆ°æ•°æ®åº“ã€æœåŠ¡å™¨ç­‰ï¼Œä½†æ›´å¤šæ˜¯æŒæ¡ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚Javaã€Pythonã€Goï¼‰ã€æ¡†æ¶ï¼ˆå¦‚Springã€Djangoï¼‰å’Œæ•°æ®åº“ä¼˜åŒ–æŠ€å·§ï¼Œæ•°å­¦çŸ¥è¯†çš„åº”ç”¨åœºæ™¯å°‘ä¹‹åˆå°‘ã€‚</p><p>æˆ‘èº«è¾¹æœ‰ä¸å°‘åšæ™®é€šå¼€å‘çš„å­¦é•¿ï¼Œå¤§å­¦æ—¶æ•°å­¦æˆç»©å¹¶ä¸çªå‡ºï¼Œä½†å‡­å€Ÿæ‰å®çš„ç¼–ç¨‹åŸºç¡€å’Œä¸æ–­ç§¯ç´¯çš„ä¸šåŠ¡ç»éªŒï¼Œç…§æ ·èƒ½æˆä¸ºå›¢é˜Ÿé‡Œçš„éª¨å¹²ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯è¯´æ•°å­¦å¯¹æ™®é€šå¼€å‘å²—æ¯«æ— ç”¨å¤„â€”â€”å¦‚æœæ‡‚ä¸€ç‚¹ç¦»æ•£æ•°å­¦ï¼Œåœ¨ç†è§£æ•°æ®ç»“æ„ï¼ˆå¦‚æ ‘ã€å›¾ï¼‰æ—¶ä¼šæ›´è½»æ¾ï¼›å¦‚æœæ‡‚ä¸€ç‚¹çº¿æ€§ä»£æ•°ï¼Œåœ¨å¤„ç†å›¾å½¢ç›¸å…³çš„å¼€å‘ä»»åŠ¡æ—¶å¯èƒ½ä¼šæ›´å¾—å¿ƒåº”æ‰‹ã€‚ä½†è¿™äº›éƒ½å±äºâ€œåŠ åˆ†é¡¹â€ï¼Œè€Œéâ€œå…¥é—¨å¿…å¤‡é¡¹â€ï¼Œä¸ä¼šæˆä¸ºé˜»ç¢ä½ å…¥è¡Œå’Œå‘å±•çš„ç»Šè„šçŸ³ã€‚</p><h2 id="äºŒã€ç®—æ³•å²—-amp-äººå·¥æ™ºèƒ½å²—ï¼šæ•°å­¦æ˜¯â€œåŸºçŸ³â€ï¼Œç”šè‡³æ¯”è®¡ç®—æœºçŸ¥è¯†æ›´é‡è¦"><a href="#äºŒã€ç®—æ³•å²—-amp-äººå·¥æ™ºèƒ½å²—ï¼šæ•°å­¦æ˜¯â€œåŸºçŸ³â€ï¼Œç”šè‡³æ¯”è®¡ç®—æœºçŸ¥è¯†æ›´é‡è¦" class="headerlink" title="äºŒã€ç®—æ³•å²—&amp;äººå·¥æ™ºèƒ½å²—ï¼šæ•°å­¦æ˜¯â€œåŸºçŸ³â€ï¼Œç”šè‡³æ¯”è®¡ç®—æœºçŸ¥è¯†æ›´é‡è¦"></a>äºŒã€ç®—æ³•å²—&amp;äººå·¥æ™ºèƒ½å²—ï¼šæ•°å­¦æ˜¯â€œåŸºçŸ³â€ï¼Œç”šè‡³æ¯”è®¡ç®—æœºçŸ¥è¯†æ›´é‡è¦</h2><p>ä¸æ™®é€šå¼€å‘å²—ä¸åŒï¼Œç®—æ³•å²—ï¼ˆå¦‚æœºå™¨å­¦ä¹ ç®—æ³•å·¥ç¨‹å¸ˆã€æ¨èç®—æ³•å·¥ç¨‹å¸ˆï¼‰å’Œäººå·¥æ™ºèƒ½å²—ï¼ˆå¦‚AIç ”ç©¶å‘˜ã€æ·±åº¦å­¦ä¹ å·¥ç¨‹å¸ˆï¼‰å¯¹æ•°å­¦çš„è¦æ±‚æé«˜ï¼Œæ•°å­¦çŸ¥è¯†æ˜¯å¼€å±•å·¥ä½œçš„æ ¸å¿ƒåŸºç¡€ï¼Œç”šè‡³åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ¯”å•çº¯çš„è®¡ç®—æœºçŸ¥è¯†æ›´é‡è¦ã€‚</p><p>è¿™äº›å²—ä½çš„å·¥ä½œæœ¬è´¨æ˜¯â€œè§£å†³å¤æ‚é—®é¢˜â€ï¼Œéœ€è¦é€šè¿‡æ•°å­¦æ¨¡å‹æ¥æŠ½è±¡ç°å®é—®é¢˜ï¼Œå¹¶è®¾è®¡é«˜æ•ˆçš„ç®—æ³•æ¥æ±‚è§£ã€‚è¿™å°±è¦æ±‚ä»ä¸šè€…å¿…é¡»æŒæ¡å¤šé—¨é«˜ç­‰æ•°å­¦çŸ¥è¯†ï¼š</p><ul><li><p><strong>çº¿æ€§ä»£æ•°</strong>ï¼šæ˜¯æœºå™¨å­¦ä¹ çš„åŸºç¡€ï¼Œæ¯”å¦‚æ•°æ®çš„è¡¨ç¤ºï¼ˆå‘é‡ã€çŸ©é˜µï¼‰ã€ç‰¹å¾å˜æ¢ï¼ˆçŸ©é˜µä¹˜æ³•ã€ç‰¹å¾å€¼åˆ†è§£ï¼‰ã€é™ç»´ç®—æ³•ï¼ˆPCAï¼‰ç­‰ï¼Œéƒ½ç¦»ä¸å¼€çº¿æ€§ä»£æ•°çš„çŸ¥è¯†ã€‚å¦‚æœä¸æ‡‚çŸ©é˜µè¿ç®—ï¼Œè¿æœ€ç®€å•çš„ç¥ç»ç½‘ç»œå‰å‘ä¼ æ’­éƒ½æ— æ³•ç†è§£ã€‚</p></li><li><p><strong>æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡</strong>ï¼šåœ¨å¤„ç†ä¸ç¡®å®šæ€§é—®é¢˜æ—¶è‡³å…³é‡è¦ï¼Œæ¯”å¦‚è´å¶æ–¯åˆ†ç±»å™¨ã€æ¦‚ç‡æ¨¡å‹ï¼ˆå¦‚éšé©¬å°”å¯å¤«æ¨¡å‹ï¼‰ã€æ¨¡å‹è¯„ä¼°æŒ‡æ ‡ï¼ˆå‡†ç¡®ç‡ã€å¬å›ç‡ã€ROCæ›²çº¿ï¼‰ç­‰ï¼Œéƒ½éœ€è¦æ¦‚ç‡è®ºå’Œç»Ÿè®¡å­¦çš„æ”¯æ’‘ã€‚</p></li><li><p><strong>å¾®ç§¯åˆ†</strong>ï¼šä¸»è¦ç”¨äºä¼˜åŒ–ç®—æ³•ï¼Œæ¯”å¦‚æœºå™¨å­¦ä¹ ä¸­çš„æ¢¯åº¦ä¸‹é™æ³•ï¼Œå°±æ˜¯é€šè¿‡æ±‚å¯¼æ¥æ‰¾åˆ°å‡½æ•°çš„æœ€å°å€¼ç‚¹ï¼Œä»è€Œæ›´æ–°æ¨¡å‹å‚æ•°ã€‚å¦‚æœä¸æ‡‚å¯¼æ•°ã€åå¯¼æ•°ï¼Œå°±æ— æ³•ç†è§£ä¼˜åŒ–ç®—æ³•çš„åŸç†ï¼Œæ›´è°ˆä¸ä¸Šè°ƒä¼˜æ¨¡å‹ã€‚</p></li><li><p><strong>ç¦»æ•£æ•°å­¦</strong>ï¼šåœ¨å›¾ç®—æ³•ã€ç»„åˆä¼˜åŒ–ç­‰é¢†åŸŸåº”ç”¨å¹¿æ³›ï¼Œæ¯”å¦‚æœ€çŸ­è·¯å¾„ç®—æ³•ï¼ˆDijkstraã€Floydï¼‰ã€å›¾ç¥ç»ç½‘ç»œï¼ˆGNNï¼‰ç­‰ï¼Œéƒ½éœ€è¦ç¦»æ•£æ•°å­¦çš„çŸ¥è¯†ä½œä¸ºé“ºå«ã€‚</p></li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æƒ³åšæ·±åº¦å­¦ä¹ å·¥ç¨‹å¸ˆï¼Œæ­å»ºä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹å¯èƒ½ç”¨TensorFlowæˆ–PyTorchå‡ è¡Œä»£ç å°±èƒ½å®ç°ï¼Œä½†è¦æƒ³è®©æ¨¡å‹è¾¾åˆ°æ›´å¥½çš„æ•ˆæœâ€”â€”æ¯”å¦‚è°ƒæ•´ç½‘ç»œç»“æ„ã€ä¼˜åŒ–æŸå¤±å‡½æ•°ã€è§£å†³è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œå°±å¿…é¡»æ·±å…¥ç†è§£æ¨¡å‹èƒŒåçš„æ•°å­¦åŸç†ã€‚å¦‚æœæ•°å­¦åŸºç¡€è–„å¼±ï¼Œåªèƒ½åœç•™åœ¨â€œè°ƒå‚å·¥ç¨‹å¸ˆâ€çš„å±‚é¢ï¼Œæ— æ³•çœŸæ­£æˆä¸ºä¸€åä¼˜ç§€çš„ç®—æ³•æˆ–AIå·¥ç¨‹å¸ˆã€‚å¾ˆå¤šé¡¶å°–çš„AIç ”ç©¶å‘˜ï¼Œæœ¬èº«å°±æ˜¯æ•°å­¦ä¸“ä¸šå‡ºèº«ï¼Œå¯è§æ•°å­¦åœ¨è¿™ä¸ªé¢†åŸŸçš„é‡è¦æ€§ã€‚</p><h2 id="ä¸‰ã€æ€»ç»“ï¼šæ ¹æ®ç›®æ ‡å²—ä½ï¼Œåˆç†è§„åˆ’æ•°å­¦å­¦ä¹ "><a href="#ä¸‰ã€æ€»ç»“ï¼šæ ¹æ®ç›®æ ‡å²—ä½ï¼Œåˆç†è§„åˆ’æ•°å­¦å­¦ä¹ " class="headerlink" title="ä¸‰ã€æ€»ç»“ï¼šæ ¹æ®ç›®æ ‡å²—ä½ï¼Œåˆç†è§„åˆ’æ•°å­¦å­¦ä¹ "></a>ä¸‰ã€æ€»ç»“ï¼šæ ¹æ®ç›®æ ‡å²—ä½ï¼Œåˆç†è§„åˆ’æ•°å­¦å­¦ä¹ </h2><p>å›åˆ°æœ€åˆçš„é—®é¢˜â€œå­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿâ€ï¼Œç­”æ¡ˆå·²ç»å¾ˆæ¸…æ™°äº†ï¼š</p><div class="tip warning faa-horizontal animated"><p>å¦‚æœä½ ç›®æ ‡æ˜¯æ™®é€šå¼€å‘å²—ï¼Œä¸ç”¨å› ä¸ºæ•°å­¦ä¸å¥½è€Œç„¦è™‘ï¼Œé‡ç‚¹æ”¾åœ¨æå‡ç¼–ç¨‹èƒ½åŠ›å’Œé€»è¾‘æ€ç»´ä¸Šï¼Œæ•°å­¦å¯ä»¥ä½œä¸ºåç»­æå‡çš„è¡¥å……ï¼›å¦‚æœä½ ç›®æ ‡æ˜¯ç®—æ³•å²—æˆ–äººå·¥æ™ºèƒ½å²—ï¼Œé‚£ä¹ˆä¸€å®šè¦æ‰“å¥½æ•°å­¦åŸºç¡€ï¼ŒæŠŠçº¿æ€§ä»£æ•°ã€æ¦‚ç‡è®ºã€å¾®ç§¯åˆ†ç­‰æ ¸å¿ƒçŸ¥è¯†å­¦æ‰å®ï¼Œè¿™æ¯”å•çº¯æŒæ¡ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶æ›´é‡è¦ã€‚</p></div><p>è®¡ç®—æœºé¢†åŸŸåšå¤§ç²¾æ·±ï¼Œä¸åŒå²—ä½çš„éœ€æ±‚å·®å¼‚å¾ˆå¤§ã€‚å…³é”®æ˜¯æ˜ç¡®è‡ªå·±çš„èŒä¸šæ–¹å‘ï¼Œç„¶åæœ‰é’ˆå¯¹æ€§åœ°å­¦ä¹ ã€‚ä¸è¦è¢«â€œæ•°å­¦ä¸å¥½å°±ä¸èƒ½å­¦è®¡ç®—æœºâ€çš„è¯¯åŒºå“ä½ï¼Œä¹Ÿä¸è¦å¿½è§†ç®—æ³•å’ŒAIå²—å¯¹æ•°å­¦çš„é«˜è¦æ±‚ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®å¤§å®¶æ›´æ¸…æ™°åœ°è®¤è¯†è®¡ç®—æœºä¸æ•°å­¦çš„å…³ç³»ï¼Œç¥å¤§å®¶åœ¨è®¡ç®—æœºçš„é“è·¯ä¸Šèµ°å¾—æ›´è¿œï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ&quot;&gt;&lt;a href=&quot;#å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ&quot; class=&quot;headerlink&quot; title=&quot;å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ&quot;&gt;&lt;/a&gt;å­¦è®¡ç®—æœºä¸€å®šè¦æ•°å­¦å¥½å—ï¼Ÿä¸åŒå²—ä½éœ€æ±‚å¤§ä¸åŒ&lt;/</summary>
      
    
    
    
    
    <category term="è®¡ç®—æœºæ‚è°ˆ" scheme="https://nmcb666.vip/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
</feed>
