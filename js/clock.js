const DEBUG_MODE=!1;function debugLog(...e){false}function clockUpdateTime(e,c){debugLog("🔍 [调试] clockUpdateTime函数被调用"),debugLog("🔍 [调试] 传入的城市参数:",c),debugLog("🔍 [调试] 传入的天气数据:",e),debugLog("🔍 [调试] 最终显示的城市名称:",c),debugLog("🔍 [调试] 温度:",e.now.temp,"°C"),debugLog("🔍 [调试] 天气状况:",e.now.text);let a="#000";switch(e.now.icon){case"100":a="#fdcc45";break;case"101":a="#fe6976";break;case"102":case"103":a="#fe7f5b";break;case"104":case"150":case"151":case"152":case"153":case"154":case"800":case"801":case"802":case"803":case"804":case"805":case"806":case"807":a="#2152d1";break;case"300":case"301":case"305":case"306":case"307":case"308":case"309":case"310":case"311":case"312":case"313":case"314":case"315":case"316":case"317":case"318":case"350":case"351":case"399":a="#49b1f5";break;case"302":case"303":case"304":a="#fdcc46";break;case"400":case"401":case"402":case"403":case"404":case"405":case"406":case"407":case"408":case"409":case"410":case"456":case"457":case"499":a="#a3c2dc";break;case"500":case"501":case"502":case"503":case"504":case"507":case"508":case"509":case"510":case"511":case"512":case"513":case"514":case"515":a="#97acba";break;case"900":case"999":a="red";break;case"901":a="#179fff;"}var t=document.getElementById("hexo_electric_clock");clock_box_html=`\n  <div class="clock-row">\n    <span id="card-clock-clockdate" class="card-clock-clockdate"></span>\n    <span class="card-clock-weather"><i class="qi-${e.now.icon}-fill" style="color: ${a}"></i> ${e.now.text} <span>${e.now.temp}</span> ℃</span>\n    <span class="card-clock-humidity">💧 ${e.now.humidity}%</span>\n  </div>\n  <div class="clock-row">\n    <span id="card-clock-time" class="card-clock-time"></span>\n  </div>\n  <div class="clock-row">\n    <span class="card-clock-windDir"> <i class="qi-gale"></i> ${e.now.windDir}</span>\n    <span class="card-clock-location">${c}</span>\n    <span id="card-clock-dackorlight" class="card-clock-dackorlight"></span>\n  </div>\n  `;var o=["SUN","MON","TUE","WED","THU","FRI","SAT"],n=document.getElementById("card-clock-loading");function r(){var e,c=new Date,a=g(c.getHours(),2)+":"+g(c.getMinutes(),2)+":"+g(c.getSeconds(),2),t=g(c.getFullYear(),4)+"-"+g(c.getMonth()+1,2)+"-"+g(c.getDate(),2)+" "+o[c.getDay()],n=c.getHours();if(n>12?(n-=12,e=" P M"):e=" A M",document.getElementById("card-clock-time")){var r=document.getElementById("card-clock-time"),s=document.getElementById("card-clock-clockdate"),l=document.getElementById("card-clock-dackorlight");r.innerHTML=a,s.innerHTML=t,l.innerHTML=e}}function g(e,c){for(var a="",t=0;t<c;t++)a+="0";return(a+e).slice(-c)}n&&(n.innerHTML=""),t.innerHTML=clock_box_html;setInterval(r,1e3);r()}function getIpInfo(){debugLog("🔍 [调试] 开始获取IP信息"),debugLog("🔍 [调试] clock_default_rectangle_enable:",clock_default_rectangle_enable),debugLog("🔍 [调试] clock_rectangle:",clock_rectangle),debugLog("🔍 [调试] qweather_key:",qweather_key?"已配置":"未配置"),debugLog("🔍 [调试] gaud_map_key:",gaud_map_key?"已配置":"未配置");let e={city:"",qweather_url:""};function c(){return debugLog("🔍 [调试] 开始获取默认城市，使用坐标:",clock_rectangle),fetch(`https://restapi.amap.com/v3/geocode/regeo?key=${gaud_map_key}&location=${clock_rectangle}`).then(e=>e.json()).then(c=>{if(debugLog("🔍 [调试] 逆地理编码响应:",c),"1"===c.status){const a=c.regeocode.addressComponent,t=Array.isArray(a.city)?a.province:a.city;return debugLog("🔍 [调试] 获取到的默认城市:",t),e.city=t,t}return debugLog("🔍 [调试] 逆地理编码失败，返回未知城市"),"未知城市"}).catch(e=>(debugLog("🔍 [调试] 获取默认城市失败:",e),"未知城市"))}"true"===clock_default_rectangle_enable&&e?(debugLog("🔍 [调试] 使用固定坐标模式"),fetch(`https://restapi.amap.com/v3/geocode/regeo?key=${gaud_map_key}&location=${clock_rectangle}`).then(e=>e.json()).then(e=>{if("1"===e.status){const c=e.regeocode.addressComponent;return Array.isArray(c.city)?c.province:c.city}}).then(c=>{fetch(`https://devapi.qweather.com/v7/weather/now?location=${clock_rectangle}&key=${qweather_key}`).then(e=>e.json()).then(a=>{if(document.getElementById("hexo_electric_clock")){clockUpdateTime(a,Array.isArray(c)?e.city:c)}})})):(debugLog("🔍 [调试] 开始动态IP定位流程"),fetch("https://v.api.aa1.cn/api/myip/index.php?aa1=json").then(e=>e.json()).then(e=>{const c=e.myip;return debugLog("🔍 [调试] 获取到用户IP:",c),debugLog("🔍 [调试] 开始高德地图IP定位，IP:",c),fetch(`https://restapi.amap.com/v3/ip?key=${gaud_map_key}&ip=${c}`)}).then(e=>e.json()).then(a=>{debugLog("🔍 [调试] 高德地图定位完整结果:",a),debugLog("🔍 [调试] 检测到的城市:",a.city),debugLog("🔍 [调试] 检测到的省份:",a.province),debugLog("🔍 [调试] rectangle字段:",a.rectangle),debugLog("🔍 [调试] rectangle是否为数组:",Array.isArray(a.rectangle));let t=Array.isArray(a.rectangle)?clock_rectangle:a.rectangle.split(";")[0];if(e.qweather_url=`https://devapi.qweather.com/v7/weather/now?location=${t}&key=${qweather_key}`,Array.isArray(a.rectangle))debugLog("🔍 [调试] IP定位失败，rectangle为数组，使用备用坐标"),c().then(c=>{debugLog("🔍 [调试] IP定位失败分支，获取到默认城市:",c),debugLog("🔍 [调试] IP定位失败分支，天气API URL:",e.qweather_url),fetch(e.qweather_url).then(e=>e.json()).then(e=>{debugLog("🔍 [调试] IP定位失败分支，天气数据:",e),document.getElementById("hexo_electric_clock")&&(debugLog("🔍 [调试] IP定位失败分支，最终显示城市:",c),clockUpdateTime(e,c))})});else{debugLog("🔍 [调试] IP定位成功，rectangle不是数组");const t=a.city||a.province;debugLog("🔍 [调试] 从IP定位获取的城市信息:",t),t?(debugLog("🔍 [调试] IP定位成功分支，直接使用IP城市:",t),debugLog("🔍 [调试] IP定位成功分支，天气API URL:",e.qweather_url),fetch(e.qweather_url).then(e=>e.json()).then(e=>{debugLog("🔍 [调试] IP定位成功分支，天气数据:",e),document.getElementById("hexo_electric_clock")&&(debugLog("🔍 [调试] IP定位成功分支，最终显示城市:",t),clockUpdateTime(e,t))})):(debugLog("🔍 [调试] IP定位成功但无城市信息，使用默认城市"),c().then(c=>{debugLog("🔍 [调试] IP定位无城市分支，获取到默认城市:",c),debugLog("🔍 [调试] IP定位无城市分支，天气API URL:",e.qweather_url),fetch(e.qweather_url).then(e=>e.json()).then(e=>{debugLog("🔍 [调试] IP定位无城市分支，天气数据:",e),document.getElementById("hexo_electric_clock")&&(debugLog("🔍 [调试] IP定位无城市分支，最终显示城市:",c),clockUpdateTime(e,c))})}))}}).catch(a=>{debugLog("🔍 [调试] 第三方IP API失败，使用备用方案:",a),debugLog("🔍 [调试] 开始备用方案：直接使用高德地图IP定位"),fetch(`https://restapi.amap.com/v3/ip?key=${gaud_map_key}`).then(e=>e.json()).then(a=>{debugLog("🔍 [调试] 备用方案高德地图定位结果:",a),debugLog("🔍 [调试] 备用方案检测到的城市:",a.city),debugLog("🔍 [调试] 备用方案检测到的省份:",a.province),debugLog("🔍 [调试] 备用方案rectangle字段:",a.rectangle),debugLog("🔍 [调试] 备用方案rectangle是否为数组:",Array.isArray(a.rectangle));let t=Array.isArray(a.rectangle)?clock_rectangle:a.rectangle.split(";")[0];if(e.qweather_url=`https://devapi.qweather.com/v7/weather/now?location=${t}&key=${qweather_key}`,debugLog("🔍 [调试] 备用方案天气API URL:",e.qweather_url),Array.isArray(a.rectangle))debugLog("🔍 [调试] 备用方案IP定位失败，使用默认坐标"),c().then(c=>{debugLog("🔍 [调试] 备用方案获取到默认城市:",c),fetch(e.qweather_url).then(e=>e.json()).then(e=>{debugLog("🔍 [调试] 备用方案天气数据:",e),document.getElementById("hexo_electric_clock")&&(debugLog("🔍 [调试] 备用方案最终显示城市:",c),clockUpdateTime(e,c))})});else{debugLog("🔍 [调试] 备用方案IP定位成功");const t=a.city||a.province;debugLog("🔍 [调试] 备用方案从IP获取的城市:",t),t?(debugLog("🔍 [调试] 备用方案直接使用IP城市:",t),fetch(e.qweather_url).then(e=>e.json()).then(e=>{debugLog("🔍 [调试] 备用方案天气数据:",e),document.getElementById("hexo_electric_clock")&&(debugLog("🔍 [调试] 备用方案最终显示城市:",t),clockUpdateTime(e,t))})):c().then(c=>{fetch(e.qweather_url).then(e=>e.json()).then(e=>{document.getElementById("hexo_electric_clock")&&clockUpdateTime(e,c)})})}})}))}getIpInfo();